<html>
<head>
	<script>const Spyral = window.Spyral || {};</script>
	<script src="../table.js"></script>
	<script src="test.js"></script>
</head>
<body>
<div id="table1"></div>
<div id="table2"></div>
<script>
	let table;
	
	// empty table
	table = createTable();
	equals(table.rows(),0);
	equals(table.columns(),0);
	error(() => table.cell(0,0), "The requested row does not exist: 0");

	// table with a single value
	table = createTable(1);
	equals(table.rows(),1);
	equals(table.columns(),1);
	equals(table.cell(0,0), 1);
	
	// table with a multiple values
	table = createTable(1,2);
	equals(table.rows(),2);
	equals(table.columns(),1);
	equals(table.cell(0,0), 1);

	// table with a multiple values
	table = createTable(1,2,true);
	equals(table.rows(),3);
	equals(table.columns(),1);
	equals(table.cell(2,0), true);
	
	// table with config and multiple values
	table = createTable({headers: ["val"]}, 1 ,2, true);
	equals(table.rows(),3);
	equals(table.columns(),1);
	equals(table.cell(2,0), true);
	
	// table with config and multiple values
	table = createTable({headers: ["ind","val"]}, [0,1] , [1,2], [2,true]);
	equals(table.rows(),3);
	equals(table.columns(),2);
	equals(table.cell(2,1), true);
	
	// table with a single array
	table = createTable([1]);
	equals(table.rows(),1);
	equals(table.columns(),1);
	equals(table.cell(0,0), 1);
	
	// table with a single array with multiple values
	table = createTable([1,2]);
	equals(table.rows(),2);
	equals(table.columns(),1);
	equals(table.cell(0,0), 1);
	
	// table with double array
	table = createTable([[1,2],[3,4]]);
	equals(table.rows(),2);
	equals(table.columns(),2);
	equals(table.cell(1,1), 4);

	// table with single array
	table = createTable(["one","two","two","three","three","three"]);
	equals(table.rows(),6);
	equals(table.columns(),1);
	equals(table.cell(2,0), "two");

	let words = ["one","two","two","three","three","three"];
	
	// table with single array to be counted
	table = createTable(words, {count: true});
	equals(table.rows(),1);
	equals(table.columns(),3);
	equals(table.cell(0,"two"), 2);
	table.rowSort(); // unchanged
	equals(table.rows(),1);
	equals(table.columns(),3);
	equals(table.cell(0,"two"), 2);
	table.rowSort(1); // unchanged
	equals(table.rows(),1);
	equals(table.columns(),3);
	equals(table.cell(0,"two"), 2);
	table.columnSort(); // sort by alphabetic order
	equals(table.rows(),1);
	equals(table.columns(),3);
	equals(table.cell(0,0), 1);
	equals(table.cell(0,1), 3);
	equals(table.cell(0,2), 2);
	table.setColumn("four", 4, true);
	equals(table.rows(),1);
	equals(table.columns(),4);
	equals(table.cell(0,3), 4);
	equals(table.cell(0,"four"), 4);
	table.setColumn("five", [5], true);
	equals(table.rows(),1);
	equals(table.columns(),5);
	equals(table.cell(0,4), 5);
	equals(table.cell(0,"five"), 5);
	equals(table.rowRollingMean(0,1)[4], 4.5);
	table.rowRollingMean(0,1,true);
	equals(table.rows(),1);
	equals(table.columns(),5);
	equals(table.cell(0,4), 4.5);
	equals(table.cell(0,"five"), 4.5);

	// table with single array to be counted
	table = createTable(words, {count: "vertical", rowKeyColumn: 0, headers: ["item","count"]});
	equals(table.rows(),3);
	equals(table.columns(),2);
	equals(table.cell(0,0), "three");
	equals(table.cell(0,1), 3);
	equals(table.cell("one",1), 1);
	equals(table.cell("one","count"), 1);
	table.rowSort();
	equals(table.rows(),3);
	equals(table.columns(),2);
	equals(table.cell(2,0), "two"); // from row 1 to row 2
	table.rowSort("count", {reverse: true});
	equals(table.rows(),3);
	equals(table.columns(),2);
	equals(table.cell(2,0), "one"); // from row 1 to row 2
	table.rowSort((a,b) => a[0].localeCompare(b[0]));
	equals(table.rows(),3);
	equals(table.columns(),2);
	equals(table.cell(2,0), "two"); // sorted alphabetically at end
	table.rowSort((a,b) => b.item.localeCompare(a.item), {asObject: true});
	equals(table.rows(),3);
	equals(table.columns(),2);
	equals(table.cell(2,0), "one"); // reverse sorted alphabetically at end

	table.columnSort(); // sort by column name
	equals(table.rows(),3);
	equals(table.columns(),2);
	equals(table.header(0), "count");
	equals(table.cell(2,0), 1); // reverse sorted alphabetically at end
	equals(table.toCsv(), "count,item\n2,two\n3,three\n1,one");
	equals(table.toTsv(), "count	item\n2	two\n3	three\n1	one");
	equals(table.toString(), "<table class='spyral-table'><thead><tr><th>count</th><th>item</th></tr></thead><tbody><tr><td>2</td><td>two</td></tr><tr><td>3</td><td>three</td></tr><tr><td>1</td><td>one</td></tr></tbody></table>");
	table.html("#table1");
	table.html(document.getElementById("table2"))
	equals(document.querySelectorAll("table").length, 2)

	// make sure we get same thing from CSV
	let newTable = createTable(table.toCsv());
	equals(newTable.rows(),3);
	equals(newTable.columns(),2);
	equals(newTable.header(0), "count");

	// table adding rows with chaining
	table = createTable({headers: ["item","count"]});
	table.addRow("one", 1).addRow(["two", 2]);
	table.setCell(2,0,"three").setCell(2,1,3);
	equals(table.rows(),3);
	equals(table.columns(),2);
	equals(table.cell(0,0), "one");
	equals(table.cell(0,1), 1);
	equals(table.cell(1,"item"), "two");
	equals(table.cell("three", "count"), 3);
	let rows = table.rows(true);
	equals(rows.length, 3);
	equals(rows[0][0], "one");
	equals(rows[2][1], 3);
	rows = table.rows(2); // single
	equals(rows.length, 1);
	equals(rows[0][0], "three");
	equals(rows[0][1], 3);
	rows = table.rows(1,2); // varargs
	equals(rows.length, 2);
	equals(rows[0][0], "two");
	equals(rows[0][1], 2);
	rows = table.rows([0,2]); // array
	equals(rows.length, 2);
	equals(rows[0][0], "one");
	equals(rows[0][1], 1);
	rows = table.rows([0,2], {zip: true}); // array
	equals(rows.length, 2);
	equals(rows[0][0], "one");
	equals(rows[0][1], "three");
	equals(rows[1][0], 1);
	equals(rows[1][1], 3);
	let counts = table.columnCounts(0);
	equals(counts.one, 1);
	counts = table.columnCounts(1);
	equals(counts["1"], 1);
	counts = table.rowCounts(0);
	equals(counts.one, 1);
	
	
</script>
</body>
</html>