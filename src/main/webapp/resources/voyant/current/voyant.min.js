/* This file created by JSCacher. Last modified: Wed Dec 16 15:30:57 PST 2015 */
function Bubblelines(a){this.container=a.container;this.externalClickHandler=a.clickHandler;this.INTERVAL=50;this.DISMISS_DELAY=2500;this.UNIFORM_LINE_LENGTH=!0;this.SEPARATE_LINES_FOR_TERMS=!1;this.MAX_LINE_WIDTH=this.MAX_LABEL_WIDTH=0;this.DRAW_TITLES=!0;this.DRAW_SHORT_TITLES=!1;this.graphSeparation=this.MIN_GRAPH_SEPARATION=50;this.yIndex=0;this.mouseOver=!1;this.clearToolTipId=this.intervalId=null;this.overBubbles=[];this.lastClickedBubbles={};this.ctx=this.canvas=this.dragInfo=null;this.maxDocLength=
2;this.maxFreq={term:null,value:0};this.maxRadius=0;this.cache=new Ext.util.MixedCollection;this.currentTerms={};this.termsFilter=[];this.bubbleSpacing=50;this.initialized=!1}
Bubblelines.prototype={constructor:Bubblelines,initializeCanvas:function(){var a=this.container,b=a.getHeight(),c=a.getWidth();this.DRAW_SHORT_TITLES=500>c;var d=Ext.id("bubblelines");a.add({xtype:"container",width:c,height:b,html:'\x3ccanvas id\x3d"'+d+'" width\x3d"'+c+'" height\x3d"'+b+'"\x3e\x3c/canvas\x3e',border:!1,listeners:{afterrender:{fn:function(a){this.canvas=document.getElementById(d);this.ctx=this.canvas.getContext("2d");this.canvas.addEventListener("click",this.clickHandler.bind(this),
!1);this.canvas.addEventListener("mousedown",this.mouseDownHandler.bind(this),!1);this.canvas.addEventListener("mouseup",this.mouseUpHandler.bind(this),!1);this.canvas.addEventListener("mousemove",this.moveHandler.bind(this),!1);this.canvas.addEventListener("mouseenter",this.mouseEnterHandler.bind(this),!1);this.canvas.addEventListener("mouseleave",this.mouseLeaveHandler.bind(this),!1)},single:!0,scope:this}}});a.updateLayout();this.initialized=!0},doBubblelinesLayout:function(){if(this.initialized){var a=
this.container.getWidth();this.DRAW_SHORT_TITLES=500>a;this.setTitleWidthsAndMaxTitleWidth();for(var b=Ext.DomQuery.jsSelect("div:not(div[class*\x3dterm])",this.container.el.dom),c=0;c<b.length;c++)Ext.fly(b[c]).setWidth(a);this.canvas.width=a;b=75;this.DRAW_SHORT_TITLES&&(b=50);this.setMaxLineWidth(a-this.MAX_LABEL_WIDTH-b);this.setLineLengths();this.recache();this.setCanvasHeight();this.drawGraph()}},addDocToCache:function(a){this.cacheBubbles(a);this.calculateBubbleRadii(a);a.lineLength=600;a.freqCounts=
{};!1===this.cache.containsKey(a.id)?this.cache.add(a):this.cache.replace(a.id,a);this.cache.sort("index","ASC")},addTermsToDoc:function(a,b){var c,d;for(d in a)c=d;this.currentTerms[c]=!0;c=this.cache.get(b);Ext.apply(c.terms,a);this.cacheBubbles(c)?this.recache():this.calculateBubbleRadii(c)},cacheBubbles:function(a){var b=!1,c;for(c in a.terms){for(var d=a.terms[c],e=d.distributions.length,f=a.lineLength/e,g=[],h=0,k=0,l=0,m=0;m<e;m++){var n=d.distributions[m];n>k&&(k=n);g.push({id:Ext.id(null,
"bub"),x:l,freq:n,radius:0,bin:m,tokenPositions:d.positions.slice(h,h+=n)});l+=f}a.terms[c].maxDistribution=k;a.terms[c].pos=g;k>this.maxFreq.value&&(b=!0,this.setMaxFreq({term:c,value:k}))}return b},calculateBubbleRadii:function(a,b){var c=Math.log(this.maxFreq.value),d=Math.log(2)/2,e;for(e in a.terms){var f=a.terms[e];if(f&&(null==b||e==b))for(var g=0;g<f.pos.length;g++){var h=f.pos[g];if(0<h.freq){var k=Math.max(Math.log(h.freq),d)/c*this.maxRadius;h.radius=k}else h.radius=0}}},recache:function(){this.cache.each(function(a){this.cacheBubbles(a);
this.calculateBubbleRadii(a)},this)},getTotalHeight:function(){var a=this.maxRadius;this.cache.each(function(b,c,d){a+=b.height},this);return a},setCanvasHeight:function(){this.calculateGraphHeights();var a=this.getTotalHeight(),b=this.container.dom;if(void 0!==b)for(var b=Ext.DomQuery.jsSelect("div",b),c=0;c<b.length;c++)Ext.fly(b[c]).setHeight(a);this.canvas.height=a},setMaxLineWidth:function(a){this.maxRadius=a/30;this.MAX_LINE_WIDTH=a-this.maxRadius/2},calculateGraphHeights:function(){var a=.5*
this.maxRadius;if(this.SEPARATE_LINES_FOR_TERMS){var b=this.termsFilter;this.cache.each(function(c,e,f){e=this.maxRadius*b.length;for(f=0;f<b.length;f++)c.terms[b[f]]||(e-=this.maxRadius);0==e&&(e=this.maxRadius);c.height=e+a},this)}else{var c=Math.max(this.maxRadius,this.MIN_GRAPH_SEPARATION);this.cache.each(function(b,e,f){b.height=c+a},this)}},findLongestDocument:function(a){a=a.getTotalWordTokens();a>this.maxDocLength&&(this.maxDocLength=a)},getTitleWidth:function(a){var b=a.title;this.DRAW_SHORT_TITLES&&
(b=this.cache.indexOf(a)+1+")");this.ctx.textBaseline="top";this.ctx.font="bold 12px Verdana";return this.ctx.measureText(b).width},setTitleWidthsAndMaxTitleWidth:function(){this.cache.each(function(a,b){var c=this.getTitleWidth(a);a.titleWidth=c;c>this.MAX_LABEL_WIDTH&&(this.MAX_LABEL_WIDTH=c)},this)},setLineLengths:function(){this.cache.each(function(a,b){var c;c=this.UNIFORM_LINE_LENGTH?this.MAX_LINE_WIDTH:Math.log(a.getTotalWordTokens())/Math.log(this.maxDocLength)*this.MAX_LINE_WIDTH;a.lineLength=
c},this)},drawGraph:function(a){null!=this.intervalId&&clearInterval(this.intervalId);this.mouseOver?this.intervalId=setInterval(this.doDraw.bind(this,[a]),this.INTERVAL):setTimeout(this.doDraw.bind(this,[a]),5)},doDraw:function(a){this.clearCanvas();this.yIndex=this.maxRadius;!0===a&&(this.yIndex+=30);this.cache.each(this.drawDocument,this);!0===a?this.drawLegend():this.drawToolTip();this.doDrag()},drawDocument:function(a,b,c){if(!a.hidden){var d=a.lineLength,e=this.MAX_LABEL_WIDTH-a.titleWidth,
f=5;this.ctx.textBaseline="top";this.ctx.font="bold 12px Verdana";if(null!=this.dragInfo&&this.dragInfo.oldIndex==b)this.ctx.fillStyle="rgba(128, 128, 128, 0.5)",f+=e,this.ctx.fillText(a.title,f,this.yIndex),this.SEPARATE_LINES_FOR_TERMS&&(this.yIndex+=a.height);else{c=function(){f=g.MAX_LABEL_WIDTH+g.maxRadius;g.ctx.strokeStyle="rgba(128, 128, 128, 1.0)";g.ctx.fillStyle="rgba(128, 128, 128, 1.0)";g.ctx.lineWidth=.25;g.ctx.beginPath();g.ctx.moveTo(f,g.yIndex-6);g.ctx.lineTo(f,g.yIndex+6);g.ctx.stroke();
g.ctx.beginPath();g.ctx.moveTo(f,g.yIndex);g.ctx.lineTo(f+d,g.yIndex);g.ctx.stroke();g.ctx.beginPath();g.ctx.moveTo(f+d,g.yIndex-6);g.ctx.lineTo(f+d,g.yIndex+6);g.ctx.stroke()};this.DRAW_TITLES&&(f+=e,this.ctx.fillStyle="rgba(128, 128, 128, 1.0)",e=a.title,this.DRAW_SHORT_TITLES&&(e=b+1+")"),this.ctx.fillText(e,f,this.yIndex));this.yIndex+=4;var g=this;this.SEPARATE_LINES_FOR_TERMS?null!=this.termsFilter&&0!==this.termsFilter.length||c():c();var e=2*Math.PI,h=0;a.freqCounts={};var k=a.terms,l=null!=
this.lastClickedBubbles[b],m=0,n;for(n in k)if(-1!==this.termsFilter.indexOf(n)){var q=k[n];if(q){m++;this.SEPARATE_LINES_FOR_TERMS&&c();var r=0,p=q.color.join(",");this.ctx.strokeStyle="rgba("+p+", 1)";this.ctx.fillStyle="rgba("+p+", 0.35)";this.ctx.lineWidth=.25;for(var h=h+q.rawFreq,r=r+q.rawFreq,s=l&&this.lastClickedBubbles[b][n],t=0;t<q.pos.length;t++){var u=q.pos[t];if(0<u.radius){var x=!1;s&&this.lastClickedBubbles[b][n]==u.id&&(this.ctx.strokeStyle="rgba(0, 0, 0, 0.75)",this.ctx.fillStyle=
"rgba("+p+", 0.5)",this.ctx.lineWidth=1,x=!0);this.ctx.beginPath();this.ctx.arc(u.x+f,this.yIndex,u.radius,0,e,!0);this.ctx.closePath();this.ctx.fill();this.ctx.stroke();x&&(this.ctx.strokeStyle="rgba("+p+", 1)",this.ctx.fillStyle="rgba("+p+", 0.35)",this.ctx.lineWidth=.25)}}a.freqCounts[n]=r;this.SEPARATE_LINES_FOR_TERMS&&(this.ctx.fillStyle="rgba(0, 0, 0, 1.0)",this.ctx.font="10px Verdana",this.ctx.fillText(r,f+d+5,this.yIndex-4),this.yIndex+=this.maxRadius)}}this.SEPARATE_LINES_FOR_TERMS&&0==m&&
(c(),this.ctx.fillStyle="rgba(0, 0, 0, 1.0)",this.ctx.font="10px Verdana",this.ctx.fillText(0,f+d+5,this.yIndex-4),this.yIndex+=this.maxRadius);f+=d;this.SEPARATE_LINES_FOR_TERMS||(this.ctx.fillStyle="rgba(0, 0, 0, 1.0)",this.ctx.font="10px Verdana",this.ctx.fillText(h,f+5,this.yIndex-4))}this.yIndex=this.SEPARATE_LINES_FOR_TERMS?this.yIndex+.5*this.maxRadius:this.yIndex+a.height;this.yIndex-=4}},drawLegend:function(){var a=this.MAX_LABEL_WIDTH+this.maxRadius;this.ctx.textBaseline="top";this.ctx.font=
"16px serif";this.typeStore&&this.typeStore.each(function(b){var c=b.get("color").join(",");this.ctx.fillStyle="rgb("+c+")";b=b.get("type");this.ctx.fillText(b,a,5);b=this.ctx.measureText(b).width;a+=b+8},this)},drawToolTip:function(){if(0<this.overBubbles.length){this.ctx.lineWidth=.5;this.ctx.fillStyle="rgba(224, 224, 224, 0.8)";this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)";var a=this.overBubbles[0].x,b=this.overBubbles[0].y;a+110>this.canvas.width&&(a-=110);var c;if(null==this.overBubbles[0].label){var d=
this.cache.get(this.overBubbles[0].docIndex);c=1;for(var e in d.freqCounts)c++;c*=16;b+c>this.canvas.height&&(b-=c);this.ctx.fillRect(a,b,110,c);this.ctx.strokeRect(a,b,110,c);a+=10;b+=10;this.ctx.fillStyle="rgba(0, 0, 0, 0.8)";this.ctx.font="10px Verdana";for(e in d.freqCounts)this.ctx.fillText(e+": "+d.freqCounts[e],a,b,90),b+=16}else for(c=16*this.overBubbles.length+10,b+c>this.canvas.height&&(b-=c),this.ctx.fillRect(a,b,110,c),this.ctx.strokeRect(a,b,110,c),a+=10,b+=10,this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",
this.ctx.font="10px Verdana",d=0;d<this.overBubbles.length;d++)e=this.overBubbles[d],this.ctx.fillText(e.label+": "+e.freq,a,b,90),b+=16;null==this.clearToolTipId&&(this.clearToolTipId=setTimeout(this.clearToolTip.bind(this),this.DISMISS_DELAY))}},clearToolTip:function(){this.overBubbles=[];clearTimeout(this.clearToolTipId);this.clearToolTipId=null},mouseEnterHandler:function(a){this.mouseOver=!0;this.drawGraph()},mouseLeaveHandler:function(a){this.mouseOver=!1;null!=this.intervalId&&clearInterval(this.intervalId);
this.overBubbles=[];this.drawGraph()},moveHandler:function(a){this.clearToolTip();this.overBubbles=[];var b=a.layerX-this.MAX_LABEL_WIDTH,c=a.layerY,d=.25*this.maxRadius,e=-1;this.cache.each(function(a,b,f){if(c<d)return!1;d+=a.height;if(c<d)return e=b,!1},this);if(null!=this.dragInfo)this.dragInfo.x=a.layerX,this.dragInfo.y=c,e>=this.cache.getCount()?e=this.cache.getCount()-1:0>e&&(e=c+this.maxRadius>this.canvas.height?this.cache.getCount()-1:0),this.dragInfo.newIndex=e,document.body.style.cursor=
"move";else if(0<=e&&e<this.cache.getCount())if(0<=b){var f=!1,b=b-this.maxRadius,g=this.cache.get(e);if(b>=g.lineLength)this.overBubbles=[{docIndex:e,x:a.layerX+10,y:a.layerY+10}];else{var b=Math.round(b/(g.lineLength/this.bubbleSpacing)),h=this.maxRadius;0<e&&(h=d-(this.cache.get(e).height-.75*this.maxRadius));var h=Math.round((c-h)/this.maxRadius),k=0,l;for(l in g.terms)if(-1!==this.termsFilter.indexOf(l)){var m=g.terms[l];m?(this.SEPARATE_LINES_FOR_TERMS&&k==h||!this.SEPARATE_LINES_FOR_TERMS)&&
m.pos[b]&&0<m.pos[b].radius&&(f=!0,this.overBubbles.push({label:l,type:m,docId:g.id,docIndex:e,xIndex:b,yIndex:h,freq:m.pos[b].freq,id:m.pos[b].id,tokenPositions:m.pos[b].tokenPositions,x:a.layerX+10,y:a.layerY+10})):this.SEPARATE_LINES_FOR_TERMS&&k--;k++}}document.body.style.cursor=f?"pointer":"auto"}else document.body.style.cursor="move";else document.body.style.cursor="auto"},mouseDownHandler:function(a){var b=a.layerX,c=a.layerY;if(b<this.MAX_LABEL_WIDTH){var d=.25*this.maxRadius,e=-1;this.cache.each(function(a,
b,h){if(c<d)return!1;d+=a.height;if(c<d)return e=b,!1},this);0<=e&&e<this.cache.getCount()&&(this.dragInfo={oldIndex:e,newIndex:e,xOffset:b-5,yOffset:5,x:b,y:c})}},mouseUpHandler:function(a){this.dragInfo=null},doDrag:function(){if(null!=this.dragInfo){for(var a={},b=0;b<this.cache.getCount();b++)b<this.dragInfo.oldIndex&&b<this.dragInfo.newIndex?a[b]=b:b<this.dragInfo.oldIndex&&b>=this.dragInfo.newIndex?a[b]=b+1:b==this.dragInfo.oldIndex?a[b]=this.dragInfo.newIndex:b>this.dragInfo.oldIndex&&b>this.dragInfo.newIndex?
a[b]=b:b>this.dragInfo.oldIndex&&b<=this.dragInfo.newIndex&&(a[b]=b-1);this.dragInfo.oldIndex=this.dragInfo.newIndex;this.cache.reorder(a);a=this.cache.get(this.dragInfo.oldIndex);this.ctx.fillStyle="rgba(128, 128, 128, 1)";this.ctx.textBaseline="top";this.ctx.font="bold 12px Verdana";this.ctx.fillText(a.title,this.dragInfo.x-this.dragInfo.xOffset,this.dragInfo.y-this.dragInfo.yOffset)}},clickHandler:function(a){this.lastClickedBubbles={};if(0<this.overBubbles.length&&this.overBubbles[0].label){a=
[];for(var b=[],c=[],d=0;d<this.overBubbles.length;d++){var e=this.overBubbles[d];c.push({term:e.label,docIndex:e.docIndex,docId:e.docId,tokenPositions:e.tokenPositions});null==this.lastClickedBubbles[e.docIndex]&&(this.lastClickedBubbles[e.docIndex]={});this.lastClickedBubbles[e.docIndex][e.label]=e.id;a.push(e.docId+":"+e.label);b.push(e.tokenPositions)}b=Ext.flatten(b);b.sort();void 0!==this.externalClickHandler&&this.externalClickHandler(c)}this.overBubbles=[]},setMaxFreq:function(a){null==a&&
(a=this.findMaxFreq());this.maxFreq=a},findMaxFreq:function(){var a={term:"",value:0};this.cache.each(function(b){for(var c in b.terms){var d=b.terms[c].maxDistribution;d>a.value&&(a={term:c,value:d})}},this);return a},getNewColor:function(){for(var a=null,b=0;b<this.colors.length&&(a=this.colors[b],-1!=this.typeStore.findExact("color",a));b++)a=null;null==a&&(a=[128,128,128]);return a},removeAllTerms:function(){this.cache.each(function(a){a.terms={}},this);this.currentTerms={};this.termsFilter=[]},
removeTerm:function(a){delete this.currentTerms[a];var b=!1;this.cache.each(function(c){for(var d in c.terms)d==a&&(this.maxFreq.term==a&&(this.maxFreq={term:null,value:0},b=!0),delete c.terms[d])},this);for(var c in this.lastClickedBubbles){var d=this.lastClickedBubbles[c],e;for(e in d)e==a&&delete this.lastClickedBubbles[c][e]}b&&(this.setMaxFreq(),this.calculateBubbleRadii(),this.drawGraph())},clearCanvas:function(){this.canvas.width=this.canvas.width}};function Knots(a){this.container=a.container;this.externalClickHandler=a.clickHandler;this.MAX_LINE_LENGTH=0;this.LINE_SIZE=2.5;this.progressiveDraw=!0;this.progDrawDone=!1;this.drawStep=0;this.mouseOver=!1;this.refreshInterval=100;this.forceRedraw=!1;this.lastDrawTime=(new Date).getTime();this.intervalId=null;this.startAngle=315;this.angleIncrement=15;this.currentDoc=this.ctx=this.canvas=null;this.maxDocLength=0;this.offset={x:0,y:0};this.termsFilter=[];this.initialized=!1}
Knots.prototype={constructor:Knots,initializeCanvas:function(){var a=this.container,b=a.getHeight()-5,c=a.getWidth();this.MAX_LINE_LENGTH=Math.sqrt(c*c+b*b);var d=Ext.id("knots");a.add({xtype:"container",width:c,height:b,html:'\x3ccanvas id\x3d"'+d+'" width\x3d"'+c+'" height\x3d"'+b+'"\x3e\x3c/canvas\x3e',border:!1,listeners:{afterrender:{fn:function(a){this.canvas=document.getElementById(d);this.ctx=this.canvas.getContext("2d");this.canvas.addEventListener("click",this.clickHandler.bind(this),!1);
this.canvas.addEventListener("mousedown",this.mouseDownHandler.bind(this),!1);this.canvas.addEventListener("mouseup",this.mouseUpHandler.bind(this),!1);this.canvas.addEventListener("mousemove",this.moveHandler.bind(this),!1)},single:!0,scope:this}}});a.updateLayout();this.initialized=!0},doLayout:function(){if(this.initialized){var a=this.container.getWidth(),b=this.container.getHeight()-5;this.canvas.width=a;this.canvas.height=b;this.recache();this.buildGraph()}},buildGraph:function(a){null!=this.intervalId&&
(this.progDrawDone=!1,clearInterval(this.intervalId));this.forceRedraw=!0;this.drawStep=a||0;for(var b in this.currentDoc.terms)this.currentDoc.terms[b].done=!1;this.progressiveDraw?this.intervalId=setInterval(this.doDraw.createDelegate(this,[!1]),50):this.doDraw(!1)},drawGraph:function(a){null!=this.intervalId&&(this.progDrawDone=!1,clearInterval(this.intervalId));this.forceRedraw=!0;this.progressiveDraw?this.intervalId=setInterval(this.doDraw.createDelegate(this,[a]),50):this.doDraw(!1,a)},doDraw:function(a){var b=
(new Date).getTime();if(this.forceRedraw||b-this.lastDrawTime>=this.refreshInterval)if(this.forceRedraw=!1,this.clearCanvas(),this.ctx.save(),this.ctx.translate(this.offset.x,this.offset.y),this.drawDocument(this.currentDoc),this.originOpacity=.5,this.originColor="128,128,128",this.ctx.lineWidth=15*Math.abs(this.originOpacity-1),this.ctx.fillStyle="rgba("+this.originColor+",1.0)",this.ctx.strokeStyle="rgba("+this.originColor+","+this.originOpacity+")",this.ctx.beginPath(),this.ctx.arc(0,0,2*this.LINE_SIZE,
0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),a||this.ctx.stroke(),this.ctx.restore(),this.ctx.lineWidth=1,!0===a&&this.drawLegend(),this.lastDrawTime=(new Date).getTime(),this.progressiveDraw){a=!0;for(var c in this.currentDoc.terms)a=a&&this.currentDoc.terms[c].done;(this.progDrawDone=a)?(clearInterval(this.intervalId),this.intervalId=null):this.drawStep++}},drawDocument:function(a){a=a.terms;for(var b in a)if(-1!=this.termsFilter.indexOf(b)){var c=a[b],d=[[0,0],[0,0]];if(this.progressiveDraw){var e=
this.drawStep+1;c.pos.length<=this.drawStep?(c.done=!0,e=c.pos.length):c.done=!1;for(var f=0;f<e;f++){var g=c.pos[f];this.drawPolygon(g,d,c.color);d=[[g.polygon[0][3],g.polygon[1][3]],[g.polygon[0][2],g.polygon[1][2]]]}}else for(f=0;f<c.pos.length;f++)g=c.pos[f],this.drawPolygon(g,d,c.color),d=[[g.polygon[0][3],g.polygon[1][3]],[g.polygon[0][2],g.polygon[1][2]]]}},drawPolygon:function(a,b,c){var d=a.polygon[0],e=a.polygon[1];this.ctx.beginPath();this.ctx.moveTo(b[0][0],b[0][1]);this.ctx.lineTo(d[0],
e[0]);this.ctx.lineTo(d[1],e[1]);this.ctx.lineTo(b[1][0],b[1][1]);this.ctx.closePath();this.ctx.fillStyle="rgba("+c+", 0.6)";this.ctx.fill();this.ctx.beginPath();this.ctx.moveTo(d[0],e[0]);this.ctx.lineTo(d[1],e[1]);this.ctx.lineTo(d[2],e[2]);this.ctx.lineTo(d[3],e[3]);this.ctx.closePath();a.over&&(this.ctx.fillStyle="rgba("+c+", 1.0)");this.ctx.fill()},drawLegend:function(){var a=5;this.ctx.textBaseline="top";this.ctx.font="16px serif";this.termStore.each(function(b){var c=b.get("color");this.ctx.fillStyle=
"rgb("+c+")";b=b.get("term");this.ctx.fillText(b,a,5);b=this.ctx.measureText(b).width;a+=b+8},this)},setCurrentDoc:function(a){this.currentDoc=a;this.cacheDocument(a)},addTerms:function(a){Ext.apply(this.currentDoc.terms,a);this.recache()},removeTerm:function(a){delete this.currentDoc.terms[a];this.recache()},removeAllTerms:function(){this.currentDoc.terms={};this.recache()},recache:function(){this.MAX_LINE_LENGTH=Math.sqrt(this.canvas.width*this.canvas.width+this.canvas.height*this.canvas.height);
this.cacheDocument(this.currentDoc);this.determineGraphSizeAndPosition()},cacheDocument:function(a){a=this.MAX_LINE_LENGTH;this.currentDoc.lineLength=a;for(var b in this.currentDoc.terms)this.cacheTurns(this.currentDoc.terms[b],a)},cacheTurns:function(a,b){if(0<a.rawFreq){for(var c=this.currentDoc,d=a.term,e=[],f=a.positions,g=f[f.length-1],h=this.startAngle,k=this.angleIncrement,l=0,m=0,n=0,q=0,r=l=0;r<f.length;r++){var p=f[r],s=p/g*b,t=s-l,l=n,m=q,q=this.findEndPoint([n,q],t,h),n=q[0],q=q[1],l=
this.getPolygonFromLine([l,m],[n,q],h,this.LINE_SIZE);e.push({tokenId:p,polygon:l,over:!1});l=s;h+=k}c.terms[d].pos=e;c.terms[d].done=!1}},findEndPoint:function(a,b,c){var d=this.degreesToRadians(c);c=a[0]+b*Math.cos(d);a=a[1]+b*Math.sin(d);return[c,a]},determineGraphSizeAndPosition:function(){var a=this.findBoundingBoxForGraph(),b=a.maxX-a.minX,c=a.maxY-a.minY,d=Math.min(this.canvas.width/b,this.canvas.height/c),d=d-.05,c=c*d;this.offset.x=Math.abs(a.minX*d-(this.canvas.width/2-b*d/2));this.offset.y=
Math.abs(a.minY*d-(this.canvas.height/2-c/2));this.MAX_LINE_LENGTH=Math.sqrt(this.canvas.width*this.canvas.width+this.canvas.height*this.canvas.height)*d;this.cacheDocument(this.currentDoc)},findBoundingBoxForGraph:function(){var a=null,b=null,c=null,d=null,e;for(e in this.currentDoc.terms)for(var f=this.currentDoc.terms[e].pos,g=0;g<f.length;g++){var h=f[g].polygon,h=this.getBoundingBox(h[0],h[1]);if(null==a||h[0]<a)a=h[0];if(null==b||h[2]>b)b=h[2];if(null==c||h[1]<c)c=h[1];if(null==d||h[3]>d)d=
h[3]}return{minX:a,minY:c,maxX:b,maxY:d}},getBoundingBox:function(a,b){var c=Math.min(a[0],a[2]),d=Math.max(a[0],a[2]),e=Math.min(b[0],b[2]),f=Math.max(b[0],b[2]);return[c,e,d,f]},degreesToRadians:function(a){return Math.PI/180*a},clickHandler:function(a){var b=a.layerX-this.offset.x;a=a.layerY-this.offset.y;var c=null,d=0,e;for(e in this.currentDoc.terms)if(-1!=this.termsFilter.indexOf(e))for(var f=this.currentDoc.terms[e].pos,g=0;g<f.length;g++){var h=f[g].polygon;if(this.isPointInPolygon(h[0],
h[1],b,a)){c=e;d=f[g].tokenId;break}}c&&void 0!==this.externalClickHandler&&this.externalClickHandler({term:c,tokenId:d})},moveHandler:function(a){var b=a.layerX-this.offset.x,c=a.layerY-this.offset.y;if(null!=this.dragInfo)document.body.style.cursor="move",this.dragInfo.lastX=this.dragInfo.x,this.dragInfo.lastY=this.dragInfo.y,this.dragInfo.x=a.layerX,this.dragInfo.y=a.layerY,b=this.dragInfo.y-this.dragInfo.lastY,this.offset.x+=this.dragInfo.x-this.dragInfo.lastX,this.offset.y+=b;else{this.mouseOver=
!1;for(var d in this.currentDoc.terms)if(-1!=this.termsFilter.indexOf(d)){a=this.currentDoc.terms[d].pos;for(var e=0;e<a.length;e++)if(this.mouseOver)this.currentDoc.terms[d].pos[e].over=!1;else{var f=a[e].polygon;this.isPointInPolygon(f[0],f[1],b,c)?this.mouseOver=this.currentDoc.terms[d].pos[e].over=!0:this.currentDoc.terms[d].pos[e].over=!1}}if(this.mouseOver){if(document.body.style.cursor="pointer",!this.progressiveDraw||this.progressiveDraw&&this.progDrawDone)clearInterval(this.intervalId),this.intervalId=
setInterval(this.doDraw.createDelegate(this,[!1]),50)}else if(document.body.style.cursor="auto",!this.progressiveDraw||this.progressiveDraw&&this.progDrawDone)clearInterval(this.intervalId),this.doDraw(!1)}},mouseDownHandler:function(a){var b=a.layerX;a=a.layerY;this.dragInfo={lastX:b,lastY:a,x:b,y:a}},mouseUpHandler:function(a){this.dragInfo=null},getPolygonFromLine:function(a,b,c,d){var e=c+90,f=c-90;c=this.findEndPoint(a,d,e);a=this.findEndPoint(a,d,f);f=this.findEndPoint(b,d,f);b=this.findEndPoint(b,
d,e);return[[c[0],a[0],f[0],b[0]],[c[1],a[1],f[1],b[1]]]},isPointInPolygon:function(a,b,c,d){for(var e=0,f=3,g=!1,e=0;4>e;e++)(b[e]<d&&b[f]>=d||b[f]<d&&b[e]>=d)&&a[e]+(d-b[e])/(b[f]-b[e])*(a[f]-a[e])<c&&(g=!g),f=e;return g},clearCanvas:function(){this.canvas.width=this.canvas.width}};function Cirrus(a){function b(a){a="#"==a.charAt(0)?a.substring(1,7):a;var b=[];b.push(parseInt(a.substring(0,2),16));b.push(parseInt(a.substring(2,4),16));b.push(parseInt(a.substring(4,6),16));return b}function c(){if(0==$("#"+d.config.containerId).length)alert("You must provide a valid container ID!");else{d.canvas=document.createElement("canvas");d.canvas.setAttribute("id",e);d.canvas.setAttribute("tabIndex",1);d.setCanvasDimensions();$(f).append(d.canvas);e="#"+e;d.context=d.canvas.getContext("2d");
d.wordData=[];d.useFadeEffect=!0;d.colors=[[116,116,181],[139,163,83],[189,157,60],[171,75,75],[174,61,155]];g=new WordController(d);for(var a in d.config){"words"==a&&(d.wordData=d.config[a]);"layout"==a&&("circle"==d.config[a]?g.layout=g.CIRCLE:"square"==d.config[a]&&(g.layout=g.SQUARE));if("colors"==a&&$.isArray(d.config[a])&&0<d.config[a].length){d.colors=[];for(var c in d.config[a])d.colors.push(b(d.config[a][c]))}"background"==a&&$(e).css("background-color",d.config[a]);"fade"==a&&("true"==
d.config[a]?d.useFadeEffect=!0:"false"==d.config[a]&&(d.useFadeEffect=!1));"smoothness"==a&&(g.wordsToArrange=Math.max(1,Math.min(20,parseInt(d.config[a]))))}0<d.wordData.length&&(d.clear(),g.addWords(d.wordData),g.arrangeWords());$(window).resize(function(){null!=h&&clearTimeout(h);h=setTimeout(d.resizeWords,1E3)});$(e).keypress(function(a){114==a.which&&g.arrangeWords()});$(e).click(function(a){a=g.handleWordClick(a);void 0!==a&&d.config.clickHandler&&d.config.clickHandler({term:a.text,value:a.value})});
$(e).mouseover(function(a){g.startUpdates()});$(e).mouseout(function(a){g.stopUpdates()});$(e).mousemove(function(a){g.handleMouseMove(a)})}}var d=this;this.config=a;var e=Ext.id(null,"cirrusCanvas");if(null==this.config.containerId)alert("You must provide a valid container ID!");else{var f="#"+this.config.containerId,g=null,h=null;this.clear=function(){this.canvas.width=this.canvas.width};this.addWords=function(a){g.addWords(a)};this.arrangeWords=function(){g.arrangeWords()};this.clearAll=function(){g.setWords([]);
g.grid=[];this.clear()};this.resizeWords=function(){d.setCanvasDimensions();g.resetWordCoordinates();g.calculateSizeAdjustment();g.resizeWords();g.arrangeWords();h=null};this.setCanvasDimensions=function(){var a=$(f)[0],b=Math.max(a.offsetWidth,a.clientWidth),a=Math.max(a.offsetHeight,a.clientHeight);this.canvas.width=b;this.canvas.height=a};$(document).ready(c)}};function Word(a,b,c,d,e){this.relativeSize=this.rotation=this.width=this.height=0;this.mask=null;this.size=0;this.text=a;this.color=c;this.origSize=b;this.rolloverText=d;this.value=e||0;this.ty=this.tx=this.y=this.x=0;this.fontFamily="Arial";this.fontSize=12;this.alpha=1;this.isOver=this.live=!1;this.draw=function(a){a.save();a.fillStyle="rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+","+this.alpha+")";a.textBaseline="alphabetic";a.font=this.fontSize+"px "+this.fontFamily;a.translate(this.x+
this.tx,this.y+this.ty);a.rotate(this.rotation);a.fillText(this.text,0,0);a.restore()}};function WordController(a){function b(a){for(var b=Math.log(10*a.relativeSize)*Math.LOG10E,c=(b+a.relativeSize)/2,d=0,e=0;e<a.text.length;e++)var f=a.text.charAt(e),d="f"==f||"i"==f||"j"==f||"l"==f||"r"==f||"t"==f?d+b/3:"m"==f||"w"==f?d+b/(4/3):d+b/1.9;return c*d}function c(){p.sort(function(a,b){return a.origSize>b.origSize?-1:a.origSize<b.origSize?1:0})}function d(){for(var a=0;a<p.length;a++){var c=p[a],d;d=c;var e=f.sizeAdjustment,e=b(d)*e;d=(Math.sqrt(6)*Math.sqrt(6*Math.pow(d.text.length,2)+
e*d.text.length)-6*d.text.length)/(2*d.text.length);c.fontSize=d>f.minFontSize?d:f.minFontSize;c.fontFamily="Impact";d=c;g.context.save();g.context.textBaseline="alphabetic";g.context.font=d.fontSize+"px "+d.fontFamily;d.width=g.context.measureText(d.text).width;d.height=Math.ceil(1.15*g.context.measureText("m").width);g.context.restore();c.tx=0;c.ty=c.height;d=0;f.getWordOrientation()===f.MIXED&&null==c.text.match(/\s/)&&.66<Math.random()&&(d=c.height,c.height=c.width,c.width=d,0==Math.round(Math.random())?
(d=90,c.ty=0):(d=-90,c.ty=c.height,c.tx=c.width));c.size=Math.max(c.height,c.width);c.rotation=Math.PI/180*d;g.context.fillStyle=g.canvas.style.backgroundColor;g.context.fillRect(0,0,g.canvas.width,g.canvas.height);c.draw(g.context);d=g.context.getImageData(c.x,c.y,c.width,c.height);for(var e=[],h=0;h<c.width;h++){var k=Math.floor(h/f.COARSENESS)*f.COARSENESS;null==e[k]&&(e[k]={});for(var l=0;l<c.height;l++){var m=Math.floor(l/f.COARSENESS)*f.COARSENESS,n;n=4*(h+l*d.width);n=[d.data[n],d.data[n+1],
d.data[n+2],d.data[n+3]];"rgb("+n[0]+", "+n[1]+", "+n[2]+")"!=g.canvas.style.backgroundColor&&(e[k][m]=!0);e[k][m]&&(l=m+f.COARSENESS)}}c.mask=e}}function e(){g.clear();for(var a=p.length;a--;){var b=p[a];b.alpha=1;b.live&&b.draw(g.context)}a=$(g.canvas);if(null!=n){a.css("cursor","pointer");g.context.save();g.context.textBaseline="alphabetic";g.context.font="12px Arial";var b=g.context.measureText(n.text).width,c=g.context.measureText(n.value).width,b=(b>c?b:c)+20,c=q+15,d=r+25,e=a.width(),a=a.height();
c+b>=e&&(c-=b);d+40>=a&&(d-=40);g.context.fillStyle="rgba(255,255,255,0.9)";g.context.strokeStyle="rgba(100,100,100,0.9)";g.context.translate(c,d);g.context.fillRect(0,0,b,40);g.context.strokeRect(0,0,b,40);g.context.fillStyle="rgba(0,0,0,0.9)";g.context.fillText(n.text+":",8,18);g.context.fillText(n.value,8,30);g.context.restore()}else a.css("cursor","default")}var f=this,g=a;this.CIRCLE=0;this.ratio=1;var h=this.CIRCLE;this.getLayout=function(){return h};this.setLayout=function(a){h=a};this.HORIZONTAL=
0;var k=this.MIXED=1;this.getWordOrientation=function(){return k};this.setWordOrientation=function(a){k=a};this.UPDATE_RATE=25;this.COARSENESS=5;this.grid=[];var l=0,m;this.doingArrange=!1;this.wordsToArrange=5;var n=null,q=0,r=0,p=[];this.getWords=function(){return p};this.setWords=function(a){p=a};this.sizeAdjustment=100;this.minFontSize=12;this.largestWordSize=0;this.smallestWordSize=1E4;var s={};this.addWords=function(a){for(var b=!1,e=0;e<a.length;e++){var h=a[e],k;k=void 0==typeof h.color||
null==h.color||""==h.color?g.colors[Math.floor(Math.random()*g.colors.length)]:h.color;var l;l=void 0==typeof h.size||null==h.size||""==h.size?Math.floor(40*Math.random()):parseFloat(h.size);var m=h.word,n=h.label,q=h.value,h=!1;null==s[m]&&(s[m]=!0,l>f.largestWordSize&&(f.largestWordSize=l,h=!0),l<f.smallestWordSize&&(f.smallestWordSize=.8*l,h=!0),m=new Word(m,l,k,n,q),p.push(m));b=h||b}c();this.setRelativeSizes();this.calculateSizeAdjustment();b?this.resizeWords():d()};this.resetWordCoordinates=
function(){g.clear();clearTimeout(m);for(var a=0;a<p.length;a++){var b=p[a];b.x=0;b.y=0;b.tx=0;b.ty=0}};this.calculateSizeAdjustment=function(){this.ratio=g.canvas.width/g.canvas.height;var a=g.canvas.width*g.canvas.height;this.minFontSize=1E5>a?8:12;for(var c=0,d=0;d<p.length;d++)var e=b(p[d]),c=c+e;this.sizeAdjustment=a/c};this.setRelativeSizes=function(){for(var a=0;a<p.length;a++){var b=p[a],c=this.smallestWordSize;b.relativeSize=.1+(b.origSize-c)/(this.largestWordSize-c)*.9}};this.resizeWords=
function(){g.clear();d();c()};this.arrangeWords=function(){clearTimeout(m);g.clear();this.toggleLoadingText();if(0<p.length){var a=function(a,b,c){for(var d=0;d<c.width;d+=this.COARSENESS)for(var e=0;e<c.height;e+=this.COARSENESS)c.mask[d]&&c.mask[d][e]&&(this.grid[d+a]||(this.grid[d+a]=[]),this.grid[d+a][e+b]=c)},b=function(a){a.alpha+=.25;a.draw(g.context)},c=function(b,c,d,e){a(b,c,d);d.x=b;d.y=c;d.live=!0;e&&d.draw(g.context)},d=function(a,b,c,d,e){for(var f=0;f<=d;f+=this.COARSENESS)for(var g=
0;g<=c;g+=this.COARSENESS)if(e[f]&&e[f][g]&&null!=this.grid[f+a]&&null!=this.grid[f+a][g+b])return!0;return!1},f;this.grid=[];l=0;f=function(){var a,f,h,k,n=this.wordsToArrange-1,t=g.canvas.width,s=g.canvas.height,q=.5*t,r=.5*s;do{h=p[l];if(void 0!==h){for(var v=Math.random()*Math.PI,w=.25*Math.random()*h.size,A=.5*(Math.random()-.5),y=.5*h.width,z=.5*h.height;;){a=Math.floor((q+Math.cos(v)*w*this.ratio-y)/this.COARSENESS)*this.COARSENESS;f=Math.floor((r+Math.sin(v)*w-z)/this.COARSENESS)*this.COARSENESS;
k=a+y>=t||f+z>=s?!0:d(a,f,h.height,h.width,h.mask);if(!k)break;v+=A;w+=.05}c(a,f,h);if(g.useFadeEffect)for(a=h.alpha=0;a<l;a++)f=p[a],1>f.alpha&&b(f);else h.alpha=1,h.draw(g.context)}l++;if(l>=p.length){clearTimeout(m);this.doingArrange=!1;this.toggleLoadingText(!1);e();break}}while(n--)}.createDelegate(this);d=d.createDelegate(this);c=c.createDelegate(this);b=b.createDelegate(this);a=a.createDelegate(this);this.doingArrange=!0;m=setInterval(f,50)}else alert("Error: There are no words to arrange.")};
this.toggleLoadingText=function(a){g.context.save();g.context.fillStyle=a?"black":g.canvas.style.backgroundColor;g.context.textBaseline="top";g.context.font="10px Arial";a=g.context.measureText("Loading").width+10;g.context.fillText("Loading",g.canvas.width-a,10);g.context.restore()};this.startUpdates=function(){m=setInterval(e,f.UPDATE_RATE)};this.stopUpdates=function(){null!=n&&(n=null,e());clearTimeout(m)};this.handleMouseMove=function(a){if(!this.doingArrange){for(var b=p.length;b--;)p[b].isOver=
!1;var c=$(g.canvas).offset(),d=(a.pageX-c.left)%this.COARSENESS,b=a.pageX-c.left-d,d=(a.pageY-c.top)%this.COARSENESS;a=a.pageY-c.top-d;n=this.findWordByCoords(b,a);null!=n&&(n.isOver=!0,q=b,r=a)}};this.handleWordClick=function(a){var b=$(g.canvas).offset(),c=(a.pageX-b.left)%this.COARSENESS,d=a.pageX-b.left-c,c=(a.pageY-b.top)%this.COARSENESS;a=this.findWordByCoords(d,a.pageY-b.top-c);if(null!=a)return{text:a.text,value:a.value}};this.findWordByCoords=function(a,b){var c=null;null!=this.grid[a]&&
(null!=this.grid[a][b]?c=this.grid[a][b]:null!=this.grid[a][b+this.COARSENESS]&&(c=this.grid[a][b+this.COARSENESS]));null==c&&null!=this.grid[a+this.COARSENESS]&&(null!=this.grid[a+this.COARSENESS][b]?c=this.grid[a+this.COARSENESS][b]:null!=this.grid[a+this.COARSENESS][b+this.COARSENESS]&&(c=this.grid[a+this.COARSENESS][b+this.COARSENESS]));return c}}
Function.prototype.createDelegate=function(a,b,c){var d=this;return function(){var e=b||arguments;if(!0===c)e=Array.prototype.slice.call(arguments,0),e=e.concat(b);else if("number"==typeof c){var e=Array.prototype.slice.call(arguments,0),f=[c,0].concat(b);Array.prototype.splice.apply(e,f)}return d.apply(a||window,e)}};Ext.define("Voyant.util.Api",{constructor:function(a){a=[];if(!this.isApplication){var b=this.getApplication();this.addParentApi(a,Ext.ClassManager.getClass(b));b.getApiParams&&a.push(this.getApplication().getApiParams())}this.addParentApi(a,Ext.ClassManager.getClass(this));this.api={};a.forEach(function(a){for(c in a)this.api[c]={initial:a[c],value:a[c]}},this);a=Ext.Object.fromQueryString(document.location.search);for(var c in a)this.api[c]&&this.setApiParam(c,a[c])},addParentApi:function(a,b){b.api&&
a.splice(0,0,b.api);b.superclass&&this.addParentApi(a,b.superclass.self)},getApiParam:function(a,b){return void 0!==this.api[a]?this.api[a].value:b},getApiParams:function(a,b){a=a||Object.keys(this.api);var c={};Ext.isString(a)&&(a=[a]);a.forEach(function(a){var e=this.getApiParam(a);if(b||!Ext.isEmpty(e))c[a]=e},this);return c},getModifiedApiParams:function(){var a={},b;for(b in this.api)this.api[b].initial!=this.api[b].value&&(a[b]=this.api[b].value);return a},setApiParams:function(a){for(var b in a)this.setApiParam(b,
a[b])},setApiParam:function(a,b){this.api&&this.api[a]&&(this.api[a].value=b)}});Ext.define("Voyant.util.Localization",{statics:{DEFAULT_LANGUAGE:"en",LANGUAGE:"en"},languageStore:Ext.create("Ext.data.ArrayStore",{fields:["code","language"],data:[["en","English"]]}),getLanguage:function(a){var b=this.languageStore.findRecord(2==a.length?"code":"language",a);if(b)return b.get(2==a.length?"language":"code")},localize:function(a,b){return this._localizeObject(this,a,b)},_localizeObject:function(a,b,c){var d=this._localizeClass(Ext.ClassManager.getClass(a),b,c);if(d)return d;if(a.mixins)for(mixin in a.mixins)if(d=
this._localizeClass(Ext.ClassManager.getClass(a.mixins[mixin]),b,c))return d;return a.superclass&&(d=this._localizeObject(a.superclass,b,c))?d:c&&void 0!=c["default"]?c["default"]:"["+b+"]"},_localizeClass:function(a,b,c){if(a&&a.i18n&&a.i18n[b]){var d=!1;c&&c.lang&&a.i18n[b][c.lang]?d=a.i18n[b][c.lang]:a.i18n[b][Voyant.util.Localization.LANGUAGE]?d=a.i18n[b][Voyant.util.Localization.LANGUAGE]:a.i18n[b][Voyant.util.Localization.DEFAULT_LANGUAGE]&&(d=a.i18n[b][Voyant.util.Localization.DEFAULT_LANGUAGE]);
return d?d.isTemplate?d.apply(c):d:c&&void 0!=c["default"]?c["default"]:"["+b+"]"}return!1}});Ext.define("Voyant.util.Deferrable",{deferredStack:[],releaseAllDeferred:function(){this.deferredStack=[]},getDeferredCount:function(){return this.deferredStack.length},getDeferred:function(a){var b=jQuery.Deferred(),c=this.getPromiseFromDeferred(b);a&&a.transfer&&a.transfer(a,c);!c.show&&window.show&&(c.show=show);this.deferredStack.push(b);var d=this;c.always(function(){d.deferredStack.pop()});return b},getPromiseFromDeferred:function(a){return"object"===typeof a.promise?a.promise:a.promise()},
getDeferredNestedPromise:function(a,b,c){var d=arguments.callee.caller,e=Voyant.application.getDeferred(c);a.then(function(a){e.resolve(d.apply(a,b))}).fail(function(){e.reject.apply(this,arguments)});return e.promise}});Ext.define("Voyant.util.DetailedError",{extend:"Ext.Error",mixins:["Voyant.util.Localization"],config:{msg:void 0,error:void 0,details:void 0},statics:{i18n:{error:{en:"Error"}}},constructor:function(a){this.setMsg(a.msg);this.setError(a.error);this.setDetails(a.details);this.callParent(arguments)},show:function(a){window.showError?showError.call(this):this.showMsg(a)},showMsg:function(a){a=a||{};Ext.applyIf(a,{message:this.getMsg()+"\x3cp class\x3d'error'\x3e\n"+this.getError()+"\u2026 \x3ca href\x3d'#' onclick\x3d\"window.open('').document.write(unescape('\x3cpre\x3e"+
escape(this.getDetails())+"\x3c/pre\x3e')); return false;\"\x3emore\x3c/a\x3e\x3c/p\x3e",title:this.localize("error"),buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,autoScroll:!0});Ext.Msg.show(a)}});Ext.define("Voyant.util.ResponseError",{extend:"Voyant.util.DetailedError",config:{response:void 0},constructor:function(a){this.setResponse(a.response);Ext.applyIf(a,{msg:a.response.statusText,error:a.response.responseText.split(/(\r\n|\r|\n)/).shift(),details:a.response.responseText});this.callParent(arguments)}});Ext.define("Voyant.util.SparkLine",{getSparkLine:function(a,b){if(2>a.length)return"";for(var c=Number.MAX_VALUE,d=Number.MIN_VALUE,e=!1,f=0;f<a.length;f++)a[f]<c&&(c=a[f]),a[f]>d&&(d=a[f]),!e&&-1<a[f].toString().indexOf(".")&&(e=!0);var g=(d-c).toString(),h=1,h=1,k=[];if(e){h=100;for(f=g.indexOf(".")+1;f<g.length;f++)if("0"==g.charAt(f))h*=10;else break;for(f=0;f<a.length;f++)k[f]=parseInt(a[f]*h);d=parseInt(d*h);c=parseInt(c*h)}else{h=1;for(f=g.length-1;-1<f;f--)if("0"==g.charAt(f))h*=10;else break;
if(1!=h){for(f=0;f<a.length;f++)k[f]=a[f]/h;d/=h;c/=h}else k=a}var e=Math.floor(1800/((d.toString().length>c.toString().length?d.toString().length:c.toString().length)+1)),c="http://chart.apis.google.com/chart?cht\x3dls\x26amp;chco\x3d0077CC\x26amp;chls\x3d1,0,0\x26amp;chds\x3d"+c+","+d,d=Math.ceil(a.length/e),g=0,h="",l;l=5>a.length?5:10>a.length?4:20>a.length?3:50>a.length?2:1;for(f=0;f<d;f++){var m=k.slice(g,g+=e),h=h+("\x3cimg style\x3d'margin: 0; padding: 0;' border\x3d'0' src\x3d'"+c+"\x26amp;chs\x3d"+
l*m.length+"x15\x26amp;chd\x3dt:"+m.join(",")+"' alt\x3d'' class\x3d'chart-");1==d?h+="full":0<f&&f+1<d?h+"middle":h=0==f?h+"left":h+"right";h+="' /\x3e"}return h}});Ext.define("Voyant.util.Toolable",{requires:["Voyant.util.Localization"],statics:{i18n:{maximizeTip:{en:"Open this tool in a new window"},plusTip:{en:"Click to choose another tool for this panel location (this will replace the current tool)."},saveTip:{en:"Export a URL, an embeddable tool, data or a bibliographic reference."},gearTip:{en:"Define options for this tool."},helpTip:{en:'No tool-specific help is currently available. Click this icon to visit the \x3ca href\x3d"http://docs.voyant-tools.org/" target\x3d"_blank"\x3eVoyant Tools Documentation\x3c/a\x3e site.'},
moreHelp:{en:"More help\u2026"},exportTitle:{en:"Export"},exportViewUrl:{en:"a URL for this view (tools and data)"},exportViewFieldset:{en:"Export View (Tools and Data)"},exportViewHtmlEmbed:{en:"an HTML snippet for embedding this view in another web page"},exportViewHtmlEmbed:{en:"an HTML snippet for embedding this view in another web page"},exportViewEmbedTitle:{en:"Embed HTML Snippet"},exportViewEmbedMessage:{en:"You can copy and paste the HTML snippet from the box below into another web page. Note that some content management systems (like WordPress) may need a special plugin to handle \x26lt;iframe\x26gt; tags."},
exportBiblioTitle:{en:"Export Bibliographic Reference"},exportViewBiblio:{en:"a bibliographic reference for this view"},exportGridCurrent:{en:"Export Current Data"},exportGridCurrentHtml:{en:"export current data as HTML"},exportGridCurrentJson:{en:"export current data as JSON"},exportGridCurrentTsv:{en:"export current data as tab separated values (text)"},"export":{en:"Export"},optionsTitle:{en:"Options"},confirmTitle:{en:"Confirm"},cancelTitle:{en:"Cancel"},exportError:{en:"Export Error"},exportNoFunction:{en:"An export function has been defined by is not availble."},
exportDataHtmlMessage:{en:"Copy the data below, they can be pasted into an HTML page or used as XML."},exportDataTsvMessage:{en:"Copy data below, they can be pasted into a spreadsheet or text file."},exportDataJsonMessage:{en:"Copy the data below, they can be used in other web-based applications."},exportPng:{en:"export a PNG image of this visualization"},exportDataTitle:{en:"Export Data"},exportVizTitle:{en:"Export Visualization"},exportPngTitle:{en:"Export PNG"},exportSvg:{en:"export the SVG of this visualization"},
exportPngMessage:{en:"\x3cp\x3eThis is a thumbnail of the PNG image, right-click or ctrl-click on the image to save a full-size copy on your hard drive.\x3c/p\x3e\x3cp\x3eAlternatively, copy the HTML code below.\x3c/p\x3e"},exportSvgTitle:{en:"Export SVG"},exportSvgMessage:{en:"\x3cp\x3eThis is a thumbnail of the SVG image, right-click or ctrl-click on the image to save a full-size copy on your hard drive.\x3c/p\x3e\x3cp\x3eAlternatively, copy the SVG code below.\x3c/p\x3e"}}},constructor:function(a){a=
a||{};var b=void 0,c=this.up("component");a.moreTools?(b=[],a.moreTools.forEach(function(a){a&&a!=this.xtype&&b.push(this.getMenuItemFromXtype(a))},this)):c&&c.getInitialConfig("moreTools")&&(b=[],c.getInitialConfig("moreTools").forEach(function(a){a&&a!=this.xtype&&b.push(this.getMenuItemFromXtype(a))},this));b&&this.getApplication().getMoreTools&&b.push({xtype:"menuseparator"});if(this.getApplication().getMoreTools){var b=b||[],d=this.getApplication(),c=d.getMoreTools();c.forEach(function(a){var c=
[];a.items.forEach(function(a){c.push(this.getMenuItemFromXtype(a))},this);b.push({text:d.localize(a.i18n),glyph:a.glyph,menu:{items:c}})},this)}var e={save:{glyph:"xf08e@FontAwesome",fn:this.exportToolClick,items:void 0},plus:b?{glyph:"xf17a@FontAwesome",items:b}:void 0,gear:this.showOptionsClick||this.getOptions?{glyph:"xf205@FontAwesome",fn:this.showOptionsClick?this.showOptionsClick:function(a){a.isXType("voyanttabpanel")&&(a=a.getActiveTab());Ext.create("Ext.window.Window",{title:a.localize("optionsTitle"),
modal:!0,panel:a,items:{xtype:"form",items:a.getOptions(),buttons:[{text:a.localize("confirmTitle"),glyph:"xf00c@FontAwesome",flex:1,panel:a,handler:function(a){var b=a.up("form").getValues();this.setApiParams(b);var c=this.getApplication(),d=c.getCorpus();if(void 0!=b.stopList&&void 0!=b.stopListGlobal&&b.stopListGlobal){c.setApiParams&&c.setApiParams({stopList:b.stopList});for(var e=c.getViewport().query("panel,chart"),f=0;f<e.length;f++)e[f].setApiParams&&e[f].setApiParams({stopList:b.stopList});
d&&(c.dispatchEvent("loadedCorpus",this,d),this.fireEvent("loadedCorpus",this,d))}d&&this.fireEvent("loadedCorpus",this,d);a.up("window").close()},scope:a},{text:a.localize("cancelTitle"),glyph:"xf00d@FontAwesome",flex:1,handler:function(a){a.up("window").close()}}]},bodyPadding:5}).show()}}:void 0,help:{glyph:"xf128@FontAwesome",fn:this.helpToolClick}},c=[];if(a.includeTools)for(var f in a.includeTools)"object"==typeof a.includeTools[f]&&c.push(a.includeTools[f]);for(f in e)a.includeTools&&!a.includeTools[f]||
!e[f]||c.push({type:f,tooltip:this.localize(f+"Tip"),callback:e[f].fn,xtype:"toolmenu",glyph:e[f].glyph,items:e[f].items});Ext.apply(this,{tools:c});this.on("afterrender",function(){var a=this.getHeader();if(a){var b=a.getEl();b.on("mouseover",function(){this.getHeader().getTools().forEach(function(a){a.show()})},this);b.on("mouseout",function(){this.getHeader().getTools().forEach(function(a){"help"!=a.type&&-1==a.type.indexOf("collapse")&&a.hide()})},this);a.getTools().forEach(function(a,b){"help"!=
a.type&&a.hide()})}},this)},getMenuItemFromXtype:function(a){var b=this.getApplication().getToolConfigFromToolXtype(a);b&&b.tooltip&&delete b.tooltip;return Ext.apply(Ext.clone(b),{xtype:"menuitem",text:b.title,textAlign:"left",handler:function(){this.replacePanel(b.xtype)},scope:this})},maximizeToolClick:function(a){var b=Ext.getClass(a).getName().split(".");url=a.getBaseUrl()+"tool/"+b[b.length-1]+"/";params=a.getModifiedApiParams();!params.corpus&&a.getCorpus&&a.getCorpus()&&(params.corpus=a.getCorpus().getId());
params&&(url+="?"+Ext.Object.toQueryString(params));a.openUrl(url)},exportToolClick:function(a){a.isXType("voyanttabpanel")&&(a=a.getActiveTab());var b=[{xtype:"radio",name:"export",inputValue:"url",boxLabel:"\x3ca href\x3d'"+a.getExportUrl.call(a)+"' target\x3d'_blank'\x3e"+a.localize("exportViewUrl")+"\x3c/a\x3e",checked:!0,listeners:{afterrender:function(){this.boxLabelEl.on("click",function(){this.up("window").close()},this)}}},{xtype:"fieldset",collapsible:!0,collapsed:!0,title:a.localize("exportViewFieldset"),
items:[{xtype:"radio",name:"export",inputValue:"embed",boxLabel:a.localize("exportViewHtmlEmbed")},{xtype:"radio",name:"export",inputValue:"biblio",boxLabel:a.localize("exportViewBiblio")}]}];a.isXType("grid")&&b.push({xtype:"fieldset",collapsible:!0,collapsed:!0,title:a.localize("exportGridCurrent"),items:[{xtype:"radio",name:"export",inputValue:"gridCurrentHtml",boxLabel:a.localize("exportGridCurrentHtml")},{xtype:"radio",name:"export",inputValue:"gridCurrentTsv",boxLabel:a.localize("exportGridCurrentTsv")},
{xtype:"radio",name:"export",inputValue:"gridCurrentJson",boxLabel:a.localize("exportGridCurrentJson")}]});if((!a.getExportVisualization||a.getExportVisualization())&&(a.down("chart")||a.getTargetEl().dom.querySelector("canvas")||a.getTargetEl().dom.querySelector("svg"))){var c=[{xtype:"radio",name:"export",inputValue:"png",boxLabel:a.localize("exportPng")}];a.getTargetEl().dom.querySelector("svg")&&c.push({xtype:"radio",name:"export",inputValue:"svg",boxLabel:a.localize("exportSvg")});b.push({xtype:"fieldset",
collapsible:!0,collapsed:!0,title:a.localize("exportVizTitle"),items:c})}Ext.create("Ext.window.Window",{title:a.localize("exportTitle"),modal:!0,items:{xtype:"form",items:b,buttons:[{text:a.localize("exportTitle"),glyph:"xf08e@FontAwesome",flex:1,panel:a,handler:function(b){var c=b.up("form"),f="export"+Ext.String.capitalize(c.getValues()["export"]);Ext.isFunction(a[f])?a[f].call(a,a,c):Ext.Msg.show({title:a.localize("exportError"),message:a.localize("exportNoFunction"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});
b.up("window").close()},scope:a},{text:a.localize("cancelTitle"),glyph:"xf00d@FontAwesome",flex:1,handler:function(a){a.up("window").close()}}]},bodyPadding:5}).show()},exportSvg:function(a){if(a=this.getTargetEl().dom.querySelector("svg"))a=d3.select(a).attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML,Ext.Msg.show({title:this.localize("exportSvgTitle"),message:'\x3cimg src\x3d"data:image/svg+xml;base64,'+btoa(a)+'" style\x3d"float: right; max-width: 200px; max-height: 200px; border: thin dotted #ccc;"/\x3e'+
this.localize("exportSvgMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:a})},exportPngData:function(a){Ext.Msg.show({title:this.localize("exportPngTitle"),message:'\x3cimg src\x3d"'+a+'" style\x3d"float: right; max-width: 200px; max-height: 200px; border: thin dotted #ccc;"/\x3e'+this.localize("exportPngMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:'\x3cimg src\x3d"'+a+'" /\x3e'})},exportPng:function(){var a;if(this.down("chart"))return this.exportPngData(this.down("chart").getImage().data);
var b=this.getTargetEl().dom.querySelector("canvas");if(b)return this.exportPngData(b.toDataURL("image/png"));var c=this.getTargetEl().dom.querySelector("svg");if(c){var d=d3.select(c).attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;a="data:image/svg+xml;base64,"+btoa(d);var b=Ext.DomHelper.createDom({tag:"canvas",width:c.offsetWidth,height:c.offsetHeight}),e=b.getContext("2d"),f=new Image;f.src=a;f.panel=this;f.onload=function(){e.drawImage(f,0,0);a=b.toDataURL("image/png");
return this.panel.exportPngData.call(this.panel,a)}}},exportUrl:function(){this.openUrl(this.getExportUrl())},exportEmbed:function(){Ext.Msg.show({title:this.localize("exportViewEmbedTitle"),message:this.localize("exportViewEmbedMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:"\x3c!--\tExported from Voyant Tools: http://voyant-tools.org/.\nPlease note that this is an early version and the API may change.\nFeel free to change the height and width values below: --\x3e\n\x3ciframe style\x3d'width: 100%; height: 800px' src\x3d'"+
this.getExportUrl()+"'\x3e\x3c/iframe\x3e"})},exportBiblio:function(){var a=new Date;Ext.Msg.show({title:this.localize("exportBiblioTitle"),message:"\x3cfieldset\x3e\x3clegend\x3eMLA\x3c/legend\x3eSinclair, St\u00e9fan and Geoffrey Rockwell. "+(this.isXType("voyantheader")?"":'"'+this.localize("title")+'." ')+"\x3ci\x3eVoyant Tools\x3c/i\x3e. "+Ext.Date.format(a,"Y")+". Web. "+Ext.Date.format(a,"j M Y")+". \x26lt;http://voyant-tools.org\x26gt;.\x3c/fieldset\x3e\x3cbr \x3e\x3cfieldset\x3e\x3clegend\x3eChicago\x3c/legend\x3eSt\u00e9fan Sinclair and Geoffrey Rockwell, "+
(this.isXType("voyantheader")?"":'"'+this.localize("title")+'", ')+"\x3ci\x3eVoyant Tools\x3c/i\x3e, accessed "+Ext.Date.format(a,"F j, Y")+", http://voyant-tools.org.\x3c/fieldset\x3e\x3cbr \x3e\x3cfieldset\x3e\x3clegend\x3eAPA\x3c/legend\x3eSinclair, S. \x26amp; G. Rockwell. ("+Ext.Date.format(a,"Y")+"). "+(this.isXType("voyantheader")?"":this.localize("title")+". ")+"\x3ci\x3eVoyant Tools\x3c/i\x3e. Retrieved "+Ext.Date.format(a,"F j, Y")+", from http://voyant-tools.org\x3c/fieldset\x3e",buttons:Ext.Msg.OK,
icon:Ext.Msg.INFO})},exportGridCurrentJson:function(a,b){function c(a){var b={};e.forEach(function(c){b[c.text]=a.get(c.dataIndex)});values.push(b)}var d=a.getStore();d.getFields();var e=a.getColumnManager().headerCt.getVisibleGridColumns();values=[];d.buffered?d.data.forEach(c):d.each(c);Ext.Msg.show({title:this.localize("exportDataTitle"),message:this.localize("exportDataJsonMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:Ext.encode(values)})},exportGridCurrentTsv:function(a,
b){function c(a){cells=[];f.forEach(function(b){b=a.get(b.dataIndex);Ext.isString(b)&&(b=b.replace(/\s+/g," "));cells.push(b)});g+=cells.join("\t")+"\n"}var d=a.getStore(),e=d.getFields(),f=a.getColumnManager().headerCt.getVisibleGridColumns(),e=[];f.forEach(function(a){e.push(a.text)});var g=e.join("\t")+"\n";d.buffered?d.data.forEach(c):d.each(c);Ext.Msg.show({title:this.localize("exportDataTitle"),message:this.localize("exportDataTsvMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,
value:g})},exportGridCurrentHtml:function(a,b){function c(a){e+="\t\t\x3ctr\x3e\n";f.forEach(function(b){b=a.get(b.dataIndex);Ext.isString(b)&&(b=b.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26lg;"));e+="\t\t\t\x3ctd\x3e"+b+"\x3c/td\x3e\n"});e+="\t\t\x3c/tr\x3e\n"}var d=a.getStore();d.getFields();var e="\x3ctable\x3e\n\t\x3cthead\x3e\n\t\t\x3ctr\x3e\n",f=a.getColumnManager().headerCt.getVisibleGridColumns();f.forEach(function(a){e+="\t\t\t\x3ctd\x3e"+a.text+"\x3c/td\x3e\n"});
e+="\t\t\x3c/tr\x3e\n\t\x3c/thead\x3e\n\t\x3ctbody\x3e\n";d.buffered?d.data.forEach(c):d.each(c);e+="\t\x3c/tbody\x3e\n\x3c/table\x3e";Ext.Msg.show({title:this.localize("exportDataTitle"),message:this.localize("exportDataHtmlMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:e})},getExportUrl:function(){var a=this.isXType("voyantheader")?this.getApplication().getModifiedApiParams():this.getModifiedApiParams();this.isXType("voyantheader")||(a.view=Ext.getClassName(this).split(".").pop());
return this.getApplication().getBaseUrl()+"?corpus\x3d"+this.getApplication().getCorpus().getId()+"\x26"+Ext.Object.toQueryString(a)},helpToolClick:function(a){a.isXType("voyanttabpanel")&&(a=a.getActiveTab());var b=a.localize("help",{"default":!1})||a.localize("helpTip");b==a._localizeClass(Ext.ClassManager.get("Voyant.util.Toolable"),"helpTip")?a.openUrl(a.getBaseUrl()+"docs/#!/guide/"+a.getXType()):Ext.Msg.alert(a.localize("title"),b+"\x3cp\x3e\x3ca href\x3d'"+a.getBaseUrl()+"docs/"+(a.isXType("voyantheader")?
"":"#!/guide/"+a.getXType())+"' target\x3d'voyantdocs'\x3e"+a.localize("moreHelp")+"\x3c/a\x3e\x3c/p\x3e")},replacePanel:function(a){var b=this.getApplication().getCorpus();this.getInitialConfig();var c;if(this.isXType("voyantheader")&&this.getApplication().getViewComponent){c=this.getApplication().getViewComponent();c.removeAll(!0);var d=c.add({xtype:a});b&&this.getApplication().dispatchEvent("loadedCorpus",c,b);c=Ext.Object.fromQueryString(document.location.search);var d=this.getApplication().getBaseUrl(),
d=d+("?corpus\x3d"+b.getId()),d=d+("\x26view\x3d"+a),e;for(e in c)"corpus"!==e&&"view"!==e&&(d+="\x26"+e+"\x3d"+c[e]);window.history.pushState({corpus:b.getId(),view:a},"",d)}else c=this.isXType("voyantheader")&&this.getApplication().getViewComponent?this.getApplication().getViewComponent():this.up("component"),c.remove(this,!0),d=c.add({xtype:a}),c.isXType("voyanttabpanel")&&c.setActiveTab(d),b&&d.fireEvent("loadedCorpus",d,b);this.getApplication().dispatchEvent("panelChange",this)}});
Ext.define("Voyant.util.ToolMenu",{extend:"Ext.panel.Tool",alias:"widget.toolmenu",renderTpl:['\x3cdiv class\x3d"x-menu-tool-hover"\x3e\x3c/div\x3e\x3ctpl if\x3d"glyph"\x3e\x3cspan id\x3d"{id}-toolEl" class\x3d"{baseCls}-glyph {childElCls}" role\x3d"presentation" style\x3d"font-family: {glyphFontFamily}"\x3e\x26#{glyph}\x3c/span\x3e\x3ctpl else\x3e\x3cimg id\x3d"{id}-toolEl" src\x3d"{blank}" class\x3d"{baseCls}-img {baseCls}-{type}{childElCls}" role\x3d"presentation"/\x3e\x3c/tpl\x3e'],privates:{onClick:function(){var a=
this.callParent(arguments);a&&this.items&&(this.toolMenu||(this.toolMenu=new Ext.menu.Menu({items:this.items})),this.toolMenu.showAt(0,0),this.toolMenu.showAt(this.getX()+this.getWidth()-this.toolMenu.getWidth(),this.getY()+this.getHeight()+10));return a},onDestroy:function(){Ext.destroyMembers(this,"toolMenu");this.callParent()}},initComponent:function(){this.callParent(arguments);var a,b;a=this.glyph||"xf12e@FontAwesome";"string"===typeof a?(b=a.split("@"),a=b[0],b=b[1]):b="FontAwesome";Ext.applyIf(this.renderData,
{baseCls:this.baseCls,blank:Ext.BLANK_IMAGE_URL,type:this.type,glyph:a,glyphFontFamily:b})}});Ext.define("Voyant.util.Transferable",{transferable:["transfer"],transfer:function(a,b){if(a.transferable)for(var c=0;c<a.transferable.length;c++){var d=a.transferable[c];b[d]=Ext.bind(a[d],b)}if(a.mixins)for(mixin in a.mixins)this.transfer(a.mixins[mixin],b)}});Ext.define("Voyant.util.Variants",{extend:"Ext.Base",constructor:function(a){this.variants=a;this.map={};this.variants.forEach(function(a,c){a.forEach(function(a){this.map[a]=c},this)},this)},getVariants:function(a){var b=[];Ext.isString(a)&&(a=[a]);Ext.isArray(a)&&a.forEach(function(a){void 0!=this.map[a]&&b.push.apply(b,this.variants[this.map[a]])},this);return b}});Ext.define("Voyant.data.model.AnalysisToken",{extend:"Ext.data.Model",idProperty:"term",fields:[{name:"term"},{name:"rawFreq",type:"int"},{name:"relativeFreq",type:"number"},{name:"cluster",type:"int"},{name:"clusterCenter",type:"boolean"},{name:"vector"}]});Ext.define("Voyant.data.model.Context",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"docIndex",type:"int"},{name:"docId"},{name:"left"},{name:"keyword"},{name:"term"},{name:"right"}]});Ext.define("Voyant.data.model.CorpusCollocate",{extend:"Ext.data.Model",fields:[{name:"term"},{name:"rawFreq",type:"int"},{name:"contextTerm"},{name:"contextTermRawFreq",type:"int"}],getTerm:function(){return this.getKeyword()},getRawFreq:function(){return this.getKeywordRawFreq()},getKeyword:function(){return this.get("term")},getKeywordRawFreq:function(){return this.get("rawFreq")},getContextTerm:function(){return this.get("contextTerm")},getContextTermRawFreq:function(){return this.get("contextTermRawFreq")}});Ext.define("Voyant.data.model.CorpusTerm",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"rawFreq",type:"int"},{name:"relativeFreq",type:"float"},{name:"relativePeakedness",type:"float"},{name:"relativeSkewness",type:"float"},{name:"distributions"},{name:"typeTokenRatio-lexical",type:"float",calculate:function(a){return a["typesCount-lexical"]/a["tokensCount-lexical"]}}],getTerm:function(){return this.get("term")},getRawFreq:function(){return parseInt(this.get("rawFreq"))}});Ext.define("Voyant.data.model.CorpusNgram",{extend:"Ext.data.Model",fields:[{name:"term"},{name:"length",type:"int"},{name:"rawFreq",type:"int"},{name:"distributions"}],getTerm:function(){return this.get("term")}});Ext.define("Voyant.data.model.Dimension",{extend:"Ext.data.Model",fields:[{name:"percentage",type:"number"}]});Ext.define("Voyant.data.model.Document",{extend:"Ext.data.Model",fields:[{name:"corpus"},{name:"id"},{name:"index",type:"int"},{name:"tokensCount-lexical",type:"int"},{name:"typesCount-lexical",type:"int"},{name:"typeTokenRatio-lexical",type:"float",calculate:function(a){return a["typesCount-lexical"]/a["tokensCount-lexical"]}},{name:"lastTokenStartOffset-lexical",type:"int"},{name:"title"},{name:"language",convert:function(a){return Ext.isEmpty(a)?"":a}}],getDocumentTerms:function(a){a=a||{};Ext.apply(a,
{docId:this.get("id")});return this.get("corpus").getDocumentTerms(a)},getIndex:function(){return this.get("index")},getFullLabel:function(){return this.getTitle()},getTitle:function(){var a=this.get("title");void 0===a&&(a="");a=Ext.isArray(a)?a.join("; "):a;return a=a.trim().replace(/\s+/g," ")},getTruncated:function(a,b){if(a.length>b){var c=a.lastIndexOf("/");-1<c&&(a=a.substr(c+1));if(a.length>b){c=a.indexOf(" ",b-5);if(0>c||c>b)c=b;a=a.substring(0,c)+"\u2026"}}return a},getShortTitle:function(){var a=
this.getTitle(),a=a.replace(/\.(html?|txt|xml|docx?|pdf|rtf|\/)$/,""),a=a.replace(/^(the|a|le|l'|un|une)\s/,"");return this.getTruncated(a,25)},getTinyTitle:function(){return this.getTruncated(this.getShortTitle(),10)},getShortLabel:function(){return parseInt(this.getIndex())+1+") "+this.getShortTitle()},getTinyLabel:function(){return parseInt(this.getIndex())+1+") "+this.getTinyTitle()},getAuthor:function(){var a=this.get("author");return Ext.isArray(a)?a.join("; "):a},getCorpusId:function(){return this.get("corpus")},
isPlainText:function(){return this.get("extra.Content-Type")&&/plain/i.test(this.get("extra.Content-Type"))?!0:!1}});Ext.define("Voyant.data.model.DocumentQueryMatch",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"count",type:"int"},{name:"query"},{name:"distributions"}],getCount:function(){return this.get("count")},getDistributions:function(){return this.get("distributions")}});Ext.define("Voyant.data.model.DocumentTerm",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"term"},{name:"docIndex",type:"int"},{name:"docId"},{name:"rawFreq",type:"int"},{name:"relativeFreq",type:"float"},{name:"tfidf",type:"float"},{name:"zscore",type:"float"},{name:"zscoreRatio",type:"float"},{name:"distributions"}],getTerm:function(){return this.get("term")},getDocIndex:function(){return this.get("docIndex")}});Ext.define("Voyant.data.model.PrincipalComponent",{extend:"Ext.data.Model",fields:[{name:"eigenValue",type:"number"},{name:"eigenVectors"}]});Ext.define("Voyant.data.model.StatisticalAnalysis",{extend:"Ext.data.Model",requires:["Voyant.data.model.PrincipalComponent","Voyant.data.model.Dimension","Voyant.data.model.AnalysisToken"],fields:[{name:"id"}],getPrincipalComponents:function(){var a=[];this.data.principalComponents.forEach(function(b){a.push(Ext.create("Voyant.data.model.PrincipalComponent",b))});return a},getDimensions:function(){var a=[];this.data.dimensions.forEach(function(b){a.push(Ext.create("Voyant.data.model.Dimension",b))});
return a},getTokens:function(){var a=[];this.data.tokens.forEach(function(b){a.push(Ext.create("Voyant.data.model.AnalysisToken",b))});return a}});Ext.define("Voyant.data.model.Token",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"docId"},{name:"docIndex",type:"int"},{name:"token"},{name:"rawFreq"},{name:"tokenType"},{name:"position",type:"int"},{name:"startOffset",type:"int"},{name:"endOffset",type:"int"}],statics:{getInfoFromElement:function(a){if(a&&a.getId)return a=a.getId().split("_"),{docIndex:parseInt(a[1]),position:parseInt(a[2])}}},isWord:function(){return"lexical"==this.getTokenType()},getTokenType:function(){return this.get("tokenType")},
getId:function(){return["",this.getDocIndex(),this.getPosition()].join("_")},getDocIndex:function(){return this.get("docIndex")},getDocId:function(){return this.get("docId")},getTerm:function(){return this.get("term")},getTermWithLineSpacing:function(a){var b=this.getTerm().replace(/<\/?\w+\b.*?>/g,"\x3cbr /\x3e\x3cbr /\x3e").replace(/>\s+</g,"\x3e\x3c").replace(/<br \/><br \/>(<br \/>)+/g,"\x3cbr /\x3e\x3cbr /\x3e");a&&(b=b.replace(/(\r\n|\r|\n)\s*/g,"\x3cbr /\x3e"));return b},getPosition:function(){return this.get("position")},
getDocumentRawFreq:function(){return this.get("rawFreq")}});Ext.define("Voyant.data.store.VoyantStore",{extend:"Ext.data.BufferedStore",config:{parentPanel:void 0},constructor:function(a){void 0!==a.parentPanel&&this.setParentPanel(a.parentPanel);this.callParent([a]);this.on("beforeload",this.applyApiParams,this)},applyApiParams:function(a,b){var c=this.getParentPanel();if(void 0!==c){c=c.getApiParams();void 0===b.params&&(b.params={});for(var d in c)b.params[d]=c[d]}}});Ext.define("Voyant.data.store.CAAnalysis",{extend:"Ext.data.Store",model:"Voyant.data.model.StatisticalAnalysis",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.CA",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,withDistributions:!0},reader:{type:"json",rootProperty:"correspondenceAnalysis",totalProperty:"correspondenceAnalysis.totalTerms"},simpleSortMode:!0}});this.callParent([a])},
setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.Contexts",{extend:"Voyant.data.store.VoyantStore",model:"Voyant.data.model.Context",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,trailingBufferZone:100,remoteSort:!0,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentContexts",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,stripTags:a.stripTags},reader:{type:"json",rootProperty:"documentContexts.contexts",
totalProperty:"documentContexts.total"},simpleSortMode:!0},listeners:{beforeprefetch:function(a,c){var d=this.getParentPanel();if(void 0!==d){var d=d.getApiParams(),e=a.getProxy(),f;for(f in d)e.extraParams[f]=d[f]}},scope:this}});this.callParent([a])},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.CorpusCollocates",{extend:"Voyant.data.store.VoyantStore",model:"Voyant.data.model.CorpusCollocate",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,autoLoad:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.CorpusCollocates",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"corpusCollocates.collocates",
totalProperty:"corpusCollocates.total"},simpleSortMode:!0}});this.callParent([a])},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.proxy.CorpusTerms",{extend:"Ext.data.proxy.Ajax",constructor:function(a){a=a||{};Ext.apply(a,{extraParams:Ext.apply(a.extraParams||{},{tool:"corpus.CorpusTerms"})});Ext.applyIf(a,{url:Voyant.application.getTromboneUrl()});this.callParent([a])},reader:{type:"json",rootProperty:"corpusTerms.terms",totalProperty:"corpusTerms.total"},simpleSortMode:!0});
Ext.define("Voyant.data.store.CorpusTerms",{extend:"Voyant.data.store.VoyantStore",model:"Voyant.data.model.CorpusTerm",transferable:["setCorpus"],config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,autoLoad:!1,proxy:Ext.create("Voyant.data.proxy.CorpusTerms")});this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),c=this;a.corpus.then(function(a){c.setCorpus(a);c.getAutoLoad()?
c.load({callback:function(){b.resolve(c)}}):b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.DocumentQueryMatches",{extend:"Ext.data.Store",model:"Voyant.data.model.DocumentQueryMatch",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{autoLoad:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsFinder",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"documentsFinder.queries"}}});this.callParent([a]);a&&a.corpus&&this.setCorpus(a.corpus)},
setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.DocumentTerms",{extend:"Voyant.data.store.VoyantStore",model:"Voyant.data.model.DocumentTerm",transferable:["setCorpus"],config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"documentTerms.terms",
totalProperty:"documentTerms.total"},simpleSortMode:!0}});this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),c=this;a.corpus.then(function(a){c.setCorpus(a);b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.Documents",{extend:"Ext.data.Store",model:"Voyant.data.model.Document",config:{corpus:void 0},statics:{i18n:{failedGetDocuments:{en:"Failed attempt to get documents."}}},sorters:{property:"index",direction:"ASC"},remoteSort:!0,constructor:function(a){Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsMetadata",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"documentsMetadata.documents",
totalProperty:"documentsMetadata.total"},simpleSortMode:!0},listeners:{load:function(a,b,c,g){if(c){var h=a.getCorpus();b.forEach(function(a){a.set("corpus",h)})}}}});this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),c=this;a.corpus.then(function(a){c.setCorpus(a);b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)},
getDocument:function(a){if(this.getCorpus().getDocumentsCount()!=this.getTotalCount()){var b=Voyant.application.getDeferred();this.load({scope:this,callback:function(c,d,e){e?b.resolve(this.getDocument(a)):(Voyant.application.showResponseError(this.localize("failedGetDocuments"),response),b.reject())}});return b.promise()}return Ext.isNumber(a)?this.getAt(a):this.getById(a)}});Ext.define("Voyant.data.store.PCAAnalysis",{extend:"Ext.data.Store",model:"Voyant.data.model.StatisticalAnalysis",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.PCA",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,withDistributions:!0},reader:{type:"json",rootProperty:"pcaAnalysis",totalProperty:"pcaAnalysis.totalTerms"},simpleSortMode:!0}});this.callParent([a])},setCorpus:function(a){a&&
this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.CorpusNgrams",{extend:"Ext.data.BufferedStore",model:"Voyant.data.model.CorpusNgram",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.CorpusNgrams",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"corpusNgrams.ngrams",totalProperty:"corpusNgrams.total"},
simpleSortMode:!0}});this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),c=this;a.corpus.then(function(a){c.setCorpus(a);b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.Tokens",{extend:"Ext.data.Store",model:"Voyant.data.model.Token",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTokens",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,stripTags:a.stripTags},reader:{type:"json",rootProperty:"documentTokens.tokens",totalProperty:"documentTokens.total"},simpleSortMode:!0}});this.callParent([a])},setCorpus:function(a){a&&
this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});var Corpus=function(a,b){return Ext.create("Voyant.data.model.Corpus",a,b)};
Ext.define("Voyant.data.model.Corpus",{alternateClassName:["Corpus"],mixins:["Voyant.util.Localization"],transferable:"show getSize getId getDocument getDocuments getCorpusTerms getDocumentsCount getWordTokensCount getWordTypesCount getDocumentTerms".split(" "),requires:["Voyant.util.ResponseError","Voyant.data.store.CorpusTerms","Voyant.data.store.Documents"],extend:"Ext.data.Model",config:{documentsStore:void 0},statics:{i18n:{failedCreateCorpus:{en:"Failed attempt to create a Corpus."},thisCorpus:{en:"This corpus"},
isEmpty:{en:"is empty"},hasNdocuments:{en:new Ext.Template("has {count} documents")},has1document:{en:"has 1 document"},widthNwordsAndNTypes:{en:new Ext.Template("with {words} \x3cspan class\x3d'info-tip' data-qtip\x3d'every occurrence of every word (like multiple occurrences of \"the\") is counted'\x3etotal words\x3c/span\x3e and {types} \x3cspan class\x3d'info-tip' data-qtip\x3d'multiple occurrences of words (like \"the\") are counted once'\x3eunique word forms\x3c/span\x3e")},yearAgo:{en:new Ext.Template("about a year ago")},
yearsAgo:{en:new Ext.Template("about {count} years ago")},monthAgo:{en:new Ext.Template("about a month ago")},monthsAgo:{en:new Ext.Template("about {count} months ago")},dayAgo:{en:new Ext.Template("about a day ago")},daysAgo:{en:new Ext.Template("about {count} days ago")},hourAgo:{en:new Ext.Template("about an hour ago")},hoursAgo:{en:new Ext.Template("about {count} hours ago")},minuteAgo:{en:new Ext.Template("about a minute ago")},minutesAgo:{en:new Ext.Template("about {count} minutes ago")},secondAgo:{en:new Ext.Template("about a second ago")},
secondsAgo:{en:new Ext.Template("{count} seconds ago")},now:{en:"now"}}},fields:[{name:"documentsCount",type:"int"},{name:"lexicalTokensCount",type:"int"},{name:"lexicalTypesCount",type:"int"},{name:"createdTime",type:"int"},{name:"createdDate",type:"date",dateFormat:"c"}],constructor:function(a,b){this.callParent([b]);if(a){b=b||{};Ext.apply(b,{tool:"corpus.CorpusMetadata"});Ext.isString(a)||Ext.isArray(a)?b.input=a:Ext.isObject(a)&&Ext.apply(b,a);var c=Voyant.application.getDeferred(this),d=this;
$.ajax({type:"POST",url:Voyant.application.getTromboneUrl(),data:b,dataType:"json"}).done(function(a){d.set(a.corpus.metadata);a=Ext.create("Voyant.data.store.Documents",{corpus:d});d.setDocumentsStore(a);a.load({params:{limit:1E3},callback:function(a,b,e){d.setDocumentsStore(this);c.resolve(d)},scope:a})}).fail(function(a){Voyant.application.showResponseError(d.localize("failedCreateCorpus"),a);c.reject()});return Voyant.application.getPromiseFromDeferred(c)}},getId:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,
arguments):this.get("id")},getCorpusTerms:function(a){return Ext.create("Voyant.data.store.CorpusTerms",Ext.apply(a||{},{corpus:this}))},getCorpusCollocates:function(a){return Ext.create("Voyant.data.store.CorpusCollocates",Ext.apply(a||{},{corpus:this}))},getDocumentQueryMatches:function(a){return Ext.create("Voyant.data.store.DocumentQueryMatches",Ext.apply(a||{},{corpus:this}))},getDocumentTerms:function(a){return Ext.create("Voyant.data.store.DocumentTerms",Ext.apply(a||{},{corpus:this}))},getDocuments:function(a){return this.getDocumentsStore()?
this.getDocumentsStore():Ext.create("Voyant.data.store.Documents",Ext.apply(a||{},{corpus:this}))},getDocument:function(a){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.getDocumentsStore().getDocument(a)},getDocumentsCount:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("documentsCount")},getWordTokensCount:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("lexicalTokensCount")},
getWordTypesCount:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("lexicalTypesCount")},getCreatedTime:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("createdTime")},show:function(a){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.getShow().show()},getShow:function(a){if(this.then)return Voyant.application.getDeferredNestedPromise(this,arguments);var b=this.getDocumentsCount(),
c=this.localize("thisCorpus");if(0==b)c+=" "+this.localize("isEmpty")+".";else{var c=c+" ",c=1<b?c+this.localize("hasNdocuments",{count:Ext.util.Format.number(b,"0,000")}):c+this.localize("has1document"),c=c+(" "+this.localize("widthNwordsAndNTypes",{words:Ext.util.Format.number(this.getWordTokensCount(),"0,000"),types:Ext.util.Format.number(this.getWordTypesCount(),"0,000")})+"."),c=c+" Created ",d=this.get("createdDate"),e=new Date;!0===Ext.Array.each([["year",Ext.Date.YEAR],["month",Ext.Date.MONTH],
["day",Ext.Date.DAY],["hour",Ext.Date.HOUR],["minute",Ext.Date.MINUTE],["second",Ext.Date.SECOND]],function(a){if(Ext.Date.diff(d,e,a[1])>("second"==a[0]?1:0)){var b=Ext.Date.diff(d,e,a[1]);c+="\x3cspan class\x3d'info-tip' data-qtip\x3d'"+Ext.Date.format(d,"Y-m-d, H:i:s")+"'\x3e";c=1==b?c+this.localize(a[0]+"Ago",{count:b,date:d}):c+this.localize(a[0]+"sAgo",{count:b,date:d});c+="\x3c/span\x3e";return!1}},this)&&(c+=this.localize("now"));c+=".";c+=""}return c}});Ext.define("Voyant.widget.StopListOption",{extend:"Ext.container.Container",mixins:["Voyant.util.Localization"],alias:"widget.stoplistoption",layout:"hbox",statics:{i18n:{label:{en:"Stopwords:"},editList:{en:"Edit List"},noEditAutoTitle:{en:"Edit Stoplist Error"},noEditAutoMessage:{en:'The auto-detected stoplist cannot be edited, please select a specifc stoplist such as the "New User-Defined List".'},auto:{en:"Auto-detect"},none:{en:"None"},"new":{en:"New User-Defined List"},ar:{en:"Arabic",value:"stop.ar.arabic-lucene.txt"},
bg:{en:"Bulgarian",value:"stop.bu.bulgarian-lucene.txt"},br:{en:"Breton",value:"stop.br.breton-lucene.txt"},ca:{en:"Catalan",value:"stop.ca.catalan-lucene.txt"},ckb:{en:"Kurdish",value:"stop.ckb-turkish-lucene.txt"},cn:{en:"Chinese",value:"stop.cn.chinese-lawrence.txt"},cz:{en:"Czech",value:"stop.cz.czech-lucene.txt"},de:{en:"German",value:"stop.de.german.txt"},el:{en:"Greek",value:"stop.el.greek-lucene.txt"},en:{en:"English",value:"stop.en.taporware.txt"},es:{en:"Spanish",value:"stop.es.spanish.txt"},
eu:{en:"Basque",value:"stop.eu.basque-lucene.txt"},fa:{en:"Farsi",value:"stop.fa.farsi-lucene.txt"},fr:{en:"French",value:"stop.fr.veronis.txt"},ga:{en:"Irish",value:"stop.ga-irish-lucene.txt"},gl:{en:"Galician",value:"stop.ga.galician-lucene.txt"},hi:{en:"Hindi",value:"stop.hi.hindi-lucene.txt"},hu:{en:"Hungarian",value:"stop.hu.hungarian.txt"},hy:{en:"Armenian",value:"stop.hy.armenian-lucene.txt"},id:{en:"Indonesian",value:"stop.id.indonesian-lucene.txt"},it:{en:"Italian",value:"stop.it.italian.txt"},
ja:{en:"Japanese",value:"stop.ja.japanese-lucene.txt"},lt:{en:"Latvian",value:"stop.lv.latvian-lucene.txt"},lv:{en:"Lithuanian",value:"stop.lt.lithuanian-lucene.txt"},mu:{en:"Multilingual",value:"stop.mu.multi.txt"},nl:{en:"Dutch",value:"stop.nl.dutch.txt"},no:{en:"Norwegian",value:"stop.no.norwegian.txt"},ro:{en:"Romanian",value:"stop.ro.romanian-lucene.txt"},se:{en:"Swedish",value:"stop.se.swedish-long.txt"},th:{en:"Thai",value:"stop.th.thai-lucene.txt"},tr:{en:"Turkish",value:"stop.tr.turkish-lucene.txt"},
ok:{en:"Save"},cancel:{en:"Cancel"},editStopListTitle:{en:"Edit Stoplist"},editStopListMessage:{en:"This is the stoplist, one term per line."},applyGlobally:{en:"apply globally"}}},initComponent:function(a){var b=this.up("window").panel.getApiParam("stopList"),c=[];"ar bg br ca ckb cn cz de el en es eu fa fr ga gl hi hu hy id it ja lv lt mu nl no ro se th tr".split(" ").forEach(function(a){c.push({name:this.localize(a),value:this.localize(a,{lang:"value"})})},this);c.sort(function(a,b){return a.name<
b.name?-1:1});c.splice(0,0,{name:this.localize("auto"),value:"auto"},{name:this.localize("none"),value:""},{name:this.localize("new"),value:"new"});c.forEach(function(a){console.warn(a.name+": "+a.value)});Ext.apply(this,{items:[{xtype:"combo",queryMode:"local",value:b,triggerAction:"all",editable:!0,fieldLabel:this.localize("label"),labelAlign:"right",name:"stopList",displayField:"name",valueField:"value",store:{fields:["name","value"],data:c}},{width:10},{xtype:"tbspacer"},{xtype:"button",text:this.localize("editList"),
handler:this.editList,scope:this},{width:10},{xtype:"checkbox",name:"stopListGlobal",checked:!0,boxLabel:this.localize("applyGlobally")}]});this.callParent(arguments)},editList:function(){var a=this.up("window").panel,b=this.down("combo").getValue(),c=a.getApplication&&a.getApplication().getCorpus?a.getApplication().getCorpus().getId():void 0;"auto"!=b||c?Ext.Ajax.request({url:a.getTromboneUrl(),params:{tool:"resource.KeywordsManager",stopList:b,corpus:c},success:function(b){b=Ext.util.JSON.decode(b.responseText).keywords.keywords.sort().join("\n");
Ext.Msg.show({title:this.localize("editStopListTitle"),message:this.localize("editStopListMessage"),buttons:Ext.Msg.OKCANCEL,buttonText:{ok:this.localize("ok"),cancel:this.localize("cancel")},icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:b,original:b,fn:function(b,d,g){"ok"==b&&g.original!=d&&(b=this.down("combo"),0==Ext.String.trim(d).length?b.setValue("empty"):Ext.Ajax.request({url:a.getTromboneUrl(),params:{tool:"resource.StoredResource",storeResource:d,corpus:c},combo:b,success:function(a,b){var c=
Ext.util.JSON.decode(a.responseText),d=b.combo.getStore(),c="keywords-"+c.storedResource.id;d.add({name:c,value:c});b.combo.setValue(c);b.combo.updateLayout()},scope:this}))},scope:this})},scope:this}):Ext.Msg.show({title:this.localize("noEditAutoTitle"),message:this.localize("noEditAutoMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}});Ext.define("Voyant.widget.QuerySearchField",{extend:"Ext.form.field.Text",mixins:["Voyant.util.Localization"],alias:"widget.querysearchfield",statics:{i18n:{querySearch:{en:"Search"},querySearchTip:{en:'\x3cdiv\x3eSearch syntax (press enter/return to trigger a search):\x3c/div\x3e\x3cul style\x3d"margin-top: 3px; margin-bottom: 3px;"\x3e\x3cli\x3e\x3cb\x3ecoat\x3c/b\x3e: match exact term \x3ci\x3ecoat\x3c/i\x3e\x3c/li\x3e\x3cli\x3e\x3cb\x3ecoat*\x3c/b\x3e: match terms that start with \x3ci\x3ecoat\x3c/i\x3e as one term\x3c/li\x3e\x3cli\x3e\x3cb\x3e^coat*\x3c/b\x3e: match terms that start with \x3ci\x3ecoat\x3c/i\x3e as separate terms (coat, coats, etc.)\x3c/li\x3e\x3cli\x3e\x3cb\x3ecoat,jacket\x3c/b\x3e: match each term separated by commas as separate terms\x3c/li\x3e\x3cli\x3e\x3cb\x3ecoat|jacket\x3c/b\x3e: match terms separate by pipe as a single term\x3c/li\x3e\x3cli\x3e\x3cb\x3e\x26quot;winter coat\x26quot;\x3c/b\x3e: \x3ci\x3ewinter coat\x3c/i\x3e as a phrase\x3c/li\x3e\x3cli\x3e\x3cb\x3e\x26quot;coat mittens\x26quot;~5\x3c/b\x3e: \x3ci\x3ecoat\x3c/i\x3e near \x3ci\x3emittens\x3c/i\x3e (within 5 words)\x3c/li\x3e\x3cli\x3e\x3cb\x3e^coat*,jacket|parka,\x26quot;coat mittens\x26quot;~5\x3c/b\x3e: combine syntaxes\x3c/li\x3e\x3c/ul\x3e'}}},
triggers:{help:{weight:2,cls:"fa-trigger form-fa-help-trigger",handler:"onHelpClick",scope:"this"}},initComponent:function(a){var b=this;Ext.apply(b,{enableKeyEvents:!0,listeners:{render:function(a){a.triggers&&a.triggers.help&&Ext.QuickTips.register({target:a.triggers.help.getEl(),text:a.localize("querySearchTip"),enabled:!0,showDelay:20,trackMouse:!0,autoShow:!0});this.suggest=Ext.create("Ext.tip.ToolTip",{target:this.inputEl,autoShow:!1,hidden:!0,html:""})},keyup:function(a,b,e){if((!this.store||
Ext.isString(this.store))&&this.findParentByType){b=this.findParentByType("panel");var f;b.getCorpus?f=b.getCorpus():b.getStore&&b.getStore().getCorpus&&(f=b.getStore().getCorpus());f&&(this.store=f.getCorpusTerms())}this.store&&(a=a.getValue().trim().replace(/^\^/,""),0==/[,|^~" ]/.test(a)&&0<a.length?this.store.load({params:{query:[a+"*","^"+a+"*"],limit:5},scope:this,callback:function(a,b,c){suggest="";a.forEach(function(a){suggest+="\x3cdiv\x3e"+a.getTerm()+" ("+a.getRawFreq()+")\x3c/div\x3e"});
this.suggest.show();this.suggest.update(suggest)}}):(this.suggest.update(""),this.suggest.hide()))},scope:b},width:120,emptyText:b.localize("querySearch")});b.callParent(arguments);b.on("specialkey",function(a,d){d.getKey()==d.ENTER&&b.doSearch()})},onClearClick:function(){this.setValue("");this.findParentByType("panel").fireEvent("query",this,void 0);this.updateLayout()},onHelpClick:function(){Ext.Msg.show({title:this.localize("querySearch"),message:this.localize("querySearchTip"),buttons:Ext.Msg.OK,
icon:Ext.Msg.INFO})},doSearch:function(){var a=this.getValue();this.findParentByType("panel").fireEvent("query",this,0==a.length?void 0:a);this.updateLayout()}});Ext.define("Voyant.widget.TotalPropertyStatus",{extend:"Ext.Component",mixins:["Voyant.util.Localization"],alias:"widget.totalpropertystatus",statics:{i18n:{totalPropertyStatus:{en:'{count:number("0,000")}'}}},initComponent:function(){Ext.applyIf(this,{tpl:this.localize("totalPropertyStatus"),itemId:"totalpropertystatus",style:"margin-right:5px",listeners:{afterrender:function(a){var b=a.up("grid");if(b){var c=b.getStore();a.updateStatus(c.getTotalCount());b.getStore().on("totalcountchange",a.updateStatus,
a)}}}});this.callParent(arguments)},updateStatus:function(a){this.update({count:a})}});Ext.define("Voyant.widget.DocumentSelector",{extend:"Ext.button.Button",mixins:["Voyant.util.Localization"],alias:"widget.documentselector",statics:{i18n:{documents:{en:"Documents"},selectAll:{en:"Select All"},selectNone:{en:"Select None"},ok:{en:"Ok"}}},config:{docs:void 0,corpus:void 0,docStore:void 0,singleSelect:!1},initComponent:function(){this.setSingleSelect(void 0==this.config.singleSelect?this.getSingleSelect():this.config.singleSelect);Ext.apply(this,{text:this.localize("documents"),menu:[],
listeners:{}});this.callParent(arguments);this.setDocStore(Ext.create("Ext.data.Store",{model:"Voyant.data.model.Document",autoLoad:!1,remoteSort:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsMetadata"},reader:{type:"json",rootProperty:"documentsMetadata.documents",totalProperty:"documentsMetadata.total"},simpleSortMode:!0},listeners:{load:function(a,b,c,d){this.populate(b)},scope:this}}))},updateCorpus:function(a){this.getDocStore().getProxy().setExtraParam("corpus",
a.getId());this.getDocStore().load()},populate:function(a,b){this.setDocs(a);var c=this.getMenu();b&&c.removeAll();var d=this.getSingleSelect();c.add([{xtype:"button",style:"margin: 5px;",itemId:"selectAll",text:this.localize("selectAll"),hidden:d,handler:function(a,b){c.query("menucheckitem").forEach(function(a){a.setChecked(!0)})},scope:this},{xtype:"button",style:"margin: 5px;",itemId:"selectNone",text:this.localize("selectNone"),handler:function(a,b){c.query("menucheckitem").forEach(function(a){a.setChecked(!1)})},
scope:this},{xtype:"menuseparator"}]);var e="docGroup"+Ext.id();a.forEach(function(a,b){c.add({xtype:"menucheckitem",text:a.getShortTitle(),docId:a.get("id"),checked:d&&0==b||!d,group:d?e:void 0,checkHandler:function(a,b){this.getSingleSelect()&&b&&this.findParentByType("panel").fireEvent("documentsSelected",this,[a.docId])},scope:this})},this);c.add([{xtype:"menuseparator"},{xtype:"button",style:"margin: 5px;",text:this.localize("ok"),handler:function(a,b){var d=[];c.query("menucheckitem").forEach(function(a){a.checked&&
d.push(a.docId)},this);this.hideMenu();this.findParentByType("panel").fireEvent("documentsSelected",this,d)},scope:this}])}});Ext.define("Voyant.panel.Panel",{mixins:"Voyant.util.Localization Voyant.util.Api Voyant.util.Toolable Voyant.util.DetailedError Voyant.widget.QuerySearchField Voyant.widget.StopListOption Voyant.widget.TotalPropertyStatus".split(" "),statics:{i18n:{term:{en:"Term"},rawFreq:{en:"Count"},relativeFreq:{en:"Relative"},trend:{en:"Trend"},colon:{en:": "},loading:{en:"Loading"}}},constructor:function(a){this.mixins["Voyant.util.Api"].constructor.apply(this,arguments);this.mixins["Voyant.util.Toolable"].constructor.apply(this,
arguments);this.glyph||(this.glyph=Ext.ClassManager.getClass(this).glyph)},getApplication:function(){return Voyant.application},getBaseUrl:function(){return this.getApplication().getBaseUrl()},openUrl:function(a){window.open(a)||Ext.Msg.show({title:"Popup Blocked",buttonText:{ok:"Close"},icon:Ext.MessageBox.INFO,message:"A popup window was blocked. \x3ca href\x3d'"+a+"' target\x3d'_blank' class\x3d'link'\x3eClick here\x3c/a\x3e to open the new window.",buttons:Ext.Msg.OK})},getTromboneUrl:function(){return this.getApplication().getTromboneUrl()},
dispatchEvent:function(){var a=this.getApplication();a.dispatchEvent.apply(a,arguments)},showError:function(a){this.getApplication().showError.apply(this,arguments)}});Ext.define("Voyant.panel.VoyantTabPanel",{extend:"Ext.tab.Panel",alias:"widget.voyanttabpanel",mixins:["Voyant.panel.Panel"],statics:{i18n:{}},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){this.callParent(arguments)},listeners:{tabchange:function(a,b){this.tools=[];this.getHeader().tools=[];this.query("toolmenu").forEach(function(a){a.destroy()});this.addTool(b.tools);this.getApplication().dispatchEvent("panelChange",
this)},afterrender:function(a){this.fireEvent("tabchange",this,this.getActiveTab())}},showOptionsClick:function(a){var b=a.getActiveTab();b.showOptionsClick&&b.showOptionsClick.apply(b,arguments)}});Ext.define("Voyant.panel.Bubblelines",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.bubblelines",statics:{i18n:{title:{en:"Bubblelines"},type:{en:"Visualization"},findTerm:{en:"Find Term"},clearTerms:{en:"Clear Terms"},removeTerm:{en:"Remove Term"},showTerm:{en:"Show Term"},hideTerm:{en:"Hide Term"},granularity:{en:"Granularity"},separateLines:{en:"Separate Lines for Terms"},total:{en:"Total"},corpusTooSmall:{en:"The provided corpus is too small for this tool."},help:{en:"Bubblelines visualizes the frequency and repetition of  a term's use in a corpus. Each document in the corpus is represented as a horizontal line and divided into segments of equal lengths. Each term is represented as a bubble, the size of the bubble indicates its frequency in the corresponding segment of text. The larger the bubble's radius the more frequently the term occurs."},
adaptedFrom:{en:""}},api:{bins:50,query:null,stopList:"auto",docId:void 0,docIndex:void 0,maxDocs:50},glyph:"xf06e@FontAwesome"},config:{corpus:void 0,docTermStore:void 0,docStore:void 0,options:{xtype:"stoplistoption"}},selectedDocs:void 0,processedDocs:new Ext.util.MixedCollection,bubblelines:null,termTpl:new Ext.XTemplate('\x3ctpl for\x3d"."\x3e','\x3cdiv class\x3d"term" style\x3d"color: rgb({color});float: left;padding: 3px;margin: 2px;"\x3e{term}\x3c/div\x3e',"\x3c/tpl\x3e"),termStore:new Ext.data.ArrayStore({fields:["term",
"color"],listeners:{load:function(a,b,c,d){a=this.down("#termsView");for(c=0;c<b.length;c++)a.select(b[c],!0)},scope:this}}),constructor:function(){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.setCorpus(b);this.getDocStore().getProxy().setExtraParam("corpus",b.getId());this.isVisible()&&this.getDocStore().load();this.getDocTermStore().getProxy().setExtraParam("corpus",
b.getId());this.down("#docSelector").setCorpus(b)},this);this.on("activate",function(){this.getCorpus()&&Ext.Function.defer(function(){this.getDocStore().load()},100,this)},this);this.on("query",function(a,b){void 0!==b&&""!=b&&this.getDocTermsFromQuery(b)},this);this.on("documentsSelected",function(a,b){this.setApiParam("docId",b);this.bubblelines.cache.each(function(a){a.hidden=-1===b.indexOf(a.id)});this.bubblelines.drawGraph()},this);this.on("termsClicked",function(a,b){if(a!==this){var c=[];
b.forEach(function(a){Ext.isString(a)?c.push(a):a.term?c.push(a.term):a.getTerm&&c.push(a.getTerm())});this.getDocTermsFromQuery(c)}},this);this.on("documentTermsClicked",function(a,b){var c=[];b.forEach(function(a){a.getTerm()&&c.push(a.getTerm())});this.getDocTermsFromQuery(c)},this);this.down("#granularity").setValue(parseInt(this.getApiParam("bins")))},initComponent:function(){var a=Ext.create("Ext.data.Store",{model:"Voyant.data.model.Document",autoLoad:!1,remoteSort:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),
extraParams:{tool:"corpus.DocumentsMetadata"},reader:{type:"json",rootProperty:"documentsMetadata.documents",totalProperty:"documentsMetadata.total"},simpleSortMode:!0},listeners:{load:function(a,c,d,e){this.processDocuments(c);this.processedDocs.each(function(a){this.bubblelines.addDocToCache(a)},this);this.loadFromCorpusTerms(this.getCorpus().getCorpusTerms({autoload:!1}))},scope:this}});this.setDocStore(a);a=Ext.create("Ext.data.Store",{model:"Voyant.data.model.DocumentTerm",autoLoad:!1,remoteSort:!1,
proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",withDistributions:"raw",withPositions:!0},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0},listeners:{load:function(a,c,d,e){c.forEach(function(a){var b=this.processTerms(a),c=a.get("docId");a=a.get("term");var d={};d[a]=b;this.bubblelines.addTermsToDoc(d,c)},this);this.bubblelines.doBubblelinesLayout()},scope:this}});this.setDocTermStore(a);
Ext.apply(this,{dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"button",text:this.localize("clearTerms"),handler:function(){this.down("#termsView").getSelectionModel().deselectAll(!0);this.termStore.removeAll();this.setApiParams({query:null});this.bubblelines.removeAllTerms();this.bubblelines.drawGraph()},scope:this},"-",{xtype:"documentselector",itemId:"docSelector"},"-",{xtype:"slider",itemId:"granularity",fieldLabel:this.localize("granularity"),labelAlign:"right",
labelWidth:70,width:150,increment:10,minValue:10,maxValue:300,listeners:{changecomplete:function(a,c){this.setApiParams({bins:c});this.bubblelines.bubbleSpacing=c;this.reloadTermsData()},scope:this}},"-",{xtype:"checkbox",boxLabel:this.localize("separateLines"),boxLabelAlign:"before",checked:!1,handler:function(a,c){this.bubblelines.SEPARATE_LINES_FOR_TERMS=c;this.bubblelines.lastClickedBubbles={};this.bubblelines.setCanvasHeight();this.bubblelines.drawGraph()},scope:this}]}],border:!1,layout:"fit",
items:{layout:{type:"vbox",align:"stretch"},defaults:{border:!1},items:[{height:30,itemId:"termsView",xtype:"dataview",store:this.termStore,tpl:this.termTpl,itemSelector:"div.term",overItemCls:"over",selectedItemCls:"selected",selectionModel:{mode:"SIMPLE"},focusCls:"",listeners:{beforeitemclick:function(a,c,d,e,f,g){f.preventDefault();f.stopPropagation();a.fireEvent("itemcontextmenu",a,c,d,e,f,g);return!1},beforecontainerclick:function(){event.preventDefault();event.stopPropagation();return!1},selectionchange:function(a,
c){var d=this.down("#termsView"),e=[];d.getStore().each(function(a){-1!==c.indexOf(a)?(e.push(a.get("term")),Ext.fly(d.getNodeByRecord(a)).removeCls("unselected").addCls("selected")):Ext.fly(d.getNodeByRecord(a)).removeCls("selected").addCls("unselected")});for(var f in this.bubblelines.lastClickedBubbles){var g=this.bubblelines.lastClickedBubbles[f],h;for(h in g)-1==e.indexOf(h)&&delete this.bubblelines.lastClickedBubbles[f][h]}this.bubblelines.termsFilter=e;this.bubblelines.setCanvasHeight();this.bubblelines.drawGraph()},
itemcontextmenu:function(a,c,d,e,f){f.preventDefault();f.stopPropagation();var g=a.isSelected(d);(new Ext.menu.Menu({floating:!0,items:[{text:g?this.localize("hideTerm"):this.localize("showTerm"),handler:function(){g?a.deselect(e):a.select(e,!0)},scope:this},{text:this.localize("removeTerm"),handler:function(){a.deselect(e);var c=this.termStore.getAt(e).get("term");this.termStore.removeAt(e);a.refresh();this.bubblelines.removeTerm(c);this.bubblelines.setCanvasHeight();this.bubblelines.drawGraph()},
scope:this}]})).showAt(f.getXY())},scope:this}},{flex:1,xtype:"container",autoEl:"div",itemId:"canvasParent",layout:"fit",overflowY:"auto",overflowX:"hidden"}],listeners:{render:function(a){a=this.down("#canvasParent");this.bubblelines=new Bubblelines({container:a,clickHandler:this.bubbleClickHandler.bind(this)});this.bubblelines.bubbleSpacing=parseInt(this.getApiParam("bins"))},afterlayout:function(a){!1===this.bubblelines.initialized&&this.bubblelines.initializeCanvas()},resize:function(a,c,d){this.bubblelines.doBubblelinesLayout()},
scope:this}}});this.callParent(arguments)},loadFromCorpusTerms:function(a){this.bubblelines&&(this.bubblelines.removeAllTerms(),this.termStore.removeAll(!0));a.load({callback:function(a,c,d){var e=[];"string"==typeof e&&(e=[e]);a.forEach(function(a,b){e.push(a.get("term"))},this);this.getDocTermsFromQuery(e)},scope:this,params:{limit:5,stopList:this.getApiParams("stopList")}})},getDocTermsFromQuery:function(a){a&&this.setApiParam("query",a);if(this.getCorpus()&&this.isVisible())for(var b=this.getCorpus().getDocuments(),
c=b.getCount(),d=0;d<c;d++){var e=b.getAt(d);this.setApiParams({query:a,docIndex:void 0,docId:e.getId()});this.getDocTermStore().load({params:this.getApiParams()})}},reloadTermsData:function(){var a=[],b;for(b in this.bubblelines.currentTerms)a.push(b);this.getDocTermsFromQuery(a)},filterDocuments:function(){var a=this.getApiParam("docId");""==a&&(a=[],this.getCorpus().getDocuments().each(function(b,c){a.push(b.getId())}),this.setApiParams({docId:a}));"string"==typeof a&&(a=[a]);if(null==a){this.selectedDocs=
this.getCorpus().getDocuments().clone();var b=this.selectedDocs.getCount();if(10<b)for(var c=10;c<b;c++)this.selectedDocs.removeAt(10);a=[];this.selectedDocs.eachKey(function(b,c){a.push(b)},this);this.setApiParams({docId:a})}else this.selectedDocs=this.getCorpus().getDocuments().filterBy(function(b,c){return-1!=a.indexOf(c)},this)},processDocuments:function(a){a.forEach(this.processDocument,this)},processDocument:function(a){var b=a.getId();if(!this.processedDocs.containsKey(b)){var c=a.getShortTitle(),
c=c.replace("\x26hellip;","..."),d=a.get("index");a=a.get("tokensCount-lexical");this.processedDocs.add(b,{id:b,index:d,title:c,totalTokens:a,terms:{}})}},processTerms:function(a){var b,c=a.get("term");b=a.get("rawFreq");var d=a.get("positions");if(0<b){var e=this.getApplication().getColorForTerm(c);-1===this.termStore.find("term",c)&&(this.termStore.loadData([[c,e]],!0),c=this.termStore.find("term",c),this.down("#termsView").select(c,!0));a=a.get("distributions");b={positions:d,distributions:a,rawFreq:b,
color:e}}else b=!1;return b},bubbleClickHandler:function(a){this.getApplication().dispatchEvent("termsClicked",this,a)}});Ext.define("Voyant.panel.Cirrus",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.cirrus",statics:{i18n:{title:{en:"Cirrus"},helpTip:{en:"\x3cp\x3eCirrus provides a wordcloud view of the most frequently occurring words in the corpus or document \u2013\u00a0this provides a convenient (though reductive) overview of the content. Features include\x3c/p\x3e\x3cul\x3e\x3cli\x3eterm frequency appears when hovering over words\x3c/li\x3e\x3cli\x3eclicking on terms may produce results in other tools if any are displayed\x3c/li\x3e\x3c/ul\x3e"},
visible:{en:"Show"},reset:{en:"reset"},maxTerms:{en:"Max terms"}},api:{stopList:"auto",limit:500,visible:50,terms:void 0,docId:void 0,docIndex:void 0},glyph:"xf06e@FontAwesome"},config:{mode:void 0,options:[{xtype:"stoplistoption"},{xtype:"numberfield",name:"label",fieldLabel:"Max words",labelAlign:"right",value:500,minValue:50,step:50,listeners:{afterrender:function(a){var b=a.up("window");b&&b.panel&&a.setFieldLabel(b.panel.localize("maxTerms"))}}}],corpus:void 0,records:void 0,terms:void 0,visLayout:void 0,
vis:void 0,sizeAdjustment:100,minFontSize:12,largestWordSize:0,smallestWordSize:1E6},MODE_CORPUS:"corpus",MODE_DOCUMENT:"mode_document",layout:"fit",constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(a){Ext.apply(this,{title:this.localize("title"),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"slider",itemId:"visible",fieldLabel:this.localize("visible"),labelAlign:"right",labelWidth:40,width:120,
increment:25,minValue:25,maxValue:500,listeners:{afterrender:function(a){a.maxValue=this.getApiParam("limit");a.increment=parseInt(a.maxValue/50);a.setValue(this.getApiParam("visible"))},changecomplete:function(a,b){this.setApiParams({visible:b});this.loadFromTermsRecords()},scope:this}},{xtype:"tbfill"},{text:this.localize("reset"),hidden:!0,itemId:"reset",handler:function(a){a.hide();(a=this.getCorpus())&&this.loadFromCorpus(a)},scope:this}]}]});if(a&&a.embedded){var b=Ext.getClass(a.embedded).getName();
"Voyant.data.store.CorpusTerms"==b&&this.loadFromCorpusTerms(a.embedded);"Voyant.data.model.Corpus"==b&&this.loadFromCorpusTerms(a.embedded.getCorpusTerms())}this.callParent(arguments)},listeners:{resize:function(a,b,c){this.getVisLayout()&&this.getCorpus()&&(this.setAdjustedSizes(),a=this.getLayout().getRenderTarget(),b=a.getWidth(),c=a.getHeight(),a.down("svg").set({width:b,height:c}),this.getVisLayout().size([b,c]).stop().words(this.getTerms()).start())},loadedCorpus:function(a,b){this.loadFromCorpus(b)},
documentsClicked:function(a,b,c){b&&(this.setApiParam("docId",b[0].getId()),this.loadFromDocumentTerms(b[0].getDocumentTerms({autoload:!1,corpus:c,pageSize:this.getApiParam("maxVisible"),parentPanel:this})))},ensureCorpusView:function(a,b){this.getMode()!=this.MODE_CORPUS&&this.loadFromCorpus(b)},boxready:function(){this.initVisLayout()}},loadFromCorpus:function(a){this.setCorpus(a);this.setApiParams({docId:void 0,docIndex:void 0});this.loadFromCorpusTerms(a.getCorpusTerms({autoload:!1,pageSize:this.getApiParam("maxVisible"),
parentPanel:this}))},loadFromDocumentTerms:function(a){a.load({callback:function(a,c,d){this.setMode(this.MODE_DOCUMENT);this.setRecords(c.getRecords());this.loadFromTermsRecords()},scope:this,params:this.getApiParams()});this.down("#reset").show()},loadFromCorpusTerms:function(a){a.load({callback:function(a,c,d){this.setMode(this.MODE_CORPUS);this.setRecords(c.getRecords());this.loadFromTermsRecords()},scope:this,params:this.getApiParams()})},loadFromTermsRecords:function(){var a=this.getRecords(),
b=this.getApiParam("visible");b>a.length&&(b=a.length);for(var c=[],d=0;d<b;d++)c.push({text:a[d].get("term"),rawFreq:a[d].get("rawFreq")});this.setTerms(c);this.buildFromTerms()},initVisLayout:function(){if(void 0==this.getVisLayout()){var a=this.getLayout().getRenderTarget(),b=a.getWidth(),c=a.getHeight();this.setVisLayout(d3.layout.cloud().size([b,c]).padding(1).rotate(function(){return 90*~~(2*Math.random())}).spiral("archimedean").font("Impact").fontSize(function(a){return a.fontSize}.bind(this)).text(function(a){return a.text}).on("end",
this.draw.bind(this)));a=d3.select(a.dom).append("svg").attr("id","cirrusGraph").attr("width",b).attr("height",c);this.setVis(a.append("g").attr("transform","translate("+b/2+","+c/2+")"));Ext.create("Ext.tip.ToolTip",{target:a.node(),delegate:"text",trackMouse:!0,listeners:{beforeshow:function(a){var b=a.triggerElement.getAttribute("data-freq");a.update(b)}}})}},buildFromTerms:function(){var a=this.getTerms();if(this.rendered&&a){for(var b=1E3,c=-1,d=0;d<a.length;d++){var e=a[d].rawFreq;e<b&&(b=e);
e>c&&(c=e)}this.setSmallestWordSize(b);this.setLargestWordSize(c);this.setRelativeSizes();this.setAdjustedSizes();this.getVisLayout().words(a).start()}else Ext.defer(this.buidlFromTerms,50,this)},draw:function(a,b){var c=this;this.getLayout().getRenderTarget();var d=this.getVisLayout().size()[0],e=this.getVisLayout().size()[1],f=b?Math.min(d/Math.abs(b[1].x-d/2),d/Math.abs(b[0].x-d/2),e/Math.abs(b[1].y-e/2),e/Math.abs(b[0].y-e/2))/2:1,g=this.getVis().selectAll("text").data(a,function(a){return a.text});
g.transition().duration(1E3).attr("transform",function(a){return"translate("+[a.x,a.y]+")rotate("+a.rotate+")"}).style("font-size",function(a){return a.fontSize+"px"});g.enter().append("text").attr("text-anchor","middle").attr("data-freq",function(a){return a.rawFreq}).attr("transform",function(a){return"translate("+[a.x,a.y]+")rotate("+a.rotate+")"}).style("font-size","1px").transition().duration(1E3).style("font-size",function(a){return a.fontSize+"px"});g.style("font-family",function(a){return a.font}).style("fill",
function(a){return c.getApplication().getColorForTerm(a.text,!0)}).text(function(a){return a.text}).on("click",function(a){c.dispatchEvent("termsClicked",c,[a.text])});g.exit().remove();this.getVis().transition().duration(1E3).attr("transform","translate("+d/2+","+e/2+")scale("+f+")")},map:function(a,b,c,d,e){return d+(a-b)/(c-b)*(e-d)},calculateSizeAdjustment:function(){var a=this.getTerms();if(void 0!==a){var b=this.getLayout().getRenderTarget(),b=b.getWidth()*b.getHeight();1E5>b?this.setMinFontSize(8):
this.setMinFontSize(12);for(var c=0,d=0;d<a.length;d++)var e=this.calculateWordArea(a[d]),c=c+e;this.setSizeAdjustment(b/c)}},calculateWordArea:function(a){for(var b=Math.log(10*a.relativeSize)*Math.LOG10E,c=(b+a.relativeSize)/2,d=0,e=0;e<a.text.length;e++)var f=a.text.charAt(e),d="f"==f||"i"==f||"j"==f||"l"==f||"r"==f||"t"==f?d+b/3:"m"==f||"w"==f?d+b/(4/3):d+b/1.9;return c*d},setAdjustedSizes:function(){this.calculateSizeAdjustment();var a=this.getTerms();if(void 0!==a)for(var b=0;b<a.length;b++){var c=
a[b],d=this.findNewRelativeSize(c);c.fontSize=d>this.getMinFontSize()?d:this.getMinFontSize()}},setRelativeSizes:function(){var a=this.getTerms();if(void 0!==a)for(var b=0;b<a.length;b++){var c=a[b];c.relativeSize=this.map(c.rawFreq,this.getSmallestWordSize(),this.getLargestWordSize(),.1,1)}},findNewRelativeSize:function(a){var b=this.getSizeAdjustment(),b=this.calculateWordArea(a)*b;return(Math.sqrt(6)*Math.sqrt(6*Math.pow(a.text.length,2)+b*a.text.length)-6*a.text.length)/(2*a.text.length)}});Ext.define("Voyant.panel.CollocatesGraph",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.collocatesgraph",statics:{i18n:{title:{en:"Links"},helpTip:{en:"\x3cp\x3eCollocates graph shows a network graph of higher frequency terms that appear in proximity. Keywords are shown in blue and collocates (words in proximity) are showing in orange. Features include:\x3cul\x3e\x3cli\x3ehovering over keywords shows their frequency in the corpus\x3c/li\x3e\x3cli\x3ehovering over collocates shows their frequency in proximity (not their total frequency)\x3c/li\x3e\x3cli\x3edouble-clicking on any word fetches more results\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
clearTerms:{en:"Clear Terms"},releaseToRemove:{en:"Release to remove this term"},cleaning:{en:"Cleaning"},context:{en:"Context"}},api:{query:void 0,mode:void 0,limit:15,stopList:"auto",terms:void 0,context:5},glyph:"xf1cb@FontAwesome"},config:{corpus:void 0,node:void 0,link:void 0,nodeDataSet:new vis.DataSet,edgeDataSet:new vis.DataSet,network:void 0,contextMenu:void 0,force:void 0,graphHeight:void 0,graphWidth:void 0,corpusColours:d3.scale.category10()},nodeOptions:{shape:"box",color:{border:"rgba(0,0,0,0.1)",
background:"rgba(255,255,255,1)"},scaling:{label:{min:10,max:30}}},edgeOptions:{color:{color:"rgba(0,0,0,0.1)",highlight:"black",hover:"red"},labelHighlightBold:!1},highlightOptions:{font:{color:"white"},color:{background:"black"}},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){var a=this;Ext.apply(a,{title:this.localize("title"),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},
{text:a.localize("clearTerms"),handler:function(){this.getNodeDataSet().clear()},scope:a},this.localize("context"),{xtype:"slider",minValue:3,value:5,maxValue:30,increment:2,width:50,listeners:{render:function(b){b.setValue(a.getApiParam("context"))},changecomplete:{fn:function(a,c){this.setApiParam("context",a.getValue());var d=this.getNodeDataSet().map(function(a){return a.label});0<d.length&&(this.getNodeDataSet().clear(),this.loadFromQuery(d))},scope:a}}}]}]});this.setContextMenu(Ext.create("Ext.menu.Menu",
{renderTo:Ext.getBody(),items:[{text:"",itemId:"label",disabled:!0},{xtype:"menuseparator"},{xtype:"menucheckitem",text:"Fixed",itemId:"fixed",listeners:{checkchange:function(a,c,d){a=this.getNetwork().getSelectedNodes();null!=a[0]&&this.getNodeDataSet().update({id:a[0],fixed:c})},scope:this}},{xtype:"button",text:"Remove",style:"margin: 5px;",handler:function(a,c){var d=this.getNetwork().getSelectedNodes();null!=d[0]&&(this.getNodeDataSet().remove(d[0]),a.up("menu").hide(),this.forceUpdate())},scope:this}]}));
this.on("loadedCorpus",function(a,c){this.setCorpus(c);this.isVisible()&&this.initLoad()},this);this.on("activate",function(){this.getCorpus()&&Ext.Function.defer(this.initLoad,100,this)},this);this.on("query",function(a,c){this.loadFromQuery(c)},this);this.on("resize",function(a,c,d){a=this.getLayout().getRenderTarget();c=this.getDockedItems();for(var e=0,f=0;f<c.length;f++)e+=c[f].getHeight();a.setHeight(d-e);a.setWidth(a.getWidth());this.setGraphHeight(a.getHeight());this.setGraphWidth(a.getWidth());
void 0!==this.getNetwork()&&this.getNetwork().fit()},this);this.mixins["Voyant.panel.Panel"].initComponent.apply(this,arguments);a.callParent(arguments)},initLoad:function(){this.getCorpus()&&(this.initGraph(),this.getCorpus().getCorpusTerms({leadingBufferZone:0,autoLoad:!1}).load({callback:function(a,b,c){c&&this.loadFromCorpusTermRecords(a)},scope:this,params:{limit:10,stopList:this.getApiParam("stopList")}}))},loadFromQuery:function(a){var b=this.getCorpus().getCorpusCollocates({autoLoad:!1});
this.setApiParams({query:a,mode:"corpus"});b.load({params:this.getApiParams(),callback:function(a,b,e){e&&this.loadFromCorpusCollocateRecords(a)},scope:this})},loadFromCorpusTermRecords:function(a){if(Ext.isArray(a)&&0<a.length){var b=[];a.forEach(function(a){b.push(a.getTerm())});this.loadFromCorpusTermStringsArray(b)}},loadFromCorpusTermStringsArray:function(a){var b=this.getCorpus().getCorpusCollocates({autoLoad:!1});this.setApiParams({query:a,mode:"corpus"});b.load({params:this.getApiParams(),
callback:function(a,b,e){e&&this.loadFromCorpusCollocateRecords(a)},scope:this})},loadFromCorpusCollocateRecords:function(a,b){if(Ext.isArray(a)){var c={};this.getNodeDataSet().forEach(function(a){c[a.id]=!0});var d=[],e=[],f=this.getEdgeDataSet(),g=this.getApiParam("limit");a.forEach(function(a){if(a.getContextTerm()!=a.getTerm()){if(void 0===b){var k={id:a.getKeyword(),label:a.getKeyword(),title:a.getKeyword()+" ("+a.getKeywordRawFreq()+")",type:"keyword",value:a.getKeywordRawFreq(),start:g};b=
k.id;void 0===c[b]&&(c[b]=!0,d.push(k))}a={id:a.getContextTerm(),label:a.getContextTerm(),title:a.getContextTerm()+" ("+a.getContextTermRawFreq()+")",type:"context",value:a.getContextTermRawFreq(),start:0};var l=a.id;void 0===c[l]&&(c[l]=!0,d.push(a));var m=!1;f.forEach(function(a){if(a.from==b&&a.to==l||a.from==l&&a.to==b)m=!0});m||e.push({from:b,to:l})}});this.getNodeDataSet().add(d);f.add(e);this.forceUpdate();this.getNetwork().fit()}},initGraph:function(){var a=this.getLayout().getRenderTarget();
a.setWidth(a.getWidth());a.setHeight(a.getHeight());this.setGraphHeight(a.getHeight());this.setGraphWidth(a.getWidth());if(void 0===this.getNetwork()){var b={autoResize:!0,interaction:{hover:!0,hoverConnectedEdges:!0,multiselect:!1},physics:{barnesHut:{}},nodes:this.nodeOptions,edges:this.edgeOptions},a=new vis.Network(a.dom,{nodes:this.getNodeDataSet(),edges:this.getEdgeDataSet()},b);this.setNetwork(a);this.getNodeDataSet().on("remove",function(a,b,e){var f=b.items[0];a=this.getEdgeDataSet().get({filter:function(a){return a.from==
f||a.to==f}});this.getEdgeDataSet().remove(a);var g=[];this.getNodeDataSet().forEach(function(a){0==this.getEdgeDataSet().get({filter:function(b){return b.from==a.id||b.to==a.id}}).length&&g.push(a.id)}.bind(this));this.getNodeDataSet().remove(g)}.bind(this));a.on("dragStart",function(a){a=a.nodes[0];null!=a&&this.getNodeDataSet().update({id:a,fixed:!1})}.bind(this));a.on("dragging",function(a){null!=a.nodes[0]&&(this.isMasked()?this.isOffCanvas(a.pointer.DOM)||this.unmask():this.isOffCanvas(a.pointer.DOM)&&
this.mask(this.localize("releaseToRemove")))}.bind(this));a.on("dragEnd",function(a){var b=a.nodes[0];null!=b&&(this.isOffCanvas(a.pointer.DOM)?(this.unmask(),this.mask("cleaning"),this.getNodeDataSet().remove(b),this.forceUpdate(),this.unmask()):this.getNodeDataSet().update({id:b,fixed:!0}))}.bind(this));a.on("click",function(a){this.getContextMenu().hide()}.bind(this));a.on("doubleClick",function(a){a=a.nodes[0];null!=a&&(a=this.getNodeDataSet().get(a),this.itemdblclick(a))}.bind(this));a.on("oncontext",
function(a){a.event.preventDefault();var b=this.getNetwork().getNodeAt(a.pointer.DOM);if(null!=b){this.getNetwork().selectNodes([b]);var b=this.getNodeDataSet().get(b),e=this.getContextMenu();e.queryById("label").setText(b.label);e.queryById("fixed").setChecked(b.fixed);e.showAt(a.event.pageX,a.event.pageY)}}.bind(this))}},forceUpdate:function(){var a=this.getNodeDataSet().map(function(a){return{id:a.id}});this.getNodeDataSet().update(a)},isOffCanvas:function(a){return 0>a.x||0>a.y||a.x>this.getGraphWidth()||
a.y>this.getGraphHeight()},itemdblclick:function(a){var b=this.getApiParam("limit");this.getCorpus().getCorpusCollocates({autoLoad:!1}).load({params:Ext.apply(this.getApiParams(),{query:a.label,start:a.start,limit:b}),callback:function(c,d,e){e&&(this.getNodeDataSet().update({id:a.id,start:a.start+b}),this.loadFromCorpusCollocateRecords(c,a.label))},scope:this})}});Ext.define("Voyant.panel.Contexts",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],requires:["Voyant.data.store.Contexts"],alias:"widget.contexts",statics:{i18n:{title:{en:"Contexts"},emptyText:{en:"No matching results."},document:{en:"Document"},documentTip:{en:"The document of the occurrence."},helpTip:{en:"The Keywords in Context tool shows each occurrence of a keyword with a bit of surounding text (the context). It can be useful for studying more closely how terms are used in different contexts. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering document, by keyword or by left or right context\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
termTip:{en:"The keyword for the context."},left:{en:"Left"},leftTip:{en:"Context to the left of the keyword."},right:{en:"Right"},rightTip:{en:"Context to the right of the keyword."},position:{en:"Position"},positionTip:{en:"The position of the keyword within the document."},context:{en:"context"},expand:{en:"expand"},corpus:{en:"corpus"},corpusTip:{en:"Reset to corpus mode (contexts from all documents)."}},api:{query:void 0,docId:void 0,docIndex:void 0,stopList:"auto",context:5,expand:50},glyph:"xf0ce@FontAwesome"},
constructor:function(){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){var a=this;Ext.apply(a,{title:this.localize("title"),emptyText:this.localize("emptyText"),store:Ext.create("Voyant.data.store.Contexts",{parentPanel:this,stripTags:"all",sortOnLoad:!0,sorters:{property:"position",direction:"ASC"}}),selModel:Ext.create("Ext.selection.RowModel",{listeners:{selectionchange:{fn:function(a,c){this.getApplication().dispatchEvent("termLocationClicked",
this,c)},scope:this}}}),plugins:[{ptype:"rowexpander",rowBodyTpl:new Ext.XTemplate("")}],dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"totalpropertystatus"},this.localize("context"),{xtype:"slider",minValue:5,value:5,maxValue:50,increment:5,width:50,listeners:{render:function(b){b.setValue(a.getApiParam("context"))},changecomplete:function(b,c){a.setApiParam("context",b.getValue());a.getStore().loadPage(1,{params:a.getApiParams()})}}},this.localize("expand"),
{xtype:"slider",minValue:5,value:5,maxValue:500,increment:10,width:50,listeners:{render:function(b){b.setValue(a.getApiParam("expand"))},changecomplete:function(b,c){a.setApiParam("expand",c);var d=a.getView(),e=a.plugins[0].recordsExpanded,f=d.getStore(),g;for(g in e){var h=f.getByInternalId(g),k=d.getRow(h),l=k.parentNode.childNodes[1];e[g]?d.fireEvent("expandbody",k,h,l,{force:!0}):Ext.fly(l).down(".x-grid-rowbody").setHtml("")}}}},{text:this.localize("corpus"),tooltip:this.localize("corpusTip"),
itemId:"corpus",handler:function(a){a.hide();this.setApiParams({docIndex:void 0,docId:void 0});this.getStore().load({params:this.getApiParams()})},hidden:!0,scope:this}]}],columns:[{text:this.localize("document"),toolTip:this.localize("documentTip"),width:"autoSize",dataIndex:"docIndex",sortable:!0,renderer:function(a,c,d,e,f,g){return g.getCorpus().getDocument(a).getTinyLabel()}},{text:this.localize("left"),tooltip:this.localize("leftTip"),align:"right",dataIndex:"left",sortable:!0,flex:1},{text:this.localize("term"),
tooltip:this.localize("termTip"),dataIndex:"term",sortable:!0,width:"autoSize"},{text:this.localize("right"),tooltip:this.localize("rightTip"),dataIndex:"right",sortable:!0,flex:1},{text:this.localize("position"),tooltip:this.localize("positionTip"),dataIndex:"position",sortable:!0,hidden:!0,flex:1}],listeners:{documentSegmentTermClicked:{fn:function(a,c){c.term&&(params={query:c.term},c.docId?params.docId=c.docId:params.docIndex=c.docIndex?c.docIndex:0,this.setApiParams(params),this.isVisible()&&
this.getStore().loadPage(1,{params:this.getApiParams()}))},scope:this},documentIndexTermsClicked:{fn:function(a,c){var d={},e=[],f={},g=[];c.forEach(function(a){d[a.term]||(e.push(a.term),d[a.term]=!0);f[a.docIndex]||(g.push(a.docIndex),f[a.docIndex]=!0)});this.setApiParams({docId:void 0,docIndex:g,query:e});this.down("#corpus").show();this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})},scope:this},afterrender:function(a){a.getView().on("expandbody",function(c,d,e,f){if(""===
e.innerText||f&&f.force){c=Ext.create("Voyant.data.store.Contexts",{stripTags:"all",corpus:a.getStore().getCorpus()});var g=d.getData();c.load({params:{query:g.query,docIndex:g.docIndex,position:g.position,limit:1,context:a.getApiParam("expand")},callback:function(a,b,c){c&&1==a.length&&(g=a[0].getData(),b.expandRow.firstElementChild.firstElementChild.innerHTML=g.left+" \x3cspan class\x3d'word keyword'\x3e"+g.middle+"\x3c/span\x3e "+g.right)},expandRow:e})}})}}});a.on("loadedCorpus",function(b,c){this.getStore().setCorpus(c);
Ext.create("Voyant.data.store.CorpusTerms",{corpus:c}).load({callback:function(a,b,c){c&&0<a.length&&(this.setApiParam("query",a[0].getTerm()),this.getStore().load({params:this.getApiParams()}))},scope:a,params:{limit:1,stopList:this.getApiParam("stopList")}})});a.on("query",function(a,c){this.setApiParam("query",c);this.getStore().load({params:this.getApiParams()})},a);a.on("documentTermsClicked",function(a,c){var d=[];c.forEach(function(a){d.push({term:a.getTerm(),docIndex:a.getDocIndex()})});this.fireEvent("documentIndexTermsClicked",
this,d)});a.on("termsClicked",function(a,c){var d=[];Ext.isString(c)&&(c=[c]);c.forEach(function(a){void 0!==a.docIndex&&d.push({term:a.term,docIndex:a.docIndex})});0<d.length&&this.fireEvent("documentIndexTermsClicked",this,d)});a.callParent(arguments)}});Ext.define("Voyant.panel.CorpusCollocates",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.corpuscollocates",config:{corpus:void 0},statics:{i18n:{title:{en:"Collocates"},emptyText:{en:"No matching results."},helpTip:{en:"\x3cp\x3eCorpus Collocates is a table view of which terms appear more frequently in proximity to keywords across the entire corpus. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering by keyword, collocate word, collocate word count\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
term:{en:"Term"},termTip:{en:"This is the keyword term around which collocate (context) terms are counted."},termRawFreq:{en:"Count (keyword)"},termRawFreqTip:{en:"The number of times the keyword term occurs in the corpus."},contextTerm:{en:"Collocate"},contextTermTip:{en:"This is the collocate (context) term that occurs near the keyword term."},contextTermRawFreq:{en:"Count (context)"},contextTermRawFreqTip:{en:"The number of times this collocate occurs near the keyword term in the corpus."},matchingTerms:{en:"{count}"},
context:{en:"context"}},api:{stopList:"auto",context:5,query:void 0,docId:void 0,docIndex:void 0,sort:"contextTermRawFreq"},glyph:"xf0ce@FontAwesome"},config:{options:{xtype:"stoplistoption"}},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,c){this.getStore().setCorpus(c);this.isVisible()&&this.loadFromApis()});a.embedded||a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus);this.on("corpusTermsClicked",
function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){d.push(a.get("term"))});this.setApiParams({query:d,docId:void 0,docIndex:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})}});this.on("documentsClicked",function(a,c){var d=[];c.forEach(function(a){d.push(a.get("id"))});this.setApiParams({docId:d,docid:void 0,query:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})});this.on("activate",function(){this.getStore().getCorpus()&&
this.loadFromApis()},this);this.on("query",function(a,c){this.setApiParam("query",c);this.getStore().getProxy().setExtraParam("query",c);this.loadFromApis()},this)},loadFromApis:function(){this.getStore().getCorpus()&&(this.getApiParam("query")?this.getStore().loadPage(1,{params:this.getApiParams()}):this.getStore().getCorpus().getCorpusTerms({leadingBufferZone:0,autoLoad:!1}).load({callback:function(a,b,c){if(c){var d=[];a.forEach(function(a){d.push(a.getTerm())});this.getStore().getProxy().setExtraParam("query",
d);this.setApiParam("query",d);this.loadFromApis()}},scope:this,params:{limit:10,stopList:this.getApiParam("stopList")}}))},initComponent:function(){var a=this,b=Ext.create("Voyant.data.store.CorpusCollocates",{parentPanel:this});Ext.apply(a,{title:this.localize("title"),emptyText:this.localize("emptyText"),store:b,selModel:Ext.create("Ext.selection.CheckboxModel",{listeners:{selectionchange:{fn:function(a,b){var e=[],f=this.getApiParam("context");b.forEach(function(a){e.push('"'+a.getKeyword()+" "+
a.getContextTerm()+'"~'+f)});this.getApplication().dispatchEvent("termsClicked",this,e)},scope:this}}}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"totalpropertystatus"},this.localize("context"),{xtype:"slider",minValue:1,value:5,maxValue:30,increment:2,width:50,listeners:{render:function(b){b.setValue(a.getApiParam("context"))},changecomplete:function(b,d){a.setApiParam("context",b.getValue());a.getStore().loadPage(1,{params:a.getApiParams()})}}}]}],columns:[{text:this.localize("term"),
dataIndex:"term",tooltip:this.localize("termTip"),sortable:!0,flex:1},{text:this.localize("rawFreq"),dataIndex:"rawFreq",tooltip:this.localize("termRawFreqTip"),sortable:!0,width:"autoSize",hidden:!0},{text:this.localize("contextTerm"),dataIndex:"contextTerm",tooltip:this.localize("contextTermTip"),flex:1,sortable:!0},{text:this.localize("contextTermRawFreq"),tooltip:this.localize("contextTermRawFreqTip"),dataIndex:"contextTermRawFreq",width:"autoSize",sortable:!0}],listeners:{termsClicked:{fn:function(a,
b){if(this.getStore().getCorpus()){var e=[];b.forEach(function(a){Ext.isString(a)?e.push(a):a.term?e.push(a.term):a.getTerm&&e.push(a.getTerm())});0<e.length&&(this.setApiParams({docIndex:void 0,docId:void 0,query:e}),this.isVisible()&&this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()}))}},scope:this}}});a.callParent(arguments);a.getStore().getProxy().setExtraParam("withDistributions",!0)}});Ext.define("Voyant.panel.CorpusCreator",{extend:"Ext.form.Panel",requires:["Ext.form.field.File"],requires:["Voyant.data.model.Corpus"],mixins:["Voyant.panel.Panel"],alias:"widget.corpuscreator",statics:{i18n:{title:{en:"Add Texts"},helpTip:{en:"This tool allows you to create a corpus in one of three ways:\x3col\x3e\x3cli\x3eby typing or pasting text into the text box and clicking \x3ci\x3eReveal\x3c/i\x3e; if each line in the text box is a URL, text is fetched from those URLs, otherwise the contents are treated as a single document\x3c/li\x3e\x3cli\x3eclick the \x3ci\x3eOpen\x3c/i\x3e button to open an existing corpus\x3c/li\x3e\x3cli\x3eclick the \x3ci\x3eUpload\x3c/i\x3e button to upload one or more files from you computer (you can select multiple files by using the Ctrl and/or Shift keys)\x3c/li\x3e\x3c/ul\x3e"},
gearTip:{en:"Options"},gearWinTitle:{en:"Options"},inputFormat:{en:"Input Format"},inputFormatAuto:{en:"Auto-Detect (recommended)"},advancedOptionsText:{en:"The advanced options below only apply to certain input formats. See the documentation on \x3ca href\x3d'{0}' target\x3d'voyantdocs'\x3ecreating a corpus\x3c/a\x3e."},xmlOptions:{en:"XML"},xmlOptionsText:{en:"Define XPath Expressions for any of the following:"},xpathDocuments:{en:"Documents"},xpathGroupBy:{en:"Group by"},xpathContent:{en:"Content"},
xpathTitle:{en:"Title"},xpathAuthor:{en:"Author"},tableOptions:{en:"Tabular Data"},tableDocuments:{en:"Documents"},tableContent:{en:"Content"},tableTitle:{en:"Title"},tableAuthor:{en:"Author"},tokenizationOptions:{en:"Tokenization"},tokenization:{en:"Tokenization"},tokenizationAuto:{en:"Automatic (highly recommended)"},tokenizationWordBoundaries:{en:"Simple Word Boundaries"},emptyInput:{en:"Type in one or more URLs on separate lines or paste in a full text."},uploadingCorpus:{en:"Uploading corpus\u2026"},
fileTypesWarning:{en:"File Types Warning"},fileTypesMessage:{en:"You have one or more files with incompatible or unrecognized file extensions that may cause problems."},badFiles:{en:"incompatible (likely error): "},unknownFiles:{en:"unrecognized (possible error): "},sureContinue:{en:"Are you sure you wish to continue?"},error:{en:"Error"},errorNotXmlContinue:{en:"You've selected an XML input format but the input doesn't appear to be XML. Are you sure you wish to continue?"},reveal:{en:"Reveal"},ok:{en:"OK"},
cancel:{en:"Cancel"}},api:{inputFormat:void 0,xmlDocumentsXpath:void 0,xmlContentXpath:void 0,xmlTitleXpath:void 0,xmlAuthorXpath:void 0,tokenization:void 0}},config:{corpus:void 0},constructor:function(a){this.callParent(arguments);a=a||{};this.mixins["Voyant.panel.Panel"].constructor.call(this,Ext.apply(a,{includeTools:{gear:!0,help:!0}}))},initComponent:function(){var a=this;Ext.apply(a,{title:this.localize("title"),width:800,frame:!0,padding:10,style:{borderColor:"#aaa",borderStyle:"solid"},frameHeader:!0,
layout:{type:"vbox",align:"middle"},dockedItems:[{xtype:"toolbar",dock:"bottom",buttonAlign:"right",defaultButtonUI:"default",items:[{text:"Open",glyph:"xf115@FontAwesome",tooltip:"Select an exsting corpus",hidden:void 0!=this.getCorpus(),handler:function(){Ext.create("Ext.window.Window",{title:"Open an Existing Corpus",layout:"fit",modal:!0,items:{xtype:"form",submitEmptyText:!1,margin:"5,5,5,5",items:{xtype:"combo",labelWidth:150,fieldLabel:"Choose a corpus:",name:"corpus",queryMode:"local",store:[["shakespeare",
"Shakespeare's Plays"],["austen","Austen's Novels"]],forceSelection:!0},buttons:[{text:"Open",glyph:"xf00c@FontAwesome",handler:function(b){b.up("form").getForm();var c=b.up("form").getForm().getValues().corpus;""!=c?(a.loadCorpus({corpus:c}),b.up("window").close()):Ext.Msg.show({title:"Select a Corpus",message:"Please be sure to select a corpus.",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})},flex:1},{text:"Cancel",glyph:"xf00d@FontAwesome",flex:1,handler:function(a){a.up("window").close()}}]}}).show()}},
{xtype:"filefield",glyph:"xf093@FontAwesome",name:"upload",buttonOnly:!0,hideLabel:!0,buttonText:"Upload",tooltip:"test",listeners:{render:function(a){a.fileInputEl.dom.setAttribute("multiple",!0);Ext.QuickTips.register({target:a.getEl(),text:"Upload one or more documents from your computer",enabled:!0,showDelay:20,trackMouse:!0,autoShow:!0})},change:function(b,c){if(c){var d=b.up("form").getForm();if(d.isValid()){for(var e=b.fileInputEl.dom.files,f=/\.(png|gif|jpe?g|xls|mp[234a]|mpeg|exe|wmv|avi|ppt|mpg|tif|wav|mov|psd|wma|ai|bmp|pps|aif|pub|dwg|indd|swf|asf|mbd|dmg|flv)$/i,
g=/\.(txt|pdf|html?|xml|docx?|rtf|pages|odt|zip|jar|tar|gz|ar|cpio|bzip2|bz2|gzip)$/i,h=[],k=[],l=0,m=e.length;l<m;l++){var n=e[l].name;f.test(n)?h.push(n.split("/").pop()):g.test(n)||k.push(n.split("/").pop())}0<h.length||0<k.length?Ext.Msg.show({title:a.localize("fileTypesWarning"),icon:Ext.MessageBox.ERROR,message:a.localize("fileTypesMessage")+"\x3cul\x3e"+(0<h.length?"\x3cli\x3e"+a.localize("badFiles")+h.slice(0,5).join(", ")+(5<h.length?"\u2026":"")+"\x3c/li\x3e":"")+(0<k.length?"\x3cli\x3e"+
a.localize("unknownFiles")+k.slice(0,5).join(", ")+(5<k.length?"\u2026":"")+"\x3c/li\x3e":"")+"\x3c/ul\x3e"+a.localize("sureContinue"),buttons:Ext.Msg.YESNO,fn:function(c){"yes"===c?a.loadForm(d):(b.reset(),b.fileInputEl.dom.setAttribute("multiple",!0))},scope:d}):a.loadForm(d)}}}}},"-\x3e",{xtype:"button",scale:"large",glyph:"xf00d@FontAwesome",text:this.localize("cancel"),hidden:void 0==this.getCorpus(),handler:function(a){(a=this.up("window"))&&a.isFloating()&&a.close()}},{xtype:"button",scale:"large",
glyph:"xf00c@FontAwesome",text:this.localize("reveal"),handler:function(b){var c=b.up("form").down("#input").getValue();if(""!==c){var d=a.getApiParams();delete d.view;delete d.stopList;d.inputFormat&&0!==c.trim().indexOf("\x3c")?Ext.Msg.confirm(a.localize("error"),a.localize("errorNotXmlContinue"),function(b){"yes"==b&&a.loadCorpus(Ext.apply(d,{input:c}))},a):a.loadCorpus(Ext.apply(d,{input:c}))}else Ext.Msg.show({title:"No Text Provided",message:"Please provide text in the text box (or choose open or upload).",
buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}]}],items:{xtype:"textareafield",width:800,height:100,itemId:"input",emptyText:this.localize("emptyInput")}});a.callParent(arguments)},loadForm:function(a){var b={tool:this.getCorpus()?"corpus.CorpusMetadata":"corpus.CorpusCreator"};this.getCorpus()&&Ext.apply(b,{corpus:this.getCorpus().getId(),addDocuments:!0});var c=this.getApiParams();delete c.view;delete c.stopList;Ext.apply(b,c);var d=this.getApplication().getViewport();d.mask(this.localize("uploadingCorpus"));
a.submit({url:this.getTromboneUrl(),params:b,failure:function(a,b){d.unmask();b.result&&(this.setCorpus(void 0),this.loadCorpus({corpus:b.result.corpus?b.result.corpus.metadata.id:b.result.stepEnabledCorpusCreator.storedId}))},scope:this})},loadCorpus:function(a){this.getCorpus()&&Ext.apply(a,{corpus:this.getCorpus().getId(),addDocuments:!0});var b=this.up("window");b&&b.isFloating()&&b.close();var c=this.getApplication(),d=c.getViewport();d.mask();(new Corpus(a)).then(function(a){d.unmask();c.dispatchEvent("loadedCorpus",
c,a)}).fail(function(a,b){d.unmask();c.showErrorResponse({message:a},b)})},showOptionsClick:function(a){void 0===a.optionsWin&&(a.optionsWin=Ext.create("Ext.window.Window",{title:a.localize("gearWinTitle"),closeAction:"hide",layout:"fit",bodyPadding:10,items:[{xtype:"form",defaultType:"textfield",fieldDefaults:{labelAlign:"right",labelWidth:80,width:320},items:[{xtype:"combo",fieldLabel:a.localize("inputFormat"),labelWidth:90,name:"inputFormat",queryMode:"local",store:[["",a.localize("inputFormatAuto")],
["dtoc","DToC: Dynamic Table of Contexts"],["TEI","TEI: Text Encoding Initative"],["TEI","TEI Corpus"],["RSS","Really Simple Syndication: RSS"]],forceSelection:!0,value:""},{xtype:"container",html:"\x3cp\x3e\x3ci\x3e"+(new Ext.Template(a.localize("advancedOptionsText"))).applyTemplate([a.getBaseUrl()+"docs/#!/guide/corpuscreator"])+"\x3c/i\x3e\x3c/p\x3e",width:375},{xtype:"fieldset",title:"\x3ca href\x3d'"+a.getBaseUrl()+"docs/#!/guide/corpuscreator-section-xml' target\x3d'voyantdocs'\x3e"+a.localize("xmlOptions")+
"\x3c/a\x3e",collapsible:!0,collapsed:!0,defaultType:"textfield",items:[{xtype:"container",html:"\x3cp\x3e\x3ci\x3e"+a.localize("xmlOptionsText")+"\x3c/i\x3e\x3c/p\x3e",width:375},{fieldLabel:a.localize("xpathContent"),name:"xmlContentXpath"},{fieldLabel:a.localize("xpathTitle"),name:"xmlTitleXpath"},{fieldLabel:a.localize("xpathAuthor"),name:"xmlAuthorXpath"},{fieldLabel:a.localize("xpathDocuments"),name:"xmlDocumentsXpath"},{fieldLabel:a.localize("xpathGroupBy"),name:"xmlGroupByXpath"}]},{xtype:"fieldset",
title:"\x3ca href\x3d'"+a.getBaseUrl()+"docs/#!/guide/corpuscreator-section-tokenization' target\x3d'voyantdocs'\x3e"+a.localize("tokenizationOptions")+"\x3c/a\x3e",collapsible:!0,collapsed:!0,items:[{xtype:"combo",fieldLabel:a.localize("tokenization"),name:"tokenization",queryMode:"local",store:[["",a.localize("tokenizationAuto")],["wordBoundaries",a.localize("tokenizationWordBoundaries")]],forceSelection:!0,value:""}]}]}],buttons:[{text:a.localize("ok"),handler:function(b,c){var d=b.findParentByType("window"),
e=d.down("form").getValues();a.setApiParams(e);d.hide()}},{text:a.localize("cancel"),handler:function(a,c){a.findParentByType("window").hide()}}]}));a.optionsWin.show()}});Ext.define("Voyant.panel.Knots",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.knots",statics:{i18n:{title:{en:"Knots"},type:{en:"Visualization"},findTerm:{en:"Find Term"},clearTerms:{en:"Clear Terms"},removeTerm:{en:"Remove Term"},showTerm:{en:"Show Term"},hideTerm:{en:"Hide Term"},speed:{en:"Speed"},startAngle:{en:"Start Angle"},tangles:{en:"Tangles"},context:{en:"Context"}},api:{query:null,stopList:"auto",docId:void 0},glyph:"xf06e@FontAwesome"},config:{corpus:void 0,docTermStore:void 0,
tokensStore:void 0,options:{xtype:"stoplistoption"},refreshInterval:100,startAngle:315,angleIncrement:15,currentTerm:void 0},knots:null,termTpl:new Ext.XTemplate('\x3ctpl for\x3d"."\x3e','\x3cdiv class\x3d"term" style\x3d"color: rgb({color});float: left;padding: 3px;margin: 2px;"\x3e{term}\x3c/div\x3e',"\x3c/tpl\x3e"),termStore:new Ext.data.ArrayStore({fields:["term","color"]}),constructor:function(){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,
arguments);this.on("loadedCorpus",function(a,b){this.setCorpus(b);var c=b.getDocument(0),d=this.processDocument(c);this.knots.setCurrentDoc(d);this.setApiParams({docId:c.getId()});this.getDocTermStore().getProxy().setExtraParam("corpus",b.getId());this.getTokensStore().setCorpus(b);this.down("#docSelector").setCorpus(b);this.getDocTermStore().load({params:{limit:5,stopList:this.getApiParams("stopList")}})},this);this.on("activate",function(){this.getCorpus()&&Ext.Function.defer(function(){this.getDocTermStore().load({params:{limit:5,
stopList:this.getApiParams("stopList")}})},100,this)},this);this.on("query",function(a,b){void 0!==b&&""!=b&&this.getDocTermsFromQuery(b)},this);this.on("documentsSelected",function(a,b){var c=b[0];this.setApiParam("docId",c);var d=this.knots.currentDoc.terms,e=[],f;for(f in d)e.push(f);this.termStore.removeAll();this.setApiParams({query:e});d=e.length;0===d&&(d=5);c=this.processDocument(this.getCorpus().getDocument(c));this.knots.setCurrentDoc(c);this.getDocTermStore().load({params:{query:e,limit:d,
stopList:this.getApiParams("stopList")}})},this);this.on("termsClicked",function(a,b){var c=[];b.forEach(function(a){Ext.isString(a)?c.push(a):a.term?c.push(a.term):a.getTerm&&c.push(a.getTerm())});0<c.length&&this.getDocTermsFromQuery(c)},this);this.on("corpusTermsClicked",function(a,b){var c=[];b.forEach(function(a){a.getTerm()&&c.push(a.getTerm())});this.getDocTermsFromQuery(c)},this);this.on("documentTermsClicked",function(a,b){var c=[];b.forEach(function(a){a.getTerm()&&c.push(a.getTerm())});
this.getDocTermsFromQuery(c)},this)},initComponent:function(){this.setDocTermStore(Ext.create("Ext.data.Store",{model:"Voyant.data.model.DocumentTerm",autoLoad:!1,remoteSort:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",withDistributions:"raw",withPositions:!0},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0},listeners:{beforeload:function(a){a.getProxy().setExtraParam("docId",this.getApiParam("docId"))},
load:function(a,b,c,d){var e={};b.forEach(function(a){var b=this.processTerms(a);a.get("docId");a=a.get("term");e[a]=b},this);this.knots.addTerms(e);this.knots.buildGraph()},scope:this}}));this.setTokensStore(Ext.create("Voyant.data.store.Tokens",{stripTags:"all",listeners:{beforeload:function(a){a.getProxy().setExtraParam("docId",this.getApiParam("docId"))},load:function(a,b,c,d){var e="",f=this.getCurrentTerm();b.forEach(function(a){e=a.getPosition()==f.tokenId?e+("\x3cstrong\x3e"+a.getTerm()+"\x3c/strong\x3e"):
e+a.getTerm()});Ext.Msg.show({title:this.localize("context"),message:e,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})},scope:this}}));Ext.apply(this,{dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"button",text:this.localize("clearTerms"),handler:function(){this.down("#termsView").getSelectionModel().deselectAll(!0);this.termStore.removeAll();this.setApiParams({query:null});this.knots.removeAllTerms();this.knots.drawGraph()},scope:this},"-",{xtype:"documentselector",
itemId:"docSelector",singleSelect:!0},"-",{xtype:"slider",itemId:"speed",fieldLabel:this.localize("speed"),labelAlign:"right",labelWidth:70,width:150,increment:50,minValue:0,maxValue:500,value:this.getRefreshInterval(),listeners:{changecomplete:function(a,b){this.setRefreshInterval(b)},scope:this}},{xtype:"slider",itemId:"startAngle",fieldLabel:this.localize("startAngle"),labelAlign:"right",labelWidth:70,width:150,increment:15,minValue:0,maxValue:360,value:this.getStartAngle(),listeners:{changecomplete:function(a,
b){this.setStartAngle(b)},scope:this}},{xtype:"slider",itemId:"tangles",fieldLabel:this.localize("tangles"),labelAlign:"right",labelWidth:70,width:150,increment:5,minValue:5,maxValue:90,value:this.getAngleIncrement(),listeners:{changecomplete:function(a,b){this.setAngleIncrement(b)},scope:this}}]}],border:!1,layout:"fit",items:{layout:{type:"vbox",align:"stretch"},defaults:{border:!1},items:[{height:30,itemId:"termsView",xtype:"dataview",store:this.termStore,tpl:this.termTpl,itemSelector:"div.term",
overItemCls:"over",selectedItemCls:"selected",selectionModel:{mode:"SIMPLE"},focusCls:"",listeners:{beforeitemclick:function(a,b,c,d,e,f){e.preventDefault();e.stopPropagation();a.fireEvent("itemcontextmenu",a,b,c,d,e,f);return!1},beforecontainerclick:function(){event.preventDefault();event.stopPropagation();return!1},selectionchange:function(a,b){var c=this.down("#termsView"),d=[];c.getStore().each(function(a){-1!==b.indexOf(a)?(d.push(a.get("term")),Ext.fly(c.getNodeByRecord(a)).removeCls("unselected").addCls("selected")):
Ext.fly(c.getNodeByRecord(a)).removeCls("selected").addCls("unselected")});this.knots.termsFilter=d;this.knots.drawGraph()},itemcontextmenu:function(a,b,c,d,e){e.preventDefault();e.stopPropagation();var f=a.isSelected(c);(new Ext.menu.Menu({floating:!0,items:[{text:f?this.localize("hideTerm"):this.localize("showTerm"),handler:function(){f?a.deselect(d):a.select(d,!0)},scope:this},{text:this.localize("removeTerm"),handler:function(){a.deselect(d);var b=this.termStore.getAt(d).get("term");this.termStore.removeAt(d);
a.refresh();this.knots.removeTerm(b);this.knots.drawGraph()},scope:this}]})).showAt(e.getXY())},scope:this}},{flex:1,xtype:"container",autoEl:"div",itemId:"canvasParent",layout:"fit",overflowY:"auto",overflowX:"hidden"}],listeners:{render:function(a){a=this.down("#canvasParent");this.knots=new Knots({container:a,clickHandler:this.knotClickHandler.bind(this)})},afterlayout:function(a){!1===this.knots.initialized&&this.knots.initializeCanvas()},resize:function(a,b,c){this.knots.doLayout()},scope:this}}});
this.callParent(arguments)},updateRefreshInterval:function(a){this.knots&&(50>a?(a=50,this.knots.progressiveDraw=!1):this.knots.progressiveDraw=!0,this.knots.refreshInterval=a,this.knots.buildGraph(this.knots.drawStep))},updateStartAngle:function(a){this.knots&&(this.knots.startAngle=a,this.knots.recache(),this.knots.buildGraph())},updateAngleIncrement:function(a){this.knots&&(this.knots.angleIncrement=a,this.knots.recache(),this.knots.buildGraph())},loadFromCorpusTerms:function(a){this.knots&&(this.knots.removeAllTerms(),
this.termStore.removeAll(!0));a.load({callback:function(a,c,d){var e=[];"string"==typeof e&&(e=[e]);a.forEach(function(a,b){e.push(a.get("term"))},this);this.getDocTermsFromQuery(e)},scope:this,params:{limit:5,stopList:this.getApiParams("stopList")}})},getDocTermsFromQuery:function(a){a&&this.setApiParam("query",a);this.getCorpus()&&this.isVisible()&&(this.setApiParams({query:a}),this.getDocTermStore().load({params:this.getApiParams()}))},reloadTermsData:function(){var a=[],b;for(b in this.bubblelines.currentTerms)a.push(b);
this.getDocTermsFromQuery(a)},filterDocuments:function(){var a=this.getApiParam("docId");""==a&&(a=[],this.getCorpus().getDocuments().each(function(b,c){a.push(b.getId())}),this.setApiParams({docId:a}));"string"==typeof a&&(a=[a]);if(null==a){this.selectedDocs=this.getCorpus().getDocuments().clone();var b=this.selectedDocs.getCount();if(10<b)for(var c=10;c<b;c++)this.selectedDocs.removeAt(10);a=[];this.selectedDocs.eachKey(function(b,c){a.push(b)},this);this.setApiParams({docId:a})}else this.selectedDocs=
this.getCorpus().getDocuments().filterBy(function(b,c){return-1!=a.indexOf(c)},this)},processDocument:function(a){var b=a.getShortTitle(),b=b.replace("\x26hellip;","...");return{id:a.getId(),index:a.get("index"),title:b,totalTokens:a.get("tokensCount-lexical"),terms:{},lineLength:void 0}},processTerms:function(a){var b;b=a.get("term");var c=a.get("rawFreq"),d=a.get("positions");if(0<c){var e=this.getApplication().getColorForTerm(b);if(-1===this.termStore.find("term",b)){this.termStore.loadData([[b,
e]],!0);var f=this.termStore.find("term",b);this.down("#termsView").select(f,!0)}a=a.get("distributions");b={term:b,positions:d,distributions:a,rawFreq:c,color:e}}else b=!1;return b},knotClickHandler:function(a){this.setCurrentTerm(a);var b=a.tokenId-10;0>b&&(b=0);this.getTokensStore().load({start:b,limit:21});a=[a];this.getApplication().dispatchEvent("termsClicked",this,a)}});Ext.define("Voyant.panel.Phrases",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.phrases",statics:{i18n:{title:{en:"Phrases"},emptyText:{en:"No matching results."},helpTip:{en:"\x3cp\x3eCorpus Phrases is a table view of repeating phrases in the entire corpus.\x3c!-- Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering by keyword, collocate word, collocate word count\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e--\x3e"},
term:{en:"Term"},termTip:{en:"This is the keyword phrase (this is a generalized form, it may appear slightly differently for each occurrence)."},termRawFreq:{en:"Count"},termRawFreqTip:{en:"The number of times the phrase occurs in the corpus."},matchingTerms:{en:"{count}"},length:{en:"Length"},lengthTip:{en:"The upper and lower bounds of phrase lengths (how many words in each phrase)."},overlap:{en:"Overlap"},overlapTip:{en:"This determines how overlapping phrases are filtered."},overlapMenu:{en:"Choose an overlap filter:"},
overlapNone:{en:"none (keep all)"},overlapLength:{en:"prioritize longest phrases"},overlapFreq:{en:"prioritize most frequent phrases"}},api:{stopList:"auto",query:void 0,docId:void 0,docIndex:void 0,sort:"length",dir:"desc",minLength:2,maxLength:50,overlapFilter:"length"},glyph:"xf0ce@FontAwesome"},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,c){this.getStore().setCorpus(c);this.isVisible()&&
this.loadFromApis()});a.embedded||a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus);this.on("corpusTermsClicked",function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){d.push(a.get("term"))});this.setApiParams({query:d,docId:void 0,docIndex:void 0});this.isVisible()&&this.getStore().load({params:this.getApiParams()})}});this.on("activate",function(){this.getStore().getCorpus()&&this.loadFromApis()},this);this.on("query",function(a,c){this.setApiParam("query",c);this.getStore().getProxy().setExtraParam("query",
c);this.loadFromApis()},this)},loadFromApis:function(){this.getStore().getCorpus()&&this.getStore().load({params:this.getApiParams()})},initComponent:function(){var a=Ext.create("Voyant.data.store.CorpusNgrams",{autoLoad:!1});this.on("sortchange",function(a,c,d,e){this.setApiParam("sort",c.dataIndex);this.setApiParam("dir",d);a=this.getApiParams("stopList query docId docIndex sort dir minLength maxLength overlapFilter".split(" "));c=this.getStore().getProxy();for(var f in a)c.setExtraParam(f,a[f])},
this);Ext.apply(this,{title:this.localize("title"),emptyText:this.localize("emptyText"),store:a,selModel:Ext.create("Ext.selection.CheckboxModel",{listeners:{selectionchange:{fn:function(a,c){var d=[];this.getApiParam("context");c.forEach(function(a){d.push('"'+a.getTerm()+'"')});this.getApplication().dispatchEvent("termsClicked",this,d)},scope:this}}}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"totalpropertystatus"},"-",{text:this.localize("length"),tooltip:"test",
xtype:"label"},{xtype:"slider",minValue:2,values:[2,30],maxValue:30,increment:1,width:75,tooltip:this.localize("lengthTip"),listeners:{render:{fn:function(a){var c=a.getValues();a.setValue(0,parseInt(this.getApiParam("minLength",c[0])));a.setValue(1,parseInt(this.getApiParam("maxLength",c[1])))},scope:this},changecomplete:{fn:function(a,c){var d=a.getValues();this.setApiParam("minLength",parseInt(d[0]));this.setApiParam("maxLength",parseInt(d[1]));this.getStore().load({params:this.getApiParams()})},
scope:this}}},"-",{xtype:"button",text:this.localize("overlap"),tooltip:this.localize("overlapTip"),menu:{items:[{xtype:"menucheckitem",text:this.localize("overlapNone"),group:"overlap",inputValue:"none",checkHandler:function(){this.setApiParam("overlapFilter","none");this.getStore().load({params:this.getApiParams()})},scope:this},{xtype:"menucheckitem",text:this.localize("overlapLength"),group:"overlap",inputValue:"length",checkHandler:function(){this.setApiParam("overlapFilter","length");this.getStore().load({params:this.getApiParams()})},
scope:this},{xtype:"menucheckitem",text:this.localize("overlapFreq"),group:"overlap",inputValue:"rawFreq",checkHandler:function(){this.setApiParam("overlapFilter","rawfreq");this.getStore().load({params:this.getApiParams()})},scope:this}],listeners:{afterrender:{fn:function(a){var c=this.getApiParam("overlapFilter");a.items.each(function(a){a.group&&a.setChecked(a.inputValue==c)},this)},scope:this}}}}]}],columns:[{text:this.localize("term"),dataIndex:"term",tooltip:this.localize("termTip"),sortable:!0,
flex:1},{text:this.localize("rawFreq"),dataIndex:"rawFreq",tooltip:this.localize("termRawFreqTip"),sortable:!0,width:"autoSize"},{text:this.localize("length"),dataIndex:"length",tooltip:this.localize("lengthTip"),sortable:!0,width:"autoSize"},{xtype:"widgetcolumn",text:this.localize("trend"),tooltip:this.localize("trendTip"),width:120,dataIndex:"distributions",widget:{xtype:"sparklineline"}}],listeners:{termsClicked:{fn:function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){Ext.isString(a)?
d.push(a):a.term?d.push(a.term):a.getTerm&&d.push(a.getTerm())});0<d.length&&(this.setApiParams({docIndex:void 0,docId:void 0,query:d}),this.isVisible()&&this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()}))}},scope:this}}});this.callParent(arguments);this.getStore().getProxy().setExtraParam("withDistributions",!0)}});Ext.define("Voyant.panel.CorpusTerms",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.corpusterms",statics:{i18n:{title:{en:"Corpus Terms"},emptyText:{en:"No matching results."},helpTip:{en:"\x3cp\x3eCorpus Terms is a table view of terms that appear in the entire corpus. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering by \x3ci\x3eterm\x3c/i\x3e and \x3ci\x3ecount\x3c/i\x3e (click on the column headers)\x3c/li\x3e\x3cli\x3ea sparkline graph of the term frequency trends across the corpus (if the corpus has multiple documents) or across the document (if the corpus has only one document)\x3c/li\x3e\x3cli\x3eadditional columns available (relative frequency, distribution peakedness and skew) by clicking on the arrow that appears when hovering over a header\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
matchingTerms:{en:"Matching terms: {count}"},termTip:{en:"The term in the corpus."},rawFreqTip:{en:"The total count (raw frequency) of this term in the entire corpus."},relativeFreqTip:{en:"The relative frequency (per million) of this term in the entire corpus."},relativePeakedness:{en:"Peakedness"},relativePeakednessTip:{en:"This is a statistical measure of how much the relative frequencies of a term in a corpus are bunched up into peaks (regions with higher values where the rest are lower)."},relativeSkewness:{en:"Skew"},
relativeSkewnessTip:{en:"This is a statistical measure of the symmetry of the relative frequencies of a term across the corpus."},trendTip:{en:"This represents the trend of the relative frequencies for each term in each document in the corpus."}},api:{stopList:"auto",query:void 0},glyph:"xf0ce@FontAwesome"},config:{options:{xtype:"stoplistoption"}},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,
b){var e=this.getStore();e.setCorpus(b);e.getProxy().setExtraParam("corpus",b.getId());e.loadPage(1)});this.on("query",function(a,b){this.setApiParam("query",b);this.getStore().loadPage(1)},this);if(a.embedded){var b=Ext.getClass(a.embedded).getName();"Voyant.data.store.CorpusTerms"==b&&this.fireEvent("loadedCorpus",this,a.embedded.getCorpus());"Voyant.data.model.Corpus"==b&&this.fireEvent("loadedCorpus",this,a.embedded)}else a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus)},initComponent:function(){var a=
Ext.create("Voyant.data.store.CorpusTerms",{parentPanel:this});a.getProxy().setExtraParam("withDistributions","relative");Ext.apply(this,{title:this.localize("title"),emptyText:this.localize("emptyText"),store:a,selModel:Ext.create("Ext.selection.CheckboxModel",{pruneRemoved:!1,listeners:{selectionchange:{fn:function(a,c){c&&0<c.length&&this.getApplication().dispatchEvent("corpusTermsClicked",this,c)},scope:this}},mode:"SIMPLE"}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},
{xtype:"totalpropertystatus"}]}],columns:[{xtype:"rownumberer",width:"autoSize",sortable:!1},{text:this.localize("term"),tooltip:this.localize("termTip"),dataIndex:"term",flex:1,sortable:!0},{text:this.localize("rawFreq"),tooltip:this.localize("rawFreqTip"),dataIndex:"rawFreq",width:"autoSize",sortable:!0},{text:this.localize("relativeFreq"),tooltip:this.localize("relativeFreqTip"),dataIndex:"relativeFreq",renderer:function(a){return Ext.util.Format.number(1E6*a,"0,000")},width:"autoSize",hidden:!0,
sortable:!0},{text:this.localize("relativePeakedness"),tooltip:this.localize("relativePeakednessTip"),dataIndex:"relativePeakedness",renderer:Ext.util.Format.numberRenderer("0,000.0"),width:"autoSize",hidden:!0,sortable:!0},{text:this.localize("relativeSkewness"),tooltip:this.localize("relativeSkewnessTip"),dataIndex:"relativeSkewness",renderer:Ext.util.Format.numberRenderer("0,000.0"),width:"autoSize",hidden:!0,sortable:!0},{xtype:"widgetcolumn",text:this.localize("trend"),tooltip:this.localize("trendTip"),
flex:1,dataIndex:"distributions",widget:{xtype:"sparklineline",tipTpl:new Ext.XTemplate("{[this.getDocumentTitle(values.x,values.y)]}",{getDocumentTitle:function(a,c){return this.panel.store.getCorpus().getDocument(a).getTitle()+"\x3cbr\x3erelative frequency: "+Ext.util.Format.number(1E6*c,"0,000")},panel:this})}}]});this.callParent(arguments)},load:function(){this.rendered?this.store.loadPage(1):Ext.defer(this.load,100,this)}});Ext.define("Voyant.panel.DocumentTerms",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],requires:["Voyant.data.store.DocumentTerms"],alias:"widget.documentterms",config:{corpus:void 0,options:{xtype:"stoplistoption"}},statics:{i18n:{title:{en:"Document Terms"},emptyText:{en:"No matching results."},helpTip:{en:"\x3cp\x3eDocument Terms is a table view of terms that appear in each document. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering by \x3ci\x3eTerm\x3c/i\x3e, \x3ci\x3eCount\x3c/i\x3e (raw frequency), and \x3ci\x3eRelative\x3c/i\x3e frequency (click on the column headers)\x3c/li\x3e\x3cli\x3ea sparkline graph of the distribution of term frequencies across the documents\x3c/li\x3e\x3cli\x3eadditional columns available (\x3ci\x3eSignificance\x3c/i\x3e or TF-IDF) by clicking on the arrow that appears when hovering over a header\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
matchingTerms:{en:"Matching terms: {count}"},termTip:{en:"The term in a single, specific document."},rawFreqTip:{en:"The count (raw frequency) of this term in this document."},relativeFreqTip:{en:"The relative frequency (per million) of this term in each document."},trendTip:{en:"This is a sparkline graph that represents the distribution of the term within linear segments of the document (by default 10 segments of equal size)."},tfidf:{en:"Significance"},tfidfTip:{en:"The significance is measured here using an TF-IDF score, a common way of expressing how important a term is in a document relative to the rest of the corpus."}},
api:{stopList:"auto",query:void 0,docId:void 0,docIndex:void 0},glyph:"xf0ce@FontAwesome"},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.getStore().setCorpus(b)});if(a.embedded){window.console&&console.warn(a.embedded.then);var b=Ext.getClass(a.embedded).getName();"Voyant.data.store.DocumentTerms"!=b&&"Voyant.data.model.Document"!=b||this.fireEvent("loadedCorpus",this,a.embedded.getCorpus())}else a.corpus&&
this.fireEvent("loadedCorpus",this,a.corpus);this.on("query",function(a,b){this.fireEvent("corpusTermsClicked",a,[b])},this);this.on("corpusTermsClicked",function(a,b){if(this.getStore().getCorpus()){var e=[];b.forEach(function(a){e.push(Ext.isString(a)?a:a.get("term"))});this.setApiParams({query:e,docId:void 0,docIndex:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})}});this.on("documentsClicked",function(a,b){var e=[];b.forEach(function(a){e.push(a.get("id"))});
this.setApiParams({docId:e,query:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})});this.on("activate",function(){this.getStore().getCorpus()&&this.getStore().loadPage(1,{params:this.getApiParams()})},this)},initComponent:function(){var a=Ext.create("Voyant.data.store.DocumentTerms",{parentPanel:this});Ext.apply(this,{title:this.localize("title"),emptyText:this.localize("emptyText"),store:a,selModel:Ext.create("Ext.selection.CheckboxModel",{listeners:{selectionchange:{fn:function(a,
c){this.getApplication().dispatchEvent("documentTermsClicked",this,c)},scope:this}},pruneRemoved:!1,mode:"SIMPLE"}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"totalpropertystatus"}]}],columns:[{text:"#",width:30,dataIndex:"docIndex",sortable:!0,renderer:function(a){return a+1}},{text:this.localize("term"),dataIndex:"term",tooltip:this.localize("termTip"),sortable:!0,flex:1},{text:this.localize("rawFreq"),dataIndex:"rawFreq",tooltip:this.localize("rawFreqTip"),
width:"autoSize",sortable:!0},{text:this.localize("relativeFreq"),tooltip:this.localize("relativeFreqTip"),dataIndex:"relativeFreq",width:"autoSize",sortable:!0,renderer:Ext.util.Format.numberRenderer("0,000")},{text:this.localize("tfidf"),tooltip:this.localize("tfidfTip"),dataIndex:"tfidf",width:"autoSize",sortable:!0,hidden:!0,renderer:Ext.util.Format.numberRenderer("0,000.000")},{xtype:"widgetcolumn",text:this.localize("trend"),tooltip:this.localize("trendTip"),flex:1,dataIndex:"distributions",
widget:{xtype:"sparklineline"}}],listeners:{termsClicked:{fn:function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){Ext.isString(a)?d.push(a):a.term?d.push(a.term):a.getTerm&&d.push(a.getTerm())});0<d.length&&(this.setApiParams({docIndex:void 0,docId:void 0,query:d}),this.isVisible()&&this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()}))}},scope:this}}});this.callParent(arguments);this.getStore().getProxy().setExtraParam("withDistributions",!0)}});Ext.define("Voyant.panel.Documents",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.documents",statics:{i18n:{title:{en:"Documents"},emptyText:{en:"No matching results."},helpTip:{en:"\x3cp\x3eDocuments is a table view of the documents in the corpus. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering by \x3ci\x3eTitle\x3c/i\x3e, \x3ci\x3eWords\x3c/i\x3e count (tokens), word forms count (\x3ci\x3eTypes\x3c/i\x3e), and \x3ci\x3eRatio\x3c/i\x3e (Types/Tokens Ratio) (click on the column headers)\x3c/li\x3e\x3cli\x3ea search box for queries (by default in the full-text, title and author fields \x26mdash;\u00a0hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
id:{en:"ID"},documentTitle:{en:"Title"},documentAuthor:{en:"Author"},tokensCountLexical:{en:"Words"},typesCountLexical:{en:"Types"},typeTokenRatioLexical:{en:"Ratio"},language:{en:"Language"},matchingDocuments:{en:"Matching documents: {count}"},error:{en:"Error"},add:{en:"Add"},addTip:{en:"Click here to add new documents to this corpus."},remove:{en:"Remove"},removeTip:{en:"Click here to create a new corpus that excludes selected or filtered (search query) documents."},reorder:{en:"Reorder"},reorderTip:{en:"Click here to create a new corpus based on a reordering of documents (drag and drop rows to reorder)."},
keep:{en:"Keep"},keepTip:{en:"Click here to create a new corpus that only includes selected or filtered (search query) documents."},modify:{en:"Modify"},newCorpus:{en:"New Corpus"},modifyTip:{en:"Click this button to create a new corpus by adding new documents, by selecting a subset of documents or by re-ordering documents."},allSelectedError:{en:"You have selected all documents, you must select a subset of documents to remove or keep."},removeSelectedDocuments:{en:"Create a \x3ci\x3enew\x3c/i\x3e corpus that removes (does NOT include) the {0:plural('selected document')}?"},
removeFilteredDocuments:{en:"Create a \x3ci\x3enew\x3c/i\x3e corpus that removes (does NOT include) the {0:plural('filtered document')}?"},keepSelectedDocuments:{en:"Create a \x3ci\x3enew\x3c/i\x3e corpus that only keeps the {0:plural('selected document')}?"},keepFilteredDocuments:{en:"Create a \x3ci\x3enew\x3c/i\x3e corpus that only keeps the {0:plural('filtered document')}?"},selectOrFilterError:{en:"You need to first select documents by clicking on one or more rows or by performing a search query."},
onlyOneError:{en:"Your corpus has only one document, you can't remove or keep documents to create a new corpus."},reorderFilteredError:{en:"You cannot reorder a filtered (after search query) corpus. Please create a new corpus first (with the \x3ci\x3eRemove\x3c/i\x3e or \x3ci\x3eKeep\x3c/i\x3e button) and then reorder the new corpus."},reorderOriginalError:{en:"Please reorder the corpus first (drag and drop the rows in the table)."},reorderDocuments:{en:"Create a \x3ci\x3enew\x3c/i\x3e corpus based on the order shown?"}},
api:{query:void 0,docIndex:void 0,docId:void 0},glyph:"xf0ce@FontAwesome"},MODE_EDITING:"editing",MODE_NORMAL:"normal",config:{mode:this.MODE_NORMAL},constructor:function(a){var b=Ext.create("Voyant.data.store.Documents",{selModel:{pruneRemoved:!1}}),c=[{xtype:"querysearchfield"},{xtype:"totalpropertystatus"}];a&&a.mode==this.MODE_EDITING||c.push({text:this.localize("modify"),tooltip:this.localize("modifyTip"),glyph:"xf044@FontAwesome",scope:this,handler:function(a){Ext.create("Ext.window.Window",
{title:this.localize("title"),modal:!0,width:"80%",minWidth:300,minHeight:200,height:"80%",layout:"fit",frame:!0,border:!0,items:{xtype:"documents",mode:this.MODE_EDITING,corpus:this.getStore().getCorpus(),header:!1,viewConfig:{plugins:{ptype:"gridviewdragdrop"},listeners:{beforedrop:function(a,b,c,d,k){return this.getStore().getCount()<this.getStore().getCorpus().getDocumentsCount()?(a=this.up("panel"),Ext.Msg.show({title:a.localize("error"),message:a.localize("reorderFilteredError"),buttons:Ext.Msg.OK,
icon:Ext.Msg.ERROR}),!1):!0}}}},buttons:[{text:this.localize("add"),tooltip:this.localize("addTip"),glyph:"xf067@FontAwesome",handler:function(a){a.up("window").close();Ext.create("Ext.window.Window",{header:!1,modal:!0,layout:"fit",items:{xtype:"corpuscreator",corpus:this.getStore().getCorpus()}}).show()},scope:this},{text:this.localize("remove"),tooltip:this.localize("removeTip"),glyph:"xf05e@FontAwesome",hidden:1==this.getStore().getCorpus().getDocumentsCount(),handler:this.keepRemoveReorderHandler,
itemId:"remove",scope:this},{text:this.localize("keep"),tooltip:this.localize("keepTip"),glyph:"xf00c@FontAwesome",hidden:1==this.getStore().getCorpus().getDocumentsCount(),handler:this.keepRemoveReorderHandler,itemId:"keep",scope:this},{text:this.localize("reorder"),tooltip:this.localize("reorderTip"),glyph:"xf0dc@FontAwesome",hidden:1==this.getStore().getCorpus().getDocumentsCount(),handler:this.keepRemoveReorderHandler,itemId:"reorder",scope:this},{text:"Cancel",glyph:"xf00d@FontAwesome",handler:function(a){a.up("window").close()}}]}).show()}});
Ext.apply(this,{title:this.localize("title"),emptyText:this.localize("emptyText"),columns:[{xtype:"rownumberer",renderer:function(a,b,c){return c.getIndex()+1},sortable:!1},{text:this.localize("documentTitle"),dataIndex:"title",sortable:!0,renderer:function(a,b,c){return c.getTitle()},flex:3},{text:this.localize("documentAuthor"),dataIndex:"author",sortable:!0,hidden:!0,renderer:function(a,b,c){return c.getAuthor()},flex:2},{text:this.localize("tokensCountLexical"),dataIndex:"tokensCount-lexical",
renderer:Ext.util.Format.numberRenderer("0,000"),sortable:!0,width:"autoSize"},{text:this.localize("typesCountLexical"),dataIndex:"typesCount-lexical",renderer:Ext.util.Format.numberRenderer("0,000"),width:"autoSize"},{text:this.localize("typeTokenRatioLexical"),dataIndex:"typeTokenRatio-lexical",renderer:function(a){return Ext.util.Format.percent(a)},width:"autoSize"},{text:this.localize("language"),dataIndex:"language",hidden:!0,renderer:function(a,b,c,g,h,k,l){return l.ownerCt.getLanguage(a)},
width:"autoSize"}],store:b,selModel:Ext.create("Ext.selection.RowModel",{mode:"MULTI",listeners:{selectionchange:{fn:function(a,b){this.getApplication().dispatchEvent("documentsClicked",this,b,this.getStore().getCorpus())},scope:this}}}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:c}]});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.store.setCorpus(b);this.store.load({params:this.getApiParams()})});this.on("query",
function(a,b){this.setApiParam("query",b);this.store.load({params:this.getApiParams()})});a.embedded&&("Voyant.data.model.Corpus"==Ext.getClass(a.embedded).getName()?a.corpus=a.embedded:"Voyant.data.store.Documents"==Ext.getClass(a.embedded).getName()&&(this.store.setRecords(a.embedded.getData()),a.corpus=a.embedded.getCorpus()));a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus)},keepRemoveReorderHandler:function(a){var b=a.up("window").down("documents"),c=b.getSelection(),d=b.getStore().getCorpus().getDocumentsCount(),
e=a.getItemId();if("reorder"==e){if(b.getStore().getCount()<d)return Ext.Msg.show({title:this.localize("error"),message:this.localize("reorderFilteredError"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});docIndex=[];b.getStore().each(function(a){docIndex.push(a.getIndex())},this);for(a=1;a<docIndex.length;a++)if(docIndex[a-1]>docIndex[a])return Ext.Msg.confirm(b.localize("newCorpus"),(new Ext.Template(b.localize(e+"Documents"))).applyTemplate([c.length]),function(a){"yes"===a&&(docIndex=[],this.getStore().each(function(a){docIndex.push(a.getIndex())},
this),a={docIndex:docIndex},a[e+"Documents"]=!0,this.editCorpus(a))},b);return Ext.Msg.show({title:this.localize("error"),message:this.localize("reorderOriginalError"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}return 0<c.length?c.length==d?1==d?Ext.Msg.show({title:this.localize("error"),message:this.localize("onlyOneError"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}):Ext.Msg.show({title:this.localize("error"),message:this.localize("allSelectedError"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}):Ext.Msg.confirm(this.localize("newCorpus"),
(new Ext.Template(this.localize(e+"SelectedDocuments"))).applyTemplate([c.length]),function(a){"yes"===a&&(docIndex=[],c.forEach(function(a){docIndex.push(a.getIndex())}),a={docIndex:docIndex},a[e+"Documents"]=!0,this.editCorpus(a))},b):b.getApiParam("query")&&b.getStore().getCount()<d?Ext.Msg.confirm(this.localize("newCorpus"),(new Ext.Template(this.localize(e+"FilteredDocuments"))).applyTemplate([c.length]),function(a){"yes"===a&&(docIndex=[],this.getStore().each(function(a){docIndex.push(a.getIndex())},
this),a={docIndex:docIndex},a[e+"Documents"]=!0,this.editCorpus(a))},b):Ext.Msg.show({title:this.localize("error"),message:this.localize("selectOrFilterError"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})},editCorpus:function(a){Ext.apply(a,{tool:"corpus.CorpusManager",corpus:this.getStore().getCorpus().getId()});var b=this.getApplication(),c=b.getViewport();c.mask(this.localize("Creating new corpus\u2026"));Ext.Ajax.request({url:this.getApplication().getTromboneUrl(),method:"POST",params:a,success:function(a){c.unmask();
a=Ext.decode(a.responseText);c.mask("Loading new corpus\u2026");(new Corpus({corpus:a.corpus.id})).then(function(a){c.unmask();b.dispatchEvent("loadedCorpus",b,a)}).fail(function(a,d){c.unmask();b.showErrorResponse({message:a},d)})}});(a=this.up("window"))&&a.isFloating()&&a.close()}});Ext.define("Voyant.panel.DocumentsFinder",{extend:"Ext.grid.Panel",require:["Voyant.data.store.DocumentQueryMatches","Ext.grid.plugin.CellEditing"],mixins:["Voyant.panel.Panel"],alias:"widget.documentsfinder",statics:{i18n:{title:{en:"Documents Finder"},emptyText:{en:"No matching results."},operator:{en:"Operator"},field:{en:"Field"},query:{en:"Query"},count:{en:"Count"},emptyQuery:{en:"type query here"},titleField:{en:"title"},authorField:{en:"author"},pubDateField:{en:"publication date"},publisherField:{en:"publisher"},
pubPlaceField:{en:"publication location"},advancedField:{en:"\x3ci\x3eadvanced query\x3c/i\x3e"},textField:{en:"text (default)"},loading:{en:"loading corpus"},unsuccessfulQuery:{en:"Unable to complete query."},addRow:{en:"Add Row"},deleteRowTip:{en:"Click to delete this row"},noMatches:{en:new Ext.Template("No matches (out of {0} documents).",{compiled:!0})},queryMatches:{en:new Ext.Template("A total of {0} matching documents (out of {1}).",{compiled:!0})},exportNewCorpus:{en:"New Corpus"},exportNewCorpusTip:{en:"Create a new corpus from matching documents (button will be disabled if there are no matches)."}}},
config:{corpus:void 0},constructor:function(a){this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});this.cellEditing.on("edit",this.onEditComplete,this);var b=this;Ext.apply(this,{title:this.localize("title"),emptyText:this.localize("emptyText"),plugins:[this.cellEditing],bbar:[{text:this.localize("addRow"),glyph:"xf055@FontAwesome",handler:this.addRow,scope:this},{text:this.localize("exportNewCorpus"),disabled:!0,glyph:"xf08e@FontAwesome",tooltip:this.localize("exportNewCorpusTip"),
handler:function(){var a=this.getQueryFromStore();a?(this.setLoading(!0),this.getCorpus().getDocumentQueryMatches().load({params:{query:a,createNewCorpus:!0},callback:function(a,b,c){this.setLoading(!1);c?(a=b.getProxy().getReader().rawData.documentsFinder.corpus,a=this.getBaseUrl()+"?corpus\x3d"+a,Ext.Msg.alert({title:this.localize("title"),message:"\x3ca href\x3d'"+a+"' target\x3d'_blank'\x3eNew Corpus\x3c/a\x3e"})):Ext.create("Voyant.util.ResponseError",{msg:this.localize("unsuccessfulQuery"),
response:b.getError().response}).show()},scope:this})):Ext.Msg.alert({title:this.localize("title"),message:this.localize("noMatches")})},scope:this,cls:"exportBtn"},{xtype:"tbtext",name:"status",cls:"status"}],columns:[{text:this.localize("query"),dataIndex:"query",renderer:function(a){return Ext.isEmpty(a)?'\x3cspan class\x3d"placeholder"\x3e'+b.localize("emptyQuery")+"\x3c/span\x3e":a},editor:!0,minWidth:150,maxWidth:300},{text:this.localize("field"),dataIndex:"field",editor:{xtype:"combo",typeAhead:!0,
triggerAction:"all",forceSelection:!0,value:"",valueField:"value",listeners:{change:function(){Ext.isEmpty(this.getValue())&&this.reset()}},store:new Ext.data.Store({fields:["text","value"],data:[[this.localize("textField"),"text"],[this.localize("advancedField"),"advanced"]]})},width:150,renderer:function(a){return Ext.isEmpty(a)?"":b.localize(a+"Field")}},{text:this.localize("operator"),dataIndex:"operator",editor:{xtype:"combo",forceSelection:!0,store:new Ext.data.Store({autoDestroy:!0,fields:["text",
"value"],displayField:"text",valueField:"value",data:[{text:"AND",value:"+"},{text:"OR",value:""}]})},minWidth:75,maxWidth:75},{text:this.localize("count"),dataIndex:"count",renderer:function(a,b,e){return Ext.isEmpty(e.get("query"))?"":Ext.util.Format.number(a,"0,000")},minWidth:100,maxWidth:100},{xtype:"actioncolumn",width:25,sortable:!1,menuDisabled:!0,width:25,getGlyph:"xf014@FontAwesome",tooltip:this.localize("deleteQueryTip"),menuDisabled:!0,sortable:!1,handler:this.removeRow,scope:this}],store:new Ext.data.Store({autoDestroy:!0,
fields:["id","operator","field","query","count"],data:[["","","","",0]]})});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.setCorpus(b);var e=b.getDocuments();if(e&&0<e.getCount()){var f=e.getDocument(0),g=[];["title","author","pubDate","publisher","pubPlace"].forEach(function(a){Ext.isEmpty(f.get(a))||g.push([this.localize(a+"Field"),a])},this);g&&(e=this.getColumnManager().getHeaderByDataIndex("field").getEditor(),
e.getStore().each(function(a){g.push([a.get("text"),a.get("value")])},this),e.setStore(Ext.create("Ext.data.Store",{fields:["text","value"],data:g})));this.updateStatus(0);this.setLoading(!1)}})},removeRow:function(a,b){this.getStore().removeAt(b);0==this.getStore().getCount()&&this.addRow();this.updateAggregate()},addRow:function(){this.store.loadData([["","","","",0]],!0)},onEditComplete:function(a,b){var c=this.getQueryFromRecord(b.record);if(Ext.isEmpty(c))b.record.set("count",""),this.updateAggregate();
else{var d=b.view.getCell(b.record,this.getColumnManager().getHeaderByDataIndex("count"));d.mask("loading");this.getCorpus().getDocumentQueryMatches().load({params:{query:c},callback:function(a,c,g){d.unmask();g?b.record.set("count",0==a.length?0:a[0].get("count")):(Ext.create("Voyant.util.ResponseError",{msg:this.localize("unsuccessfulQuery"),response:c.getError().response}).show(),b.record.set("count",0));this.updateAggregate()},scope:this})}},getQueryFromRecord:function(a){if(Ext.isEmpty(a)||Ext.isEmpty(a.get("query")))return"";
var b=a.get("query").trim();if(Ext.isEmpty(b))return"";a=a.get("field");return Ext.isEmpty(a?a.trim():a)?b:a+":"+b},getQueryFromStore:function(){var a="";this.getStore().each(function(b){var c=this.getQueryFromRecord(b);Ext.isEmpty(c)||(Ext.isEmpty(a)||(b=b.get("operator"),a+="AND"==b?" + ":" | "),a+=c)},this);console.warn(a);return a},updateAggregate:function(){var a=this.getStore().sum("count");a&&"string"!=typeof a?1==a?(a=this.getStore().getAt(0).get("count"),this.updateStatus(this.getStore().getAt(0).get("count"))):
(a=this.getQueryFromStore(),Ext.isEmpty(a)||(this.status||(this.status=this.down("[cls~\x3dstatus]")),this.status.mask(this.localize("loading")),this.getCorpus().getDocumentQueryMatches().load({params:{query:a},callback:function(a,c,d){debugger;this.status.unmask();d?this.updateStatus(a[0].get("count")):(Ext.create("Voyant.util.ResponseError",{msg:this.localize("unsuccessfulQuery"),response:c.getError().response}).show(),this.updateStatus(0))},scope:this}))):this.updateStatus(0)},updateStatus:function(a){this.status||
(this.status=this.down("[cls~\x3dstatus]"));this.exportBtn||(this.exportBtn=this.down("[cls~\x3dexportBtn]"));0==a?this.status.update(this.localize("noMatches",[this.getCorpus().getDocumentsCount()])):this.status.update(this.localize("queryMatches",[a,this.getCorpus().getDocumentsCount()]));this.exportBtn.setDisabled(0==a)}});Ext.define("Voyant.panel.Dummy",{extend:"Ext.Panel",xtype:"dummy",width:650,initComponent:function(){this.myDataStore=Ext.create("Ext.data.JsonStore",{fields:["theta","sin","cos","tan"],data:[{theta:0,sin:0,cos:1,tan:0},{theta:10,sin:.17,cos:.98,tan:.18},{theta:20,sin:.34,cos:.94,tan:.36},{theta:30,sin:.5,cos:.87,tan:.58},{theta:40,sin:.64,cos:.77,tan:.84},{theta:50,sin:.77,cos:.64,tan:1.19},{theta:60,sin:.87,cos:.5,tan:1.73},{theta:70,sin:.94,cos:.34,tan:2.75},{theta:80,sin:.98,cos:.17,tan:5.67},
{theta:90,sin:1,cos:0,tan:!1},{theta:100,sin:.98,cos:-.17,tan:-5.67},{theta:110,sin:.94,cos:-.34,tan:-2.75},{theta:120,sin:.87,cos:-.5,tan:-1.73},{theta:130,sin:.77,cos:-.64,tan:-1.19},{theta:140,sin:.64,cos:-.77,tan:-.84},{theta:150,sin:.5,cos:-.87,tan:-.58},{theta:160,sin:.34,cos:-.94,tan:-.36},{theta:170,sin:.17,cos:-.98,tan:-.18},{theta:180,sin:0,cos:-1,tan:0},{theta:190,sin:-.17,cos:-.98,tan:.18},{theta:200,sin:-.34,cos:-.94,tan:.36},{theta:210,sin:-.5,cos:-.87,tan:.58},{theta:220,sin:-.64,cos:-.77,
tan:.84},{theta:230,sin:-.77,cos:-.64,tan:1.19},{theta:240,sin:-.87,cos:-.5,tan:1.73},{theta:250,sin:-.94,cos:-.34,tan:2.75},{theta:260,sin:-.98,cos:-.17,tan:5.67},{theta:270,sin:-1,cos:0,tan:!1},{theta:280,sin:-.98,cos:.17,tan:-5.67},{theta:290,sin:-.94,cos:.34,tan:-2.75},{theta:300,sin:-.87,cos:.5,tan:-1.73},{theta:310,sin:-.77,cos:.64,tan:-1.19},{theta:320,sin:-.64,cos:.77,tan:-.84},{theta:330,sin:-.5,cos:.87,tan:-.58},{theta:340,sin:-.34,cos:.94,tan:-.36},{theta:350,sin:-.17,cos:.98,tan:-.18},
{theta:360,sin:0,cos:1,tan:0}]});this.items=[{xtype:"cartesian",width:"100%",height:500,store:this.myDataStore,insetPadding:{top:40,right:40,bottom:20,left:20},legend:{docked:"right"},sprites:[{type:"text",text:"Line Charts - Marked Spline",fontSize:22,width:100,height:30,x:40,y:20}],axes:[{type:"numeric",fields:["sin","cos","tan"],position:"left",grid:!0,renderer:function(a){return Ext.util.Format.number(a,"0.0")}},{type:"category",title:"Theta",fields:"theta",position:"bottom",style:{textPadding:0},
grid:!0,label:{rotate:{degrees:-45}}}],series:[{type:"line",axis:"left",xField:"theta",yField:"sin",smooth:!0,style:{lineWidth:4},marker:{radius:4},highlight:{fillStyle:"#000",radius:5,lineWidth:2,strokeStyle:"#fff"}},{type:"line",axis:"left",xField:"theta",yField:"cos",smooth:!0,style:{lineWidth:4},marker:{radius:4},highlight:{fillStyle:"#000",radius:5,lineWidth:2,strokeStyle:"#fff"}},{type:"line",axis:"left",xField:"theta",yField:"tan",smooth:!0,style:{lineWidth:4},marker:{radius:4},highlight:{fillStyle:"#000",
radius:5,lineWidth:2,strokeStyle:"#fff"}}]}];this.callParent()}});Ext.define("Voyant.panel.RezoViz",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.rezoviz",statics:{i18n:{title:{en:"RezoViz"},categories:{en:"Categories"},people:{en:"People"},locations:{en:"Locations"},organizations:{en:"Organizations"},reload:{en:"Reload"},minEdgeCount:{en:"Min. Edge Count"},repulsion:{en:"Repulsion"},stiffness:{en:"Stiffness"},friction:{en:"Friction"},noEntities:{en:"No entities to graph."},noEntitiesForEdgeCount:{en:"No entities were found. Would you like to reduce the minimum edge count to improve results?"},
loadingEntities:{en:"Loading entities\u2026"}},api:{query:void 0,limit:25,stopList:"auto",type:["organization","location","person"],minEdgeCount:2},glyph:"xf1cb@FontAwesome"},config:{corpus:void 0,network:void 0,nodesStore:void 0,nodesDataSet:void 0,edgesDataSet:void 0,isNetworkBounded:!0},categorizedNodeOptions:{location:{font:{color:"green"}},person:{font:{color:"maroon"}},organization:{font:{color:"purple"}}},nodeOptions:{shape:"box",color:{border:"rgba(0,0,0,0.1)",background:"rgba(255,255,255,1)"},
scaling:{label:{min:8,max:20}}},edgeOptions:{color:{color:"rgba(0,0,0,0.1)",highlight:"black",hover:"red"},labelHighlightBold:!1},highlightOptions:{font:{color:"white"},color:{background:"black"}},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){this.setNodesStore(Ext.create("Ext.data.Store",{fields:["id","term","type","rawFreq"],sortOnLoad:!0,sorters:"term"}));Ext.apply(this,{title:this.localize("title"),
dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"combo",queryMode:"local",valueField:"term",displayField:"term",store:this.getNodesStore(),listeners:{select:function(a,b){this.getNetwork().selectNodes([b.get("id")])},scope:this}},{xtype:"button",text:this.localize("categories"),menu:{items:[{xtype:"menucheckitem",text:this.localize("people"),itemId:"person",checked:!0},{xtype:"menucheckitem",text:this.localize("locations"),itemId:"location",checked:!0},{xtype:"menucheckitem",text:this.localize("organizations"),
itemId:"organization",checked:!0},{xtype:"button",text:this.localize("reload"),style:"margin: 5px;",handler:this.categoriesHandler,scope:this}]}},{xtype:"numberfield",itemId:"minEdgeCount",fieldLabel:this.localize("minEdgeCount"),labelAlign:"right",labelWidth:120,width:170,maxValue:10,minValue:1,allowDecimals:!1,allowExponential:!1,allowOnlyWhitespace:!1,listeners:{render:function(a){a.setRawValue(this.getApiParam("minEdgeCount"))},change:function(a,b){a.isValid()&&(this.setApiParam("minEdgeCount",
b),this.getEntities())},scope:this}},{xtype:"tbseparator"},{xtype:"slider",fieldLabel:this.localize("repulsion"),labelAlign:"right",labelWidth:70,width:150,value:100,increment:10,minValue:0,maxValue:500,listeners:{changecomplete:function(a,b){this.getNetwork().physics.options.repulsion.nodeDistance=b;this.getNetwork().startSimulation()},scope:this}},{xtype:"slider",fieldLabel:this.localize("stiffness"),labelAlign:"right",labelWidth:70,width:150,value:4,increment:1,minValue:0,maxValue:10,listeners:{changecomplete:function(a,
b){b/=100;this.getNetwork().physics.options.repulsion.springConstant=b;this.getNetwork().startSimulation()},scope:this}},{xtype:"slider",fieldLabel:this.localize("friction"),labelAlign:"right",labelWidth:55,width:150,value:9,increment:10,minValue:0,maxValue:100,listeners:{changecomplete:function(a,b){b/=100;this.getNetwork().physics.options.repulsion.damping=b;this.getNetwork().startSimulation()},scope:this}}]}]});this.on("loadedCorpus",function(a,b){this.setCorpus(b);1==b.getDocumentsCount()&&this.setApiParam("minEdgeCount",
1);this.getEntities()},this);this.on("resize",function(a,b,c){},this);this.mixins["Voyant.panel.Panel"].initComponent.apply(this,arguments);this.callParent(arguments)},getEntities:function(){var a=this.getCorpus().getId(),b=this.getLayout().getRenderTarget();b.mask(this.localize("loadingEntities"));Ext.Ajax.request({url:this.getApplication().getTromboneUrl(),method:"POST",params:{tool:"corpus.EntityCollocationsGraph",type:this.getApiParam("type"),limit:this.getApiParam("limit"),minEdgeCount:this.getApiParam("minEdgeCount"),
corpus:a},success:function(a){b.unmask();a=Ext.decode(a.responseText);0==a.entityCollocationsGraph.edges.length?(this.showError({msg:this.localize("noEntities")}),Ext.Msg.confirm(this.localize("error"),this.localize("noEntitiesForEdgeCount"),function(a){"yes"===a&&(a=Math.max(1,this.getApiParam("minEdgeCount")-1),this.queryById("minEdgeCount").setRawValue(a),this.setApiParam("minEdgeCount",a),this.getEntities())},this)):(this.processEntities(a.entityCollocationsGraph),this.initGraph())},scope:this})},
processEntities:function(a){var b=a.nodes;a=a.edges;for(var c=d3.extent(b,function(a){return a.rawFreq}),d=c[0],c=c[1],e=d3.scale.linear().domain([d,c]).range([10,24]),d=[],c=0;c<b.length;c++){var f=b[c];f.id=c;d.push({id:c,label:f.term,value:b[c].rawFreq,font:{size:e(f.rawFreq),color:this.categorizedNodeOptions[f.type].font.color},type:f.type,rawFreq:f.rawFreq,title:f.term+(f.rawFreq?" ("+f.rawFreq+")":"")})}this.getNodesStore().loadData(b);b=[];for(c=0;c<a.length;c++)e=a[c].nodes,b.push({from:e[0],
to:e[1],title:a[c].count,value:200*a[c].count});this.setNodesDataSet(new vis.DataSet(d));this.setEdgesDataSet(new vis.DataSet(b))},initGraph:function(){var a=this.getLayout().getRenderTarget();a.update("");a.setWidth(a.getWidth());a.setHeight(a.getHeight());var b={interaction:{hover:!0,hoverConnectedEdges:!0,multiselect:!1},physics:{solver:"repulsion",repulsion:{centralGravity:.1}},nodes:this.nodeOptions,edges:this.edgeOptions},c=new vis.Network(a.dom,{nodes:this.getNodesDataSet(),edges:this.getEdgesDataSet()},
b);if(this.getIsNetworkBounded())c.on("beforeDrawing",function(a){var b=this.getLayout().getRenderTarget();a=b.getWidth();var b=b.getHeight(),f=c.getPositions(),g;for(g in f){var h=c.canvasToDOM(f[g]),k=Math.max(0,Math.min(a,h.x)),h=Math.max(0,Math.min(b,h.y)),k=c.DOMtoCanvas({x:k,y:h});c.body.nodes[g].x=k.x;c.body.nodes[g].y=k.y}}.bind(this));c.on("selectNode",function(a){this.doNodeSelect(a.nodes[0])}.bind(this));c.on("deselectNode",function(a){c.unselectAll();a=a.nodes[0];void 0!==a&&setTimeout(this.doNodeSelect.bind(this),
5,a)}.bind(this));c.on("selectEdge",function(a){c.unselectAll()});this.setNetwork(c)},doNodeSelect:function(a){var b=this.getNodesDataSet().get(a).label;this.dispatchEvent("termsClicked",this,[b]);var b=this.getNetwork(),c=b.getConnectedNodes(a);c.push(a);a=b.getConnectedEdges(a);b.unselectAll();for(var d=0;d<c.length;d++)b.selectionHandler.selectObject(b.body.nodes[c[d]],!1);for(d=0;d<a.length;d++)b.selectionHandler.selectObject(b.body.edges[a[d]],!1);b.redraw()},categoriesHandler:function(a){var b=
[];a.up("menu").items.each(function(a){a.checked&&b.push(a.itemId)});this.setApiParam("type",b);this.getEntities()},map:function(a,b,c,d,e){return d+(a-b)/(c-b)*(e-d)}});Ext.define("Voyant.panel.Reader",{extend:"Ext.panel.Panel",requires:["Voyant.data.store.Tokens"],mixins:["Voyant.panel.Panel"],alias:"widget.reader",statics:{i18n:{title:{en:"Reader"},helpTip:{en:"\x3cp\x3eThe Reader tool provides a view of text from the corpus. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3efrequency information appears when hovering over a word\x3c/li\x3e\x3cli\x3edistribution information appears in a graph at the bottom when clicking on a word\x3c/li\x3e\x3cli\x3ea bar graph at the bottom indicates the relative size of each document in the corpus\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
documentFrequency:{en:"document frequency:"}},api:{start:0,limit:1E3,skipToDocId:void 0},glyph:"xf0f6@FontAwesome"},config:{corpus:void 0,tokensStore:void 0,documentsStore:void 0,documentTermsStore:void 0,exportVisualization:!1,lastScrollTop:0,scrollIntoView:!1,insertWhere:"beforeEnd",locationMarker:void 0,lastLocationUpdate:new Date},INITIAL_LIMIT:1E3,innerContainer:null,cls:"voyant-reader",layout:"fit",items:{layout:"border",items:[{bodyPadding:10,region:"center",border:!1,autoScroll:!0,html:'\x3cdiv class\x3d"readerContainer"\x3e\x3c/div\x3e'},
{region:"south",height:40,split:{size:2},splitterResize:!0,border:!1,layout:{type:"hbox"}}]},constructor:function(){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){var a=Ext.create("Voyant.data.store.Tokens");a.on("load",function(a,c,d){if(d){var e="",f=this.localize("documentFrequency"),g=!1,h=-1,k=!1;c.forEach(function(a){0==a.getPosition()&&(e+="\x3ch3\x3e"+this.getDocumentsStore().getById(a.getDocId()).getFullLabel()+
"\x3c/h3\x3e");a.getDocIndex()!=h&&(g=this.getDocumentsStore().getById(a.getDocId()).isPlainText(),h=a.getDocIndex());if(a.isWord())k=!1,e+="\x3cspan class\x3d'word' id\x3d'"+a.getId()+"' data-qtip\x3d'"+f+" "+a.getDocumentRawFreq()+"'\x3e"+a.getTerm()+"\x3c/span\x3e";else{a=a.getTermWithLineSpacing(g);var b=0==a.indexOf("\x3cbr /\x3e");if(!k||!b&&0!=a.trim().length)e+=a,k=b}},this);this.updateText(e,!0);a=this.down("querysearchfield").getValue();""!=a&&this.highlightKeywords(a)}},this);this.setTokensStore(a);
this.on("query",function(a,c){this.loadQueryTerms([c])},this);this.setDocumentTermsStore(Ext.create("Ext.data.Store",{model:"Voyant.data.model.DocumentTerm",autoLoad:!1,remoteSort:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",withDistributions:!0,withPositions:!0,bins:25},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0},listeners:{load:function(a,c,d,e){a.sort("docIndex","ASC");var f=
{},g=0,h;a.each(function(a){var b=[],c=a.get("distributions"),d=a.get("docId"),e=a.get("docIndex");h=a.get("term");for(a=0;a<c.length;a++){var r=a,p=c[a];p>g&&(g=p);b.push([d,e,r,p,h])}f[e]=b},this);this.highlightKeywords(h);this.down("querysearchfield").setValue(h);a=this.query("cartesian");for(c=0;c<a.length;c++)d=a[c],e=f[c],void 0!==e?(d.getAxes()[0].setMaximum(g),d.getStore().loadData(e)):d.getStore().removeAll()},scope:this}}));this.on("afterrender",function(){var a=this.down('panel[region\x3d"center"]');
this.innerContainer=a.getLayout().getRenderTarget();a.body.on("scroll",function(a,b){this.innerContainer.first();var e=this.getLastScrollTop()<b.scrollTop;!e&&1>b.scrollTop?this.fetchPrevious(!0):e&&b.scrollHeight-b.scrollTop<1.5*b.offsetHeight?this.fetchNext(!1):250<new Date-this.getLastLocationUpdate()&&this.updateLocationMarker(b);this.setLastScrollTop(b.scrollTop)},this);a.body.on("click",function(a,b){b=Ext.get(b);if(b.hasCls("word")){var e=Voyant.data.model.Token.getInfoFromElement(b),f=b.getHtml(),
e=[{term:f,docIndex:e.docIndex}];this.loadQueryTerms([f]);this.getApplication().dispatchEvent("termsClicked",this,e)}},this);this.getCorpus()&&this.load()},this);Ext.apply(this,{dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{glyph:"xf060@FontAwesome",handler:function(){this.fetchPrevious(!0)},scope:this},{glyph:"xf061@FontAwesome",handler:function(){this.fetchNext(!0)},scope:this},{xtype:"tbseparator"},{xtype:"querysearchfield"}]}],listeners:{loadedCorpus:function(a,c){this.setCorpus(c);this.getTokensStore().setCorpus(c);
this.getDocumentTermsStore().getProxy().setExtraParam("corpus",c.getId());var d=c.getDocuments();this.setDocumentsStore(d);d=this.down('panel[region\x3d"south"]');this.setLocationMarker(Ext.DomHelper.append(d.el,{tag:"div",style:"background-color: #157fcc; height: 100%; width: 2px; position: absolute; top: 0; left: 0;"}));this.generateChart(c,d);this.rendered&&this.load()},termsClicked:function(a,c){var d=[];c.forEach(function(a){Ext.isString(a)?d.push(a):a.term?d.push(a.term):a.getTerm&&d.push(a.getTerm())});
0<d.length&&this.loadQueryTerms(d)},corpusTermsClicked:function(a,c){var d=[];c.forEach(function(a){a.getTerm()&&d.push(a.getTerm())});this.loadQueryTerms(d)},documentTermsClicked:function(a,c){var d=[];c.forEach(function(a){a.getTerm()&&d.push(a.getTerm())});this.loadQueryTerms(d)},documentsClicked:function(a,c,d){c&&(this.setApiParams({skipToDocId:c[0].getId(),start:0}),this.load(!0))},termLocationClicked:function(a,c){if(void 0!==c[0]){var d=c[0],e=d.get("docIndex"),f=d.get("position"),g=f-this.getApiParam("limit")/
2,h=this.getCorpus().getDocument(e);this.setApiParams({skipToDocId:h.getId(),start:0>g?0:g});this.load(!0,{callback:function(){var a=this.body.dom.querySelector("#_"+e+"_"+f);a&&a.scrollIntoView();this.highlightKeywords(d.get("term"),!1)},scope:this})}},documentIndexTermsClicked:function(a,c){if(void 0!==c[0]){var d=Ext.create("Voyant.data.model.Token",c[0]);this.fireEvent("termLocationClicked",this,[d])}},scope:this}});this.callParent(arguments)},loadQueryTerms:function(a){a&&0<a.length&&this.getDocumentTermsStore().load({params:{query:a,
docIndex:void 0,docId:void 0,page:void 0,start:void 0,limit:void 0}})},updateLocationMarker:function(a){var b;b=0==a.scrollTop?0:a.scrollHeight-a.scrollTop==a.clientHeight?1:(a.scrollTop+.5*a.clientHeight)/a.scrollHeight;a=$(a).find(".readerContainer").find(".word");var c=a.first()[0],d=a.last()[0];if(void 0!==c&&void 0!==d){a=this.getCorpus();var e=!1,c=Voyant.data.model.Token.getInfoFromElement(Ext.get(c)),d=Voyant.data.model.Token.getInfoFromElement(Ext.get(d));0!==c.position&&(e=!0);for(var f=
{},g=0,h=c.docIndex;h<=d.docIndex;){var k=a.getDocument(h).get("tokensCount-lexical");h===d.docIndex&&(k=d.position);h===c.docIndex&&(k-=c.position);g+=k;f[h]=k;h++}g=Math.round(g*b);h=b=0;for(k=c.docIndex;k<=d.docIndex&&!(b=k,h+=f[k],h>=g);k++);d=f[b]-(h-g);e&&b===c.docIndex&&(d+=c.position);a=d/a.getDocument(b).get("tokensCount-lexical");e=this.query("cartesian")[b];a=e.getX()+e.getWidth()*a;Ext.get(this.getLocationMarker()).setX(a)}this.setLastLocationUpdate(new Date)},generateChart:function(a,
b){function c(a,b){var c=[[116,116,181],[139,163,83],[189,157,60],[171,75,75],[174,61,155]],c=c[a%c.length];return"rgba("+c[0]+","+c[1]+","+c[2]+","+b+")"}function d(d,e){var f=d.index,g=d.fraction,h=d.relativeHeight,k=c(f,.3),f=c(f,1);b.add({xtype:"cartesian",plugins:{ptype:"chartitemevents"},flex:g,height:"100%",insetPadding:0,background:{type:"linear",degrees:90,stops:[{offset:0,color:k},{offset:h,color:k},{offset:h,color:"white"},{offset:1,color:"white"}]},axes:[{type:"numeric",position:"left",
fields:"distribution",hidden:!0},{type:"category",position:"bottom",fields:"bin",hidden:!0}],series:[{type:"line",xField:"bin",yField:"distribution",style:{lineWidth:2,strokeStyle:f},tooltip:{corpus:a,trackMouse:!0,style:"background: #fff",showDelay:0,dismissDelay:500,hideDelay:5,renderer:function(b,c){this.setHtml(a.getDocument(b.get("docIndex")).getTitle()+"\x3cbr\x3e"+b.get("term")+": "+b.get("distribution"))}}}],store:Ext.create("Ext.data.ArrayStore",{fields:["docId","docIndex","bin","distribution",
"term"],data:[]}),listeners:{itemclick:function(a,b,c){a=b.record.data;a=this.getDocumentsStore().getAt(a.docIndex);this.getApplication().dispatchEvent("documentsClicked",this,[a])},scope:e}}).body.on("click",function(a,b){var c=Ext.get(b),d=a.getX(),e=c.getBox(),d=(d-e.x)/e.width,c=c.parent(".x-panel"),e=c.parent(),c=Ext.toArray(e.dom.children).indexOf(c.dom),c=this.getDocumentsStore().getAt(c),e=c.get("tokensCount-lexical"),d=Math.floor(e*d)-this.getApiParam("limit")/2;this.setApiParams({skipToDocId:c.getId(),
start:0>d?0:d});this.load(!0)},e)}b.removeAll();var e=a.getDocuments();if(50>e.getTotalCount()){for(var f=a.getWordTokensCount(),g=[],h=Number.MAX_VALUE,k=-1,l=0;l<e.getCount();l++){var m=e.getAt(l),n=m.get("index"),m=m.get("tokensCount-lexical");m<h&&(h=m);m>k&&(k=m);g.push({index:n,count:m,fraction:m/f})}for(l=0;l<g.length;l++)m=g[l],m.relativeHeight=m.count==k?1:.25+(m.count-h)/(k-h)*.75,d(m,this)}},highlightKeywords:function(a,b){Ext.isArray(a)||(a=[a]);this.innerContainer.first().select("span[class*\x3dkeyword]").removeCls("keyword");
var c=[],d=new RegExp("^"+a[0]+"$","i");this.innerContainer.first().select("span.word").each(function(a,b,g){a.dom.firstChild&&a.dom.firstChild.nodeValue.match(d)&&(a.addCls("keyword"),c.push(a.dom))})},fetchPrevious:function(a){var b=this.innerContainer.first(),c=b.first(".word");if(null!=c&&!1===c.hasCls("loading"))for(;c;){if(c.hasCls("word")){var b=Voyant.data.model.Token.getInfoFromElement(c),d=b.docIndex,b=b.position,e=this.getDocumentsStore().getAt(d),f=this.getApiParam("limit"),g=!1;if(0===
d&&0===b){c.dom.scrollIntoView();c.frame("red");break}0<d&&0===b?(g=!0,d--,e=this.getDocumentsStore().getAt(d),d=e.get("tokensCount-lexical"),b=d-f,0>b&&(b=0,this.setApiParam("limit",d))):(f--,b-=f);0>b&&(b=0);c.insertSibling("\x3cdiv class\x3d'loading'\x3e"+this.localize("loading")+"\x3c/div\x3e","before",!1).mask();g||c.destroy();c=e.getId();this.setApiParams({skipToDocId:c,start:b});this.setInsertWhere("afterBegin");this.setScrollIntoView(a);this.load();this.setApiParam("limit",this.INITIAL_LIMIT);
break}c.destroy();c=b.first()}},fetchNext:function(a){var b=this.innerContainer.first(),c=b.last();if(!1===c.hasCls("loading"))for(var d=$(b.dom).contents().filter(function(){return 3===this.nodeType}).last();c;){if(c.hasCls("word")){var b=Voyant.data.model.Token.getInfoFromElement(c),e=b.docIndex,f=b.position,g=this.getDocumentsStore().getAt(b.docIndex),h=g.getId(),g=g.get("tokensCount-lexical");if(f+this.getApiParam("limit")>=g&&e==this.getCorpus().getDocumentsCount()-1)if(e=g-f,1>=e){c.dom.scrollIntoView();
c.frame("red");break}else this.setApiParam("limit",e);c.el.dom.nextSibling===d[0]&&d.remove();c.insertSibling("\x3cdiv class\x3d'loading'\x3e"+this.localize("loading")+"\x3c/div\x3e","after",!1).mask();c.destroy();this.setApiParams({skipToDocId:h,start:b.position});this.setInsertWhere("beforeEnd");this.setScrollIntoView(a);this.load();this.setApiParam("limit",this.INITIAL_LIMIT);break}c.destroy();c=b.last()}},load:function(a,b){a&&(this.innerContainer.first().destroy(),this.innerContainer.setHtml('\x3cdiv class\x3d"readerContainer"\x3e\x3cdiv class\x3d"loading"\x3e'+
this.localize("loading")+"\x3c/div\x3e\x3c/div\x3e"),this.innerContainer.first().first().mask());this.getTokensStore().load(Ext.apply(b||{},{params:Ext.apply(this.getApiParams(),{stripTags:"blocksOnly"})}))},updateText:function(a){var b=this.innerContainer.down(".loading");b&&b.destroy();var c=this.innerContainer.first().insertHtml(this.getInsertWhere(),a,!0);c&&this.getScrollIntoView()&&(c.dom.scrollIntoView(),Ext.Function.defer(function(){var a=Ext.get(c.id);a&&a.frame("red")},100));a=this.down('panel[region\x3d"center"]').body.dom;
this.updateLocationMarker(a)},updateChart:function(){}});Ext.define("Voyant.panel.ScatterPlot",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],requires:["Ext.chart.CartesianChart"],alias:"widget.scatterplot",config:{corpus:void 0,options:{xtype:"stoplistoption"}},statics:{i18n:{title:{en:"ScatterPlot"},analysis:{en:"Analysis"},ca:{en:"Correspondence Analysis"},pca:{en:"Principal Components Analysis"},rawFreq:{en:"Raw Frequency"},relFreq:{en:"Relative Frequency"},terms:{en:"Terms"},term:{en:"Term"},numTerms:{en:"Terms Count"},addTerm:{en:"Add Term"},
clusters:{en:"Clusters"},dimensions:{en:"Dimensions"},labels:{en:"Labels"},remove:{en:"Remove"},removeTerm:{en:"Remove \x3cb\x3e{0}\x3c/b\x3e"},nearby:{en:"Nearby"},nearbyTerm:{en:"Nearby \x3cb\x3e{0}\x3c/b\x3e"},pcTitle:{en:"Percentage of Total Variation Explained by Each Component"},pc:{en:"PC"},caTitle:{en:"Percentage of Total Assocation Explained by Each Dimension"},dimension:{en:"Dimension"},xAxis:{en:"X Axis"},yAxis:{en:"Y Axis"},fill:{en:"Fill"},loading:{en:"Loading"},helpTip:{en:"\x3cp\x3eScatterPlot displays the correspondance of word use in a corpus. This visualization relies on a statistical analysis that takes the word\u2019s correspondance from each document (where each document represents a dimension) and reduces it to a three dimensional space to easily visualize the data through a scatterplot.\x3c/p\x3e"},
tokenFreqTip:{en:"\x3cb\x3e{0}\x3c/b\x3e\x3cbr/\x3e\x3cb\x3eRaw Frequency\x3c/b\x3e\x3cbr/\x3e{1}\x3c/b\x3e\x3cbr/\x3e\x3cb\x3eRelative Frequency\x3c/b\x3e\x3cbr/\x3e{2}\x3c/b\x3e"},docFreqTip:{en:"\x3cb\x3e{0}\x3c/b\x3e\x3cbr/\x3e\x3cb\x3eWord Count\x3c/b\x3e\x3cbr/\x3e{1}\x3c/b\x3e"}},api:{analysis:"ca",limit:50,dimensions:3,bins:10,clusters:3,stopList:"auto",target:void 0,query:void 0},glyph:"xf06e@FontAwesome"},tokenFreqTipTemplate:null,docFreqTipTemplate:null,caStore:null,pcaStore:null,termStore:Ext.create("Ext.data.JsonStore",
{fields:[{name:"term"},{name:"rawFreq",type:"int"},{name:"relativeFreq",type:"number"},{name:"coordinates",mapping:"vector"}],sorters:[{property:"rawFreq",direction:"DESC"}]}),newTerm:null,termsTimeout:null,chartMenu:null,labelsMode:0,constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){Ext.apply(this,{title:this.localize("title"),caStore:Ext.create("Voyant.data.store.CAAnalysis"),pcaStore:Ext.create("Voyant.data.store.PCAAnalysis"),
termStore:this.termStore,chartMenu:Ext.create("Ext.menu.Menu",{items:[{text:this.localize("remove"),itemId:"remove",glyph:"xf068@FontAwesome"},{text:this.localize("nearby"),itemId:"nearby",glyph:"xf0b2@FontAwesome"}],listeners:{hide:function(){var a=this.down("#chart").getSeries();a[0].enableToolTips();a[1].enableToolTips()},scope:this}}),layout:"border",autoDestroy:!0,items:[{itemId:"chartParent",region:"center",layout:"fit",tbar:[{text:this.localize("analysis"),itemId:"analysis",glyph:"xf1ec@FontAwesome",
menu:{items:[{text:this.localize("pca"),itemId:"analysis_pca",group:"analysis",xtype:"menucheckitem"},{text:this.localize("ca"),itemId:"analysis_ca",group:"analysis",xtype:"menucheckitem"}],listeners:{click:function(a,b){void 0!==b&&(b.text===this.localize("pca")?this.setApiParam("analysis","pca"):(this.setApiParam("analysis","ca"),this.getCorpus().getDocumentsCount()),this.loadFromApis(!0))},scope:this}}},{text:this.localize("clusters"),itemId:"clusters",glyph:"xf192@FontAwesome",menu:{items:[{text:"1",
itemId:"clusters_1",group:"clusters",xtype:"menucheckitem"},{text:"2",itemId:"clusters_2",group:"clusters",xtype:"menucheckitem"},{text:"3",itemId:"clusters_3",group:"clusters",xtype:"menucheckitem"},{text:"4",itemId:"clusters_4",group:"clusters",xtype:"menucheckitem"},{text:"5",itemId:"clusters_5",group:"clusters",xtype:"menucheckitem"}],listeners:{click:function(a,b){void 0!==b&&(this.setApiParam("clusters",parseInt(b.text)),this.loadFromApis(!0))},scope:this}}},{text:this.localize("dimensions"),
itemId:"dimensions",glyph:"xf1b2@FontAwesome",menu:{items:[{text:"2",itemId:"dimensions_2",group:"dimensions",xtype:"menucheckitem"},{text:"3",itemId:"dimensions_3",group:"dimensions",xtype:"menucheckitem"}],listeners:{click:function(a,b){void 0!==b&&(this.setApiParam("dimensions",parseInt(b.text)),this.loadFromApis(!0))},scope:this}}},{text:this.localize("labels"),itemId:"labels",glyph:"xf02b@FontAwesome",handler:function(){this.labelsMode++;2<this.labelsMode&&(this.labelsMode=0);this.doLabels()},
scope:this}]},{itemId:"terms",xtype:"grid",title:"Terms",region:"east",width:"40%",split:!0,collapsible:!0,border:!0,dockedItems:[{dock:"top",xtype:"toolbar",items:[{fieldLabel:this.localize("numTerms"),labelAlign:"right",labelWidth:100,itemId:"limit",xtype:"combo",width:180,store:Ext.create("Ext.data.ArrayStore",{fields:["count"],data:[[10],[20],[30],[40],[50],[60],[70],[80],[90],[100]]}),displayField:"count",valueField:"count",queryMode:"local",editable:!0,allowBlank:!1,validator:function(a){return null===
a.match(/\D/)},listeners:{change:function(a,b,c){function d(){var a=Math.min(parseInt(b),1E4);this.setApiParam("limit",a);this.loadFromApis()}a.isValid()&&null!==c&&(null!==this.termsTimeout&&clearTimeout(this.termsTimeout),this.termsTimeout=setTimeout(d.bind(this),500))},scope:this}},{xtype:"tbseparator"},{xtype:"button",text:this.localize("nearby"),glyph:"xf0b2@FontAwesome",handler:function(){var a=this.down("#terms").getSelection()[0];void 0!==a&&(a=a.get("term"),this.getNearbyForTerm(a))},scope:this},
{xtype:"button",text:this.localize("remove"),glyph:"xf068@FontAwesome",handler:function(){var a=this.down("#terms").getSelection()[0];void 0!==a&&(a=a.get("term"),this.removeTerm(a))},scope:this},{xtype:"textfield",emptyText:this.localize("addTerm"),triggers:{clear:{weight:0,cls:Ext.baseCSSPrefix+"form-clear-trigger",hidden:!0,handler:function(){this.setValue("");this.findParentByType("panel").fireEvent("query",this,void 0);this.getTrigger("clear").hide();this.updateLayout()}},search:{weight:1,cls:Ext.baseCSSPrefix+
"form-search-trigger",handler:function(){var a=this.getValue();this.findParentByType("panel").fireEvent("query",this,a);a?this.getTrigger("clear").show():this.getTrigger("clear").hide();this.updateLayout()}}},listeners:{specialkey:function(a,b){if(b.getKey()===b.ENTER)this.triggers.search.onClick()}}}]}],columns:[{text:this.localize("term"),dataIndex:"term",flex:1,sortable:!0},{text:this.localize("rawFreq"),dataIndex:"rawFreq",width:"autoSize",sortable:!0},{text:this.localize("relFreq"),dataIndex:"relativeFreq",
width:"autoSize",sortable:!0,hidden:!0}],selModel:Ext.create("Ext.selection.RowModel",{listeners:{selectionchange:{fn:function(a,b){var c=b[0];void 0!==c&&(c=c.get("term"),this.selectTerm(c))},scope:this}},mode:"SINGLE"}),store:this.termStore,listeners:{query:function(a,b){void 0!==b&&-1===this.termStore.findExact("term",b)?(this.newTerm=b,this.loadFromApis()):this.newTerm=null},scope:this}}]});this.on("loadedCorpus",function(a,b){var c=function(a){var b=this.getApiParam(a);this.queryById("chartParent").getDockedItems("toolbar")[0].down("#"+
a).down("#"+a+"_"+b).setChecked(!0)}.bind(this);c("analysis");c("clusters");c("dimensions");this.setCorpus(b);this.caStore.setCorpus(b);this.pcaStore.setCorpus(b);this.loadFromApis()},this);this.caStore.on("load",function(a,b){this.buildChart(a)},this);this.pcaStore.on("load",function(a,b){this.buildChart(a)},this);this.tokenFreqTipTemplate=new Ext.Template(this.localize("tokenFreqTip"));this.docFreqTipTemplate=new Ext.Template(this.localize("docFreqTip"));this.callParent(arguments)},buildChart:function(a){var b=
this,c=this.queryById("chart");null!==c&&this.queryById("chartParent").remove(c);var c=a.getAt(0),d=this.getApiParam("dimensions");a="";if("pca"==this.getApiParam("analysis")){for(var e=c.getPrincipalComponents(),f=0,g=0;g<e.length;g++)var h=e[g],f=f+parseFloat(h.get("eigenValue"));a=this.localize("pcTitle")+"\n";for(var k=["xAxis","yAxis","fill"],g=0;g<e.length&&!(g>=d);g++)h=e[g],h=parseFloat(h.get("eigenValue"))/f*100,a+=this.localize("pc")+" "+(g+1)+" ("+this.localize(k[g])+"): "+Math.round(100*
h)/100+"%\n"}else for(a=this.localize("caTitle")+"\n",k=["xAxis","yAxis","fill"],e=c.getDimensions(),g=0;g<e.length&&!(g>=d);g++)h=parseFloat(e[g].data),a+=this.localize("dimension")+" "+(g+1)+" ("+this.localize(k[g])+"): "+Math.round(100*h)/100+"%\n";var l=0,m=Number.MAX_VALUE,n=0,q=Number.MAX_VALUE;this.termStore.removeAll();var r=[],p=[];c.getTokens().forEach(function(a){var b=a.get("rawFreq"),c="part"===a.get("category");c||(b>l&&(l=b),b<m&&(m=b),this.termStore.findExact("term",-1===a.get("term"))&&
this.termStore.addSorted(a));if(3===d){var e=a.get("vector")[2];e<q&&(q=e);e>n&&(n=e)}b={term:a.get("term"),rawFreq:b,relativeFreq:a.get("relativeFreq"),cluster:a.get("cluster"),x:a.get("vector")[0],y:a.get("vector")[1],z:a.get("vector")[2],isDoc:c};c?(b.docIndex=a.get("docIndex"),a=this.getCorpus().getDocument(b.docIndex),b.term=a.getTinyTitle(),b.title=a.getTitle(),p.push(b)):r.push(b)},this);c=this.termStore.getCount();this.queryById("limit").setRawValue(c);this.setApiParam("limit",c);c=Ext.create("Ext.data.JsonStore",
{fields:"term x y z rawFreq relativeFreq cluster isDoc docIndex".split(" "),data:r});g=Ext.create("Ext.data.JsonStore",{fields:"term x y z rawFreq relativeFreq cluster isDoc docIndex".split(" "),data:p});a={itemId:"chart",xtype:"cartesian",interactions:["crosszoom","panzoom","itemhighlight"],plugins:{ptype:"chartitemevents"},axes:[{type:"numeric",position:"bottom",fields:["x"]},{type:"numeric",position:"left",fields:["y"]}],sprites:[{type:"text",text:a,hidden:0<this.labelsMode,x:70,y:70}],innerPadding:{top:25,
right:25,bottom:25,left:25},series:[{type:"customScatter",xField:"x",yField:"y",store:c,tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c){this.setHtml(b.tokenFreqTipTemplate.apply([a.get("term"),a.get("rawFreq"),a.get("relativeFreq")]))}},marker:{type:"circle"},highlight:{fillStyle:"yellow",strokeStyle:"black"},renderer:function(a,b,c,e){c=c.store.getAt(e);if(null!==c){var f=c.get("cluster");a=this.getParent().up("scatterplot");-1===f&&(f=0);e=.65;3===d&&(e=a.interpolate(c.get("z"),
q,n,0,1));f=a.getApplication().getColor(f);b.fillStyle="rgba("+f.join(",")+","+e+")";b.strokeStyle="rgba("+f.join(",")+",1)";c=c.get("rawFreq");a=a.interpolate(c,m,l,2,20);b.radius=a}}},{type:"customScatter",xField:"x",yField:"y",store:g,tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c){this.setHtml(b.docFreqTipTemplate.apply([a.get("title"),a.get("rawFreq")]))}},marker:{type:"diamond"},highlight:{fillStyle:"yellow",strokeStyle:"black"},renderer:function(a,b,c,e){c=c.store.getAt(e);
null!==c&&(c.get("cluster"),e=this.getParent().up("scatterplot"),a=.65,3===d&&(a=e.interpolate(c.get("z"),q,n,0,1)),c=e.getApplication().getColor(6),b.fillStyle="rgba("+c.join(",")+","+a+")",b.strokeStyle="rgba("+c.join(",")+",1)",b.radius=5)}}],listeners:{itemclick:function(a,b,c){a=b.record.data;a.isDoc?(a=this.getCorpus().getDocument(a.docIndex),this.getApplication().dispatchEvent("documentsClicked",this,[a])):(a=Ext.create("Voyant.data.model.CorpusTerm",a),this.getApplication().dispatchEvent("corpusTermsClicked",
this,[a]))},render:function(a){a.body.on("contextmenu",function(a,b){a.preventDefault();var c=a.getXY(),d=Ext.fly(b).getXY(),e=c[0]-d[0],d=c[1]-d[1],f=this.down("#chart").getItemForPoint(e,d);null!=f&&1!=f.record.get("isDoc")&&(e=this.down("#chart").getSeries(),e[0].disableToolTips(),e[1].disableToolTips(),e=f.record.get("term"),d=(new Ext.Template(this.localize("removeTerm"))).apply([e]),this.chartMenu.queryById("remove").setText(d),d=(new Ext.Template(this.localize("nearbyTerm"))).apply([e]),this.chartMenu.queryById("nearby").setText(d),
this.chartMenu.on("click",function(a,b){if(void 0!==b){var c=f.record.get("term");b.text===this.localize("remove")?this.removeTerm(c):this.getNearbyForTerm(c)}},this,{single:!0}),this.chartMenu.showAt(c))},this)},scope:this}};2>this.labelsMode&&(a.series[0].label={field:"term",display:"over"},a.series[1].label={field:"term",display:"over"});a=Ext.create("Ext.chart.CartesianChart",a);this.queryById("chartParent").insert(0,a);null!==this.newTerm&&(this.selectTerm(this.newTerm),this.newTerm=null)},doLabels:function(){var a=
this.queryById("chart"),b=a.getSeries(),c=a.getSurface("chart").getItems()[0];switch(this.labelsMode){case 0:b[0].getLabel().show();b[1].getLabel().show();c.show();break;case 1:b[0].getLabel().show();b[1].getLabel().show();c.hide();break;case 2:b[0].getLabel().hide(),b[1].getLabel().hide(),c.hide()}a.redraw()},selectTerm:function(a){var b=this.down("#chart").getSeries()[0];a=b.getStore().findExact("term",a);if(-1!==a){var c=b.getStore().getAt(a),d=b.getSprites()[0];a={series:b,category:b.getItemInstancing()?
"items":"markers",index:a,record:c,field:b.getYField(),sprite:d};b.setHighlightItem(a)}},getCurrentTerms:function(){var a=[];this.termStore.each(function(b){b.get("isDoc")||a.push(b.get("term"))});return a},getNearbyForTerm:function(a){var b=Math.max(2E3,Math.round(this.getCorpus().getWordTokensCount()/100));this.setApiParams({limit:b,target:a});this.loadFromApis();this.setApiParam("target",void 0)},removeTerm:function(a){var b=this.down("#chart").getSeries()[0],c=b.getStore().findExact("term",a);
b.getStore().removeAt(c);c=this.termStore.findExact("term",a);this.termStore.removeAt(c);a=this.termStore.getCount();this.queryById("limit").setRawValue(a)},loadFromApis:function(a){var b=this.down("#chart");null!==b&&b.mask(this.localize("loading"));var b={},c=this.getCurrentTerms();null!==this.newTerm&&(c.push(this.newTerm),this.setApiParam("limit",c.length));if(0<c.length){if(null!==this.newTerm||a)b.query=c.join(",");b.term=c}Ext.apply(b,this.getApiParams());"pca"===b.analysis?this.pcaStore.load({params:b}):
this.caStore.load({params:b})},interpolate:function(a,b,c,d,e){return d+(e-d)*Math.max(0,Math.min(1,(a-b)/(c-b)))}});Ext.define("Ext.chart.series.CustomScatter",{extend:"Ext.chart.series.Scatter",alias:"series.customScatter",type:"customScatter",seriesType:"scatterSeries",tipsDisabled:!1,enableToolTips:function(){this.tipsDisabled=!1},disableToolTips:function(){this.tipsDisabled=!0},showTip:function(a,b){this.tipsDisabled||this.callParent(arguments)}});Ext.define("Voyant.panel.Summary",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel","Voyant.util.SparkLine"],alias:"widget.summary",statics:{i18n:{title:{en:"Summary"},helpTip:{en:"\x3cp\x3eThe \x3ci\x3eSummary\x3c/i\x3e tool provides general information about the corpus. Many elements in the tool are links that trigger other views. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3etotal words (tokens) and word forms (types) and age of the corpus\x3c/li\x3e\x3cli\x3emost frequent terms in the corpus\x3c/li\x3e\x3cli\x3efor corpora with more than one documen\x3cul\x3e\x3cli\x3edocuments ordered by length and vocabulary density\x3c/li\x3e\x3cli\x3edistinctive words for each document (by TF-IDF score)\x3c/li\x3e\x3c/ul\x3e\x3c/li\x3e\x3c/ul\x3e"},
corpusType:{en:'\x3ctpl for\x3d"types"\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"corpus-type keyword" voyant:recordId\x3d"{id}"\x3e{type}\x3c/a\x3e ({val})\x3ctpl if\x3d"xindex \x26lt; len"\x3e, \x3c/tpl\x3e\x3c/tpl\x3e'},documentType:{en:'\x3ctpl for\x3d"types"\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-type keyword" voyant:recordId\x3d"{id}" voyant:val\x3d"{docId}:{type}"\x3e{type}\x3c/a\x3e ({val})\x3ctpl if\x3d"xindex \x26lt; len"\x3e, \x3c/tpl\x3e\x3c/tpl\x3e'},
mostFrequentWords:{en:"Most \x3cb\x3efrequent words\x3c/b\x3e in the corpus: "},docsLength:{en:'\x3cul\x3e\x3ctpl for\x3d"docs"\x3e\x3cli\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-id" voyant:val\x3d"{id}"\x3e{title}\x3c/a\x3e ({totalWordTokens})\x3c/li\x3e\x3c/tpl\x3e\x3c/ul\x3e'},docsLengthLongest:{en:"\x3cb\x3eLongest documents\x3c/b\x3e (by words {0})"},docsLengthShortest:{en:"Shortest documents"},docsLengthAll:{en:"Documents ordered by number of words ({0})"},docsDensity:{en:'\x3cul\x3e\x3ctpl for\x3d"docs"\x3e\x3cli\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-id" voyant:val\x3d"{id}"\x3e{title}\x3c/a\x3e ({wordDensity})\x3c/li\x3e\x3c/tpl\x3e\x3c/ul\x3e'},
docsDensityHighest:{en:"Highest \x3cb\x3evocabulary density\x3c/b\x3e ({0})"},docsDensityLowest:{en:"Lowest density"},docsDensityAll:{en:"Documents ordered by vocabulary density ({0})"},distinctiveWords:{en:"\x3cb\x3eDistinctive words\x3c/b\x3e (compared to the rest of the corpus): "},moreDistinctiveWords:{en:'\x3ca href\x3d"#" onclick\x3d"return false"\x3eNext {0} of {1} remaining\x3c/a\x3e'},seeAll:{en:"All\x26hellip;"},more:{en:"More\x26hellip;"}},api:{stopList:"auto",start:0,limit:5,numberOfDocumentsForDistinctiveWords:5},
glyph:"xf1ea@FontAwesome"},config:{corpus:void 0},autoScroll:!0,cls:"corpus-summary",corpusTermsStore:null,docsStore:null,documentTermsStore:null,summaryListParent:null,constructor:function(a){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,c){this.setCorpus(c);this.corpusTermsStore=c.getCorpusTerms();this.docStore=Ext.create("Ext.data.Store",{model:"Voyant.data.model.Document",
autoLoad:!1,remoteSort:!1,corpus:this.getCorpus(),proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsMetadata",corpus:this.getCorpus().getId()},reader:{type:"json",rootProperty:"documentsMetadata.documents",totalProperty:"documentsMetadata.total"},simpleSortMode:!0},listeners:{load:function(a,b,c,d){var k=this.getCorpus();b.forEach(function(a){a.set("corpus",k)})},scope:this}});this.documentTermsStore=Ext.create("Ext.data.Store",{model:"Voyant.data.model.DocumentTerm",
autoLoad:!1,remoteSort:!1,corpus:this.getCorpus(),proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",corpus:this.getCorpus().getId()},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0}});if(this.rendered){var d=this.getLayout().getRenderTarget();d.update("");this.summaryListParent=Ext.dom.Helper.append(d,"\x3cul\x3e\x3c/ul\x3e");Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e"+c.getShow()+
"\x3c/li\x3e");d=c.getDocumentsCount();1<d&&this.showLongestDocuments();1<d&&this.showMostDenseDocuments();this.showMostFrequentWords();1<d&&this.showDistinctiveWords();d=Ext.apply({},{limit:null},this.getApiParams());this.docStore.load({params:d});this.addLinksHandler()}else Ext.defer(this.fireEvent,100,this)});this.on("activate",function(){this.getCorpus()&&this.dispatchEvent("ensureCorpusView",this,this.getCorpus())},this);a.embedded&&"Voyant.data.model.Corpus"==Ext.getClass(a.embedded).getName()&&
(a.corpus=a.embedded);a&&a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus)},showLongestDocuments:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e\x3c/li\x3e");this.docStore.on("load",function(b,c,d){c=b.getTotalCount();if(1<c){b.sort("index","ASC");var e=[];b.each(function(a){e.push(a.get("tokensCount-lexical"))});b.sort("tokensCount-lexical","DESC");b={shortest:b.getRange(c-2,c).reverse(),longest:b.getRange(0,1),all:b.getRange(0,c)};for(var f in b)if(f){d=b[f];for(var g=
0;g<d.length;g++){var h=d[g];b[f][g]={title:h.getShortTitle(),id:h.get("id"),totalWordTokens:Ext.util.Format.number(h.get("tokensCount-lexical"),"0,000"),docsLen:d.length}}}f=new Ext.XTemplate(this.localize("docsLength"));d="";5<c?(d+=(new Ext.Template(this.localize("docsLengthLongest"))).applyTemplate([this.getSparkLine(e)])+this.localize("colon")+f.apply({docs:b.longest}),d+=this.localize("docsLengthShortest")+this.localize("colon")+f.apply({docs:b.shortest}),d+="\x3ca href\x3d'#' onclick\x3d'return false' class\x3d'corpus-documents corpus-documents-length'\x3e"+
this.localize("seeAll")+"\x3c/a\x3e"):d+=(new Ext.Template(this.localize("docsLengthAll"))).apply([this.getSparkLine(e)])+this.localize("colon")+f.apply({docs:b.all});Ext.dom.Helper.append(a,d)}},this)},showMostDenseDocuments:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e\x3c/li\x3e");this.docStore.on("load",function(b,c,d){c=b.getTotalCount();if(1<c){b.sort("index","ASC");var e=[];b.each(function(a){e.push(a.get("typeTokenRatio-lexical"))});b.sort("typeTokenRatio-lexical",
"DESC");b={lowest:b.getRange(c-2,c).reverse(),highest:b.getRange(0,1),all:b.getRange(0,c)};for(var f in b)if(f){d=b[f];for(var g=0;g<d.length;g++){var h=d[g];b[f][g]={title:h.getShortTitle(),id:h.get("id"),wordDensity:Ext.util.Format.number(h.get("typeTokenRatio-lexical"),"0.000"),docsLen:d.length}}}f=new Ext.XTemplate(this.localize("docsDensity"));d="";5<c?(d+=(new Ext.Template(this.localize("docsDensityHighest"))).applyTemplate([this.getSparkLine(e)])+this.localize("colon")+f.apply({docs:b.highest}),
d+=this.localize("docsDensityLowest")+this.localize("colon")+f.apply({docs:b.lowest}),d+="\x3ca href\x3d'#' onclick\x3d'return false' class\x3d'corpus-documents corpus-documents-density'\x3e"+this.localize("seeAll")+"\x3c/a\x3e"):d+=(new Ext.Template(this.localize("docsDensityAll"))).applyTemplate([this.getSparkLine(e)])+this.localize("colon")+f.apply({docs:b.all});Ext.dom.Helper.append(a,d)}},this)},showMostFrequentWords:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e\x3c/li\x3e"),
b=this.getApiParams();this.corpusTermsStore.load({params:b,scope:this,callback:function(b){var d=this.localize("mostFrequentWords"),e=[],f=b.length;b.forEach(function(a,b,c){e.push({id:a.getId(),type:a.getTerm(),val:Ext.util.Format.number(a.get("rawFreq"),"0,000"),len:f})});d+=(new Ext.XTemplate(this.localize("corpusType"))).applyTemplate({types:e})+".";Ext.dom.Helper.append(a,d)}})},showDistinctiveWords:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e"+this.localize("distinctiveWords")+
"\x3col\x3e\x3c/ol\x3e\x3c/li\x3e",!0).first("ol");this.docStore.on("load",function(b,c,d){c=b.getTotalCount();if(1<c){b.sort("index","ASC");var e=this.getApiParam("numberOfDocumentsForDistinctiveWords");b.each(function(b,c,d){Ext.dom.Helper.append(a,{tag:"li","voyant:index":String(c),cls:c>e-1?"x-hidden":"",html:'\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-id document-id-distinctive" voyant:val\x3d"'+b.get("id")+'"\x3e'+b.getShortTitle()+"\x3c/a\x3e"})},this);if(c>e){var f=new Ext.Template(this.localize("moreDistinctiveWords"));
b=c-e;var g=Ext.dom.Helper.append(this.summaryListParent,{tag:"div",html:f.apply([e>b?b:e,b])},!0);g.addListener("click",function(){var b=a.select('li[class\x3d"x-hidden"]');for(i=0;i<b.getCount()&&i!=e;i++)b.item(i).removeCls("x-hidden");this.showDistinctiveWordsStep(b.item(0));b=b.getCount()-e;0<b?g.update(f.apply([e>b?b:e,b])):g.remove()},this)}this.showDistinctiveWordsStep(a.first("li"))}},this)},showDistinctiveWordsStep:function(a){var b=Number(a.getAttribute("index","voyant"));this.documentTermsStore.load({addRecords:!0,
params:{docIndex:b,limit:5,sort:"TFIDF",dir:"DESC"},scope:this,callback:function(b,d,e){var f=[];if(b){var g=b.length;b.forEach(function(a,b,c){f.push({id:a.getId(),type:a.getTerm(),val:Ext.util.Format.number(a.get("rawFreq"),"0,000"),docId:a.get("docId"),len:g})});Ext.dom.Helper.append(a,this.localize("colon")+(new Ext.XTemplate(this.localize("documentType"))).apply({types:f})+".");(b=a.next("li"))&&!b.hasCls("x-hidden")&&this.showDistinctiveWordsStep(b)}}})},addLinksHandler:function(){this.body.addListener("click",
function(a){if((a=a.getTarget(null,null,!0))&&"A"==a.dom.tagName){var b={};a.hasCls("corpus-documents")?(a.hasCls("corpus-documents-length")?b.sortBy="totalWordTokens":a.hasCls("corpus-documents-density")&&(b.sortBy="wordDensity"),b.sortDirection="DESC"):a.hasCls("document-id")?(a=a.getAttribute("val","voyant"),a=this.docStore.getById(a),this.dispatchEvent("documentsClicked",this,[a])):a.hasCls("corpus-type")?(a=a.getAttribute("recordId","voyant"),a=this.corpusTermsStore.getById(a),this.dispatchEvent("corpusTermsClicked",
this,[a])):a.hasCls("corpus-types")?(b.query="",a.hasCls("corpus-types-peaks")?Ext.apply(b,{sortBy:"RELATIVEDISTRIBUTIONKURTOSIS",sortDirection:"DESC",extendedSortZscoreMinimum:1}):Ext.apply(b,{sortBy:"rawFreq",sortDirection:"DESC",extendedSortZscoreMinimum:null})):a.hasCls("document-type")&&(a=a.getAttribute("recordId","voyant"),a=this.documentTermsStore.getById(a),this.dispatchEvent("documentTermsClicked",this,[a]))}},this)}});Ext.define("Voyant.panel.TopicContexts",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.topiccontexts",statics:{i18n:{title:{en:"Topic Contexts"},helpTip:{en:"Topic Contexts"},reset:{en:"reset"}},api:{},glyph:"xf06e@FontAwesome"},constructor:function(a){Ext.apply(this,{title:this.localize("title"),cls:"twic_body"});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},listeners:{loadedCorpus:function(a,b){this.loadFromCorpus(b)}},loadFromCorpus:function(a){a=
Ext.Loader.getPath("resources")+"/twic/current/data/input/json";var b=TWiC.Level.prototype.Instance();b.LoadJSON(a+"/twic_corpusinfo.json",a+"/twic_corpusmap.json");var c=this;b.m_queue.await(function(){var a=[],e=[],f=new TWiC.TopicBar({x:0,y:635},{width:1280,height:165},"dickinson",b,[]);e.push(f);var g=new TWiC.DocumentBar({x:1055,y:0},{width:225,height:635},"dickinson",b,[]);e.push(g);g=new TWiC.CorpusClusterView({x:0,y:0},{width:1055,height:635},"dickinson",b,[f,g]);a.push(g);f.m_linkedViews.push(g);
f=c.getLayout().getRenderTarget();b.Initialize([0,0],{width:f.getWidth(),height:f.getHeight()},"dickinson",a,e,"#"+f.getId());b.Start()}.bind(b))}});Ext.define("Voyant.panel.TermsRadio",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.termsradio",config:{corpus:void 0,options:[{xtype:"stoplistoption"}]},statics:{i18n:{title:{en:"TermsRadio"},type:{en:"Visualization"},help:{en:"This tool can be used to examine word occurence over a corpus spanning a period of time."},segments:{en:"Segments"},segmentsTip:{en:"This option allows you to define how many segments a document should be divided into (note that this option only applies to distribution within a document, not distribution across a corpus)."},
displayPanel:{en:"Display Panel"},displayPanelTip:{en:"Panel to control settings for word display."},duration:{en:"Scroll Duration"},fraction:{en:"Word Display"},fractionTip:{en:"This option allows you to define the number of words displayed. Ex. 20 will only keep the words that occur with the lowest 20% of frequency."},reset:{en:"Reset"},resetTip:{en:"Reset the visualization to the beginning."},stop:{en:"Pause"},stopTip:{en:"Pauses the scrolling movement."},toggleLeft:{en:"\x3c Back"},toggleLeftTip:{en:"Toggle the values to the left."},
toggleRight:{en:"Forward \x3e"},toggleRightTip:{en:"Toggle the values to the right."},visibleSegments:{en:"Visible Segments"},visibleSegmentsTip:{en:"This option allows you to define how many segments are visible at once."},adaptedFrom:{en:"TermsRadio is adapted from Type frequencies chart."},scrollSpeed:{en:"Scroll speed"},yScale:{en:"Y-axis Scale"},linear:{en:"Linear"},log:{en:"Logarithmic"},removeTerm:{en:"Remove \x3cb\x3e{0}\x3c/b\x3e"}},api:{withDistributions:!0,bins:5,visibleBins:5,docIdType:null,
limit:50,mode:null,position:0,selectedWords:[],stopList:"auto",query:null,yAxisScale:"log"},glyph:"xf201@FontAwesome"},absMaxFreq:0,absMinFreq:0,allData:[],chart:null,theme:Ext.create("Ext.chart.theme.Base"),colorIndex:[],colorMasterList:[],continueTransition:!0,counterSeries:[],displayData:[],dragged:!1,isTransitioning:!1,lastSlippery:null,lastSticky:null,maxFont:30,minFreq:0,numDataPoints:0,numVisPoints:5,overlayQueue:[],records:0,recordsLength:0,reselectTop:!1,shiftCount:0,sliderDragSum:0,titlesArray:[],
transitionCall:"draw",valFraction:1,win:0,bPadding:25,lPadding:40,rPadding:20,tPadding:20,navigationHeight:100,largestW:0,largestH:0,constructor:function(a){this.colorMasterList=this.theme.getColors();for(var b=0;b<this.colorMasterList.length;b++)this.colorIndex.push(this.colorMasterList[b]);b=function(a,b,e,f){this.setApiParams({mode:a});b=this.getApiParam("query");f=!1;if(null!=b){this.setApiParams({query:null});for(var g=0;g<this.records.length;g++)if(this.records[g].getTerm()==b){f=!0;break}f||
(e=e.concat(this.records))}if(!f){this.initData(e);this.prepareData();for(e=this.shiftCount;0<e--;)this.displayData.shift();null!=this.chart?this.redraw():this.initializeChart();this.setVisibleSegments();this.redrawSliderOverlay()}null!=b&&(e=null,"document"===a&&(e=this.getCorpus().getDocument(0).getId()),a=this.buildParamsBundle({wordString:b,docId:e}),this.manageOverlaySticky(a))};this.corpusStore=Ext.create("Voyant.data.store.CorpusTerms",{listeners:{load:{fn:b.bind(this,"corpus"),scope:this}}});
this.documentStore=Ext.create("Voyant.data.store.DocumentTerms",{listeners:{load:{fn:b.bind(this,"document"),scope:this}}});this.segments=new Ext.Button({text:this.localize("segments"),tooltip:this.localize("segmentsTip"),menu:new Ext.menu.Menu({items:[new Ext.menu.CheckItem({text:"5",checked:!0,group:"segments"}),new Ext.menu.CheckItem({text:"10",checked:!1,group:"segments"}),new Ext.menu.CheckItem({text:"15",checked:!1,group:"segments"}),new Ext.menu.CheckItem({text:"20",checked:!1,group:"segments"}),
new Ext.menu.CheckItem({text:"25",checked:!1,group:"segments"}),new Ext.menu.CheckItem({text:"30",checked:!1,group:"segments"}),new Ext.menu.CheckItem({text:"40",checked:!1,group:"segments"}),new Ext.menu.CheckItem({text:"50",checked:!1,group:"segments"}),new Ext.menu.CheckItem({text:"75",checked:!1,group:"segments"}),new Ext.menu.CheckItem({text:"100",checked:!1,group:"segments"})],listeners:{click:{fn:function(a,b){this.numDataPoints=parseInt(b.text);this.setApiParams({bins:parseInt(b.text)});this.loadStore()},
scope:this}}})});this.visibleSegments=new Ext.Button({text:this.localize("visibleSegments"),tooltip:this.localize("visibleSegmentsTip"),menu:new Ext.menu.Menu({items:[new Ext.menu.CheckItem({text:"5",checked:!0,group:"visibleSegments"}),new Ext.menu.CheckItem({text:"10",checked:!1,group:"visibleSegments"}),new Ext.menu.CheckItem({text:"15",checked:!1,group:"visibleSegments"}),new Ext.menu.CheckItem({text:"20",checked:!1,group:"visibleSegments"}),new Ext.menu.CheckItem({text:"25",checked:!1,group:"visibleSegments"}),
new Ext.menu.CheckItem({text:"30",checked:!1,group:"visibleSegments"}),new Ext.menu.CheckItem({text:"40",checked:!1,group:"visibleSegments"}),new Ext.menu.CheckItem({text:"50",checked:!1,group:"visibleSegments"}),new Ext.menu.CheckItem({text:"75",checked:!1,group:"visibleSegments"}),new Ext.menu.CheckItem({text:"100",checked:!1,group:"visibleSegments"})],listeners:{click:{fn:function(a,b){this.numVisPoints=parseInt(b.text);this.setApiParams({visibleBins:parseInt(b.text)});this.loadStore()},scope:this}}})});
this.fraction=new Ext.form.ComboBox({fieldLabel:this.localize("fraction"),labelAlign:"right",labelWidth:100,itemId:"limit",width:170,store:Ext.create("Ext.data.ArrayStore",{fields:["count"],data:[[10],[20],[30],[40],[50],[60],[70],[80],[90],[100]]}),value:50,displayField:"count",valueField:"count",queryMode:"local",editable:!0,allowBlank:!1,validator:function(a){return null===a.match(/\D/)},listeners:{change:function(a,b,e){function f(){var a=Math.min(parseInt(b),1E4);this.setApiParam("limit",a);
this.loadStore()}a.isValid()&&null!==e&&(null!==this.termsTimeout&&clearTimeout(this.termsTimeout),this.termsTimeout=setTimeout(f.bind(this),500))},scope:this}});this.typeSearch=Ext.create("Voyant.widget.QuerySearchField",{width:100});this.toggleLeft=new Ext.Button({text:this.localize("toggleLeft"),tooltip:this.localize("toggleLeftTip"),listeners:{click:{fn:function(){var a=this;this.isTransitioning?"right"===this.transitionCall&&(this.continueTransition=!1,setTimeout(function(){a.isTransitioning||
a.toggleLeftCheck()},a.duration.getValue()+50)):this.toggleLeftCheck()},scope:this}}});this.toggleRight=new Ext.Button({text:this.localize("toggleRight"),tooltip:this.localize("toggleRightTip"),listeners:{click:{fn:function(){var a=this;this.isTransitioning?"left"===this.transitionCall&&(this.continueTransition=!1,setTimeout(function(){a.isTransitioning||a.toggleRightCheck()},a.duration.getValue()+50)):this.toggleRightCheck()},scope:this}}});this.stop=new Ext.Button({text:this.localize("stop"),tooltip:this.localize("stopTip"),
listeners:{click:{fn:function(){this.continueTransition=!1},scope:this}}});this.resetButton=new Ext.Button({text:this.localize("reset"),tooltip:this.localize("resetTip"),listeners:{click:{fn:function(){var a=this;setTimeout(function(){a.shiftCount=0;a.prepareData();a.redraw()},1E3)},scope:this}}});this.duration=new Ext.Slider({fieldLabel:this.localize("duration"),labelAlign:"right",width:160,increment:100,minValue:2E3,maxValue:5E3});Ext.apply(a,{title:this.localize("title"),legendMenu:Ext.create("Ext.menu.Menu",
{items:[{text:"",itemId:"remove",glyph:"xf068@FontAwesome"}]}),tbar:new Ext.Toolbar({items:{xtype:"legend",store:new Ext.data.JsonStore({fields:["name","mark"]}),listeners:{itemclick:function(a,b,e,f){a=b.get("name");this.isTermSelected(a)?this.doTermDeselect(a):this.doTermSelect(a)},itemcontextmenu:function(a,b,e,f,g){g.preventDefault();a=g.getXY();var h=b.get("name");b=(new Ext.Template(this.localize("removeTerm"))).apply([h]);this.legendMenu.queryById("remove").setText(b);this.legendMenu.on("click",
function(a,b){void 0!==b&&this.doTermDeselect(h,!0)},this,{single:!0});this.legendMenu.showAt(a)},scope:this}}}),bbar:new Ext.Toolbar({enableOverflow:!0,items:[this.toggleLeft,this.stop,this.toggleRight,"-",this.resetButton,"-",this.duration,"-",this.fraction,"-",this.segments,this.visibleSegments,"-",this.typeSearch]})});this.config.options.push({xtype:"combo",queryMode:"local",triggerAction:"all",forceSelection:!0,editable:!1,fieldLabel:this.localize("yScale"),labelAlign:"right",name:"yAxisScale",
valueField:"value",displayField:"name",store:new Ext.data.JsonStore({fields:["name","value"],data:[{name:this.localize("linear"),value:"linear"},{name:this.localize("log"),value:"log"}]}),listeners:{render:function(a){a.setValue(this.getApiParam("yAxisScale"))},scope:this}});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.addListener("corpusTermsClicked",function(a,b){1<this.getCorpus().getDocumentsCount()&&b.forEach(function(a){a=a.getTerm();this.setApiParams({query:a});
this.loadStore()})});this.addListener("documentTermsClicked",function(a,b){if(a&&a.xtype==this.xtype)return!1;b.forEach(function(a){a=a.getTerm();this.setApiParams({query:a});this.loadStore()})});this.on("query",function(a,b){Ext.isString(b)&&this.fireEvent("termsClicked",a,[b])});this.on("termsClicked",function(a,b){b.forEach(function(a){var b;Ext.isString(a)?b=a:a.term?b=a.term:a.getTerm&&(b=a.getTerm());this.setApiParams({query:b});this.loadStore()},this)});this.on("loadedCorpus",function(a,b){this.setCorpus(b);
this.documentStore.setCorpus(b);this.corpusStore.setCorpus(b);var e=this.getApiParams();e.type&&delete e.limit;var f;"document"==e.mode||1==this.getCorpus().getDocumentsCount()?f=this.documentStore:(delete e.bins,f=this.corpusStore);f.on("load",function(a,b){for(var c=0;3>c;c++){var d=b[c],d={wordString:d.get("term"),docId:d.get("docId")},d=this.buildParamsBundle(d);this.manageOverlaySticky(d)}},this,{single:!0});f.load({params:e})},this);this.addListener("resize",function(){if(this.chart){var a=
this.body.getHeight(),b=this.body.getWidth();this.chart.attr("height",a).attr("width",b);this.setTitleLength();this.largestH<a&&this.largestW<b&&(this.chart.select("rect[class\x3dclipping-rectangle]").attr("x",0).attr("y",this.navigationHeight+2*this.tPadding).attr("width",b).attr("height",a-this.navigationHeight),this.largestH=a,this.largestW=b);this.redraw();this.redrawSliderOverlay()}},this)},loadStore:function(){var a=this.getApiParams();"document"===this.getApiParam("mode")&&this.documentStore.load({params:a});
"corpus"===this.getApiParam("mode")&&(delete a.bins,this.corpusStore.load({params:a}))},initData:function(a){this.records=a;this.recordsLength=this.records.length;this.numVisPoints=parseInt(this.getApiParam("visibleBins"));this.shiftCount=parseInt(this.getApiParam("position"));"document"===this.getApiParam("mode")?(this.numDataPoints=this.records[0].get("distributions").length,this.numDataPoints!==this.getApiParam("bins")&&(this.numDataPoints=parseInt(this.getApiParam("bins")),this.loadStore())):
this.numDataPoints=this.records[0].get("distributions").length;this.counterSeries=[];a=[];for(var b=this.absMaxFreq=0;b<this.numDataPoints;b++)for(var c=0;c<this.recordsLength;c++)this.records[c].get("distributions")[b]>this.absMaxFreq&&(this.absMaxFreq=this.records[c].get("distributions")[b]);this.absMinFreq=this.absMaxFreq;for(b=0;b<this.numDataPoints;b++)for(c=0;c<this.recordsLength;c++)this.records[c].get("distributions")[b]<=this.absMinFreq&&0!==this.records[c].get("distributions")[b]&&(this.absMinFreq=
this.records[c].get("distributions")[b]);0>this.absMinFreq&&(this.absMinFreq=0);this.minFreq=1.01*this.absMinFreq;for(b=0;b<this.numDataPoints;b++){for(c=0;c<this.recordsLength;c++){var d=this.records[c],e=d.get("distributions")[b];e>this.minFreq&&e<=this.absMaxFreq&&a.push({freq:e,wordString:d.get("term"),counter:b,posInSeries:0,numInSeries:0,docId:d.get("docId")})}this.counterSeries.push(a);a=[]}},prepareData:function(){var a=[],b=[],c=[],d=[];this.allData=[];this.displayData=[];this.numDataPoints<
this.numVisPoints&&(this.numVisPoints=this.numDataPoints);5>=this.numDataPoints?this.visibleSegments.setDisabled(!0):this.visibleSegments.setDisabled(!1);this.numDataPoints<=this.numVisPoints?(this.toggleLeft.setDisabled(!0),this.toggleRight.setDisabled(!0)):(this.toggleLeft.setDisabled(!1),this.toggleRight.setDisabled(!1));this.shiftCount+this.numVisPoints>this.numDataPoints&&(this.shiftCount=this.numDataPoints-this.numVisPoints);for(var e=0;e<this.numDataPoints;e++){for(var f=0,g=0;g<this.counterSeries[e].length;g++){var h=
0;0===f&&(b.push(this.counterSeries[e][g]),c.push({freq:this.counterSeries[e][g].freq,frequencyArray:b,numInSeries:0}),a.push(c),b=[],c=[],h=f=1);for(var k=0;k<a[e].length&&0===h;k++)this.counterSeries[e][g].freq===a[e][k].freq&&(h=0,h=a[e][k].numInSeries,this.counterSeries[e][g].posInSeries=++h,a[e][k].numInSeries=h,a[e][k].frequencyArray.push(this.counterSeries[e][g]),h=1);0===h&&(d.push(this.counterSeries[e][g]),a[e].push({freq:this.counterSeries[e][g].freq,frequencyArray:d,numInSeries:0}),d=[])}(1>
this.counterSeries[e].length||0===f)&&a.push([])}for(e=0;e<this.numDataPoints;e++)for(g=0;g<a[e].length;g++)for(++a[e][g].numInSeries,k=0;k<a[e][g].frequencyArray.length;k++)a[e][g].frequencyArray[k].numInSeries=a[e][g].numInSeries;for(e=0;e<this.numDataPoints;e++)this.allData.push({allDataInternal:a[e],outerCounter:e});a=[];b=[];for(e=0;e<this.numVisPoints+this.shiftCount;e++){for(g=0;g<this.recordsLength;g++)this.allData[e].allDataInternal[g]&&b.push({freq:this.allData[e].allDataInternal[g].freq,
inSeries:this.allData[e].allDataInternal[g].numInSeries,frequencyArray:this.allData[e].allDataInternal[g].frequencyArray,dotObject:[{counter:e,freq:this.allData[e].allDataInternal[g].freq}]});a.push(b);b=[]}for(e=0;e<this.numVisPoints+this.shiftCount;e++)this.displayData.push({displayInternal:a[e],outerCounter:e})},manageMvtButtons:function(){!0===this.isTransitioning&&(this.toggleRight.setDisabled(!0),this.toggleLeft.setDisabled(!0),this.stop.setDisabled(!1));!1===this.isTransitioning&&(this.toggleRight.setDisabled(!1),
this.toggleLeft.setDisabled(!1),this.stop.setDisabled(!0),0===this.shiftCount?this.toggleLeft.setDisabled(!0):this.toggleLeft.setDisabled(!1),this.shiftCount+this.numVisPoints===this.numDataPoints?this.toggleRight.setDisabled(!0):this.toggleRight.setDisabled(!1))},nextR:function(){for(var a=[],b=0;b<this.recordsLength;b++)this.allData[this.numVisPoints+this.shiftCount].allDataInternal[b]&&a.push({freq:this.allData[this.numVisPoints+this.shiftCount].allDataInternal[b].freq,inSeries:this.allData[this.numVisPoints+
this.shiftCount].allDataInternal[b].numInSeries,frequencyArray:this.allData[this.numVisPoints+this.shiftCount].allDataInternal[b].frequencyArray,dotObject:[{counter:this.numVisPoints+this.shiftCount,freq:this.allData[this.numVisPoints+this.shiftCount].allDataInternal[b].freq}]});this.displayData.push({displayInternal:a,outerCounter:this.numVisPoints+this.shiftCount})},toggleRightCheck:function(){this.numVisPoints+this.shiftCount<this.numDataPoints?(this.continueTransition=this.isTransitioning=!0,
this.manageMvtButtons(),this.nextR(),this.shiftCount=++this.shiftCount,this.manageXScale(),this.setApiParams({position:this.shiftCount}),this.transitionCall="right",this.animateVis(),this.displayData.shift()):(this.continueTransition=this.isTransitioning=!1,this.manageMvtButtons())},nextL:function(){for(var a=[],b=0;b<this.recordsLength;b++)this.allData[this.shiftCount].allDataInternal[b]&&a.push({freq:this.allData[this.shiftCount].allDataInternal[b].freq,inSeries:this.allData[this.shiftCount].allDataInternal[b].numInSeries,
frequencyArray:this.allData[this.shiftCount].allDataInternal[b].frequencyArray,dotObject:[{counter:this.shiftCount,freq:this.allData[this.shiftCount].allDataInternal[b].freq}]});this.displayData.unshift({displayInternal:a,outerCounter:this.shiftCount})},toggleLeftCheck:function(){0<this.shiftCount?(this.continueTransition=this.isTransitioning=!0,this.manageMvtButtons(),this.shiftCount=--this.shiftCount,this.manageXScale(),this.setApiParams({position:this.shiftCount}),this.nextL(),this.transitionCall=
"left",this.animateVis(),this.displayData.pop()):(this.isTransitioning=!1,this.manageMvtButtons())},startScroll:function(){var a=this;a.numDataPoints>a.numVisPoints&&0===a.shiftCount&&(a.isTransitioning=!0,this.manageMvtButtons(),setTimeout(function(){a.toggleRightCheck()},3E3))},initializeChart:function(){this.initChart();this.drawXAxis();this.drawYAxis();this.drawChart();this.drawSlider();this.drawVerticalSlider();this.transitionCall="draw"},redraw:function(){this.transitionCall="redraw";this.updateFullPath();
this.redrawXAxis();this.redrawYAxis();this.redrawChart();this.redrawSlider();this.redrawVerticalSlider();this.redrawChartOverlay()},initChart:function(){var a=this.body.query("div[class$\x3dinnerCt]",!1)[0],b=a.getHeight(),c=a.getWidth(),a=a.appendChild(Ext.DomHelper.createDom('\x3csvg class\x3d"chart" width\x3d"'+c+'" height\x3d"'+b+'"\x3e\x3c/svg\x3e'),!0);this.chart=d3.select(a);this.largestW=c;this.largestH=b-this.navigationHeight;this.chart.append("clipPath").attr("id","clip1").append("rect").attr("class",
"clipping-rectangle").attr("x",0).attr("y",this.navigationHeight+2*this.tPadding).attr("width",c).attr("height",b-this.navigationHeight);this.chart.append("g").attr("class","overlay").attr("clip-path","url(#clip1)");"corpus"===this.getApiParam("mode")&&this.segments.setDisabled(!0);this.setTitleLength()},xAxis:{},xAxisScale:d3.svg.axis(),drawXAxis:function(){var a=this,b=this.body.getHeight();this.body.getWidth();this.manageAllXScales();this.xAxisScale.scale(a.xScale).orient("bottom").ticks(Math.round(a.numVisPoints)).tickFormat(function(b){var d;
"document"===a.getApiParam("mode")&&(d="Segment "+(parseInt(b)+1));"corpus"===a.getApiParam("mode")&&(d=b+1+". "+a.titlesArray[b]);return d});this.xAxis=this.chart.append("g").attr("class","axisX").attr("transform","translate(0,"+(b-this.bPadding)+")").call(this.xAxisScale);this.styleXAxis()},styleXAxis:function(){this.xAxis.selectAll("text").style("font-family","sans-serif").style("font-size","11px");this.xAxis.selectAll("line").style("fill","none").style("stroke","black").style("shape-rendering",
"crispEdges");this.xAxis.selectAll("path").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges")},redrawXAxis:function(){this.chart.selectAll("g[class\x3daxisX]").remove();this.drawXAxis()},yAxis:{},yAxisScale:d3.svg.axis(),drawYAxis:function(){this.body.getHeight();var a=this.body.getWidth();this.manageAllYScales();var b=d3.scale.linear().domain([200,700]).range([5,15]),c=d3.format(".2r");this.yAxisScale.scale(this.yScale).orient("left").ticks(b(this.body.getHeight())).tickFormat(function(a){var b=
Math.log(a)/Math.log(10)+1E-6;return.7>Math.abs(b-Math.floor(b))?c(a):""}).tickSize(-a+this.rPadding+this.lPadding);this.yAxis=this.chart.append("g").attr("class","axisY").attr("transform","translate("+this.lPadding+",0)").call(this.yAxisScale);this.yAxis.selectAll("text").style("font-family","sans-serif").style("font-size","11px");this.yAxis.selectAll("line").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges").style("stroke-opacity",.05);this.yAxis.selectAll("path").style("fill",
"none").style("stroke","black").style("shape-rendering","crispEdges")},redrawYAxis:function(){this.chart.selectAll("g[class\x3daxisY]").remove();this.drawYAxis()},drawChart:function(){var a=this;this.chart.selectAll("g[class\x3dsection]").data(a.displayData,function(a){return a.outerCounter}).enter().append("g").attr("class","section").attr("clip-path","url(#clip1)").selectAll("g").data(function(a){return a.displayInternal}).enter().append("g").attr("class","frequencies").on("mouseover",function(){d3.select(this).style("fill",
"red")}).on("mouseout",function(){d3.select(this).style("fill","black")}).selectAll("text").data(function(a){return a.frequencyArray}).enter().append("text").attr("class",function(b){return a.removeFilteredCharacters(b.wordString)}).attr("x",function(b){var c=.5/b.numInSeries-.5,d=b.posInSeries/b.numInSeries*.8;b=b.counter+a.callOffset()+c+d;return a.xScale(b)}).attr("y",function(b){return a.yScale(b.freq)}).attr("text-anchor","middle").attr("transform",function(b){var c=.5/b.numInSeries-.5,d=b.posInSeries/
b.numInSeries*.8,c=b.counter+a.callOffset()+c+d;b=b.freq;return"translate(0, 0) rotate(-20 "+a.xScale(c)+" "+a.yScale(b)+")"}).style("font-size",function(b){return a.fontScale(b.freq)+"px"}).style("fill-opacity",function(b){return a.opacityScale(b.freq)}).text(function(a){return a.wordString}).on("mouseover",function(b){d3.select(this).style("cursor","pointer").style("font-size",function(b){return a.fontScale(b.freq)*a.maxFont/a.fontScale(b.freq)+"px"});b=a.buildParamsBundle(b);a.manageOverlaySlippery(b)}).on("mouseout",
function(b){d3.select(this).style("cursor","auto").style("font-size",function(b){return a.fontScale(b.freq)+"px"});b=a.buildParamsBundle(b);a.manageOverlaySlippery(b)}).on("click",function(b){b=a.buildParamsBundle(b);a.manageOverlaySticky(b)}).append("title").text(function(a){return a.wordString})},redrawChart:function(){this.chart.selectAll("g[class\x3dsection]").remove();this.drawChart()},drawVerticalSlider:function(){},redrawVerticalSlider:function(){this.chart.selectAll("rect[class\x3dminimap]").remove();
this.drawVerticalSlider()},drawSlider:function(){this.body.getHeight();var a=this.body.getWidth()-(this.rPadding+this.lPadding),b=this.lPadding,c=this.lPadding+(this.numVisPoints-1)/(this.numDataPoints-1)*a;this.chart.append("line").attr("class","sliderAxis").attr("x1",this.lPadding).attr("x2",this.body.getWidth()-this.rPadding).attr("y1",this.tPadding+this.navigationHeight).attr("y2",this.tPadding+this.navigationHeight).style("shape-rendering","crispEdges").style("stroke","black").style("stroke-width",
"1");this.chart.append("line").attr("class","sliderAxis").attr("x1",this.lPadding).attr("x2",this.lPadding).attr("y1",this.tPadding+this.navigationHeight).attr("y2",this.tPadding).style("shape-rendering","crispEdges").style("stroke","black").style("stroke-width","1");this.chart.append("line").attr("class","slider").attr("id","before").attr("x1",a*(this.shiftCount-this.callOffset())/(this.numDataPoints-1)+b).attr("x2",a*(this.shiftCount-this.callOffset())/(this.numDataPoints-1)+b).attr("y1",this.tPadding+
this.navigationHeight).attr("y2",this.tPadding).style("stroke","black").style("stroke-width","1");this.chart.append("line").attr("class","slider").attr("id","after").attr("x1",a*(this.shiftCount-this.callOffset())/(this.numDataPoints-1)+c).attr("x2",a*(this.shiftCount-this.callOffset())/(this.numDataPoints-1)+c).attr("y1",this.tPadding+this.navigationHeight).attr("y2",this.tPadding).style("stroke","black").style("stroke-width","1");var b=this.chart.append("rect").attr("class","slider").attr("id",
"boxBefore").attr("x",this.lPadding).attr("y",this.tPadding).attr("height",this.navigationHeight).attr("width",a*(this.shiftCount-this.callOffset())/(this.numDataPoints-1)).style("fill","silver").style("fill-opacity",.25).style("cursor","move"),a=this.chart.append("rect").attr("class","slider").attr("id","boxAfter").attr("x",a*(this.shiftCount-this.callOffset())/(this.numDataPoints-1)+c).attr("y",this.tPadding).attr("height",this.navigationHeight).attr("width",a*(this.numDataPoints-this.numVisPoints-
this.shiftCount+this.callOffset())/(this.numDataPoints-1)).style("fill","silver").style("fill-opacity",.25).style("cursor","move"),d=this,c=d3.behavior.drag().origin(Object).on("drag",function(a){if(!d.isTransitioning){this.drag=!0;a=d.getWidth();var b=parseInt(d3.event.dx),c,h;d.sliderDragSum+=d3.event.dx;d.chart.selectAll("#before").attr("x1",function(){c=parseInt(this.getAttribute("x1"));parseInt(this.getAttribute("x1"));return parseInt(this.getAttribute("x1"))});d.chart.selectAll("#after").attr("x1",
function(){h=parseInt(this.getAttribute("x1"));return parseInt(this.getAttribute("x1"))});if(c+b<d.lPadding||h+b>a-d.rPadding)b=0;d.chart.select("#boxBefore").attr("width",function(){return parseInt(this.getAttribute("width"))+b});d.chart.select("#boxAfter").attr("x",function(){return parseInt(this.getAttribute("x"))+b}).attr("width",function(){return parseInt(this.getAttribute("width"))-b});d.chart.selectAll("#before").attr("x1",function(){return parseInt(this.getAttribute("x1"))+b}).attr("x2",function(){return parseInt(this.getAttribute("x2"))+
b});d.chart.selectAll("#after").attr("x1",function(){return parseInt(this.getAttribute("x1"))+b}).attr("x2",function(){return parseInt(this.getAttribute("x2"))+b})}}).on("dragend",function(a){if(this.drag){this.drag=!1;a=d3.scale.linear().domain([0,d.body.getWidth()-(d.lPadding+d.rPadding)]).range([0,d.numDataPoints])(d.sliderDragSum);var b,c=d.shiftCount;0<a&&(b=Math.floor(a));0>a&&(b=Math.ceil(a));d.shiftCount+=b;0>d.shiftCount&&(d.shiftCount=0);d.shiftCount>d.numDataPoints-1&&(d.shiftCount=d.numDataPoints-
1);d.shiftCount!==c&&(d.sliderDragSum=0,d.setApiParams({position:d.shiftCount}),d.prepareData(),d.redraw())}});b.call(c);a.call(c)},redrawSlider:function(){this.chart.selectAll("rect[class\x3dslider]").remove();this.chart.selectAll("line[class\x3dslider]").remove();this.chart.selectAll("line[class\x3dsliderAxis]").remove();this.drawSlider()},animateVis:function(){var a=this;this.getApiParam("mode");this.body.getHeight();var b=this.body.getWidth();if("left"===this.transitionCall||"right"===this.transitionCall){this.xAxis.transition().duration(a.duration.getValue()).ease("linear").call(this.xAxisScale);
this.styleXAxis();this.drawChart();this.chart.selectAll(".frequencies").transition().duration(a.duration.getValue()).ease("linear").selectAll("text").attr("x",function(b){return a.xScale(b.counter+(.5/b.numInSeries-.5)+b.posInSeries/b.numInSeries*.8)}).attr("transform",function(b){var c=b.freq;return"translate(0, 0) rotate(-20 "+a.xScale(b.counter+(.5/b.numInSeries-.5)+b.posInSeries/b.numInSeries*.8)+" "+a.yScale(c)+")"});var b=b-(this.rPadding+this.lPadding),c=this.lPadding,d=this.lPadding+(this.numVisPoints-
1)/(this.numDataPoints-1)*b;this.chart.select("#before").transition().duration(a.duration.getValue()).ease("linear").attr("x1",b*this.shiftCount/(this.numDataPoints-1)+c).attr("x2",b*this.shiftCount/(this.numDataPoints-1)+c).attr("y1",this.tPadding+this.navigationHeight).attr("y2",this.tPadding).each("end",function(){a.continueTransition?setTimeout(function(){a.callTransition()},50):(a.isTransitioning=!1,a.manageMvtButtons())});this.chart.select("#after").transition().duration(a.duration.getValue()).ease("linear").attr("x1",
b*this.shiftCount/(this.numDataPoints-1)+d).attr("x2",b*this.shiftCount/(this.numDataPoints-1)+d).attr("y1",this.tPadding+this.navigationHeight).attr("y2",this.tPadding);this.chart.select("#boxBefore").transition().duration(a.duration.getValue()).ease("linear").attr("x",this.lPadding).attr("y",this.tPadding).attr("height",this.navigationHeight).attr("width",b*this.shiftCount/(this.numDataPoints-1));this.chart.select("#boxAfter").transition().duration(a.duration.getValue()).ease("linear").attr("x",
b*this.shiftCount/(this.numDataPoints-1)+d).attr("y",this.tPadding).attr("height",this.navigationHeight).attr("width",b*(this.numDataPoints-this.numVisPoints-this.shiftCount)/(this.numDataPoints-1))}this.redrawChartOverlay()},callTransition:function(){"left"===this.transitionCall&&this.toggleLeftCheck();"right"===this.transitionCall&&this.toggleRightCheck()},buildParamsBundle:function(a){var b=a.wordString,c={},d={};"document"===this.getApiParam("mode")&&(a=a.docId,d=this.getCorpus().getDocument(a).get("totalTokens")-
1,c.tokenIdStart=parseInt(this.category*d/this.numDataPoints),c.docIdType=a+":"+b);return d={params:c,type:b}},manageOverlaySlippery:function(a){var b=a.type,c=this.removeFilteredCharacters(a.type),d="on";this.continueTransition=!1;this.transitionCall="draw";for(var e=this.overlayQueue.length;0<=--e;)c===this.overlayQueue[e].selector&&(d="off");c===this.lastSticky&&(d="off",this.lastSticky=null);"on"===d&&(c!==this.lastSlippery?(d=this.prepareFullPath(b),a={word:b,selector:c,params:a,fullPath:d.path,
pathMin:d.min,pathMax:d.max,colour:"red"},null!==this.lastSlippery&&(this.chartOverlayOff(this.lastSlippery),this.sliderOverlayOff(this.lastSlippery),this.lastSlippery=null),this.chartOverlayOn(a),this.sliderOverlayOn(a),this.lastSlippery=c):(this.chartOverlayOff(c),this.sliderOverlayOff(this.lastSlippery),this.lastSlippery=null))},manageOverlaySticky:function(a){a=a.type;this.transitionCall="draw";this.isTermSelected(a)?this.doTermDeselect(a,!0):this.doTermSelect(a,!0)},getTermIndex:function(a){var b=
-1;a=a=this.removeFilteredCharacters(a);for(var c=this.overlayQueue.length;0<=--c;)a===this.overlayQueue[c].selector&&(b=c);return b},isTermSelected:function(a){return-1!==this.getTermIndex(a)},doTermSelect:function(a,b){var c=c=this.removeFilteredCharacters(a),d=this.getApiParam("selectedWords");d.push(a);this.setApiParams({selectedWords:d});d=this.colorIndex[0];this.colorIndex.shift();if(!0===b){var e=this.query("[xtype\x3dlegend]")[0];e.getStore().add({name:a,mark:d})}else{var e=this.query("[xtype\x3dlegend]")[0],
f=e.getStore().findRecord("name",a);null!==f&&(f.set("mark",d),e.refresh())}if(0===this.colorIndex.length)for(e=0;e<this.colorMasterList.length;e++)this.colorIndex.push(this.colorMasterList[e]);e=this.prepareFullPath(a);d={word:a,selector:c,params:{params:{},type:a},fullPath:e.path,pathMin:e.min,pathMax:e.max,colour:d};c===this.lastSlippery&&(this.sliderOverlayOff(c),this.lastSlippery=null);this.chart.select("g[class\x3dfrequency-line-"+c+"]").remove();this.overlayQueue.push(d);this.chartOverlayOn(d);
this.sliderOverlayOn(d)},doTermDeselect:function(a,b){var c=this.removeFilteredCharacters(a),d=this.getTermIndex(a);if(!0===b){var e=this.query("[xtype\x3dlegend]")[0],d=e.getStore().findExact("name",a);e.getStore().removeAt(d)}for(var e=this.getApiParam("selectedWords"),f=0,g=e.length;f<g;f++)e[f]===c&&(e.splice(f,1),this.setApiParams({selectedWords:e}));this.chartOverlayOff(c);this.colorIndex.push(this.overlayQueue[d].colour);this.overlayQueue.splice(d,1);this.sliderOverlayOff(c);this.lastSticky=
c},prepareFullPath:function(a){for(var b=[],c=this.absMaxFreq,d=this.absMinFreq,e=0,f=this.allData.length;e<f;e++){for(var g=foundB=0,h=this.allData[e].allDataInternal.length;g<h;g++)for(var k=0,l=this.allData[e].allDataInternal[g].frequencyArray.length;k<l;k++)if(this.allData[e].allDataInternal[g].frequencyArray[k].wordString===a){var m=this.allData[e].allDataInternal[g].frequencyArray[k].freq;b.push({x:e,y:m});m<c&&(c=m);m>d&&(d=m);foundB=1}0===foundB&&(g=this.minFreq,b.push({x:e,y:g}),g<c&&(c=
g),g>d&&(d=g))}return{path:b,min:c,max:d}},updateFullPath:function(){for(var a=this.overlayQueue.length;0<a--;){var b=this.prepareFullPath(this.overlayQueue[a].word);this.overlayQueue[a].fullPath=b.path;this.overlayQueue[a].pathMin=b.min;this.overlayQueue[a].pathMax=b.max}},buildSliderPath:function(a){var b=this;return d3.svg.line().x(function(a){return b.xSliderScale(a.x)}).y(function(a){return b.ySliderScale(a.y)}).interpolate("monotone")(a)},sliderOverlayOn:function(a){this.transitionSliderOverlay(a);
this.chart.append("g").attr("id","slider-line-"+a.word).append("path").attr("d",this.buildSliderPath(a.fullPath)).style("stroke",a.colour).style("stroke-width",2).style("fill","none");this.redrawSlider()},sliderOverlayOff:function(a){this.chart.selectAll("g[id\x3dslider-line-"+a+"]").remove();this.transitionSliderOverlay()},redrawSliderOverlay:function(){for(var a=0;a<this.overlayQueue.length;a++)this.sliderOverlayOff(this.overlayQueue[a].selector),this.sliderOverlayOn(this.overlayQueue[a])},transitionSliderOverlay:function(a){this.updateYSliderScale(a||
0);for(a=this.overlayQueue.length;0<a--;)this.chart.selectAll("g#slider-line-"+this.overlayQueue[a].selector).select("path").transition().duration(300).ease("linear").attr("d",this.buildSliderPath(this.overlayQueue[a].fullPath))},preparePath:function(a){for(var b=[],c,d,e=0;3>e&&0<this.shiftCount-e;e++){for(var f=c=0;f<this.allData[this.shiftCount-(1+e)].allDataInternal.length;f++)for(var g=0;g<this.allData[this.shiftCount-(1+e)].allDataInternal[f].frequencyArray.length;g++)this.allData[this.shiftCount-
(1+e)].allDataInternal[f].frequencyArray[g].wordString===a&&(c=this.yScale(this.allData[this.shiftCount-(1+e)].allDataInternal[f].frequencyArray[g].freq),b.unshift({x:this.shiftCount-(1+e),y:c}),c=1);0===c&&(f=this.yScale(this.minFreq),b.unshift({x:this.shiftCount-(1+e),y:f}))}e=this.shiftCount;for(c=this.numVisPoints+this.shiftCount;e<c;e++){for(var f=d=0,h=this.allData[e].allDataInternal.length;f<h;f++)for(var g=0,k=this.allData[e].allDataInternal[f].frequencyArray.length;g<k;g++)this.allData[e].allDataInternal[f].frequencyArray[g].wordString===
a&&(d=this.yScale(this.allData[e].allDataInternal[f].frequencyArray[g].freq),b.push({x:e,y:d}),d=1);0===d&&(f=this.yScale(this.minFreq),b.push({x:e,y:f}))}for(e=0;3>e&&this.numVisPoints+this.shiftCount+e<this.numDataPoints;e++){for(f=c=0;f<this.allData[this.numVisPoints+this.shiftCount+e].allDataInternal.length;f++)for(g=0;g<this.allData[this.numVisPoints+this.shiftCount+e].allDataInternal[f].frequencyArray.length;g++)this.allData[this.numVisPoints+this.shiftCount+e].allDataInternal[f].frequencyArray[g].wordString===
a&&(d=this.yScale(this.allData[this.numVisPoints+this.shiftCount+e].allDataInternal[f].frequencyArray[g].freq),b.push({x:this.numVisPoints+this.shiftCount+e,y:d}),c=1);0===c&&(f=this.yScale(this.minFreq),b.push({x:this.numVisPoints+this.shiftCount+e,y:f}))}return b},chartOverlayOn:function(a){var b=this;this.chart.selectAll("g[class\x3dsection]").selectAll("g[class\x3dfrequencies]").selectAll("text[class\x3d"+a.selector+"]").style("fill",a.colour).style("fill-opacity",1);var c=this.preparePath(a.word),
d,e=d3.svg.line().x(function(a){d=a.x;return b.xScale(a.x+b.callOffset())}).y(function(a){return a.y}).interpolate("monotone");a=this.chart.select(".overlay").append("g").attr("class","frequency-line-"+a.selector).append("path").attr("d",e(c)).style("stroke",a.colour).style("stroke-width",2).style("fill","none");c=this.xScale(d)-this.xScale(d+this.callOffset());"left"!==this.transitionCall&&"right"!==this.transitionCall||a.transition().duration(b.duration.getValue()).ease("linear").attr("transform",
"translate("+c+")")},chartOverlayOff:function(a){var b=this;this.chart.selectAll("text."+a).style("fill","black").style("fill-opacity",function(a){return b.opacityScale(a.freq)});this.chart.select("g.frequency-line-"+a).remove()},redrawChartOverlay:function(){for(var a=0;a<this.overlayQueue.length;a++)this.chartOverlayOff(this.overlayQueue[a].selector),this.chartOverlayOn(this.overlayQueue[a])},manageAllYScales:function(){this.manageFontScale();this.manageOpacityScale();this.manageYScale();this.manageYSliderScale()},
fontScale:d3.scale.linear(),manageFontScale:function(){this.fontScale.domain([this.minFreq,this.absMaxFreq*this.valFraction]).range([10,this.maxFont])},opacityScale:d3.scale.linear(),manageOpacityScale:function(){this.opacityScale.domain([0,this.absMaxFreq*this.valFraction]).range([.4,.8])},yScale:null,manageYScale:function(){"linear"==this.getApiParam("yAxisScale")&&(this.yScale=d3.scale.linear());"log"==this.getApiParam("yAxisScale")&&(this.yScale=d3.scale.log());this.yScale.domain([this.minFreq,
this.absMaxFreq*this.valFraction*1.25]).rangeRound([this.body.getHeight()-this.bPadding,2*this.tPadding+this.navigationHeight])},ySliderScale:null,manageYSliderScale:function(){var a=this.tPadding,b=this.tPadding+this.navigationHeight;"linear"==this.getApiParam("yAxisScale")&&(this.ySliderScale=d3.scale.linear());"log"==this.getApiParam("yAxisScale")&&(this.ySliderScale=d3.scale.log());this.ySliderScale.domain([this.minFreq,this.absMaxFreq]).rangeRound([b,a])},updateYSliderScale:function(a){a=a||
0;for(var b=this.minFreq,c=0,d=this.overlayQueue.length;0<d--;)this.overlayQueue[d].pathMin<b&&(b=this.overlayQueue[d].pathMin),this.overlayQueue[d].pathMax>c&&(c=this.overlayQueue[d].pathMax);0!=a&&a.pathMin<b&&(b=a.pathMin);0!=a&&a.pathMax>c&&(c=a.pathMax);this.ySliderScale.domain([b,c])},manageAllXScales:function(){this.manageXScale();this.manageXSliderScale()},xScale:d3.scale.linear(),manageXScale:function(){this.xScale.domain([this.shiftCount-.5,this.numVisPoints+this.shiftCount-.5]).range([this.lPadding,
this.body.getWidth()-this.rPadding])},xSliderScale:d3.scale.linear(),manageXSliderScale:function(){this.xSliderScale.domain([0,this.numDataPoints-1]).range([this.lPadding,this.body.getWidth()-this.rPadding])},setSegments:function(){if("corpus"===this.getApiParam("mode")){var a=this.getCorpus().getDocumentsCount();this.visibleSegments.menu.items.each(function(b,c,d){b.text>a&&b.setDisabled(!0)})}},setVisibleSegments:function(){if("corpus"===this.getApiParam("mode")){var a=this.getCorpus().getDocumentsCount();
this.visibleSegments.menu.items.each(function(b,d,e){b.text>a&&b.setDisabled(!0)})}if("document"===this.getApiParam("mode")){var b=this;this.visibleSegments.menu.items.each(function(a,d,e){parseInt(a.text)>b.numDataPoints?a.setDisabled(!0):a.setDisabled(!1)})}},setTitleLength:function(){var a;this.titlesArray=[];for(var b=d3.scale.linear().domain([350,1250]).range([10,40]),c=this.getCorpus(),d=0,e=c.getDocumentsCount();d<e;d++)a=c.getDocument(d),a=a.getShortTitle(),a.length<=b(this.body.getWidth())?
this.titlesArray.push(a):(a=a.substring(0,b(this.body.getWidth())-3),this.titlesArray.push(a+"..."))},callOffset:function(){var a;if("draw"===this.transitionCall||"redraw"===this.transitionCall)a=0;"left"===this.transitionCall&&(a=-1);"right"===this.transitionCall&&(a=1);return a},removeFilteredCharacters:function(a){return a||""}});Ext.define("Voyant.panel.Trends",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],requires:["Ext.chart.CartesianChart","Voyant.data.store.Documents"],alias:"widget.trends",config:{corpus:void 0},statics:{i18n:{title:{en:"Trends"},helpTip:{en:"\x3cp\x3e\x3ci\x3eTrends\x3c/i\x3e shows a line graph of the relative frequencies across the corpus (for multiple documents) or within a document. Features include\x3c/p\x3e\x3cul\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
freqsModeTip:{en:"Determines if frequencies are expressed as raw counts or as relative counts (per document or segment)."},rawFrequencies:{en:"Raw Frequencies"},relativeFrequencies:{en:"Relative Frequencies"},raw:{en:"Raw"},relative:{en:"Relative"},segments:{en:"Document Segments"},documents:{en:"Documents"}},api:{limit:5,stopList:"auto",query:void 0,withDistributions:"relative",bins:10,docIndex:void 0,docId:void 0,mode:void 0},glyph:"xf201@FontAwesome"},MODE_CORPUS:"corpus",MODE_DOCUMENT:"document",
layout:"fit",constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);if(a.embedded){var b=Ext.getClass(a.embedded).getName();"Voyant.data.store.CorpusTerms"==b&&this.loadFromCorpusTerms(a.embedded);"Voyant.data.model.Corpus"==b&&this.loadFromCorpusTerms(a.embedded.getCorpusTerms())}this.on("loadedCorpus",function(a,b){this.setCorpus(b);1==b.getDocumentsCount()&&this.getApiParam("mode")!=this.MODE_DOCUMENT&&(this.setApiParams({mode:this.MODE_DOCUMENT,
withDistributions:"raw"}),this.down("#raw").setChecked(!0));this.isVisible()&&this.loadFromCorpus(b)});this.on("documentsClicked",function(a,b){this.getCorpus()&&1==b.length&&this.loadFromDocument(b[0])});this.on("query",function(a,b){Ext.isString(b)&&this.fireEvent("termsClicked",a,[b])},this);this.on("termsClicked",function(a,b){if(this.getCorpus()){var e=[];b.forEach(function(a){Ext.isString(a)?e.push(a):a.term?e.push(a.term):a.getTerm&&e.push(a.getTerm())});e&&(this.getApiParam("mode")!=this.MODE_CORPUS&&
1<this.getCorpus().getDocumentsCount()&&this.setApiParams({mode:this.MODE_CORPUS,docIndex:void 0,docId:void 0}),this.setApiParams({query:e}),this.isVisible()&&this.loadFromCorpus(this.getCorpus()))}});this.on("documentTermsClicked",function(a,b){this.getCorpus()&&(this.setApiParam("mode","document"),b[0]&&void 0!==b[0].get("distributions")?this.loadFromRecords(b):this.fireEvent("termsClicked",a,b))});this.on("corpusTermsClicked",function(a,b){this.getCorpus()&&(b[0]&&void 0!==b[0].get("distributions")&&
1<this.getCorpus().getDocumentsCount()?this.loadFromRecords(b):this.fireEvent("termsClicked",a,b))});this.on("activate",function(){this.getCorpus()&&this.loadFromCorpus(this.getCorpus())},this);this.on("ensureCorpusView",function(a,b){this.getApiParam("mode")!=this.MODE_CORPUS&&1<b.getDocumentsCount()&&(this.setApiParam("docId",void 0),this.loadFromCorpus(b))},this)},initComponent:function(){Ext.apply(this,{title:this.localize("title"),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},
{xtype:"button",text:this.localize("relative"),tooltip:this.localize("freqsModeTip"),menu:{items:[{text:this.localize("relativeFrequencies"),checked:!0,itemId:"relative",group:"freqsMode",checkHandler:function(a,b){b&&(a.up("button").setText(this.localize("relative")),this.setApiParam("withDistributions","relative"),this.reloadFromChart())},scope:this},{text:this.localize("rawFrequencies"),checked:!1,itemId:"raw",group:"freqsMode",checkHandler:function(a,b){b&&(a.up("button").setText(this.localize("raw")),
this.setApiParam("withDistributions","raw"),this.reloadFromChart())},scope:this}]}}]}]});this.callParent(arguments)},loadFromDocument:function(a){if(a.then){var b=this;a.then(function(a){b.loadFromDocument(a)})}else"Voyant.data.model.Document"==Ext.getClassName(a)&&(this.setApiParams({docIndex:void 0,query:void 0,docId:a.getId(),mode:this.MODE_DOCUMENT}),this.isVisible()&&this.loadFromDocumentTerms())},loadFromDocumentTerms:function(a){this.getCorpus()&&(a=a||this.getCorpus().getDocumentTerms({autoLoad:!1}),
a.load({callback:function(a,c,d){d?(this.setApiParam("mode","document"),this.loadFromRecords(a)):Voyant.application.showResponseError(this.localize("failedGetDocumentTerms"),c)},scope:this,params:this.getApiParams("limit stopList query docId withDistributions bins".split(" "))}))},loadFromCorpus:function(a){this.setCorpus(a);this.getApiParam("docId")?this.loadFromDocumentTerms():1==a.getDocumentsCount()?this.loadFromDocument(a.getDocument(0)):this.loadFromCorpusTerms(a.getCorpusTerms())},loadFromCorpusTerms:function(a){a.load({callback:function(a,
c,d){d?(this.setApiParam("mode",this.MODE_CORPUS),this.loadFromRecords(a)):Voyant.application.showResponseError(this.localize("failedGetCorpusTerms"),c)},scope:this,params:this.getApiParams(["limit","stopList","query","withDistributions"])})},loadFromRecords:function(a){var b=this.getApiParam("mode"),c=[],d=["index"],e=[],f=0;a.forEach(function(a,g){var l=a.get("term");a.get("distributions").forEach(function(a,b){c[b]||(c[b]={index:b});c[b]["_"+g]=a;a>f&&(f=a)},this);d.push("_"+g);e.push({type:"line",
title:l,xField:"index",yField:"_"+g,style:{lineWidth:2},marker:{radius:3},highlight:!0,smooth:!0,tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c){var d="\x3ci\x3e"+c.series.getTitle()+"\x3c/i\x3e: "+a.get(c.series.getYField());if(b==this.panel.MODE_CORPUS){var e=this.panel.getCorpus();e&&e.getDocumentsCount()==a.store.getCount()&&(d+="\x3cbr/\x3e\x3ci\x3e"+this.panel.getCorpus().getDocument(c.index).getShortTitle()+"\x3c/i\x3e")}this.setHtml(d)},panel:this},listeners:{itemclick:{fn:this.handleClickedItem,
scope:this}}})},this);a=Ext.create("Ext.data.JsonStore",{fields:d,data:c});d.shift();var g=this;this.buildChart({store:a,series:e,axes:[{type:"numeric",position:"left",majorTickSteps:"raw"==this.getApiParam("withDistributions")&&20>f?f:void 0,increment:1,title:{text:this.localize("raw"==this.getApiParam("withDistributions")?"rawFrequencies":"relativeFrequencies")}},{type:"category",position:"bottom",fields:["index"],title:{text:this.localize(b==this.MODE_DOCUMENT?"segments":"documents")},label:{rotate:{degrees:-30},
textAlign:"end"},renderer:function(a,c){return b==g.MODE_DOCUMENT?parseInt(a)+1:g.getCorpus().getDocument(a).getTinyTitle()}}]})},reloadFromChart:function(){var a=this.down("chart");if(a){var b=[];a.series.forEach(function(a){b.push(a.getTitle())});this.fireEvent("termsClicked",this,b)}},buildChart:function(a){a.axes.forEach(function(a){Ext.applyIf(a,{style:{opacity:.2},label:{opacity:.5}});Ext.applyIf(a.title,{fontSize:12})});Ext.applyIf(a,{plugins:{ptype:"chartitemevents",moveEvents:!0},legend:{docked:"top"},
interactions:["itemhighlight","panzoom"],innerPadding:{top:5,right:5,bottom:5,left:5},border:!1,bodyBorder:!1});this.query("chart").forEach(function(a){this.remove(a)},this);a=Ext.create("Ext.chart.CartesianChart",a);this.add(a)},clearChart:function(){this.query("chart").forEach(function(a){this.remove(a)},this)},handleClickedItem:function(a,b){var c=this.getApiParam("mode");if(c===this.MODE_DOCUMENT){if(c=this.getApiParam("docId")){var d=this.getCorpus().getDocument(c),d=d.get("tokensCount-lexical"),
e=this.getApiParam("bins"),d=b.index/e*d;this.dispatchEvent("documentIndexTermsClicked",this,[{term:b.series.getTitle(),docId:c,position:d}])}}else c==this.MODE_CORPUS&&(d=this.getCorpus().getDocument(b.index),this.dispatchEvent("documentIndexTermsClicked",this,[{term:b.series.getTitle(),docIndex:b.index,docId:d.getId()}]))},isLastClickedItem:function(a){return this.lastClickedItem&&this.lastClickedItem.term==a.term&&this.lastClickedItem.index==a.index}});Ext.define("Voyant.panel.VoyantFooter",{extend:"Ext.container.Container",mixins:["Voyant.panel.Panel"],alias:"widget.voyantfooter",statics:{i18n:{voyantLink:{en:'\x3ca href\x3d"http://docs.voyant-tools.org/" target\x3d"_blank"\x3eVoyant Tools\x3c/a\x3e'},privacy:{en:"Privacy"},privacyMsg:{en:'The developers of Voyant Tools gather data from the site about what tools are invoked and with what parameters (IP addresses are also logged in order to be able to identify multiple requests during a same session). In addition, Voyant Tools uses Google Analytics (see \x26lt;a href\x3d"http://www.google.ca/intl/en/policies/privacy/" target\x3d"_blank"\x26gt;Google\x26apos;s Privacy Policy\x26lt;/a\x26gt; and the \x26lt;em\x26gt;Log Information\x26lt;/em\x26gt; section in particular). Locally logged data and Google Analytics data will be used by the development team in order to debug and improve the tools, as well as to understand how researchers are using them. This data may also be used for research purposes in anonymous and aggregate forms. Please note that texts submitted to Voyant Tools are stored in order to allow persistent access during a work session and between work sessions. If you have questions about the data being collected and how it is being used, or to request that a corpus be removed, please contact \x26lt;a href\x3d"http://stefansinclair.name/contact/"\x26gt;St\u00e9fan Sinclair\x26lt;/a\x26gt;.'}}},
height:18,cls:"x-tab-bar-default voyant-footer",listeners:{boxready:function(a,b,c){c=[a.localize("voyantLink"),", \x3ca href\x3d'http://stefansinclair.name/'\x3eSt\x26eacute;fan Sinclair\x3c/a\x3e \x26amp; \x3ca href\x3d'http://geoffreyrockwell.com'\x3eGeoffrey Rockwell\x3c/a\x3e"," (\x26copy;"+(new Date).getFullYear()+")"," \x3ca href\x3d'http://docs.voyant-tools.org/privacy/' target\x3d'top' data-qtip\x3d'"+a.localize("privacyMsg")+"'\x3e"+a.localize("privacy")+"\x3c/a\x3e"," v. "+Voyant.application.getVersion()+
" ("+Voyant.application.getBuild()+")"];for(var d="",e=0,f,g=a.getEl(),h=0;h<c.length;h++)f=g.getTextWidth(c[h].replace(/<.+?>/g,"")),e+f<b&&(d+=c[h],e+=f);a.update(d)}}});Ext.define("Voyant.panel.VoyantHeader",{extend:"Ext.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.voyantheader",statics:{i18n:{title:{en:"Voyant Tools"},helpTip:{en:"Voyant Tools is a web-based reading and analysis environment for digital texts."},home:{en:"Start Over"},homeTip:{en:"Click to start over from the corpus creation screen."},homeConfirm:{en:"Are you sure you want to start over (and leave the current corpus)?"}}},constructor:function(a){Ext.apply(this,{id:"voyantheader",title:"",layout:"fit",
html:'\x3cdiv id\x3d"logo-container"\x3e\x3c/div\x3e',collapseMode:void 0,collapsible:!0,animCollapse:!1,titleCollapse:!1,floatable:!1,header:!0,hideCollapseTool:!0,listeners:{collapse:this.onCollapse},titleAlign:"center"});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.call(this,Ext.apply(a,{moreTools:["corpusset","scatterplot","termsradio"],includeTools:{save:!0,plus:!0,help:!0,home:{type:"home",tooltip:this.localize("homeTip"),xtype:"toolmenu",glyph:"xf015@FontAwesome",
handler:function(a){var c=this.up("panel");Ext.Msg.confirm(c.localize("home"),c.localize("homeConfirm"),function(a){"yes"==a&&(document.location.href=c.getBaseUrl())},this)}}}}))},onCollapse:function(a){Ext.defer(function(){this.setTitle("\x3cimg src\x3d'"+this.getBaseUrl()+"/resources/images/voyant-logo-tiny.png' style\x3d'vertical-align: middle' alt\x3d'Voyant Tools' /\x3e "+this.localize("title"))},10,a)}});Ext.define("Voyant.panel.CorpusSet",{extend:"Ext.panel.Panel",requires:"Voyant.panel.VoyantTabPanel Voyant.panel.Cirrus Voyant.panel.Summary Voyant.panel.CorpusTerms Voyant.panel.Reader Voyant.panel.Documents Voyant.panel.Trends Voyant.panel.Contexts Voyant.panel.Phrases Voyant.panel.DocumentTerms Voyant.panel.CorpusCollocates Voyant.panel.CollocatesGraph".split(" "),mixins:["Voyant.panel.Panel"],alias:"widget.corpusset",statics:{i18n:{title:{en:"Corpus View"},helpTip:{en:"This is the default, general-purpose corpus view."}},
api:{panels:void 0},glyph:"xf17a@FontAwesome"},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},layout:"border",header:!1,items:[{region:"west",flex:3,layout:"fit",moreTools:["cirrus","corpusterms"],xtype:"voyanttabpanel",split:{width:5},tabBarHeaderPosition:0,items:[{xtype:"cirrus"},{xtype:"corpusterms"}]},{region:"center",flex:3,layout:"fit",xtype:"voyanttabpanel",tabBarHeaderPosition:0,items:[{xtype:"reader"}]},{region:"east",
flex:3,layout:"fit",xtype:"voyanttabpanel",split:{width:5},tabBarHeaderPosition:0,moreTools:["trends","collocatesgraph","corpuscollocates"],items:[{xtype:"trends"},{xtype:"collocatesgraph"},{xtype:"corpuscollocates"}]},{region:"south",flex:2,split:{width:5},layout:"border",items:[{layout:"fit",region:"center",flex:1,xtype:"voyanttabpanel",split:{width:5},tabBarHeaderPosition:0,moreTools:["summary","documents","phrases"],items:[{xtype:"summary"},{xtype:"documents"},{xtype:"phrases"}]},{layout:"fit",
region:"east",flex:1,xtype:"voyanttabpanel",split:{width:5},tabBarHeaderPosition:0,moreTools:["contexts","documentterms"],items:[{xtype:"contexts"},{xtype:"bubblelines"}]}]}],listeners:{boxready:function(){var a=this.getApiParam("panels");if(a)for(var a=a.toLowerCase().split(","),b=this.query("voyanttabpanel"),c=0,d=a.length;c<d;c++){var e=a[c];if(e&&Ext.ClassManager.getByAlias("widget."+e)&&b[c]){var f=b[c];f.getActiveTab().isXType(e)||(f.items.each(function(a,b){if(a.isXType(e))return this.setActiveTab(b),
!1},f),f.getActiveTab().isXType(e)||f.getActiveTab().replacePanel(e))}}},loadedCorpus:function(a,b){if(30<b.getDocumentsCount()){var c=this.down("bubblelines");c&&c.up("voyanttabpanel").remove(c)}},panelChange:function(a){var b=[];this.query("voyanttabpanel").forEach(function(a){b.push(a.getActiveTab().xtype)});this.getApplication().setApiParam("panels",b.join(","))}}});Ext.define("Voyant.panel.Streamgraph",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.streamgraph",statics:{i18n:{title:{en:"Streamgraph"},clearTerms:{en:"Clear Terms"},granularity:{en:"Granularity"}},api:{limit:5,stopList:"auto",query:void 0,withDistributions:"raw",bins:50,docIndex:void 0,docId:void 0},glyph:"xf1cb@FontAwesome"},config:{corpus:void 0,visLayout:void 0,vis:void 0,mode:void 0},graphMargin:{top:0,right:0,bottom:0,left:0},MODE_CORPUS:"corpus",MODE_DOCUMENT:"document",
constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){Ext.apply(this,{title:this.localize("title"),tbar:new Ext.Toolbar({items:{xtype:"legend",store:new Ext.data.JsonStore({fields:["name","mark"]}),listeners:{itemclick:function(a,b,c,d){b.get("name")},scope:this}}}),bbar:new Ext.Toolbar({items:[{xtype:"button",text:this.localize("clearTerms"),handler:function(){},scope:this},"-",{xtype:"documentselector",itemId:"docSelector",
singleSelect:!0},"-",{xtype:"slider",itemId:"granularity",fieldLabel:this.localize("granularity"),labelAlign:"right",labelWidth:70,width:150,increment:10,minValue:10,maxValue:300,listeners:{changecomplete:function(a,b){this.setApiParams({bins:b});this.loadFromCorpus()},scope:this}}]})});this.on("loadedCorpus",function(a,b){this.setCorpus(b);this.down("#docSelector").setCorpus(b);this.isVisible()&&this.loadFromCorpus()},this);this.on("documentsSelected",function(a,b){this.setApiParam("docId",b[0]);
this.loadFromDocumentTerms()},this);this.on("resize",function(a,b,c){},this);this.on("boxready",this.initGraph,this);this.mixins["Voyant.panel.Panel"].initComponent.apply(this,arguments);this.callParent(arguments)},loadFromCorpus:function(){var a=this.getCorpus();this.getApiParam("docId")||this.getApiParam("docIndex")?this.loadFromDocumentTerms():1==a.getDocumentsCount()?this.loadFromDocument(a.getDocument(0)):this.loadFromCorpusTerms(a.getCorpusTerms())},loadFromCorpusTerms:function(a){a.load({callback:function(a,
c,d){d?(this.setMode(this.MODE_CORPUS),this.loadFromRecords(a)):Voyant.application.showResponseError(this.localize("failedGetCorpusTerms"),c)},scope:this,params:this.getApiParams(["limit","stopList","query","withDistributions"])})},loadFromDocument:function(a){if(a.then){var b=this;a.then(function(a){b.loadFromDocument(a)})}else"Voyant.data.model.Document"==Ext.getClassName(a)&&(this.setApiParams({docIndex:void 0,query:void 0,docId:a.getId()}),this.isVisible()&&this.loadFromDocumentTerms())},loadFromDocumentTerms:function(a){this.getCorpus()&&
(a=a||this.getCorpus().getDocumentTerms({autoLoad:!1}),a.load({callback:function(a,c,d){d?(this.setMode(this.MODE_DOCUMENT),this.loadFromRecords(a)):Voyant.application.showResponseError(this.localize("failedGetDocumentTerms"),c)},scope:this,params:this.getApiParams("docId docIndex limit stopList query docId withDistributions bins".split(" "))}))},loadFromRecords:function(a){var b=d3.scale.category10(),c=this.down("[xtype\x3dlegend]").getStore(),d=[],e=[];a.forEach(function(a,c){var f=[];a.get("distributions").forEach(function(a,
b){f.push({x:b,y:a})},this);e.push(f);d.push({name:a.get("term"),mark:b(c)})},this);c.loadData(d);a=this.getVisLayout()(e);var c=this.getMode()===this.MODE_DOCUMENT?this.getApiParam("bins")-1:this.getCorpus().getDocumentsCount()-1,f=this.body.down("svg").getWidth()-this.graphMargin.left-this.graphMargin.right,g=d3.scale.linear().domain([0,c]).range([0,f]),c=d3.max(a,function(a){return d3.max(a,function(a){return a.y0+a.y})}),f=this.body.down("svg").getHeight()-this.graphMargin.top-this.graphMargin.bottom,
h=d3.scale.linear().domain([0,c]).range([f,0]),k=d3.svg.area().x(function(a){return g(a.x)}).y0(function(a){return h(a.y0)}).y1(function(a){return h(a.y0+a.y)}),c=this.getVis().selectAll("path");0===c.size()?c.data(a).enter().append("path").attr("d",function(a){return k(a)}).style("fill",function(a,c){return b(c)}):c.data(a).attr("d",function(a){return k(a)})},initGraph:function(){if(void 0===this.getVisLayout()){var a=this.getLayout().getRenderTarget(),b=a.getWidth()-0,c=a.getHeight()-0;this.setVisLayout(d3.layout.stack().offset("silhouette"));
this.setVis(d3.select(a.dom).append("svg").attr("id","streamGraph").attr("width",b).attr("height",c).attr("transform","translate(0,0)"))}}});Ext.define("Voyant.VoyantApp",{extend:"Ext.app.Application",mixins:["Voyant.util.Deferrable","Voyant.util.Localization","Voyant.util.Api"],requires:["Voyant.util.ResponseError"],name:"VoyantApp",statics:{i18n:{error:{en:"Error"},serverResponseError:{en:"The server error reponse:"}}},config:{baseUrl:void 0,tromboneUrl:void 0},constructor:function(a){this.setBaseUrl(this.config.baseUrl);this.setTromboneUrl(this.config.baseUrl+"trombone");Voyant.application=this;this.mixins["Voyant.util.Api"].constructor.apply(this,
arguments);this.callParent(arguments)},getTools:function(){return[{type:"maximize"},{type:"help"}]},launch:function(){this.callParent(arguments)},tromboneCall:function(a){a=a?a:{};Ext.applyIf(a,{url:this.getTromboneUrl()});a.success||a.failure||a.callback||Ext.applyIf(a,{url:this.getTromboneUrl(),scope:this,callback:function(b,c,d){this.dispatchEvent(a.tool+"Loaded",b,c,d)}});Ext.Ajax.request(a)},getViewport:function(){return Ext.ComponentQuery.query("viewport")[0]},dispatchEvent:function(a,b){var c=
this.getViewport().query("panel,chart"),d=!1;this.hasListener&&this.hasListener(a)&&(this.fireEvent.apply(this,arguments),d=!0);for(var e=0;e<c.length;e++)!c[e].hasListener||!c[e].hasListener(a)||b&&b.getId&&c[e].getId&&b.getId()==c[e].getId()||(d=!0,c[e].fireEvent.apply(c[e],arguments));d||console&&console.info("Unhandled event: "+a,arguments)},showResponseError:function(a,b){this.showError(Ext.create("Voyant.util.ResponseError",{msg:Ext.isString(a)?a:a.msg,response:b}))},showError:function(a){if(a instanceof
Voyant.util.ResponseError){var b=a.getResponse();Ext.apply(a,{message:a.getMsg()+" "+this.localize("serverResponseError")+"\x3cpre class\x3d'error'\x3e\n"+b.responseText.substring(0,b.responseText.indexOf("\n\t"))+"\u2026 \x3ca href\x3d'#' onclick\x3d\"window.open('').document.write(unescape('\x3cpre\x3e"+escape(b.responseText)+"\x3c/pre\x3e')); return false;\"\x3emore\x3c/a\x3e\x3c/pre\x3e"})}Ext.applyIf(a,{title:this.localize("error"),buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,autoScroll:!0});
Ext.Msg.show(a)},getToolConfigFromToolXtype:function(a){cls=Ext.ClassManager.getByAlias("widget."+a);return{xtype:a,title:this._localizeClass(cls,"title"),tooltip:{text:this._localizeClass(cls,"helpTip")},glyph:cls&&cls.glyph?cls.glyph:"xf12e@FontAwesome"}},colors:[[0,0,255],[51,197,51],[255,0,255],[121,51,255],[28,255,255],[255,174,0],[30,177,255],[182,242,58],[255,0,164],[51,102,153],[34,111,52],[155,20,104],[109,43,157],[128,130,33],[111,76,10],[119,115,165],[61,177,169],[202,135,115],[194,169,
204],[181,212,228],[182,197,174],[255,197,197],[228,200,124],[197,179,159]],rgbToHex:function(a){return"#"+(16777216+(a[0]<<16)+(a[1]<<8)+a[2]).toString(16).slice(1)},getColorPalette:function(a){if(a){a=[];for(var b=0;b<this.colors.length;b++)a.push(this.rgbToHex(this.colors[b]));return a}return this.colors},getColor:function(a,b){return b?this.rgbToHex(this.colors[a]):this.colors[a]},colorTermAssociations:new Ext.util.MixedCollection,getColorForTerm:function(a,b){-1!=a.indexOf(":")&&(a=a.split(":")[1]);
var c=this.colorTermAssociations.get(a);null==c&&(c=this.colorTermAssociations.getCount()%this.colors.length,c=this.colors[c],this.colorTermAssociations.add(a,c));b&&(c=this.rgbToHex(c));return c}});Ext.define("Voyant.VoyantCorpusApp",{extend:"Voyant.VoyantApp",name:"VoyantCorpusApp",requires:"Voyant.panel.CorpusSet Voyant.data.model.Corpus Voyant.panel.VoyantHeader Voyant.panel.VoyantFooter Voyant.panel.CorpusCreator Voyant.panel.Cirrus Voyant.panel.Summary Voyant.panel.CorpusTerms Voyant.panel.Reader Voyant.panel.Documents Voyant.panel.Trends Voyant.panel.Contexts Voyant.panel.DocumentTerms Voyant.panel.CorpusCollocates Voyant.panel.CollocatesGraph Voyant.panel.Phrases Voyant.panel.ScatterPlot Voyant.panel.TopicContexts Voyant.panel.TermsRadio".split(" "),
statics:{i18n:{fetchingCorpus:{en:"Fetching your corpus"},moreToolsScale:{en:"Tools by Scale"},moreToolsScaleCorpus:{en:"Corpus Tools"},moreToolsScaleDocument:{en:"Document Tools"},moreToolsType:{en:"Tools by Type"},moreToolsTypeViz:{en:"Visualization Tools"},moreToolsTypeGrid:{en:"Grid Tools"},moreToolsTypeOther:{en:"Other Tools"}}},constructor:function(){this.mixins["Voyant.util.Api"].constructor.apply(this,arguments);this.callParent(arguments)},config:{corpus:void 0,moreTools:[{i18n:"moreToolsScaleCorpus",
glyph:"xf065@FontAwesome",items:"cirrus corpusterms bubblelines corpuscollocates phrases documents summary trends scatterplot termsradio".split(" ")},{i18n:"moreToolsScaleDocument",glyph:"xf066@FontAwesome",items:"cirrus contexts documentterms reader trends knots".split(" ")},{i18n:"moreToolsTypeViz",glyph:"xf06e@FontAwesome",items:"cirrus bubblelines collocatesgraph trends scatterplot termsradio knots".split(" ")},{i18n:"moreToolsTypeGrid",glyph:"xf0ce@FontAwesome",items:"corpusterms corpuscollocates phrases contexts documentterms documents".split(" ")},
{i18n:"moreToolsTypeOther",glyph:"xf035@FontAwesome",items:["reader","summary"]}]},launch:function(){this.callParent(arguments);if(this.hasQueryToLoad()){var a=Ext.Object.fromQueryString(document.location.search),b=this,c=b.getViewport();c.mask(this.localize("fetchingCorpus"));(new Corpus(a)).then(function(a){c.unmask();b.dispatchEvent("loadedCorpus",this,a)}).fail(function(a,b){c.unmask()})}},hasQueryToLoad:function(a){a||(a=Ext.Object.fromQueryString(document.location.search));return a.corpus||
a.input},listeners:{loadedCorpus:function(a,b){this.setCorpus(b)}}});Ext.define("Voyant.VoyantDefaultApp",{extend:"Voyant.VoyantCorpusApp",mixins:["Voyant.util.Api"],name:"VoyantDefaultApp",constructor:function(){this.mixins["Voyant.util.Api"].constructor.apply(this,arguments);this.callParent(arguments)},statics:{i18n:{noViewErrorTitle:{en:"View Error"},noViewErrorTpl:{en:'No view was found with the name "{view}". You can \x3ca href\x3d"{url}"\x3etry with the default view\x3c/a\x3e instead'},voyantIs:{en:"\x3cp style\x3d'text-align: center; font-style: italic;'\x3eVoyant Tools is a web-based reading and analysis environment for digital texts. \x3ca href\x3d'/docs/'\x3eFind out more\x3c/a\x3e.\x3c/p\x3e"},
helpTip:{en:"Voyant Tools is a web-based reading and analysis environment for digital texts.\x3c/p\x3e"}},api:{view:"corpusset",stopList:"auto",panels:void 0}},listeners:{loadedCorpus:function(a,b){this.viewport.down("voyantheader").collapse();this.viewport.down("#toolsContainer").setActiveItem(1);if(window.history.pushState){var c=b.getId(),d=Ext.Object.fromQueryString(document.location.search),e=this.getBaseUrl()+"?corpus\x3d"+c,f;for(f in d)"corpus"!==f&&(e+="\x26"+f+"\x3d"+d[f]);window.history.pushState({corpus:c},
"Corpus: "+c,e)}}},getViewComponent:function(){return this.viewport.down("#toolsContainer-main")},launch:function(){var a=this.getApiParam("view","CorpusSet"),b=a.toLowerCase();Ext.ClassManager.getByAlias("widget."+b)?(this.viewport=Ext.create("Ext.container.Viewport",{layout:"border",items:[{xtype:"voyantheader",region:"north"},{region:"south",xtype:"voyantfooter"},{region:"center",layout:"card",itemId:"toolsContainer",activeItem:0,items:[{xtype:"container",layout:{type:"vbox",pack:"center",align:"center"},
items:[{xtype:"corpuscreator"},{xtype:"container",html:this.localize("voyantIs")}]},{layout:"fit",itemId:"toolsContainer-main",items:{xtype:b}}]}]}),this.callParent(arguments)):(b=document.location.href.replace(/view=.*?&/,""),Ext.Msg.show({title:this.localize("noViewErrorTitle"),message:(new Ext.Template(this.localize("noViewErrorTpl"))).apply({view:a,url:b}),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}))}});