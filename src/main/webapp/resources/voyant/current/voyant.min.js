/* This file created by JSCacher. Last modified: Tue May 26 15:21:43 EDT 2015 */
function Bubblelines(a){this.container=a.container;this.externalClickHandler=a.clickHandler;this.INTERVAL=50;this.DISMISS_DELAY=2500;this.UNIFORM_LINE_LENGTH=!0;this.SEPARATE_LINES_FOR_TERMS=!1;this.MAX_LINE_WIDTH=this.MAX_LABEL_WIDTH=0;this.DRAW_TITLES=!0;this.DRAW_SHORT_TITLES=!1;this.graphSeparation=this.MIN_GRAPH_SEPARATION=50;this.yIndex=0;this.mouseOver=!1;this.clearToolTipId=this.intervalId=null;this.overBubbles=[];this.lastClickedBubbles={};this.ctx=this.canvas=this.dragInfo=null;this.maxDocLength=
2;this.maxFreq={term:null,value:0};this.maxRadius=0;this.selectedDocs=new Ext.util.MixedCollection;this.cache=new Ext.util.MixedCollection;this.currentTerms={};this.initialized=!1}
Bubblelines.prototype={constructor:Bubblelines,initializeCanvas:function(){this.selectedDocs.each(this.findLongestDocument,this);if(!(1>=this.maxDocLength)){var a=this.container,b=a.getHeight(),c=a.getWidth();this.DRAW_SHORT_TITLES=500>c;var d=Ext.id("bubblelines");a.add({width:c,height:b,html:'\x3ccanvas id\x3d"'+d+'" width\x3d"'+c+'" height\x3d"'+b+'"\x3e\x3c/canvas\x3e',border:!1,listeners:{afterrender:{fn:function(a){this.canvas=document.getElementById(d);this.ctx=this.canvas.getContext("2d");
this.canvas.addEventListener("click",this.clickHandler.bind(this),!1);this.canvas.addEventListener("mousedown",this.mouseDownHandler.bind(this),!1);this.canvas.addEventListener("mouseup",this.mouseUpHandler.bind(this),!1);this.canvas.addEventListener("mousemove",this.moveHandler.bind(this),!1);this.canvas.addEventListener("mouseenter",this.mouseEnterHandler.bind(this),!1);this.canvas.addEventListener("mouseleave",this.mouseLeaveHandler.bind(this),!1)},single:!0,scope:this}}});a.doLayout();this.initialized=
!0}},doLayout:function(){if(this.initialized){var a=this.container.getWidth();this.DRAW_SHORT_TITLES=500>a;this.setTitleWidthsAndMaxTitleWidth();for(var b=Ext.DomQuery.jsSelect("div:not(div[class*\x3dterm])",this.container.el.dom),c=0;c<b.length;c++)Ext.fly(b[c]).setWidth(a);this.canvas.width=a;b=75;this.DRAW_SHORT_TITLES&&(b=50);this.setMaxLineWidth(a-this.MAX_LABEL_WIDTH-b);this.setLineLengths();this.recache();this.setCanvasHeight();this.drawGraph()}},addDocToCache:function(a){this.cacheBubbles(a);
this.calculateBubbleRadii(a);a.lineLength=600;a.freqCounts={};!1===this.cache.containsKey(a.id)?this.cache.add(a):this.cache.replace(a.id,a);this.cache.sort("index","ASC")},addTermsToDoc:function(a,b){var c,d;for(d in a)c=d;this.currentTerms[c]=!0;c=this.cache.get(b);Ext.apply(c.terms,a);this.cacheBubbles(c)?this.recache():this.calculateBubbleRadii(c)},cacheBubbles:function(a){var b=!1,c;for(c in a.terms){for(var d=a.terms[c],e=d.distributions.length,g=a.lineLength/e,f=[],h=0,l=0,m=0,k=0;k<e;k++){var n=
d.distributions[k];n>l&&(l=n);f.push({id:Ext.id(null,"bub"),x:m,freq:n,radius:0,bin:k,tokenIds:d.positions.slice(h,h+=n)});m+=g}a.terms[c].maxDistribution=l;a.terms[c].pos=f;l>this.maxFreq.value&&(b=!0,this.setMaxFreq({term:c,value:l}))}return b},calculateBubbleRadii:function(a,b){var c=Math.log(this.maxFreq.value),d=Math.log(2)/2,e;for(e in a.terms){var g=a.terms[e];if(g&&(null==b||e==b))for(var f=0;f<g.pos.length;f++){var h=g.pos[f];if(0<h.freq){var l=Math.max(Math.log(h.freq),d)/c*this.maxRadius;
h.radius=l}else h.radius=0}}},recache:function(){this.cache.each(function(a){this.cacheBubbles(a);this.calculateBubbleRadii(a)},this)},getTotalHeight:function(){var a=this.maxRadius;this.cache.each(function(b,c,d){a+=b.height},this);return a},setCanvasHeight:function(){this.calculateGraphHeights();var a=this.getTotalHeight(),b=this.container.dom;if(void 0!==b)for(var b=Ext.DomQuery.jsSelect("div",b),c=0;c<b.length;c++)Ext.fly(b[c]).setHeight(a);this.canvas.height=a},setMaxLineWidth:function(a){this.maxRadius=
a/30;this.MAX_LINE_WIDTH=a-this.maxRadius/2},calculateGraphHeights:function(){var a=.5*this.maxRadius;if(this.SEPARATE_LINES_FOR_TERMS){var b=[],c;for(c in this.currentTerms)b.push(c);this.cache.each(function(c,d,f){d=this.maxRadius*b.length;for(f=0;f<b.length;f++)c.terms[b[f]]||(d-=this.maxRadius);0==d&&(d=this.maxRadius);c.height=d+a},this)}else{var d=Math.max(this.maxRadius,this.MIN_GRAPH_SEPARATION);this.cache.each(function(b,c,f){b.height=d+a},this)}},findLongestDocument:function(a){a=a.getTotalWordTokens();
a>this.maxDocLength&&(this.maxDocLength=a)},getTitleWidth:function(a){var b=a.title;this.DRAW_SHORT_TITLES&&(b=this.cache.indexOf(a)+1+")");this.ctx.textBaseline="top";this.ctx.font="bold 12px Verdana";return this.ctx.measureText(b).width},setTitleWidthsAndMaxTitleWidth:function(){this.cache.each(function(a,b){var c=this.getTitleWidth(a);a.titleWidth=c;c>this.MAX_LABEL_WIDTH&&(this.MAX_LABEL_WIDTH=c)},this)},setLineLengths:function(){this.cache.each(function(a,b){var c;c=this.UNIFORM_LINE_LENGTH?
this.MAX_LINE_WIDTH:Math.log(a.getTotalWordTokens())/Math.log(this.maxDocLength)*this.MAX_LINE_WIDTH;a.lineLength=c},this)},drawGraph:function(a){null!=this.intervalId&&clearInterval(this.intervalId);this.mouseOver?this.intervalId=setInterval(this.doDraw.bind(this,[a]),this.INTERVAL):setTimeout(this.doDraw.bind(this,[a]),5)},doDraw:function(a){this.clearCanvas();this.yIndex=this.maxRadius;!0===a&&(this.yIndex+=30);this.cache.each(this.drawDocument,this);!0===a?this.drawLegend():this.drawToolTip();
this.doDrag()},drawDocument:function(a,b,c){var d=a.lineLength,e=this.MAX_LABEL_WIDTH-a.titleWidth,g=5;this.ctx.textBaseline="top";this.ctx.font="bold 12px Verdana";if(null!=this.dragInfo&&this.dragInfo.oldIndex==b)this.ctx.fillStyle="rgba(128, 128, 128, 0.5)",g+=e,this.ctx.fillText(a.title,g,this.yIndex),this.SEPARATE_LINES_FOR_TERMS&&(this.yIndex+=a.height);else{c=function(){g=f.MAX_LABEL_WIDTH+f.maxRadius;f.ctx.strokeStyle="rgba(128, 128, 128, 1.0)";f.ctx.fillStyle="rgba(128, 128, 128, 1.0)";f.ctx.lineWidth=
.25;f.ctx.beginPath();f.ctx.moveTo(g,f.yIndex-6);f.ctx.lineTo(g,f.yIndex+6);f.ctx.stroke();f.ctx.beginPath();f.ctx.moveTo(g,f.yIndex);f.ctx.lineTo(g+d,f.yIndex);f.ctx.stroke();f.ctx.beginPath();f.ctx.moveTo(g+d,f.yIndex-6);f.ctx.lineTo(g+d,f.yIndex+6);f.ctx.stroke()};this.DRAW_TITLES&&(g+=e,this.ctx.fillStyle="rgba(128, 128, 128, 1.0)",e=a.title,this.DRAW_SHORT_TITLES&&(e=b+1+")"),this.ctx.fillText(e,g,this.yIndex));this.yIndex+=4;var f=this,e=[],h;for(h in this.currentTerms)e.push(h);this.SEPARATE_LINES_FOR_TERMS?
null!=e&&0!=e.length||c():c();h=2*Math.PI;e=0;a.freqCounts={};var l=a.terms,m=null!=this.lastClickedBubbles[b],k=0,n;for(n in l){var q=l[n];if(q){k++;this.SEPARATE_LINES_FOR_TERMS&&c();var p=0,r=q.color.join(",");this.ctx.strokeStyle="rgba("+r+", 1)";this.ctx.fillStyle="rgba("+r+", 0.35)";this.ctx.lineWidth=.25;for(var e=e+q.rawFreq,p=p+q.rawFreq,s=m&&this.lastClickedBubbles[b][n],w=0;w<q.pos.length;w++){var t=q.pos[w];if(0<t.radius){var x=!1;s&&this.lastClickedBubbles[b][n]==t.id&&(this.ctx.strokeStyle=
"rgba(0, 0, 0, 0.75)",this.ctx.fillStyle="rgba("+r+", 0.5)",this.ctx.lineWidth=1,x=!0);this.ctx.beginPath();this.ctx.arc(t.x+g,this.yIndex,t.radius,0,h,!0);this.ctx.closePath();this.ctx.fill();this.ctx.stroke();x&&(this.ctx.strokeStyle="rgba("+r+", 1)",this.ctx.fillStyle="rgba("+r+", 0.35)",this.ctx.lineWidth=.25)}}a.freqCounts[n]=p;this.SEPARATE_LINES_FOR_TERMS&&(this.ctx.fillStyle="rgba(0, 0, 0, 1.0)",this.ctx.font="10px Verdana",this.ctx.fillText(p,g+d+5,this.yIndex-4),this.yIndex+=this.maxRadius)}}this.SEPARATE_LINES_FOR_TERMS&&
0==k&&(c(),this.ctx.fillStyle="rgba(0, 0, 0, 1.0)",this.ctx.font="10px Verdana",this.ctx.fillText(0,g+d+5,this.yIndex-4),this.yIndex+=this.maxRadius);g+=d;this.SEPARATE_LINES_FOR_TERMS||(this.ctx.fillStyle="rgba(0, 0, 0, 1.0)",this.ctx.font="10px Verdana",this.ctx.fillText(e,g+5,this.yIndex-4))}this.yIndex=this.SEPARATE_LINES_FOR_TERMS?this.yIndex+.5*this.maxRadius:this.yIndex+a.height;this.yIndex-=4},drawLegend:function(){var a=this.MAX_LABEL_WIDTH+this.maxRadius;this.ctx.textBaseline="top";this.ctx.font=
"16px serif";this.typeStore.each(function(b){var c=b.get("color").join(",");this.ctx.fillStyle="rgb("+c+")";b=b.get("type");this.ctx.fillText(b,a,5);b=this.ctx.measureText(b).width;a+=b+8},this)},drawToolTip:function(){if(0<this.overBubbles.length){this.ctx.lineWidth=.5;this.ctx.fillStyle="rgba(224, 224, 224, 0.8)";this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)";var a=this.overBubbles[0].x,b=this.overBubbles[0].y;a+110>this.canvas.width&&(a-=110);var c;if(null==this.overBubbles[0].label){var d=this.cache.get(this.overBubbles[0].docIndex);
c=1;for(var e in d.freqCounts)c++;c*=16;b+c>this.canvas.height&&(b-=c);this.ctx.fillRect(a,b,110,c);this.ctx.strokeRect(a,b,110,c);a+=10;b+=10;this.ctx.fillStyle="rgba(0, 0, 0, 0.8)";this.ctx.font="10px Verdana";for(e in d.freqCounts)this.ctx.fillText(e+": "+d.freqCounts[e],a,b,90),b+=16}else for(c=16*this.overBubbles.length+10,b+c>this.canvas.height&&(b-=c),this.ctx.fillRect(a,b,110,c),this.ctx.strokeRect(a,b,110,c),a+=10,b+=10,this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="10px Verdana",
d=0;d<this.overBubbles.length;d++)e=this.overBubbles[d],this.ctx.fillText(e.label+": "+e.freq,a,b,90),b+=16;null==this.clearToolTipId&&(this.clearToolTipId=setTimeout(this.clearToolTip.bind(this),this.DISMISS_DELAY))}},clearToolTip:function(){this.overBubbles=[];clearTimeout(this.clearToolTipId);this.clearToolTipId=null},reloadTypeData:function(){this.cache.clear();this.store.removeAll();var a=this.getApiParamValue("type");0==a.length&&(this.cacheDocuments(),this.drawGraph());for(var b=0;b<a.length;b++)this.store.load({params:{type:a[b]},
add:!0})},mouseEnterHandler:function(a){this.mouseOver=!0;this.drawGraph()},mouseLeaveHandler:function(a){this.mouseOver=!1;null!=this.intervalId&&clearInterval(this.intervalId);this.overBubbles=[];this.drawGraph()},moveHandler:function(a){this.clearToolTip();this.overBubbles=[];var b=a.layerX-this.MAX_LABEL_WIDTH,c=a.layerY,d=.25*this.maxRadius,e=-1;this.cache.each(function(a,b,f){if(c<d)return!1;d+=a.height;if(c<d)return e=b,!1},this);if(null!=this.dragInfo)this.dragInfo.x=a.layerX,this.dragInfo.y=
c,e>=this.cache.getCount()?e=this.cache.getCount()-1:0>e&&(e=c+this.maxRadius>this.canvas.height?this.cache.getCount()-1:0),this.dragInfo.newIndex=e,document.body.style.cursor="move";else if(0<=e&&e<this.cache.getCount())if(0<=b){var g=!1,b=b-this.maxRadius,f=this.cache.get(e);if(b>=f.lineLength)this.overBubbles=[{docIndex:e,x:a.layerX+10,y:a.layerY+10}];else{var b=Math.round(b/(f.lineLength/50)),h=this.maxRadius;0<e&&(h=d-(this.cache.get(e).height-.75*this.maxRadius));var h=Math.round((c-h)/this.maxRadius),
l=0,m;for(m in f.terms)if(void 0!==this.currentTerms[m]){var k=f.terms[m];k?(this.SEPARATE_LINES_FOR_TERMS&&l==h||!this.SEPARATE_LINES_FOR_TERMS)&&k.pos[b]&&0<k.pos[b].radius&&(g=!0,this.overBubbles.push({label:m,type:k,docId:f.id,docIndex:e,xIndex:b,yIndex:h,freq:k.pos[b].freq,id:k.pos[b].id,tokenIds:k.pos[b].tokenIds,x:a.layerX+10,y:a.layerY+10})):this.SEPARATE_LINES_FOR_TERMS&&l--;l++}}document.body.style.cursor=g?"pointer":"auto"}else document.body.style.cursor="move";else document.body.style.cursor=
"auto"},mouseDownHandler:function(a){var b=a.layerX,c=a.layerY;if(b<this.MAX_LABEL_WIDTH){var d=.25*this.maxRadius,e=-1;this.cache.each(function(a,b,h){if(c<d)return!1;d+=a.height;if(c<d)return e=b,!1},this);0<=e&&e<this.cache.getCount()&&(this.dragInfo={oldIndex:e,newIndex:e,xOffset:b-5,yOffset:5,x:b,y:c})}},mouseUpHandler:function(a){this.dragInfo=null},doDrag:function(){if(null!=this.dragInfo){for(var a={},b=0;b<this.cache.getCount();b++)b<this.dragInfo.oldIndex&&b<this.dragInfo.newIndex?a[b]=
b:b<this.dragInfo.oldIndex&&b>=this.dragInfo.newIndex?a[b]=b+1:b==this.dragInfo.oldIndex?a[b]=this.dragInfo.newIndex:b>this.dragInfo.oldIndex&&b>this.dragInfo.newIndex?a[b]=b:b>this.dragInfo.oldIndex&&b<=this.dragInfo.newIndex&&(a[b]=b-1);this.dragInfo.oldIndex=this.dragInfo.newIndex;this.cache.reorder(a);a=this.cache.get(this.dragInfo.oldIndex);this.ctx.fillStyle="rgba(128, 128, 128, 1)";this.ctx.textBaseline="top";this.ctx.font="bold 12px Verdana";this.ctx.fillText(a.title,this.dragInfo.x-this.dragInfo.xOffset,
this.dragInfo.y-this.dragInfo.yOffset)}},clickHandler:function(a){this.lastClickedBubbles={};if(0<this.overBubbles.length&&this.overBubbles[0].label){a=[];for(var b=[],c=[],d=0;d<this.overBubbles.length;d++){var e=this.overBubbles[d];c.push({term:e.label,docIndex:e.docIndex});null==this.lastClickedBubbles[e.docIndex]&&(this.lastClickedBubbles[e.docIndex]={});this.lastClickedBubbles[e.docIndex][e.label]=e.id;a.push(e.docId+":"+e.label);b.push(e.tokenIds)}b=Ext.flatten(b);b.sort();void 0!==this.externalClickHandler&&
this.externalClickHandler(c)}this.overBubbles=[]},setMaxFreq:function(a){null==a&&(a=this.findMaxFreq());this.maxFreq=a},findMaxFreq:function(){var a={term:"",value:0};this.cache.each(function(b){for(var c in b.terms){var d=b.terms[c].maxDistribution;d>a.value&&(a={term:c,value:d})}},this);return a},getNewColor:function(){for(var a=null,b=0;b<this.colors.length&&(a=this.colors[b],-1!=this.typeStore.findExact("color",a));b++)a=null;null==a&&(a=[128,128,128]);return a},removeAllTerms:function(){this.cache.each(function(a){a.terms=
{}},this);this.currentTerms={}},removeTerm:function(a){delete this.currentTerms[a];var b=!1;this.cache.each(function(c){for(var d in c.terms)d==a&&(this.maxFreq.term==a&&(this.maxFreq={term:null,value:0},b=!0),delete c.terms[d])},this);for(var c in this.lastClickedBubbles){var d=this.lastClickedBubbles[c],e;for(e in d)e==a&&delete this.lastClickedBubbles[c][e]}b&&(this.setMaxFreq(),this.calculateBubbleRadii(),this.drawGraph())},clearCanvas:function(){this.canvas.width=this.canvas.width}};function Cirrus(a){function b(a){a="#"==a.charAt(0)?a.substring(1,7):a;var b=[];b.push(parseInt(a.substring(0,2),16));b.push(parseInt(a.substring(2,4),16));b.push(parseInt(a.substring(4,6),16));return b}function c(){if(0==$("#"+d.config.containerId).length)alert("You must provide a valid container ID!");else{d.canvas=document.createElement("canvas");d.canvas.setAttribute("id",e);d.canvas.setAttribute("tabIndex",1);d.setCanvasDimensions();$(g).append(d.canvas);e="#"+e;d.context=d.canvas.getContext("2d");
d.wordData=[];d.useFadeEffect=!0;d.colors=[[116,116,181],[139,163,83],[189,157,60],[171,75,75],[174,61,155]];f=new WordController(d);for(var a in d.config){"words"==a&&(d.wordData=d.config[a]);"layout"==a&&("circle"==d.config[a]?f.layout=f.CIRCLE:"square"==d.config[a]&&(f.layout=f.SQUARE));if("colors"==a&&$.isArray(d.config[a])&&0<d.config[a].length){d.colors=[];for(var c in d.config[a])d.colors.push(b(d.config[a][c]))}"background"==a&&$(e).css("background-color",d.config[a]);"fade"==a&&("true"==
d.config[a]?d.useFadeEffect=!0:"false"==d.config[a]&&(d.useFadeEffect=!1));"smoothness"==a&&(f.wordsToArrange=Math.max(1,Math.min(20,parseInt(d.config[a]))))}0<d.wordData.length&&(d.clear(),f.addWords(d.wordData),f.arrangeWords());$(window).resize(function(){null!=h&&clearTimeout(h);h=setTimeout(d.resizeWords,1E3)});$(e).keypress(function(a){114==a.which&&f.arrangeWords()});$(e).click(function(a){a=f.handleWordClick(a);void 0!==a&&d.config.clickHandler&&d.config.clickHandler({term:a.text,value:a.value})});
$(e).mouseover(function(a){f.startUpdates()});$(e).mouseout(function(a){f.stopUpdates()});$(e).mousemove(function(a){f.handleMouseMove(a)})}}var d=this;this.config=a;var e=Ext.id(null,"cirrusCanvas");if(null==this.config.containerId)alert("You must provide a valid container ID!");else{var g="#"+this.config.containerId,f=null,h=null;this.clear=function(){this.canvas.width=this.canvas.width};this.addWords=function(a){debugger;f.addWords(a)};this.arrangeWords=function(){f.arrangeWords()};this.clearAll=
function(){f.setWords([]);f.grid=[];this.clear()};this.resizeWords=function(){d.setCanvasDimensions();f.resetWordCoordinates();f.calculateSizeAdjustment();f.resizeWords();f.arrangeWords();h=null};this.setCanvasDimensions=function(){var a=$(g)[0],b=Math.max(a.offsetWidth,a.clientWidth),a=Math.max(a.offsetHeight,a.clientHeight);this.canvas.width=b;this.canvas.height=a};$(document).ready(c)}};function Word(a,b,c,d,e){this.relativeSize=this.rotation=this.width=this.height=0;this.mask=null;this.size=0;this.text=a;this.color=c;this.origSize=b;this.rolloverText=d;this.value=e||0;this.ty=this.tx=this.y=this.x=0;this.fontFamily="Arial";this.fontSize=12;this.alpha=1;this.isOver=this.live=!1;this.draw=function(a){a.save();a.fillStyle="rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+","+this.alpha+")";a.textBaseline="alphabetic";a.font=this.fontSize+"px "+this.fontFamily;a.translate(this.x+
this.tx,this.y+this.ty);a.rotate(this.rotation);a.fillText(this.text,0,0);a.restore()}};function WordController(a){function b(a){for(var b=Math.log(10*a.relativeSize)*Math.LOG10E,c=(b+a.relativeSize)/2,d=0,e=0;e<a.text.length;e++)var f=a.text.charAt(e),d="f"==f||"i"==f||"j"==f||"l"==f||"r"==f||"t"==f?d+b/3:"m"==f||"w"==f?d+b/(4/3):d+b/1.9;return c*d}function c(){p.sort(function(a,b){return a.origSize>b.origSize?-1:a.origSize<b.origSize?1:0})}function d(){for(var a=0;a<p.length;a++){var c=p[a],d;d=c;var e=g.sizeAdjustment,e=b(d)*e;d=(Math.sqrt(6)*Math.sqrt(6*Math.pow(d.text.length,2)+
e*d.text.length)-6*d.text.length)/(2*d.text.length);c.fontSize=d>g.minFontSize?d:g.minFontSize;c.fontFamily="Impact";d=c;f.context.save();f.context.textBaseline="alphabetic";f.context.font=d.fontSize+"px "+d.fontFamily;d.width=f.context.measureText(d.text).width;d.height=Math.ceil(1.15*f.context.measureText("m").width);f.context.restore();c.tx=0;c.ty=c.height;c.size=Math.max(c.height,c.width);c.rotation=Math.PI/180*0;f.context.fillStyle=f.canvas.style.backgroundColor;f.context.fillRect(0,0,f.canvas.width,
f.canvas.height);c.draw(f.context);d=f.context.getImageData(c.x,c.y,c.width,c.height);for(var e=[],h=0;h<c.width;h++){var l=Math.floor(h/g.COARSENESS)*g.COARSENESS;null==e[l]&&(e[l]={});for(var m=0;m<c.height;m++){var k=Math.floor(m/g.COARSENESS)*g.COARSENESS,n;n=4*(h+m*d.width);n=[d.data[n],d.data[n+1],d.data[n+2],d.data[n+3]];"rgb("+n[0]+", "+n[1]+", "+n[2]+")"!=f.canvas.style.backgroundColor&&(e[l][k]=!0);e[l][k]&&(m=k+g.COARSENESS)}}c.mask=e}}function e(){f.clear();for(var a=p.length;a--;){var b=
p[a];b.alpha=1;b.live&&b.draw(f.context)}a=$(f.canvas);if(null!=k){a.css("cursor","pointer");f.context.save();f.context.textBaseline="alphabetic";f.context.font="12px Arial";var b=f.context.measureText(k.text).width,c=f.context.measureText(k.value).width,b=(b>c?b:c)+20,c=n+15,d=q+25,e=a.width(),a=a.height();c+b>=e&&(c-=b);d+40>=a&&(d-=40);f.context.fillStyle="rgba(255,255,255,0.9)";f.context.strokeStyle="rgba(100,100,100,0.9)";f.context.translate(c,d);f.context.fillRect(0,0,b,40);f.context.strokeRect(0,
0,b,40);f.context.fillStyle="rgba(0,0,0,0.9)";f.context.fillText(k.text+":",8,18);f.context.fillText(k.value,8,30);f.context.restore()}else a.css("cursor","default")}var g=this,f=a;this.CIRCLE=0;this.ratio=1;var h=this.CIRCLE;this.getLayout=function(){return h};this.setLayout=function(a){h=a};this.UPDATE_RATE=25;this.COARSENESS=5;this.grid=[];var l=0,m;this.doingArrange=!1;this.wordsToArrange=5;var k=null,n=0,q=0,p=[];this.getWords=function(){return p};this.setWords=function(a){p=a};this.sizeAdjustment=
100;this.minFontSize=12;this.largestWordSize=0;this.smallestWordSize=1E4;var r={};this.addWords=function(a){for(var b=!1,e=0;e<a.length;e++){var h=a[e],l;l=void 0==typeof h.color||null==h.color||""==h.color?f.colors[Math.floor(Math.random()*f.colors.length)]:h.color;var m;m=void 0==typeof h.size||null==h.size||""==h.size?Math.floor(40*Math.random()):parseFloat(h.size);var k=h.word,n=h.label,q=h.value,h=!1;null==r[k]&&(r[k]=!0,m>g.largestWordSize&&(g.largestWordSize=m,h=!0),m<g.smallestWordSize&&(g.smallestWordSize=
.8*m,h=!0),k=new Word(k,m,l,n,q),p.push(k));b=h||b}c();this.setRelativeSizes();this.calculateSizeAdjustment();b?this.resizeWords():d()};this.resetWordCoordinates=function(){f.clear();clearTimeout(m);for(var a=0;a<p.length;a++){var b=p[a];b.x=0;b.y=0;b.tx=0;b.ty=0}};this.calculateSizeAdjustment=function(){this.ratio=f.canvas.width/f.canvas.height;var a=f.canvas.width*f.canvas.height;this.minFontSize=1E5>a?8:12;for(var c=0,d=0;d<p.length;d++)var e=b(p[d]),c=c+e;this.sizeAdjustment=a/c};this.setRelativeSizes=
function(){for(var a=0;a<p.length;a++){var b=p[a],c=this.smallestWordSize;b.relativeSize=.1+(b.origSize-c)/(this.largestWordSize-c)*.9}};this.resizeWords=function(){f.clear();d();c()};this.arrangeWords=function(){clearTimeout(m);f.clear();this.toggleLoadingText();if(0<p.length){var a=function(a,b,c){for(var d=0;d<c.width;d+=this.COARSENESS)for(var e=0;e<c.height;e+=this.COARSENESS)c.mask[d]&&c.mask[d][e]&&(this.grid[d+a]||(this.grid[d+a]=[]),this.grid[d+a][e+b]=c)},b=function(a){a.alpha+=.25;a.draw(f.context)},
c=function(b,c,d,e){a(b,c,d);d.x=b;d.y=c;d.live=!0;e&&d.draw(f.context)},d=function(a,b,c,d,e){for(var f=0;f<=d;f+=this.COARSENESS)for(var g=0;g<=c;g+=this.COARSENESS)if(e[f]&&e[f][g]&&null!=this.grid[f+a]&&null!=this.grid[f+a][g+b])return!0;return!1},g;this.grid=[];l=0;g=function(){var a,g,h,k,n=this.wordsToArrange-1,s=f.canvas.width,q=f.canvas.height,r=.5*s,A=.5*q;do{h=p[l];if(void 0!==h){for(var u=Math.random()*Math.PI,v=.25*Math.random()*h.size,B=.5*(Math.random()-.5),y=.5*h.width,z=.5*h.height;;){a=
Math.floor((r+Math.cos(u)*v*this.ratio-y)/this.COARSENESS)*this.COARSENESS;g=Math.floor((A+Math.sin(u)*v-z)/this.COARSENESS)*this.COARSENESS;k=a+y>=s||g+z>=q?!0:d(a,g,h.height,h.width,h.mask);if(!k)break;u+=B;v+=.05}c(a,g,h);if(f.useFadeEffect)for(a=h.alpha=0;a<l;a++)g=p[a],1>g.alpha&&b(g);else h.alpha=1,h.draw(f.context)}l++;if(l>=p.length){clearTimeout(m);this.doingArrange=!1;this.toggleLoadingText(!1);e();break}}while(n--)}.createDelegate(this);d=d.createDelegate(this);c=c.createDelegate(this);
b=b.createDelegate(this);a=a.createDelegate(this);this.doingArrange=!0;m=setInterval(g,50)}else alert("Error: There are no words to arrange.")};this.toggleLoadingText=function(a){f.context.save();f.context.fillStyle=a?"black":f.canvas.style.backgroundColor;f.context.textBaseline="top";f.context.font="10px Arial";a=f.context.measureText("Loading").width+10;f.context.fillText("Loading",f.canvas.width-a,10);f.context.restore()};this.startUpdates=function(){m=setInterval(e,g.UPDATE_RATE)};this.stopUpdates=
function(){null!=k&&(k=null,e());clearTimeout(m)};this.handleMouseMove=function(a){if(!this.doingArrange){for(var b=p.length;b--;)p[b].isOver=!1;var c=$(f.canvas).offset(),d=(a.pageX-c.left)%this.COARSENESS,b=a.pageX-c.left-d,d=(a.pageY-c.top)%this.COARSENESS;a=a.pageY-c.top-d;k=this.findWordByCoords(b,a);null!=k&&(k.isOver=!0,n=b,q=a)}};this.handleWordClick=function(a){var b=$(f.canvas).offset(),c=(a.pageX-b.left)%this.COARSENESS,d=a.pageX-b.left-c,c=(a.pageY-b.top)%this.COARSENESS;a=this.findWordByCoords(d,
a.pageY-b.top-c);if(null!=a)return{text:a.text,value:a.value}};this.findWordByCoords=function(a,b){var c=null;null!=this.grid[a]&&(null!=this.grid[a][b]?c=this.grid[a][b]:null!=this.grid[a][b+this.COARSENESS]&&(c=this.grid[a][b+this.COARSENESS]));null==c&&null!=this.grid[a+this.COARSENESS]&&(null!=this.grid[a+this.COARSENESS][b]?c=this.grid[a+this.COARSENESS][b]:null!=this.grid[a+this.COARSENESS][b+this.COARSENESS]&&(c=this.grid[a+this.COARSENESS][b+this.COARSENESS]));return c}}
Function.prototype.createDelegate=function(a,b,c){var d=this;return function(){var e=b||arguments;if(!0===c)e=Array.prototype.slice.call(arguments,0),e=e.concat(b);else if("number"==typeof c){var e=Array.prototype.slice.call(arguments,0),g=[c,0].concat(b);Array.prototype.splice.apply(e,g)}return d.apply(a||window,e)}};Ext.define("Voyant.util.Api",{constructor:function(a){a=[];if(!this.isApplication){var b=this.getApplication();this.addParentApi(a,Ext.ClassManager.getClass(b));b.getApiParams&&a.push(this.getApplication().getApiParams())}this.addParentApi(a,Ext.ClassManager.getClass(this));this.api={};a.forEach(function(a){for(c in a)this.api[c]={initial:a[c],value:a[c]}},this);a=Ext.Object.fromQueryString(document.location.search);for(var c in a)this.api[c]&&this.setApiParam(c,a[c])},addParentApi:function(a,b){b.api&&
a.splice(0,0,b.api);b.superclass&&this.addParentApi(a,b.superclass.self)},getApiParam:function(a,b){return void 0!==this.api[a]?this.api[a].value:b},getApiParams:function(a,b){a=a||Object.keys(this.api);var c={};Ext.isString(a)&&(a=[a]);a.forEach(function(a){var e=this.getApiParam(a);if(b||!Ext.isEmpty(e))c[a]=e},this);return c},getModifiedApiParams:function(){var a={},b;for(b in this.api)this.api[b].initial!=this.api[b].value&&(a[b]=this.api[b].value);return a},setApiParams:function(a){for(var b in a)this.setApiParam(b,
a[b])},setApiParam:function(a,b){this.api&&this.api[a]&&(this.api[a].value=b)}});Ext.define("Voyant.util.Localization",{statics:{DEFAULT_LANGUAGE:"en",LANGUAGE:"en"},languageStore:Ext.create("Ext.data.ArrayStore",{fields:["code","language"],data:[["en","English"]]}),getLanguage:function(a){var b=this.languageStore.findRecord(2==a.length?"code":"language",a);if(b)return b.get(2==a.length?"language":"code")},localize:function(a,b){return this._localizeObject(this,a,b)},_localizeObject:function(a,b,c){var d=this._localizeClass(Ext.ClassManager.getClass(a),b,c);if(d)return d;if(a.mixins)for(mixin in a.mixins)if(d=
this._localizeClass(Ext.ClassManager.getClass(a.mixins[mixin]),b,c))return d;return a.superclass&&(d=this._localizeObject(a.superclass,b,c))?d:c&&void 0!=c["default"]?c["default"]:"["+b+"]"},_localizeClass:function(a,b,c){if(a&&a.i18n&&a.i18n[b]){var d=!1;a.i18n[b][Voyant.util.Localization.LANGUAGE]?d=a.i18n[b][Voyant.util.Localization.LANGUAGE]:a.i18n[b][Voyant.util.Localization.DEFAULT_LANGUAGE]&&(d=a.i18n[b][Voyant.util.Localization.DEFAULT_LANGUAGE]);return d?d.isTemplate?d.apply(c):d:c&&void 0!=
c["default"]?c["default"]:"["+b+"]"}return!1}});Ext.define("Voyant.util.Deferrable",{deferredStack:[],releaseAllDeferred:function(){this.deferredStack=[]},getDeferredCount:function(){return this.deferredStack.length},getDeferred:function(a){var b=jQuery.Deferred(),c=this.getPromiseFromDeferred(b);a&&a.transfer&&a.transfer(a,c);!c.show&&window.show&&(c.show=show);this.deferredStack.push(b);var d=this;c.always(function(){d.deferredStack.pop()});return b},getPromiseFromDeferred:function(a){return"object"===typeof a.promise?a.promise:a.promise()},
getDeferredNestedPromise:function(a,b,c){var d=arguments.callee.caller,e=Voyant.application.getDeferred(c);a.then(function(a){e.resolve(d.apply(a,b))}).fail(function(){e.reject.apply(this,arguments)});return e.promise}});Ext.define("Voyant.util.DetailedError",{extend:"Ext.Error",mixins:["Voyant.util.Localization"],config:{msg:void 0,error:void 0,details:void 0},statics:{i18n:{error:{en:"Error"}}},constructor:function(a){this.setMsg(a.msg);this.setError(a.error);this.setDetails(a.details);this.callParent(arguments)},show:function(a){window.showError?showError.call(this):this.showMsg(a)},showMsg:function(a){a=a||{};Ext.applyIf(a,{message:this.getMsg()+"\x3cp class\x3d'error'\x3e\n"+this.getError()+"\u2026 \x3ca href\x3d'#' onclick\x3d\"window.open('').document.write(unescape('\x3cpre\x3e"+
escape(this.getDetails())+"\x3c/pre\x3e')); return false;\"\x3emore\x3c/a\x3e\x3c/p\x3e",title:this.localize("error"),buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,autoScroll:!0});Ext.Msg.show(a)}});Ext.define("Voyant.util.QuerySearchField",{extend:"Ext.form.field.Text",mixins:["Voyant.util.Localization"],alias:"widget.querysearchfield",statics:{i18n:{querySearch:{en:"Search"},querySearchTip:{en:"\x3cul\x3e\x3cli\x3e\x3cb\x3ecoat\x3c/b\x3e: match exact term \x3ci\x3ecoat\x3c/i\x3e\x3c/li\x3e\x3cli\x3e\x3cb\x3ecoat*\x3c/b\x3e: match terms that start with \x3ci\x3ecoat\x3c/i\x3e as one term\x3c/li\x3e\x3cli\x3e\x3cb\x3e^coat*\x3c/b\x3e: match terms that start with \x3ci\x3ecoat\x3c/i\x3e as separate terms (coat, coats, etc.)\x3c/li\x3e\x3cli\x3e\x3cb\x3ecoat,jacket\x3c/b\x3e: match each term separated by commas as separate terms\x3c/li\x3e\x3cli\x3e\x3cb\x3ecoat|jacket\x3c/b\x3e: match terms separate by pipe as a single term\x3c/li\x3e\x3cli\x3e\x3cb\x3e\x26quot;winter coat\x26quot;\x3c/b\x3e: \x3ci\x3ewinter coat\x3c/i\x3e as a phrase\x3c/li\x3e\x3cli\x3e\x3cb\x3e\x26quot;coat mittens\x26quot;~5\x3c/b\x3e: \x3ci\x3ecoat\x3c/i\x3e near \x3ci\x3emittens\x3c/i\x3e (within 5 words)\x3c/li\x3e\x3cli\x3e\x3cb\x3e^coat*,jacket|parka,\x26quot;coat mittens\x26quot;~5\x3c/b\x3e: combine syntaxes\x3c/li\x3e\x3c/ul\x3e"}}},
triggers:{clear:{weight:0,cls:Ext.baseCSSPrefix+"form-clear-trigger",hidden:!0,handler:"onClearClick",scope:"this"},search:{weight:1,cls:Ext.baseCSSPrefix+"form-search-trigger",handler:"onSearchClick",scope:"this"}},initComponent:function(){var a=this;Ext.apply(a,{listeners:{render:function(a){Ext.QuickTips.register({target:a.triggers.search.getEl(),text:a.localize("querySearchTip"),enabled:!0,showDelay:20,trackMouse:!0,autoShow:!0})},scope:a},labelWidth:50,fieldLabel:a.localize("querySearch"),width:"autoSize"});
a.callParent(arguments);a.on("specialkey",function(b,c){if(c.getKey()==c.ENTER)a.onSearchClick()})},onClearClick:function(){this.setValue("");this.findParentByType("panel").fireEvent("query",this,void 0);this.getTrigger("clear").hide();this.updateLayout()},onSearchClick:function(){var a=this.getValue();this.findParentByType("panel").fireEvent("query",this,a);a?this.getTrigger("clear").show():this.getTrigger("clear").hide();this.updateLayout()}});Ext.define("Voyant.util.ResponseError",{extend:"Voyant.util.DetailedError",config:{response:void 0},constructor:function(a){this.setResponse(a.response);Ext.applyIf(a,{msg:a.response.statusText,error:a.response.responseText.split(/(\r\n|\r|\n)/).shift(),details:a.response.responseText});this.callParent(arguments)}});Ext.define("Voyant.util.SparkLine",{getSparkLine:function(a,b){if(2>a.length)return"";for(var c=Number.MAX_VALUE,d=Number.MIN_VALUE,e=!1,g=0;g<a.length;g++)a[g]<c&&(c=a[g]),a[g]>d&&(d=a[g]),!e&&-1<a[g].toString().indexOf(".")&&(e=!0);var f=(d-c).toString(),h=1,h=1,l=[];if(e){h=100;for(g=f.indexOf(".")+1;g<f.length;g++)if("0"==f.charAt(g))h*=10;else break;for(g=0;g<a.length;g++)l[g]=parseInt(a[g]*h);d=parseInt(d*h);c=parseInt(c*h)}else{h=1;for(g=f.length-1;-1<g;g--)if("0"==f.charAt(g))h*=10;else break;
if(1!=h){for(g=0;g<a.length;g++)l[g]=a[g]/h;d/=h;c/=h}else l=a}var e=Math.floor(1800/((d.toString().length>c.toString().length?d.toString().length:c.toString().length)+1)),c="http://chart.apis.google.com/chart?cht\x3dls\x26amp;chco\x3d0077CC\x26amp;chls\x3d1,0,0\x26amp;chds\x3d"+c+","+d,d=Math.ceil(a.length/e),f=0,h="",m;m=5>a.length?5:10>a.length?4:20>a.length?3:50>a.length?2:1;for(g=0;g<d;g++){var k=l.slice(f,f+=e),h=h+("\x3cimg style\x3d'margin: 0; padding: 0;' border\x3d'0' src\x3d'"+c+"\x26amp;chs\x3d"+
m*k.length+"x15\x26amp;chd\x3dt:"+k.join(",")+"' alt\x3d'' class\x3d'chart-");1==d?h+="full":0<g&&g+1<d?h+"middle":h=0==g?h+"left":h+"right";h+="' /\x3e"}return h}});Ext.define("Voyant.util.Toolable",{requires:["Voyant.util.Localization"],statics:{i18n:{maximizeTip:{en:"Open this tool in a new window"},plusTip:{en:"Click to choose another tool for this panel location (this will replace the current tool)."},saveTip:{en:"Export a URL, an embeddable tool, data or a bibliographic reference."},gearTip:{en:"Define options for this tool."},helpTip:{en:'No tool-specific help is currently available. Click this icon to visit the \x3ca href\x3d"http://docs.voyant-tools.org/" target\x3d"_blank"\x3eVoyant Tools Documentation\x3c/a\x3e site.'},
exportTitle:{en:"Export"},exportViewUrl:{en:"a URL for this view (tools and data)"},exportViewFieldset:{en:"Export View (Tools and Data)"},exportViewHtmlEmbed:{en:"an HTML snippet for embedding this view in another web page"},exportViewHtmlEmbed:{en:"an HTML snippet for embedding this view in another web page"},exportViewEmbedTitle:{en:"Embed HTML Snippet"},exportViewEmbedMessage:{en:"You can copy and paste the HTML snippet from the box below into another web page. Note that some content management systems (like WordPress) may need a special plugin to handle \x26lt;iframe\x26gt; tags."},
exportBiblioTitle:{en:"Export Bibliographic Reference"},exportViewBiblio:{en:"a bibliographic reference for this view"},exportGridCurrent:{en:"Export Current Data"},exportGridCurrentHtml:{en:"export current data as HTML"},exportGridCurrentJson:{en:"export current data as JSON"},exportGridCurrentTsv:{en:"export current data as tab separated values (text)"},"export":{en:"Export"},exportTitle:{en:"Export"},confirmTitle:{en:"Confirm"},cancelTitle:{en:"Cancel"},exportError:{en:"Export Error"},exportNoFunction:{en:"An export function has been defined by is not availble."},
exportDataHtmlMessage:{en:"Copy the data below, they can be pasted into an HTML page or used as XML."},exportDataTsvMessage:{en:"Copy data below, they can be pasted into a spreadsheet or text file."},exportDataJsonMessage:{en:"Copy the data below, they can be used in other web-based applications."},exportPng:{en:"export a PNG image of this visualization"},exportDataTitle:{en:"Export Data"},exportVizTitle:{en:"Export Visualization"},exportPngTitle:{en:"Export PNG"},exportSvg:{en:"export the SVG of this visualization"},
exportPngMessage:{en:"\x3cp\x3eThis is a thumbnail of the PNG image, right-click or ctrl-click on the image to save a full-size copy on your hard drive.\x3c/p\x3e\x3cp\x3eAlternatively, copy the HTML code below.\x3c/p\x3e"},exportSvgTitle:{en:"Export SVG"},exportSvgMessage:{en:"\x3cp\x3eThis is a thumbnail of the SVG image, right-click or ctrl-click on the image to save a full-size copy on your hard drive.\x3c/p\x3e\x3cp\x3eAlternatively, copy the SVG code below.\x3c/p\x3e"}}},constructor:function(a){a=
a||{};var b=void 0,c=this.up("component");a.moreTools?(b=[],a.moreTools.forEach(function(a){a&&a!=this.xtype&&b.push(this.getMenuItemFromXtype(a))},this)):c&&c.getInitialConfig("moreTools")&&(b=[],c.getInitialConfig("moreTools").forEach(function(a){a&&a!=this.xtype&&b.push(this.getMenuItemFromXtype(a))},this));b&&this.getApplication().getMoreTools&&b.push("-");if(this.getApplication().getMoreTools){var b=b||[],d=this.getApplication(),c=d.getMoreTools();c.forEach(function(a){var c=[];a.items.forEach(function(a){var b=
[];a.items.forEach(function(a){b.push(this.getMenuItemFromXtype(a))},this);c.push({text:d.localize(a.i18n),glyph:a.glyph,menu:{items:b}})},this);b.push({text:d.localize(a.i18n),glyph:a.glyph,menu:{items:c}})},this)}var e={save:{glyph:"xf08e@FontAwesome",fn:this.exportToolClick,items:void 0},plus:b?{glyph:"xf17a@FontAwesome",items:b}:void 0,gear:this.showOptionsClick||this.getOptions?{glyph:"xf205@FontAwesome",fn:this.showOptionsClick?this.showOptionsClick:function(a){a.isXType("voyanttabpanel")&&
(a=a.getActiveTab());Ext.create("Ext.window.Window",{title:a.localize("exportTitle"),modal:!0,panel:a,items:{xtype:"form",items:a.getOptions(),buttons:[{text:a.localize("confirmTitle"),glyph:"xf00c@FontAwesome",flex:1,panel:a,handler:function(a){var b=a.up("form").getValues();this.setApiParams(b);var c=this.getApplication(),d=c.getCorpus();if(void 0!=b.stopList&&void 0!=b.stopListGlobal&&b.stopListGlobal){c.setApiParams&&c.setApiParams({stopList:b.stopList});for(var e=c.getViewport().query("panel,chart"),
f=0;f<e.length;f++)e[f].setApiParams&&e[f].setApiParams({stopList:b.stopList});d&&c.dispatchEvent("loadedCorpus",this,d)}else d&&this.fireEvent("loadedCorpus",this,d);a.up("window").close()},scope:a},{text:a.localize("cancelTitle"),glyph:"xf00d@FontAwesome",flex:1,handler:function(a){a.up("window").close()}}]},bodyPadding:5}).show()}}:void 0,help:{glyph:"xf128@FontAwesome",fn:this.helpToolClick}},c=[];if(a.includeTools)for(var g in a.includeTools)"object"==typeof a.includeTools[g]&&c.push(a.includeTools[g]);
for(g in e)a.includeTools&&!a.includeTools[g]||!e[g]||c.push({type:g,tooltip:this.localize(g+"Tip"),callback:e[g].fn,xtype:"toolmenu",glyph:e[g].glyph,items:e[g].items});Ext.apply(this,{tools:c});this.on("afterrender",function(){var a=this.getHeader();if(a){var b=a.getEl();b.on("mouseover",function(){this.getHeader().getTools().forEach(function(a){a.show()})},this);b.on("mouseout",function(){this.getHeader().getTools().forEach(function(a){"help"!=a.type&&-1==a.type.indexOf("collapse")&&a.hide()})},
this);a.getTools().forEach(function(a,b){"help"!=a.type&&a.hide()})}},this)},getMenuItemFromXtype:function(a){var b=this.getApplication().getToolConfigFromToolXtype(a);b&&b.tooltip&&delete b.tooltip;return Ext.apply(Ext.clone(b),{xtype:"menuitem",text:b.title,textAlign:"left",handler:function(){this.replacePanel(b.xtype)},scope:this})},maximizeToolClick:function(a){var b=Ext.getClass(a).getName().split(".");url=a.getBaseUrl()+"tool/"+b[b.length-1]+"/";params=a.getModifiedApiParams();!params.corpus&&
a.getCorpus&&a.getCorpus()&&(params.corpus=a.getCorpus().getId());params&&(url+="?"+Ext.Object.toQueryString(params));a.openUrl(url)},exportToolClick:function(a){a.isXType("voyanttabpanel")&&(a=a.getActiveTab());var b=[{xtype:"radio",name:"export",inputValue:"url",boxLabel:"\x3ca href\x3d'"+a.getExportUrl.call(a)+"' target\x3d'_blank'\x3e"+a.localize("exportViewUrl")+"\x3c/a\x3e",checked:!0,listeners:{afterrender:function(){this.boxLabelEl.on("click",function(){this.up("window").close()},this)}}},
{xtype:"fieldset",collapsible:!0,collapsed:!0,title:a.localize("exportViewFieldset"),items:[{xtype:"radio",name:"export",inputValue:"embed",boxLabel:a.localize("exportViewHtmlEmbed")},{xtype:"radio",name:"export",inputValue:"biblio",boxLabel:a.localize("exportViewBiblio")}]}];a.isXType("grid")&&b.push({xtype:"fieldset",collapsible:!0,collapsed:!0,title:a.localize("exportGridCurrent"),items:[{xtype:"radio",name:"export",inputValue:"gridCurrentHtml",boxLabel:a.localize("exportGridCurrentHtml")},{xtype:"radio",
name:"export",inputValue:"gridCurrentTsv",boxLabel:a.localize("exportGridCurrentTsv")},{xtype:"radio",name:"export",inputValue:"gridCurrentJson",boxLabel:a.localize("exportGridCurrentJson")}]});if((!a.getExportVisualization||a.getExportVisualization())&&(a.down("chart")||a.getTargetEl().dom.querySelector("canvas")||a.getTargetEl().dom.querySelector("svg"))){var c=[{xtype:"radio",name:"export",inputValue:"png",boxLabel:a.localize("exportPng")}];a.getTargetEl().dom.querySelector("svg")&&c.push({xtype:"radio",
name:"export",inputValue:"svg",boxLabel:a.localize("exportSvg")});b.push({xtype:"fieldset",collapsible:!0,collapsed:!0,title:a.localize("exportVizTitle"),items:c})}Ext.create("Ext.window.Window",{title:a.localize("exportTitle"),modal:!0,items:{xtype:"form",items:b,buttons:[{text:a.localize("exportTitle"),glyph:"xf08e@FontAwesome",flex:1,panel:a,handler:function(b){var c=b.up("form"),g="export"+Ext.String.capitalize(c.getValues()["export"]);Ext.isFunction(a[g])?a[g].call(a,a,c):Ext.Msg.show({title:a.localize("exportError"),
message:a.localize("exportNoFunction"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});b.up("window").close()},scope:a},{text:a.localize("cancelTitle"),glyph:"xf00d@FontAwesome",flex:1,handler:function(a){a.up("window").close()}}]},bodyPadding:5}).show()},exportSvg:function(a){if(a=this.getTargetEl().dom.querySelector("svg"))a=d3.select(a).attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML,Ext.Msg.show({title:this.localize("exportSvgTitle"),message:'\x3cimg src\x3d"data:image/svg+xml;base64,'+
btoa(a)+'" style\x3d"float: right; max-width: 200px; max-height: 200px; border: thin dotted #ccc;"/\x3e'+this.localize("exportSvgMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:a})},exportPngData:function(a){Ext.Msg.show({title:this.localize("exportPngTitle"),message:'\x3cimg src\x3d"'+a+'" style\x3d"float: right; max-width: 200px; max-height: 200px; border: thin dotted #ccc;"/\x3e'+this.localize("exportPngMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,
value:'\x3cimg src\x3d"'+a+'" /\x3e'})},exportPng:function(){var a;if(this.down("chart"))return this.exportPngData(this.down("chart").getImage().data);var b=this.getTargetEl().dom.querySelector("canvas");if(b)return this.exportPngData(b.toDataURL("image/png"));var c=this.getTargetEl().dom.querySelector("svg");if(c){var d=d3.select(c).attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;a="data:image/svg+xml;base64,"+btoa(d);var b=Ext.DomHelper.createDom({tag:"canvas",
width:c.offsetWidth,height:c.offsetHeight}),e=b.getContext("2d"),g=new Image;g.src=a;g.panel=this;g.onload=function(){e.drawImage(g,0,0);a=b.toDataURL("image/png");return this.panel.exportPngData.call(this.panel,a)}}},exportUrl:function(){this.openUrl(this.getExportUrl())},exportEmbed:function(){Ext.Msg.show({title:this.localize("exportViewEmbedTitle"),message:this.localize("exportViewEmbedMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:"\x3c!--\tExported from Voyant Tools: http://voyant-tools.org/.\nPlease note that this is an early version and the API may change.\nFeel free to change the height and width values below: --\x3e\n\x3ciframe style\x3d'width: 100%; height: 800px' src\x3d'"+
this.getExportUrl()+"'\x3e\x3c/iframe\x3e"})},exportBiblio:function(){var a=new Date;Ext.Msg.show({title:this.localize("exportBiblioTitle"),message:"\x3cfieldset\x3e\x3clegend\x3eMLA\x3c/legend\x3eSinclair, St\u00e9fan and Geoffrey Rockwell. "+(this.isXType("voyantheader")?"":'"'+this.localize("title")+'." ')+"\x3ci\x3eVoyant Tools\x3c/i\x3e. "+Ext.Date.format(a,"Y")+". Web. "+Ext.Date.format(a,"j M Y")+". \x26lt;http://voyant-tools.org\x26gt;.\x3c/fieldset\x3e\x3cbr \x3e\x3cfieldset\x3e\x3clegend\x3eChicago\x3c/legend\x3eSt\u00e9fan Sinclair and Geoffrey Rockwell, "+
(this.isXType("voyantheader")?"":'"'+this.localize("title")+'", ')+"\x3ci\x3eVoyant Tools\x3c/i\x3e, accessed "+Ext.Date.format(a,"F j, Y")+", http://voyant-tools.org.\x3c/fieldset\x3e\x3cbr \x3e\x3cfieldset\x3e\x3clegend\x3eAPA\x3c/legend\x3eSinclair, S. \x26amp; G. Rockwell. ("+Ext.Date.format(a,"Y")+"). "+(this.isXType("voyantheader")?"":this.localize("title")+". ")+"\x3ci\x3eVoyant Tools\x3c/i\x3e. Retrieved "+Ext.Date.format(a,"F j, Y")+", from http://voyant-tools.org\x3c/fieldset\x3e",buttons:Ext.Msg.OK,
icon:Ext.Msg.INFO})},exportGridCurrentJson:function(a,b){function c(a){var b={};e.forEach(function(c){b[c.text]=a.get(c.dataIndex)});values.push(b)}var d=a.getStore();d.getFields();var e=a.getColumnManager().headerCt.getVisibleGridColumns();values=[];d.buffered?d.data.forEach(c):d.each(c);Ext.Msg.show({title:this.localize("exportDataTitle"),message:this.localize("exportDataJsonMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:Ext.encode(values)})},exportGridCurrentTsv:function(a,
b){function c(a){cells=[];g.forEach(function(b){b=a.get(b.dataIndex);Ext.isString(b)&&(b=b.replace(/\s+/g," "));cells.push(b)});f+=cells.join("\t")+"\n"}var d=a.getStore(),e=d.getFields(),g=a.getColumnManager().headerCt.getVisibleGridColumns(),e=[];g.forEach(function(a){e.push(a.text)});var f=e.join("\t")+"\n";d.buffered?d.data.forEach(c):d.each(c);Ext.Msg.show({title:this.localize("exportDataTitle"),message:this.localize("exportDataTsvMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,
value:f})},exportGridCurrentHtml:function(a,b){function c(a){e+="\t\t\x3ctr\x3e\n";g.forEach(function(b){b=a.get(b.dataIndex);Ext.isString(b)&&(b=b.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26lg;"));e+="\t\t\t\x3ctd\x3e"+b+"\x3c/td\x3e\n"});e+="\t\t\x3c/tr\x3e\n"}var d=a.getStore();d.getFields();var e="\x3ctable\x3e\n\t\x3cthead\x3e\n\t\t\x3ctr\x3e\n",g=a.getColumnManager().headerCt.getVisibleGridColumns();g.forEach(function(a){e+="\t\t\t\x3ctd\x3e"+a.text+"\x3c/td\x3e\n"});
e+="\t\t\x3c/tr\x3e\n\t\x3c/thead\x3e\n\t\x3ctbody\x3e\n";d.buffered?d.data.forEach(c):d.each(c);e+="\t\x3c/tbody\x3e\n\x3c/table\x3e";Ext.Msg.show({title:this.localize("exportDataTitle"),message:this.localize("exportDataHtmlMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:e})},getExportUrl:function(){var a=this.getModifiedApiParams();this.isXType("voyantheader")||(a.view=Ext.getClassName(this).split(".").pop());return this.getApplication().getBaseUrl()+"?corpus\x3d"+this.getApplication().getCorpus().getId()+
"\x26"+Ext.Object.toQueryString(a)},helpToolClick:function(a){a.isXType("voyanttabpanel")&&(a=a.getActiveTab());var b=a.localize("help",{"default":!1})||a.localize("helpTip");b==a._localizeClass(Ext.ClassManager.get("Voyant.util.Toolable"),"helpTip")?a.openUrl("http://docs.voyant-tools.org/"):Ext.Msg.alert(a.localize("title"),b)},replacePanel:function(a){var b=this.getApplication().getCorpus();this.getInitialConfig();var c;this.isXType("voyantheader")&&this.getApplication().getViewComponent?(c=this.getApplication().getViewComponent(),
c.removeAll(!0),a=c.add({xtype:a}),b&&this.getApplication().dispatchEvent("loadedCorpus",c,b)):(c=this.isXType("voyantheader")&&this.getApplication().getViewComponent?this.getApplication().getViewComponent():this.up("component"),c.remove(this,!0),a=c.add({xtype:a}),c.isXType("voyanttabpanel")&&c.setActiveTab(a),b&&a.fireEvent("loadedCorpus",a,b))}});
Ext.define("Voyant.util.ToolMenu",{extend:"Ext.panel.Tool",alias:"widget.toolmenu",renderTpl:['\x3cdiv class\x3d"x-menu-tool-hover"\x3e\x3c/div\x3e\x3ctpl if\x3d"glyph"\x3e\x3cspan id\x3d"{id}-toolEl" class\x3d"{baseCls}-glyph {childElCls}" role\x3d"presentation" style\x3d"font-family: {glyphFontFamily}"\x3e\x26#{glyph}\x3c/span\x3e\x3ctpl else\x3e\x3cimg id\x3d"{id}-toolEl" src\x3d"{blank}" class\x3d"{baseCls}-img {baseCls}-{type}{childElCls}" role\x3d"presentation"/\x3e\x3c/tpl\x3e'],privates:{onClick:function(){var a=
this.callParent(arguments);a&&this.items&&(this.toolMenu||(this.toolMenu=new Ext.menu.Menu({items:this.items})),this.toolMenu.showAt(0,0),this.toolMenu.showAt(this.getX()+this.getWidth()-this.toolMenu.getWidth(),this.getY()+this.getHeight()+10));return a},onDestroy:function(){Ext.destroyMembers(this,"toolMenu");this.callParent()}},initComponent:function(){this.callParent(arguments);var a,b;a=this.glyph||"xf12e@FontAwesome";"string"===typeof a?(b=a.split("@"),a=b[0],b=b[1]):b="FontAwesome";Ext.applyIf(this.renderData,
{baseCls:this.baseCls,blank:Ext.BLANK_IMAGE_URL,type:this.type,glyph:a,glyphFontFamily:b})}});Ext.define("Voyant.util.Transferable",{transferable:["transfer"],transfer:function(a,b){if(a.transferable)for(var c=0;c<a.transferable.length;c++){var d=a.transferable[c];b[d]=Ext.bind(a[d],b)}if(a.mixins)for(mixin in a.mixins)this.transfer(a.mixins[mixin],b)}});Ext.define("Voyant.util.Variants",{extend:"Ext.Base",constructor:function(a){this.variants=a;this.map={};this.variants.forEach(function(a,c){a.forEach(function(a){this.map[a]=c},this)},this)},getVariants:function(a){var b=[];Ext.isString(a)&&(a=[a]);Ext.isArray(a)&&a.forEach(function(a){void 0!=this.map[a]&&b.push.apply(b,this.variants[this.map[a]])},this);return b}});Ext.define("Voyant.data.model.AnalysisToken",{extend:"Ext.data.Model",idProperty:"term",fields:[{name:"term"},{name:"rawFreq",type:"int"},{name:"relativeFreq",type:"number"},{name:"cluster",type:"int"},{name:"clusterCenter",type:"boolean"},{name:"vector"}]});Ext.define("Voyant.data.model.Context",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"docIndex",type:"int"},{name:"docId"},{name:"left"},{name:"keyword"},{name:"term"},{name:"right"}]});Ext.define("Voyant.data.model.CorpusCollocate",{extend:"Ext.data.Model",fields:[{name:"term"},{name:"rawFreq",type:"int"},{name:"contextTerm"},{name:"contextTermRawFreq",type:"int"}],getTerm:function(){return this.getKeyword()},getRawFreq:function(){return this.getKeywordRawFreq()},getKeyword:function(){return this.get("term")},getKeywordRawFreq:function(){return this.get("rawFreq")},getContextTerm:function(){return this.get("contextTerm")},getContextTermRawFreq:function(){return this.get("contextTermRawFreq")}});Ext.define("Voyant.data.model.CorpusTerm",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"rawFreq",type:"int"},{name:"relativeFreq",type:"float"},{name:"relativePeakedness",type:"float"},{name:"relativeSkewness",type:"float"},{name:"distributions"},{name:"typeTokenRatio-lexical",type:"float",calculate:function(a){return a["typesCount-lexical"]/a["tokensCount-lexical"]}}],getTerm:function(){return this.get("term")}});Ext.define("Voyant.data.model.Dimension",{extend:"Ext.data.Model",fields:[{name:"percentage",type:"number"}]});Ext.define("Voyant.data.model.Document",{extend:"Ext.data.Model",fields:[{name:"corpus"},{name:"id"},{name:"index",type:"int"},{name:"tokensCount-lexical",type:"int"},{name:"typesCount-lexical",type:"int"},{name:"typeTokenRatio-lexical",type:"float",calculate:function(a){return a["typesCount-lexical"]/a["tokensCount-lexical"]}},{name:"title"},{name:"shortTitle",mapping:function(a){a=a.title||"";a=a.replace(/\.(html?|txt|xml|docx?|pdf|rtf|\/)$/,"");if(25<a.length){var b=a.lastIndexOf("/");-1<b&&(a=
a.substr(b+1));if(25<a.length){b=a.indexOf(" ",20);if(0>b||30<b)b=25;a=a.substring(0,b)+"\x26hellip;;"}}return a}},{name:"language",convert:function(a){return Ext.isEmpty(a)?"":a}}],getDocumentTerms:function(a){a=a||{};Ext.apply(a,{docId:this.get("id")});return this.get("corpus").getDocumentTerms(a)},getIndex:function(){return this.get("index")},getFullLabel:function(){return this.getTitle()},getTitle:function(){return this.get("title")},getShortTitle:function(){return this.get("shortTitle")},getCorpusId:function(){return this.get("corpus")},
isPlainText:function(){return this.get("extra.Content-Type")&&/plain/i.test(this.get("extra.Content-Type"))?!0:!1}});Ext.define("Voyant.data.model.DocumentQueryMatch",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"count",type:"int"},{name:"query"},{name:"distributions"}],getCount:function(){return this.get("count")},getDistributions:function(){return this.get("distributions")}});Ext.define("Voyant.data.model.DocumentTerm",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"term"},{name:"docIndex",type:"int"},{name:"docId"},{name:"rawFreq",type:"int"},{name:"relativeFreq",type:"float"},{name:"tfidf",type:"float"},{name:"zscore",type:"float"},{name:"zscoreRatio",type:"float"},{name:"distributions"}],getTerm:function(){return this.get("term")},getDocIndex:function(){return this.get("docIndex")}});Ext.define("Voyant.data.model.PrincipalComponent",{extend:"Ext.data.Model",fields:[{name:"eigenValue",type:"number"},{name:"eigenVectors"}]});Ext.define("Voyant.data.model.StatisticalAnalysis",{extend:"Ext.data.Model",requires:["Voyant.data.model.PrincipalComponent","Voyant.data.model.Dimension","Voyant.data.model.AnalysisToken"],fields:[{name:"id"}],getPrincipalComponents:function(){var a=[];this.data.principalComponents.forEach(function(b){a.push(Ext.create("Voyant.data.model.PrincipalComponent",b))});return a},getDimensions:function(){var a=[];this.data.dimensions.forEach(function(b){a.push(Ext.create("Voyant.data.model.Dimension",b))});
return a},getTokens:function(){var a=[];this.data.tokens.forEach(function(b){a.push(Ext.create("Voyant.data.model.AnalysisToken",b))});return a}});Ext.define("Voyant.data.model.Token",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"docId"},{name:"docIndex",type:"int"},{name:"token"},{name:"rawFreq"},{name:"tokenType"},{name:"position",type:"int"},{name:"startOffset",type:"int"},{name:"endOffset",type:"int"}],statics:{getInfoFromElement:function(a){if(a&&a.getId)return a=a.getId().split("_"),{docIndex:a[1],position:a[2]}}},isWord:function(){return"lexical"==this.getTokenType()},getTokenType:function(){return this.get("tokenType")},getId:function(){return["",
this.getDocIndex(),this.getPosition()].join("_")},getDocIndex:function(){return this.get("docIndex")},getDocId:function(){return this.get("docId")},getTerm:function(){return this.get("term")},getTermWithLineSpacing:function(a){var b=this.getTerm().replace(/<\/?\w+\b.*?>/g,"\x3cbr /\x3e\x3cbr /\x3e").replace(/>\s+</g,"\x3e\x3c").replace(/<br \/><br \/>(<br \/>)+/g,"\x3cbr /\x3e\x3cbr /\x3e");a&&(b=b.replace(/(\r\n|\r|\n)\s*/g,"\x3cbr /\x3e"));return b},getPosition:function(){return this.get("position")},
getDocumentRawFreq:function(){return this.get("rawFreq")}});Ext.define("Voyant.data.store.CAAnalysis",{extend:"Ext.data.Store",model:"Voyant.data.model.StatisticalAnalysis",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.CA",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,withDistributions:!0},reader:{type:"json",rootProperty:"correspondenceAnalysis",totalProperty:"correspondenceAnalysis.totalTypes"},simpleSortMode:!0}});this.callParent([a])},
setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.Contexts",{extend:"Ext.data.Store",model:"Voyant.data.model.Context",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentContexts",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,stripTags:a.stripTags},reader:{type:"json",rootProperty:"documentContexts.contexts"},simpleSortMode:!0}});this.callParent([a])},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",
Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.CorpusCollocates",{extend:"Ext.data.BufferedStore",model:"Voyant.data.model.CorpusCollocate",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,autoLoad:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.CorpusCollocates",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"corpusCollocates.collocates",
totalPropery:"corpusCollocates.total"},simpleSortMode:!0},reader:{type:"json",rootProperty:"corpusCollocates.collocates",totalPropery:"corpusCollocates.total"}});this.callParent([a])},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.proxy.CorpusTerms",{extend:"Ext.data.proxy.Ajax",constructor:function(a){a=a||{};Ext.apply(a,{extraParams:Ext.apply(a.extraParams||{},{tool:"corpus.CorpusTerms"})});Ext.applyIf(a,{url:Voyant.application.getTromboneUrl()});this.callParent([a])},reader:{type:"json",rootProperty:"corpusTerms.terms",totalProperty:"corpusTerms.total"},simpleSortMode:!0});
Ext.define("Voyant.data.store.CorpusTerms",{extend:"Ext.data.BufferedStore",model:"Voyant.data.model.CorpusTerm",transferable:["setCorpus"],config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,autoLoad:!1,proxy:Ext.create("Voyant.data.proxy.CorpusTerms")});this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),c=this;a.corpus.then(function(a){c.setCorpus(a);c.getAutoLoad()?
c.load({callback:function(){b.resolve(c)}}):b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.DocumentQueryMatches",{extend:"Ext.data.Store",model:"Voyant.data.model.DocumentQueryMatch",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{autoLoad:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsFinder",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"documentsFinder.queries"}}});this.callParent([a]);a&&a.corpus&&this.setCorpus(a.corpus)},
setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.DocumentTerms",{extend:"Ext.data.BufferedStore",model:"Voyant.data.model.DocumentTerm",transferable:["setCorpus"],config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"documentTerms.terms",
totalProperty:"documentTerms.total"},simpleSortMode:!0}});this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),c=this;a.corpus.then(function(a){c.setCorpus(a);b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},setCorpus:function(a){a&&(this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId()),this.load());this.callParent(arguments)}});Ext.define("Voyant.data.store.Documents",{extend:"Ext.data.BufferedStore",model:"Voyant.data.model.Document",config:{corpus:void 0},statics:{i18n:{failedGetDocuments:{en:"Failed attempt to get documents."}}},sorters:{property:"index",direction:"ASC"},remoteSort:!0,constructor:function(a){Ext.apply(a,{pagePurgeCount:0,pageSize:1E3,leadingBufferZone:100,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsMetadata",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:
a.corpus.getId():void 0},reader:{type:"json",rootProperty:"documentsMetadata.documents",totalProperty:"documentsMetadata.total"},simpleSortMode:!0},listeners:{load:function(a,b,c,f){if(c){var h=a.getCorpus();b.forEach(function(a){a.set("corpus",h)})}}}});this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),c=this;a.corpus.then(function(a){c.setCorpus(a);b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},setCorpus:function(a){a&&
this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)},getDocument:function(a){if(this.getCorpus().getDocumentsCount()!=this.getTotalCount()){var b=Voyant.application.getDeferred();this.load({scope:this,callback:function(c,d,e){e?b.resolve(this.getDocument(a)):(Voyant.application.showResponseError(this.localize("failedGetDocuments"),response),b.reject())}});return b.promise()}return Ext.isNumber(a)?this.getAt(a):this.getById(a)}});Ext.define("Voyant.data.store.PCAAnalysis",{extend:"Ext.data.Store",model:"Voyant.data.model.StatisticalAnalysis",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.PCA",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,withDistributions:!0},reader:{type:"json",rootProperty:"pcaAnalysis",totalProperty:"pcaAnalysis.totalTypes"},simpleSortMode:!0}});this.callParent([a])},setCorpus:function(a){a&&
this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.Tokens",{extend:"Ext.data.Store",model:"Voyant.data.model.Token",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTokens",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,stripTags:a.stripTags},reader:{type:"json",rootProperty:"documentTokens.tokens",totalProperty:"documentTokens.total"},simpleSortMode:!0}});this.callParent([a])},setCorpus:function(a){a&&
this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});var Corpus=function(a,b){return Ext.create("Voyant.data.model.Corpus",a,b)};
Ext.define("Voyant.data.model.Corpus",{alternateClassName:["Corpus"],mixins:["Voyant.util.Localization"],transferable:"show getSize getId getDocument getDocuments getCorpusTerms getDocumentsCount getWordTokensCount getWordTypesCount getDocumentTerms".split(" "),requires:["Voyant.util.ResponseError","Voyant.data.store.CorpusTerms","Voyant.data.store.Documents"],extend:"Ext.data.Model",config:{documentsStore:void 0},statics:{i18n:{failedCreateCorpus:{en:"Failed attempt to create a Corpus."},thisCorpus:{en:"This corpus"},
isEmpty:{en:"is empty"},hasNdocuments:{en:new Ext.Template("has {count} documents")},has1document:{en:"has 1 document"},widthNwordsAndNTypes:{en:new Ext.Template("with {words} \x3cspan class\x3d'info-tip' data-qtip\x3d'every occurrence of every word (like multiple occurrences of \"the\") is counted'\x3etotal words\x3c/span\x3e and {types} \x3cspan class\x3d'info-tip' data-qtip\x3d'multiple occurrences of words (like \"the\") are counted once'\x3eunique word forms\x3c/span\x3e")},yearAgo:{en:new Ext.Template("about a year ago")},
yearsAgo:{en:new Ext.Template("about {count} years ago")},monthAgo:{en:new Ext.Template("about a month ago")},monthsAgo:{en:new Ext.Template("about {count} months ago")},dayAgo:{en:new Ext.Template("about a day ago")},daysAgo:{en:new Ext.Template("about {count} days ago")},hourAgo:{en:new Ext.Template("about an hour ago")},hoursAgo:{en:new Ext.Template("about {count} hours ago")},minuteAgo:{en:new Ext.Template("about a minute ago")},minutesAgo:{en:new Ext.Template("about {count} minutes ago")},secondAgo:{en:new Ext.Template("about a second ago")},
secondsAgo:{en:new Ext.Template("{count} seconds ago")},now:{en:"now"}}},fields:[{name:"documentsCount",type:"int"},{name:"lexicalTokensCount",type:"int"},{name:"lexicalTypesCount",type:"int"},{name:"createdTime",type:"int"},{name:"createdDate",type:"date",dateFormat:"c"}],constructor:function(a,b){this.callParent([b]);if(a){b=b||{};Ext.apply(b,{tool:"corpus.CorpusMetadata"});Ext.isString(a)||Ext.isArray(a)?b.input=a:Ext.isObject(a)&&Ext.apply(b,a);var c=Voyant.application.getDeferred(this),d=this;
$.ajax({type:"POST",url:Voyant.application.getTromboneUrl(),data:b,dataType:"json"}).done(function(a){d.set(a.corpus.metadata);a=Ext.create("Voyant.data.store.Documents",{corpus:d});d.setDocumentsStore(a);a.load({params:{limit:1E3},callback:function(a,b,e){d.setDocumentsStore(this);c.resolve(d)},scope:a})}).fail(function(a){Voyant.application.showResponseError(d.localize("failedCreateCorpus"),a);c.reject()});return Voyant.application.getPromiseFromDeferred(c)}},getId:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,
arguments):this.get("id")},getCorpusTerms:function(a){return Ext.create("Voyant.data.store.CorpusTerms",Ext.apply(a||{},{corpus:this}))},getCorpusCollocates:function(a){return Ext.create("Voyant.data.store.CorpusCollocates",Ext.apply(a||{},{corpus:this}))},getDocumentQueryMatches:function(a){return Ext.create("Voyant.data.store.DocumentQueryMatches",Ext.apply(a||{},{corpus:this}))},getDocumentTerms:function(a){return Ext.create("Voyant.data.store.DocumentTerms",Ext.apply(a||{},{corpus:this}))},getDocuments:function(a){return this.getDocumentsStore()?
this.getDocumentsStore():Ext.create("Voyant.data.store.Documents",Ext.apply(a||{},{corpus:this}))},getDocument:function(a){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.getDocumentsStore().getDocument(a)},getDocumentsCount:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("documentsCount")},getWordTokensCount:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("lexicalTokensCount")},
getWordTypesCount:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("lexicalTypesCount")},getCreatedTime:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("createdTime")},show:function(a){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.getShow().show()},getShow:function(a){if(this.then)return Voyant.application.getDeferredNestedPromise(this,arguments);var b=this.getDocumentsCount(),
c=this.localize("thisCorpus");if(0==b)c+=" "+this.localize("isEmpty")+".";else{var c=c+" ",c=1<b?c+this.localize("hasNdocuments",{count:Ext.util.Format.number(b,"0,000")}):c+this.localize("has1document"),c=c+(" "+this.localize("widthNwordsAndNTypes",{words:Ext.util.Format.number(this.getWordTokensCount(),"0,000"),types:Ext.util.Format.number(this.getWordTypesCount(),"0,000")})+"."),c=c+" Created ",d=this.get("createdDate"),e=new Date;!0===Ext.Array.each([["year",Ext.Date.YEAR],["month",Ext.Date.MONTH],
["day",Ext.Date.DAY],["hour",Ext.Date.HOUR],["minute",Ext.Date.MINUTE],["second",Ext.Date.SECOND]],function(a){if(Ext.Date.diff(d,e,a[1])>("second"==a[0]?1:0)){var b=Ext.Date.diff(d,e,a[1]);c+="\x3cspan class\x3d'info-tip' data-qtip\x3d'"+Ext.Date.format(d,"Y-m-d, H:i:s")+"'\x3e";c=1==b?c+this.localize(a[0]+"Ago",{count:b,date:d}):c+this.localize(a[0]+"sAgo",{count:b,date:d});c+="\x3c/span\x3e";return!1}},this)&&(c+=this.localize("now"));c+=".";c+=""}return c}});Ext.define("Voyant.widget.StopListOption",{extend:"Ext.container.Container",mixins:["Voyant.util.Localization"],alias:"widget.stoplistoption",layout:"hbox",statics:{i18n:{label:{en:"Stopwords:"},editList:{en:"Edit List"},noEditAutoTitle:{en:"Edit Stoplist Error"},noEditAutoMessage:{en:'The auto-detected stoplist cannot be edited, please select a specifc stoplist such as the "New User-Defined List".'},auto:{en:"Auto-detect"},"new":{en:"New User-Defined List"},en:{en:"English"},de:{en:"German"},es:{en:"Spanish"},
fr:{en:"French"},hu:{en:"Hungarian"},it:{en:"Italian"},no:{en:"Norwegian"},se:{en:"Swedish"},mu:{en:"Multilingual"},ok:{en:"Save"},cancel:{en:"Cancel"},editStopListTitle:{en:"Edit Stoplist"},editStopListMessage:{en:"This is the stoplist, one term per line."},applyGlobally:{en:"apply globally"}}},initComponent:function(a){var b=this.up("window").panel.getApiParam("stopList"),c=[{name:this.localize("en"),value:"stop.en.taporware.txt"},{name:this.localize("de"),value:"stop.de.german.txt"},{name:this.localize("es"),
value:"stop.es.spanish.txt"},{name:this.localize("fr"),value:"stop.fr.veronis.txt"},{name:this.localize("hu"),value:"stop.hu.hungarian.txt"},{name:this.localize("it"),value:"stop.it.italian.txt"},{name:this.localize("no"),value:"stop.no.norwegian.txt"},{name:this.localize("se"),value:"stop.se.swedish-long.txt"},{name:this.localize("mu"),value:"stop.mu.multi.txt"}];c.sort(function(a,b){return a.name<b.name?-1:1});c.splice(0,0,{name:this.localize("auto"),value:"auto"},{name:this.localize("new"),value:"new"});
Ext.apply(this,{items:[{xtype:"combo",queryMode:"local",value:b,triggerAction:"all",editable:!0,fieldLabel:this.localize("label"),labelAlign:"right",name:"stopList",displayField:"name",valueField:"value",store:{fields:["name","value"],data:c}},{width:10},{xtype:"tbspacer"},{xtype:"button",text:this.localize("editList"),handler:this.editList,scope:this},{width:10},{xtype:"checkbox",name:"stopListGlobal",checked:!0,boxLabel:this.localize("applyGlobally")}]});this.callParent(arguments)},editList:function(){var a=
this.up("window").panel,b=this.down("combo").getValue(),c=a.getApplication&&a.getApplication().getCorpus?a.getApplication().getCorpus().getId():void 0;"auto"!=b||c?Ext.Ajax.request({url:a.getTromboneUrl(),params:{tool:"resource.KeywordsManager",stopList:b,corpus:c},success:function(b){b=Ext.util.JSON.decode(b.responseText).keywords.keywords.sort().join("\n");Ext.Msg.show({title:this.localize("editStopListTitle"),message:this.localize("editStopListMessage"),buttons:Ext.Msg.OKCANCEL,buttonText:{ok:this.localize("ok"),
cancel:this.localize("cancel")},icon:Ext.Msg.INFO,prompt:!0,multiline:!0,value:b,original:b,fn:function(b,d,f){"ok"==b&&f.original!=d&&(b=this.down("combo"),0==Ext.String.trim(d).length?b.setValue("empty"):Ext.Ajax.request({url:a.getTromboneUrl(),params:{tool:"resource.StoredResource",storeResource:d,corpus:c},combo:b,success:function(a,b){var c=Ext.util.JSON.decode(a.responseText),d=b.combo.getStore(),c="keywords-"+c.storedResource.id;d.add({name:"Added "+Ext.Date.format(new Date,"M j, g:i:s a"),
value:c});b.combo.setValue(c);b.combo.updateLayout()},scope:this}))},scope:this})},scope:this}):Ext.Msg.show({title:this.localize("noEditAutoTitle"),message:this.localize("noEditAutoMessage"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}});Ext.define("Voyant.panel.Panel",{mixins:"Voyant.util.Localization Voyant.util.Api Voyant.util.Toolable Voyant.util.DetailedError Voyant.util.QuerySearchField Voyant.widget.StopListOption".split(" "),statics:{i18n:{term:{en:"Term"},rawFreq:{en:"Count"},relativeFreq:{en:"Relative"},trend:{en:"Trend"},colon:{en:": "},loading:{en:"Loading"}}},constructor:function(a){this.mixins["Voyant.util.Api"].constructor.apply(this,arguments);this.mixins["Voyant.util.Toolable"].constructor.apply(this,arguments);this.glyph||
(this.glyph=Ext.ClassManager.getClass(this).glyph)},getApplication:function(){return Voyant.application},getBaseUrl:function(){return this.getApplication().getBaseUrl()},openUrl:function(a){window.open(a)||Ext.Msg.show({title:"Popup Blocked",buttonText:{ok:"Close"},icon:Ext.MessageBox.INFO,message:"A popup window was blocked. \x3ca href\x3d'"+a+"' target\x3d'_blank' class\x3d'link'\x3eClick here\x3c/a\x3e to open the new window.",buttons:Ext.Msg.OK})},getTromboneUrl:function(){return this.getApplication().getTromboneUrl()},
dispatchEvent:function(){var a=this.getApplication();a.dispatchEvent.apply(a,arguments)},showError:function(a){this.getApplication().showError.apply(this,arguments)}});Ext.define("Voyant.panel.Bubblelines",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.bubblelines",statics:{i18n:{title:{en:"Bubblelines"},type:{en:"Visualization"},findTerm:{en:"Find Term"},clearTerms:{en:"Clear Terms"},removeTerm:{en:"Remove Term"},showTerm:{en:"Show Term"},hideTerm:{en:"Hide Term"},granularity:{en:"Granularity"},separateLines:{en:"Separate Lines for Terms"},total:{en:"Total"},corpusTooSmall:{en:"The provided corpus is too small for this tool."},help:{en:"Bubblelines visualizes the frequency and repetition of  a term's use in a corpus. Each document in the corpus is represented as a horizontal line and divided into segments of equal lengths. Each term is represented as a bubble, the size of the bubble indicates its frequency in the corresponding segment of text. The larger the bubble's radius the more frequently the term occurs."},
adaptedFrom:{en:""}},api:{bins:50,query:null,stopList:"auto",docId:void 0,docIndex:void 0},glyph:"xf06e@FontAwesome"},config:{corpus:void 0,docTermStore:void 0,docStore:void 0},selectedDocs:void 0,processedDocs:new Ext.util.MixedCollection,bubblelines:null,termTpl:new Ext.XTemplate('\x3ctpl for\x3d"."\x3e','\x3cdiv class\x3d"term" style\x3d"color: rgb({color});float: left;padding: 3px;margin: 2px;"\x3e{term}\x3c/div\x3e',"\x3c/tpl\x3e"),termStore:new Ext.data.ArrayStore({fields:["term","color"],listeners:{load:function(a,
b,c,d){a=this.down("#termsView");for(c=0;c<b.length;c++)a.select(b[c],!0)},scope:this}}),constructor:function(){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.setCorpus(b);this.getDocStore().getProxy().setExtraParam("corpus",b.getId());this.getDocStore().load();this.getDocTermStore().getProxy().setExtraParam("corpus",b.getId())},this);this.on("query",function(a,
b){void 0!==b&&""!=b&&this.getDocTermsFromQuery(b)},this);this.on("termsClicked",function(a,b){if(a!==this){var c=[];b.forEach(function(a){a.term&&c.push(a.term)});this.getDocTermsFromQuery(c)}},this);this.on("documentTermsClicked",function(a,b){var c=[];b.forEach(function(a){a.getTerm()&&c.push(a.getTerm())});this.getDocTermsFromQuery(c)},this);this.down("#granularity").setValue(parseInt(this.getApiParam("bins")))},initComponent:function(){var a=Ext.create("Ext.data.Store",{model:"Voyant.data.model.Document",
autoLoad:!1,remoteSort:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsMetadata"},reader:{type:"json",rootProperty:"documentsMetadata.documents",totalProperty:"documentsMetadata.total"},simpleSortMode:!0},listeners:{load:function(a,c,d,e){this.processDocuments(c);this.processedDocs.each(function(a){this.bubblelines.addDocToCache(a)},this);this.loadFromCorpusTerms(this.getCorpus().getCorpusTerms({autoload:!1}))},scope:this}});this.setDocStore(a);a=Ext.create("Ext.data.Store",
{model:"Voyant.data.model.DocumentTerm",autoLoad:!1,remoteSort:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",withDistributions:"raw",withPositions:!0},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0},listeners:{load:function(a,c,d,e){c.forEach(function(a){var b=this.processTerms(a),c=a.get("docId");a=a.get("term");var d={};d[a]=b;this.bubblelines.addTermsToDoc(d,c)},this);this.bubblelines.doLayout()},
scope:this}});this.setDocTermStore(a);Ext.apply(this,{dockedItems:[{dock:"top",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"button",text:this.localize("clearTerms"),handler:function(){this.down("#termsView").getSelectionModel().deselectAll(!0);this.termStore.removeAll();this.setApiParams({query:null});this.bubblelines.removeAllTerms();this.bubblelines.drawGraph()},scope:this},,"-",{xtype:"slider",itemId:"granularity",fieldLabel:this.localize("granularity"),labelAlign:"right",labelWidth:70,
width:200,increment:10,minValue:10,maxValue:300,listeners:{changecomplete:function(a,c){this.setApiParams({bins:c});this.reloadTermsData()},scope:this}},"-",{xtype:"checkbox",boxLabel:this.localize("separateLines"),boxLabelAlign:"before",checked:!1,handler:function(a,c){this.bubblelines.SEPARATE_LINES_FOR_TERMS=c;this.bubblelines.lastClickedBubbles={};this.bubblelines.setCanvasHeight();this.bubblelines.drawGraph()},scope:this}]}],border:!1,layout:"fit",items:{layout:{type:"vbox",align:"stretch"},
defaults:{border:!1},items:[{height:30,itemId:"termsView",xtype:"dataview",store:this.termStore,tpl:this.termTpl,itemSelector:"div.term",overItemCls:"over",selectedItemCls:"selected",focusCls:"",listeners:{beforeitemclick:function(a,c,d,e,g,f){g.preventDefault();g.stopPropagation();a.fireEvent("itemcontextmenu",a,c,d,e,g,f);return!1},selectionchange:function(a,c){for(var d=this.down("#termsView"),e=[],g=d.el.query("div[class*\x3dterm]"),f=0;f<g.length;f++)Ext.fly(g[f]).addCls("unselected");var f;
for(f=0;f<c.length;f++)g=c[f],e.push(g.get("term")),Ext.fly(d.getNode(g)).removeCls("unselected");for(f in this.lastClickedBubbles)for(term in d=this.lastClickedBubbles[f],d)-1==e.indexOf(type)&&delete this.lastClickedBubbles[f][term];this.setApiParams({typeFilter:e});this.bubblelines.setCanvasHeight();this.bubblelines.drawGraph()},itemcontextmenu:function(a,c,d,e,g){g.preventDefault();g.stopPropagation();a.isSelected(d);(new Ext.menu.Menu({floating:!0,items:[{text:this.localize("removeTerm"),handler:function(){a.deselect(e);
var c=this.termStore.getAt(e).get("term");this.termStore.removeAt(e);a.refresh();this.bubblelines.removeTerm(c);this.bubblelines.setCanvasHeight();this.bubblelines.drawGraph()},scope:this}]})).showAt(g.getXY())},scope:this}},{flex:1,xtype:"container",autoEl:"div",itemId:"canvasParent",autoScroll:!0,style:"overflow-x: hidden !important;"}],listeners:{render:function(a){a=this.down("#canvasParent");this.bubblelines=new Bubblelines({container:a,clickHandler:this.bubbleClickHandler.bind(this)})},afterlayout:function(a){!1===
this.bubblelines.initialized&&this.bubblelines.initializeCanvas()},resize:function(a,c,d){this.bubblelines.doLayout()},scope:this}}});this.callParent(arguments)},loadFromCorpusTerms:function(a){a.load({callback:function(a,c,d){var e=this.getApiParam("query")||[];"string"==typeof e&&(e=[e]);a.forEach(function(a,b){e.push(a.get("term"))},this);this.getDocTermsFromQuery(e)},scope:this,params:{limit:5,stopList:"auto"}})},getDocTermsFromQuery:function(a){for(var b=this.getCorpus().getDocuments(),c=0,d=
b.getCount();c<d;c++){var e=b.getAt(c);this.setApiParams({query:a,docIndex:void 0,docId:e.getId()});this.getDocTermStore().load({params:this.getApiParams()})}},reloadTermsData:function(){var a=[],b;for(b in this.bubblelines.currentTerms)a.push(b);this.getDocTermsFromQuery(a)},filterDocuments:function(){var a=this.getApiParam("docId");""==a&&(a=[],this.getCorpus().getDocuments().each(function(b,c){a.push(b.getId())}),this.setApiParams({docId:a}));"string"==typeof a&&(a=[a]);if(null==a){this.selectedDocs=
this.getCorpus().getDocuments().clone();var b=this.selectedDocs.getCount();if(10<b)for(var c=10;c<b;c++)this.selectedDocs.removeAt(10);a=[];this.selectedDocs.eachKey(function(b,c){a.push(b)},this);this.setApiParams({docId:a})}else this.selectedDocs=this.getCorpus().getDocuments().filterBy(function(b,c){return-1!=a.indexOf(c)},this)},processDocuments:function(a){a.forEach(this.processDocument,this)},processDocument:function(a){var b=a.getId();if(!this.processedDocs.containsKey(b)){var c=a.getShortTitle(),
c=c.replace("\x26hellip;","..."),d=a.get("index");a=a.get("tokensCount-lexical");this.processedDocs.add(b,{id:b,index:d,title:c,totalTokens:a,terms:{}})}},processTerms:function(a){var b,c=a.get("term");b=a.get("rawFreq");var d=a.get("positions");if(0<b){var e=this.getApplication().getColorForTerm(c);-1===this.termStore.find("term",c)&&this.termStore.loadData([[c,e]],!0);a=a.get("distributions");b={positions:d,distributions:a,rawFreq:b,color:e}}else b=!1;return b},bubbleClickHandler:function(a){this.getApplication().dispatchEvent("termsClicked",
this,a)}});Ext.define("Voyant.panel.Cirrus",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.cirrus",statics:{i18n:{title:{en:"Cirrus"},helpTip:{en:"\x3cp\x3eCirrus provides a wordcloud view of the most frequently occurring words in the corpus or document \u2013\u00a0this provides a convenient (though reductive) overview of the content. Features include\x3c/p\x3e\x3cul\x3e\x3cli\x3eterm frequency appears when hovering over words\x3c/li\x3e\x3cli\x3eclicking on terms may produce results in other tools if any are displayed\x3c/li\x3e\x3c/ul\x3e"},
reset:{en:"reset"}},api:{limit:50,terms:void 0,docId:void 0,docIndex:void 0},glyph:"xf06e@FontAwesome"},config:{mode:void 0,options:{xtype:"stoplistoption"},corpus:void 0},MODE_CORPUS:"corpus",MODE_DOCUMENT:"mode_document",layout:"fit",constructor:function(a){Ext.apply(this,{title:this.localize("title"),dockedItems:[{dock:"bottom",xtype:"toolbar",items:["-\x3e",{text:this.localize("reset"),hidden:!0,itemId:"reset",handler:function(a){a.hide();(a=this.getCorpus())&&this.loadFromCorpus(a)},scope:this}]}]});
this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);if(a.embedded){var b=Ext.getClass(a.embedded).getName();"Voyant.data.store.CorpusTerms"==b&&this.loadFromCorpusTerms(a.embedded);"Voyant.data.model.Corpus"==b&&this.loadFromCorpusTerms(a.embedded.getCorpusTerms())}},listeners:{resize:function(a,b,c){this.cirrus&&this.cirrus.resizeWords()},loadedCorpus:function(a,b){this.loadFromCorpus(b)},documentsClicked:function(a,b,c){b&&(this.setApiParam("docId",b[0].getId()),
this.loadFromDocumentTerms(b[0].getDocumentTerms({autoload:!1,corpus:c})))},ensureCorpusView:function(a,b){this.getMode()!=this.MODE_CORPUS&&this.loadFromCorpus(b)}},loadFromCorpus:function(a){this.setCorpus(a);this.setApiParams({docId:void 0,docIndex:void 0});this.loadFromCorpusTerms(a.getCorpusTerms({autoload:!1}))},loadFromDocumentTerms:function(a){a.load({callback:function(a,c,d){this.setMode(this.MODE_DOCUMENT);this.loadFromTermsRecords(a)},scope:this,params:this.getApiParams()});this.down("#reset").show()},
loadFromCorpusTerms:function(a){a.load({callback:function(a,c,d){this.setMode(this.MODE_CORPUS);this.loadFromTermsRecords(a)},scope:this,params:this.getApiParams()})},loadFromTermsRecords:function(a){var b=[];a.forEach(function(a){b.push({word:a.get("term"),size:a.get("rawFreq"),value:a.get("rawFreq")})});this.buildFromTerms(b)},buildFromTerms:function(a){if(this.rendered&&a){var b=this,c=this.getLayout().getRenderTarget();this.cirrus&&c.update("");this.cirrus=new Cirrus({containerId:this.getLayout().getRenderTarget().dom.id,
clickHandler:function(a){b.getApplication().dispatchEvent("termsClicked",b,[a])},words:a})}else Ext.defer(this.buidlFromTerms,50,this)}});Ext.define("Voyant.panel.CollocatesGraph",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.collocatesgraph",statics:{i18n:{title:{en:"Links"},helpTip:{en:"\x3cp\x3eCollocates graph shows a network graph of higher frequency terms that appear in proximity. Keywords are shown in blue and collocates (words in proximity) are showing in orange. Features include:\x3cul\x3e\x3cli\x3ehovering over keywords shows their frequency in the corpus\x3c/li\x3e\x3cli\x3ehovering over collocates shows their frequency in proximity (not their total frequency)\x3c/li\x3e\x3cli\x3edouble-clicking on any word fetches more results\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
clearTerms:{en:"clear terms"},releaseToRemove:{en:"Release to remove this term"},cleaning:{en:"Cleaning"}},api:{query:void 0,mode:void 0,limit:15,stopList:"auto",terms:void 0},glyph:"xf1cb@FontAwesome"},config:{corpus:void 0,node:void 0,link:void 0,nodes:void 0,links:void 0,force:void 0,graphHeight:void 0,graphWidth:void 0,corpusColours:d3.scale.category10()},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){Ext.apply(this,
{title:this.localize("title"),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"},{text:this.localize("clearTerms"),handler:function(){this.updateNodesAndLinks({},{})},scope:this}]}]});this.on("loadedCorpus",function(a,b){this.setCorpus(b);this.isVisible()&&this.initLoad()},this);this.on("activate",function(){this.getCorpus()&&Ext.Function.defer(this.initLoad,100,this)},this);
this.on("query",function(a,b){this.loadFromQuery(b)},this);this.on("resize",function(a,b,c){this.initGraph();this.updateNodesAndLinks()},this);this.mixins["Voyant.panel.Panel"].initComponent.apply(this,arguments);this.callParent(arguments)},initLoad:function(){this.getCorpus()&&(this.initGraph(),this.getCorpus().getCorpusTerms({leadingBufferZone:0,autoLoad:!1}).load({callback:function(a,b,c){c&&this.loadFromCorpusTermRecords(a)},scope:this,params:{limit:10,stopList:this.getApiParam("stopList")}}))},
loadFromQuery:function(a){var b=this.getCorpus().getCorpusCollocates({autoLoad:!1});this.setApiParams({query:a,mode:"corpus"});b.load({params:this.getApiParams(),callback:function(a,b,e){e&&this.loadFromCorpusCollocateRecords(a)},scope:this})},loadFromCorpusTermRecords:function(a){if(Ext.isArray(a)&&0<a.length){var b=[];a.forEach(function(a){b.push(a.getTerm())});this.loadFromCorpusTermStringsArray(b)}},loadFromCorpusTermStringsArray:function(a){var b=this.getCorpus().getCorpusCollocates({autoLoad:!1});
this.setApiParams({query:a,mode:"corpus"});b.load({params:this.getApiParams(),callback:function(a,b,e){e&&this.loadFromCorpusCollocateRecords(a)},scope:this})},loadFromCorpusCollocateRecords:function(a){if(Ext.isArray(a)){var b=this.getNodes()||{},c=this.getLinks()||{},d=this.getApiParam("limit");a.forEach(function(a){var g={term:a.getKeyword(),type:"keyword",value:a.getKeywordRawFreq(),start:d},f=[g.term,g.type].join(";");b[f]?b[f].value+=g.value:b[f]=g;g={term:a.getContextTerm(),type:"context",
value:a.getContextTermRawFreq(),start:0};a=[g.term,g.type].join(";");b[a]?b[a].value+=g.value:b[a]=g;g=[f,a].join("--");c[g]||(c[g]={source:b[f],target:b[a]})});this.updateNodesAndLinks(b,c)}},initGraph:function(){var a=this.getLayout().getRenderTarget();a.update("");var b=a.getHeight(),c=a.getWidth();this.setForce(d3.layout.force().nodes([]).links([]).charge(-50).linkDistance(120).size([c,b]).on("tick",function(){link.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",
function(a){return a.target.x}).attr("y2",function(a){return a.target.y});node.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}));a=d3.select(a.dom).append("svg").attr("width",c).attr("height",b);this.setGraphWidth(c);this.setGraphHeight(b);this.setNode(a.selectAll(".node"));this.setLink(a.selectAll(".link"))},start:function(){var a=this,b=this.getForce(),c=b.drag();c.on("dragstart",this.dragstart);c.on("drag",function(b){a.drag.call(a,b)});c.on("dragend",function(b){a.isOffCanvas(b)&&
(b.fixed=!1,d3.select(this).classed("fixed",!1));a.dragend.call(a,b)});link=this.getLink().data(b.links(),function(a){return a.source.term+a.source.type+"-"+a.target.term+a.source.type});link.enter().insert("line",".node").attr("class","link");link.exit().remove();this.setLink(link);node=this.getNode().data(b.nodes(),function(a){return a.term+a.type});var d=b.nodes().filter(function(a){return"keyword"==a.type}).map(function(a){return a.value}),e=b.nodes().filter(function(a){return"context"==a.type}).map(function(a){return a.value}),
g=[8,20],f=d3.scale.linear().domain([d3.min(d),d3.max(d)]).range(g),h=d3.scale.linear().domain([d3.min(e),d3.max(e)]).range(g),l=this.getCorpusColours();node.enter().append("text").attr("class",function(a){return"node "+a.type}).attr("text-anchor","middle").style("fill",function(a){return l("keyword"==a.type?1:2)}).attr("dx",12).attr("dy",".35em").text(function(a){return a.term}).style("font-size",function(a){return("context"==a.type?h(a.value):f(a.value))+"pt"}).on("dblclick",function(){a.dragstart.apply(this,
arguments);a.itemdblclick.apply(a,arguments)}).on("click",this.itemclick).on("mouseover",function(b){this.textContent=b.term+" ("+b.value+")";b.wasfixed=b.fixed;a.itemclick.apply(this,arguments)}).on("mouseout",function(a,b,c,d){this.textContent=a.term;d3.select(this).classed("fixed",a.fixed=a.wasfixed)}).call(c);node.exit().remove();this.setNode(node);b.start()},isOffCanvas:function(a){return 0>a.x||0>a.y||a.x>this.getGraphWidth()||a.y>this.getGraphHeight()},drag:function(a,b,c,d){this.isMasked()?
this.isOffCanvas(a)||this.unmask():this.isOffCanvas(a)&&this.mask(this.localize("releaseToRemove"))},dragstart:function(a){a.wasfixed=!0;d3.select(this).classed("fixed",a.fixed=!0)},dragend:function(a){this.isOffCanvas(a)&&(this.unmask(),this.mask("cleaning"),delete this.getNodes()[a.term+";"+a.type],this.prune(),this.updateNodesAndLinks(),this.unmask())},prune:function(){for(var a=this.getNodes()||{},b=this.getLinks()||{},c=Object.keys(this.getLinks()),d=[],e={},g=0,f=0,h=c.length;f<h;f++)parts=
c[f].split("--"),a[parts[0]]&&a[parts[1]]?(e[parts[0]]=!0,e[parts[1]]=!0):(delete b[c[f]],g++,d.push(parts[0],parts[1]));if(0<g){f=0;for(h=d.length;f<h;f++)e[d[f]]||delete a[d[f]];this.prune()}},itemclick:function(a){},itemdblclick:function(a){this.getCorpus().getCorpusCollocates({autoLoad:!1}).load({params:Ext.apply(this.getApiParams(),{query:a.term,start:a.start,limit:10}),callback:function(b,c,d){if(d){var e=this.getNodes()||{},g=this.getLinks()||{};this.getApiParam("limit");a.start+=10;var f=
[a.term,a.type].join(";");b.forEach(function(a){var b={term:a.getContextTerm(),type:"context",value:a.getContextTermRawFreq(),start:0};a=[b.term,b.type].join(";");e[a]?e[a].value+=b.value:e[a]=b;b=[f,a].join("--");g[b]||(g[b]={source:e[f],target:e[a]})});this.updateNodesAndLinks(e,g)}},scope:this})},updateNodesAndLinks:function(a,b){a=a||this.getNodes()||{};b=b||this.getLinks()||{};this.setNodes(a);this.setLinks(b);this.getForce().nodes($.map(a,function(a){return a}));this.getForce().links($.map(b,
function(a){return a}));this.start()}});Ext.define("Voyant.panel.Contexts",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],requires:["Voyant.data.store.Contexts"],alias:"widget.contexts",statics:{i18n:{title:{en:"Contexts"},helpTip:{en:"The Keywords in Context tool shows each occurrence of a keyword with a bit of surounding text (the context). It can be useful for studying more closely how terms are used in different contexts. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering document, by keyword or by left or right context\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
termTip:{en:"The keyword for the context."},left:{en:"Left"},leftTip:{en:"Context to the left of the keyword."},right:{en:"Right"},rightTip:{en:"Context to the right of the keyword."},context:{en:"context"}},api:{query:void 0,docId:void 0,docIndex:void 0,stopList:"auto",context:5},glyph:"xf0ce@FontAwesome"},constructor:function(){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){var a=this;Ext.apply(a,{title:this.localize("title"),
store:Ext.create("Voyant.data.store.Contexts",{stripTags:"all",remoteSort:!1,sortOnLoad:!0,sorters:{property:"position",direction:"ASC"}}),selModel:Ext.create("Ext.selection.RowModel",{listeners:{selectionchange:{fn:function(a,c){this.getApplication().dispatchEvent("termLocationClicked",this,c)},scope:this}}}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"},this.localize("context"),
{xtype:"slider",minValue:5,value:5,maxValue:50,increment:5,width:50,listeners:{render:function(b){b.setValue(a.getApiParam("context"))},dragend:function(b,c){a.setApiParam("context",b.getValue());a.getStore().loadPage(1,{params:a.getApiParams()})}}}]}],columns:[{text:"#",width:30,dataIndex:"docIndex",sortable:!0,renderer:function(a){return a+1}},{text:this.localize("left"),tooltip:this.localize("leftTip"),align:"right",dataIndex:"left",sortable:!0,flex:1},{text:this.localize("term"),tooltip:this.localize("termTip"),
dataIndex:"term",sortable:!0,width:"autoSize"},{text:this.localize("right"),tooltip:this.localize("rightTip"),dataIndex:"right",sortable:!0,flex:1}],listeners:{documentSegmentTermClicked:{fn:function(a,c){c.term&&(params={query:c.term},c.docId?params.docId=c.docId:params.docIndex=c.docIndex?c.docIndex:0,this.setApiParams(params),this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()}))},scope:this},documentIndexTermsClicked:{fn:function(a,c){var d={},e=[],g={},f=[];c.forEach(function(a){d[a.term]||
(e.push(a.term),d[a.term]=!0);g[a.docIndex]||(f.push(a.docIndex),g[a.docIndex]=!0)});this.setApiParams({docId:void 0,docIndex:f,query:e});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})},scope:this}}});a.on("loadedCorpus",function(b,c){this.getStore().setCorpus(c);this.getApiParam("query")?Ext.create("Voyant.data.store.CorpusTerms",{corpus:c}).load({callback:function(a,b,c){c&&0<a.length&&(this.setApiParam("query",a[0].getTerm()),this.getStore().load({params:this.getApiParams()}))},
scope:a,params:{limit:1,stopList:this.getApiParam("stopList")}}):this.getStore().load({params:this.getApiParams()})});a.on("query",function(a,c){this.setApiParam("query",c);this.getStore().load({params:this.getApiParams()})},a);a.on("documentTermsClicked",function(a,c){var d=[];c.forEach(function(a){d.push({term:a.getTerm(),docIndex:a.getDocIndex()})});this.fireEvent("documentIndexTermsClicked",this,d)});a.on("termsClicked",function(a,c){var d=[];Ext.isString(c)&&(c=[c]);c.forEach(function(a){void 0!==
a.docIndex&&d.push({term:a.term,docIndex:a.docIndex})});0<d.length&&this.fireEvent("documentIndexTermsClicked",this,d)});a.callParent(arguments)}});Ext.define("Voyant.panel.CorpusCollocates",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.corpuscollocates",config:{corpus:void 0},statics:{i18n:{title:{en:"Collocates"},helpTip:{en:"\x3cp\x3eCorpus Collocates is a table view of which terms appear more frequently in proximity to keywords across the entire corpus. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering by keyword, collocate word, collocate word count\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
term:{en:"Term"},termTip:{en:"This is the keyword term around which collocate (context) terms are counted."},termRawFreq:{en:"Count (keyword)"},termRawFreqTip:{en:"The number of times the keyword term occurs in the corpus."},contextTerm:{en:"Collocate"},contextTermTip:{en:"This is the collocate (context) term that occurs near the keyword term."},contextTermRawFreq:{en:"Count (context)"},contextTermRawFreqTip:{en:"The number of times this collocate occurs near the keyword term in the corpus."},matchingTerms:{en:"Matching terms: {count}"}},
api:{stopList:"auto",query:void 0,docId:void 0,docIndex:void 0},glyph:"xf0ce@FontAwesome"},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,c){this.getStore().setCorpus(c);this.isVisible()&&this.loadFromApis()});a.embedded||a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus);this.on("corpusTermsClicked",function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){d.push(a.get("term"))});
this.setApiParams({query:d,docId:void 0,docIndex:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})}});this.on("documentsClicked",function(a,c){var d=[];c.forEach(function(a){d.push(a.get("id"))});this.setApiParams({docId:d,docid:void 0,query:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})});this.on("activate",function(){this.getStore().getCorpus()&&this.loadFromApis()},this);this.on("query",function(a,c){this.setApiParam("query",
c);this.getStore().getProxy().setExtraParam("query",c);this.loadFromApis()},this)},loadFromApis:function(){this.getStore().getCorpus()&&(this.getApiParam("query")?this.getStore().loadPage(1,{params:this.getApiParams()}):this.getStore().getCorpus().getCorpusTerms({leadingBufferZone:0,autoLoad:!1}).load({callback:function(a,b,c){if(c){var d=[];a.forEach(function(a){d.push(a.getTerm())});this.getStore().getProxy().setExtraParam("query",d);this.setApiParam("query",d);this.loadFromApis()}},scope:this,
params:{limit:10,stopList:this.getApiParam("stopList")}}))},initComponent:function(){var a=Ext.create("Voyant.data.store.CorpusCollocates");a.on("totalcountchange",function(){this.down("#status").update({count:this.getStore().getTotalCount()})},this);Ext.apply(this,{title:this.localize("title"),store:a,selModel:Ext.create("Ext.selection.CheckboxModel",{listeners:{selectionchange:{fn:function(a,c){this.getApplication().dispatchEvent("documentTermsClicked",this,c)},scope:this}}}),dockedItems:[{dock:"bottom",
xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}],columns:[{text:this.localize("term"),dataIndex:"term",tooltip:this.localize("termTip"),sortable:!0,flex:1},{text:this.localize("rawFreq"),dataIndex:"rawFreq",tooltip:this.localize("termRawFreqTip"),sortable:!0,width:"autoSize",hidden:!0},{text:this.localize("contextTerm"),dataIndex:"contextTerm",tooltip:this.localize("contextTermTip"),flex:1,sortable:!0},
{text:this.localize("contextTermRawFreq"),tooltip:this.localize("contextTermRawFreqTip"),dataIndex:"contextTermRawFreq",width:"autoSize",sortable:!0}],listeners:{termsClicked:{fn:function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){a.term&&d.push(a.term)});d&&(this.setApiParams({docIndex:void 0,docId:void 0,query:d}),this.isVisible()&&this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()}))}},scope:this}}});this.callParent(arguments);this.getStore().getProxy().setExtraParam("withDistributions",
!0)}});Ext.define("Voyant.panel.CorpusCreator",{extend:"Ext.form.Panel",requires:["Ext.form.field.File"],requires:["Voyant.data.model.Corpus"],mixins:["Voyant.panel.Panel"],alias:"widget.corpuscreator",statics:{i18n:{title:{en:"Add Texts"},helpTip:{en:"This tool allows you to create a corpus in one of three ways:\x3col\x3e\x3cli\x3eby typing or pasting text into the text box and clicking \x3ci\x3eReveal\x3c/i\x3e; if each line in the text box is a URL, text is fetched from those URLs, otherwise the contents are treated as a single document\x3c/li\x3e\x3cli\x3eclick the \x3ci\x3eOpen\x3c/i\x3e button to open an existing corpus\x3c/li\x3e\x3cli\x3eclick the \x3ci\x3eUpload\x3c/i\x3e button to upload one or more files from you computer (you can select multiple files by using the Ctrl and/or Shift keys)\x3c/li\x3e\x3c/ul\x3e"},
gearTip:{en:"Options"},gearWinTitle:{en:"Options"},inputFormat:{en:"Input Format"},xpathDocuments:{en:"XPath to Documents"},xpathContent:{en:"XPath to Content"},xpathTitle:{en:"XPath to Title"},xpathAuthor:{en:"XPath to Author"},emptyInput:{en:"Type in one or more URLs on separate lines or paste in a full text."},uploadingCorpus:{en:"Uploading corpus\u2026"},fileTypesWarning:{en:"File Types Warning"},fileTypesMessage:{en:"You have one or more files with incompatible or unrecognized file extensions that may cause problems."},
badFiles:{en:"incompatible (likely error): "},unknownFiles:{en:"unrecognized (possible error): "},sureContinue:{en:"Are you sure you wish to continue?"},reveal:{en:"Reveal"},ok:{en:"OK"},cancel:{en:"Cancel"}},api:{inputFormat:void 0,xmlDocumentsXpath:void 0,xmlContentXpath:void 0,xmlTitleXpath:void 0,xmlAuthorXpath:void 0}},config:{},constructor:function(a){this.callParent(arguments);a=a||{};this.mixins["Voyant.panel.Panel"].constructor.call(this,Ext.apply(a,{includeTools:{gear:!0,help:!0}}))},initComponent:function(){var a=
this;Ext.apply(a,{title:this.localize("title"),width:800,frame:!0,padding:10,style:{borderColor:"#aaa",borderStyle:"solid"},frameHeader:!0,layout:{type:"vbox",align:"middle"},dockedItems:[{xtype:"toolbar",dock:"bottom",buttonAlign:"right",defaultButtonUI:"default",items:[{text:"Open",glyph:"xf115@FontAwesome",tooltip:"Select an exsting corpus",handler:function(){Ext.create("Ext.window.Window",{title:"Open an Existing Corpus",layout:"fit",modal:!0,items:{xtype:"form",margin:"5,5,5,5",items:{xtype:"combo",
labelWidth:150,fieldLabel:"Choose a corpus:",name:"corpus",queryMode:"local",store:[["shakespeare","Shakespeare's Plays"]],forceSelection:!0},buttons:[{text:"Open",glyph:"xf00c@FontAwesome",handler:function(b){b.up("form").getForm();var c=b.up("form").getForm().getValues().corpus;""!=c?(a.loadCorpus({corpus:c}),b.up("window").close()):Ext.Msg.show({title:"Select a Corpus",message:"Please be sure to select a corpus.",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})},flex:1},{text:"Cancel",glyph:"xf00d@FontAwesome",
flex:1,handler:function(a){a.up("window").close()}}]}}).show()}},{xtype:"filefield",glyph:"xf093@FontAwesome",name:"upload",buttonOnly:!0,hideLabel:!0,buttonText:"Upload",tooltip:"test",listeners:{render:function(a){a.fileInputEl.dom.setAttribute("multiple",!0);Ext.QuickTips.register({target:a.getEl(),text:"Upload one or more documents from your computer",enabled:!0,showDelay:20,trackMouse:!0,autoShow:!0})},change:function(b,c){if(c){var d=b.up("form").getForm();if(d.isValid()){for(var e=b.fileInputEl.dom.files,
g=/\.(png|gif|jpe?g|xls|mp[234a]|mpeg|exe|wmv|avi|ppt|mpg|tif|wav|mov|psd|wma|ai|bmp|pps|aif|pub|dwg|indd|swf|asf|mbd|dmg|flv)$/i,f=/\.(txt|pdf|html?|xml|docx?|rtf|pages|odt|zip|jar|tar|gz|ar|cpio|bzip2|bz2|gzip)$/i,h=[],l=[],m=0,k=e.length;m<k;m++){var n=e[m].name;g.test(n)?h.push(n.split("/").pop()):f.test(n)||l.push(n.split("/").pop())}0<h.length||0<l.length?Ext.Msg.show({title:a.localize("fileTypesWarning"),icon:Ext.MessageBox.ERROR,message:a.localize("fileTypesMessage")+"\x3cul\x3e"+(0<h.length?
"\x3cli\x3e"+a.localize("badFiles")+h.slice(0,5).join(", ")+(5<h.length?"\u2026":"")+"\x3c/li\x3e":"")+(0<l.length?"\x3cli\x3e"+a.localize("unknownFiles")+l.slice(0,5).join(", ")+(5<l.length?"\u2026":"")+"\x3c/li\x3e":"")+"\x3c/ul\x3e"+a.localize("sureContinue"),buttons:Ext.Msg.YESNO,fn:function(c){"yes"===c?a.loadForm(d):(b.reset(),b.fileInputEl.dom.setAttribute("multiple",!0))},scope:d}):a.loadForm(d)}}}}},"-\x3e",{xtype:"button",scale:"large",glyph:"xf00c@FontAwesome",text:this.localize("reveal"),
handler:function(b){b=b.up("form").down("#input").getValue();""!==b?a.loadCorpus({input:b}):Ext.Msg.show({title:"No Text Provided",message:"Please provide text in the text box (or choose open or upload).",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}]}],items:{xtype:"textareafield",width:800,height:100,itemId:"input",emptyText:this.localize("emptyInput")}});a.callParent(arguments)},loadForm:function(a){var b={tool:"corpus.CorpusCreator"},c=this.getApiParams();delete c.view;delete c.stopList;Ext.apply(b,
c);var d=this.getApplication().getViewport();d.mask(this.localize("uploadingCorpus"));a.submit({url:this.getTromboneUrl(),params:b,failure:function(a,b){d.unmask();b.result&&this.loadCorpus({corpus:b.result.stepEnabledCorpusCreator.storedId})},scope:this})},loadCorpus:function(a){var b=this.getApplication(),c=b.getViewport();c.mask();(new Corpus(a)).then(function(a){c.unmask();b.dispatchEvent("loadedCorpus",b,a)}).fail(function(a,e){c.unmask();b.showErrorResponse({message:a},e)})},showOptionsClick:function(a){void 0===
a.optionsWin&&(a.optionsWin=Ext.create("Ext.window.Window",{title:a.localize("gearWinTitle"),closeAction:"hide",height:225,width:500,layout:"fit",bodyPadding:10,items:[{xtype:"form",defaultType:"textfield",fieldDefaults:{labelAlign:"right",labelWidth:160},items:[{fieldLabel:a.localize("xpathDocuments"),name:"xmlDocumentsXpath"},{fieldLabel:a.localize("xpathContent"),name:"xmlContentXpath"},{fieldLabel:a.localize("xpathAuthor"),name:"xmlAuthorXpath"},{fieldLabel:a.localize("xpathTitle"),name:"xmlTitleXpath"}]}],
buttons:[{text:a.localize("ok"),handler:function(b,c){var d=b.findParentByType("window"),e=d.down("form").getValues();a.setApiParams(e);d.hide()}},{text:a.localize("cancel"),handler:function(a,c){a.findParentByType("window").hide()}}]}));a.optionsWin.show()}});Ext.define("Voyant.panel.CorpusTerms",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.corpusterms",statics:{i18n:{title:{en:"Corpus Terms"},helpTip:{en:"\x3cp\x3eCorpus Terms is a table view of terms that appear in the entire corpus. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering by \x3ci\x3eterm\x3c/i\x3e and \x3ci\x3ecount\x3c/i\x3e (click on the column headers)\x3c/li\x3e\x3cli\x3ea sparkline graph of the term frequency trends across the corpus (if the corpus has multiple documents) or across the document (if the corpus has only one document)\x3c/li\x3e\x3cli\x3eadditional columns available (relative frequency, distribution peakedness and skew) by clicking on the arrow that appears when hovering over a header\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
matchingTerms:{en:"Matching terms: {count}"},termTip:{en:"The term in the corpus."},rawFreqTip:{en:"The total count (raw frequency) of this term in the entire corpus."},relativeFreqTip:{en:"The relative frequency (per million) of this term in the entire corpus."},relativePeakedness:{en:"Peakedness"},relativePeakednessTip:{en:"This is a statistical measure of how much the relative frequencies of a term in a corpus are bunched up into peaks (regions with higher values where the rest are lower)."},relativeSkewness:{en:"Skew"},
relativeSkewnessTip:{en:"This is a statistical measure of the symmetry of the relative frequencies of a term across the corpus."},trendTip:{en:"This represents the trend of the relative frequencies for each term in each document in the corpus."}},api:{stopList:"auto",query:void 0},glyph:"xf0ce@FontAwesome"},config:{options:{xtype:"stoplistoption"}},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,
b){var e=this.getStore();e.setCorpus(b);e.getProxy().setExtraParam("corpus",b.getId());this.fireEvent("apiChange",this)});this.on("query",function(a,b){this.setApiParam("query",b);this.fireEvent("apiChange",this);this.store.loadPage(1)},this);this.on("apiChange",function(){var a=this.getApiParams(["stopList","query"]),b=this.getStore().getProxy(),e;for(e in a)b.setExtraParam(e,a[e]);this.getStore().loadPage(1)},this);if(a.embedded){var b=Ext.getClass(a.embedded).getName();"Voyant.data.store.CorpusTerms"==
b&&this.fireEvent("loadedCorpus",this,a.embedded.getCorpus());"Voyant.data.model.Corpus"==b&&this.fireEvent("loadedCorpus",this,a.embedded)}else a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus)},initComponent:function(){var a=Ext.create("Voyant.data.store.CorpusTerms");a.getProxy().setExtraParam("withDistributions","relative");a.on("totalcountchange",function(){this.down("#status").update({count:this.getStore().getTotalCount()})},this);Ext.apply(this,{title:this.localize("title"),store:a,selModel:Ext.create("Ext.selection.CheckboxModel",
{pruneRemoved:!1,listeners:{selectionchange:{fn:function(a,c){c&&0<c.length&&this.getApplication().dispatchEvent("corpusTermsClicked",this,c)},scope:this}},mode:"SIMPLE"}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}],columns:[{xtype:"rownumberer",width:"autoSize",sortable:!1},{text:this.localize("term"),tooltip:this.localize("termTip"),dataIndex:"term",flex:1,sortable:!0},
{text:this.localize("rawFreq"),tooltip:this.localize("rawFreqTip"),dataIndex:"rawFreq",width:"autoSize",sortable:!0},{text:this.localize("relativeFreq"),tooltip:this.localize("relativeFreqTip"),dataIndex:"relativeFreq",renderer:function(a){return Ext.util.Format.number(1E6*a,"0,000")},width:"autoSize",hidden:!0,sortable:!0},{text:this.localize("relativePeakedness"),tooltip:this.localize("relativePeakednessTip"),dataIndex:"relativePeakedness",renderer:Ext.util.Format.numberRenderer("0,000.0"),width:"autoSize",
hidden:!0,sortable:!0},{text:this.localize("relativeSkewness"),tooltip:this.localize("relativeSkewnessTip"),dataIndex:"relativeSkewness",renderer:Ext.util.Format.numberRenderer("0,000.0"),width:"autoSize",hidden:!0,sortable:!0},{xtype:"widgetcolumn",text:this.localize("trend"),tooltip:this.localize("trendTip"),flex:1,dataIndex:"distributions",widget:{xtype:"sparklineline",tipTpl:new Ext.XTemplate("{[this.getDocumentTitle(values.x,values.y)]}",{getDocumentTitle:function(a,c){return this.panel.store.getCorpus().getDocument(a).getTitle()+
"\x3cbr\x3erelative frequency: "+Ext.util.Format.number(1E6*c,"0,000")},panel:this})}}]});this.callParent(arguments)},load:function(){this.rendered?this.store.loadPage(1):Ext.defer(this.load,100,this)}});Ext.define("Voyant.panel.DocumentTerms",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],requires:["Voyant.data.store.DocumentTerms"],alias:"widget.documentterms",config:{corpus:void 0},statics:{i18n:{title:{en:"Document Terms"},helpTip:{en:"\x3cp\x3eDocument Terms is a table view of terms that appear in each document. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering by \x3ci\x3eTerm\x3c/i\x3e, \x3ci\x3eCount\x3c/i\x3e (raw frequency), and \x3ci\x3eRelative\x3c/i\x3e frequency (click on the column headers)\x3c/li\x3e\x3cli\x3ea sparkline graph of the distribution of term frequencies across the documents\x3c/li\x3e\x3cli\x3eadditional columns available (\x3ci\x3eSignificance\x3c/i\x3e or TF-IDF) by clicking on the arrow that appears when hovering over a header\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
matchingTerms:{en:"Matching terms: {count}"},termTip:{en:"The term in a single, specific document."},rawFreqTip:{en:"The count (raw frequency) of this term in this document."},relativeFreqTip:{en:"The relative frequency (per million) of this term in each document."},trendTip:{en:"This is a sparkline graph that represents the distribution of the term within linear segments of the document (by default 10 segments of equal size)."},tfidf:{en:"Significance"},tfidfTip:{en:"The significance is measured here using an TF-IDF score, a common way of expressing how important a term is in a document relative to the rest of the corpus."}},
api:{stopList:"auto",query:void 0,docId:void 0,docIndex:void 0},glyph:"xf0ce@FontAwesome"},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.getStore().setCorpus(b)});if(a.embedded){console.warn(a.embedded.then);var b=Ext.getClass(a.embedded).getName();"Voyant.data.store.DocumentTerms"!=b&&"Voyant.data.model.Document"!=b||this.fireEvent("loadedCorpus",this,a.embedded.getCorpus())}else a.corpus&&
this.fireEvent("loadedCorpus",this,a.corpus);this.on("query",function(a,b){this.fireEvent("corpusTermsClicked",a,[b])},this);this.on("corpusTermsClicked",function(a,b){if(this.getStore().getCorpus()){var e=[];b.forEach(function(a){e.push(Ext.isString(a)?a:a.get("term"))});this.setApiParams({query:e,docId:void 0,docIndex:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})}});this.on("documentsClicked",function(a,b){var e=[];b.forEach(function(a){e.push(a.get("id"))});
this.setApiParams({docId:e,query:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})});this.on("activate",function(){this.getStore().getCorpus()&&this.getStore().loadPage(1,{params:this.getApiParams()})},this)},initComponent:function(){var a=Ext.create("Voyant.data.store.DocumentTerms");a.on("totalcountchange",function(){this.down("#status").update({count:this.getStore().getTotalCount()})},this);Ext.apply(this,{title:this.localize("title"),store:a,selModel:Ext.create("Ext.selection.CheckboxModel",
{listeners:{selectionchange:{fn:function(a,c){this.getApplication().dispatchEvent("documentTermsClicked",this,c)},scope:this}},pruneRemoved:!1,mode:"SIMPLE"}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}],columns:[{text:"#",width:30,dataIndex:"docIndex",sortable:!0,renderer:function(a){return a+1}},{text:this.localize("term"),dataIndex:"term",tooltip:this.localize("termTip"),
sortable:!0,flex:1},{text:this.localize("rawFreq"),dataIndex:"rawFreq",tooltip:this.localize("rawFreqTip"),width:"autoSize",sortable:!0},{text:this.localize("relativeFreq"),tooltip:this.localize("relativeFreqTip"),dataIndex:"relativeFreq",width:"autoSize",sortable:!0,renderer:Ext.util.Format.numberRenderer("0,000")},{text:this.localize("tfidf"),tooltip:this.localize("tfidfTip"),dataIndex:"tfidf",width:"autoSize",sortable:!0,hidden:!0,renderer:Ext.util.Format.numberRenderer("0,000.000")},{xtype:"widgetcolumn",
text:this.localize("trend"),tooltip:this.localize("trendTip"),flex:1,dataIndex:"distributions",widget:{xtype:"sparklineline"}}],listeners:{termsClicked:{fn:function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){a.term&&d.push(a.term)});d&&(this.setApiParams({docIndex:void 0,docId:void 0,query:d}),this.isVisible()&&this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()}))}},scope:this}}});this.callParent(arguments);this.getStore().getProxy().setExtraParam("withDistributions",
!0)}});Ext.define("Voyant.panel.Documents",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.documents",statics:{i18n:{title:{en:"Documents"},helpTip:{en:"\x3cp\x3eDocuments is a table view of the documents in the corpus. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3ereordering by \x3ci\x3eTitle\x3c/i\x3e, \x3ci\x3eWords\x3c/i\x3e count (tokens), word forms count (\x3ci\x3eTypes\x3c/i\x3e), and \x3ci\x3eRatio\x3c/i\x3e (Types/Tokens Ratio) (click on the column headers)\x3c/li\x3e\x3cli\x3ea search box for queries (by default in the full-text, title and author fields \x26mdash;\u00a0hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
id:{en:"ID"},documentTitle:{en:"Title"},documentAuthor:{en:"Author"},tokensCountLexical:{en:"Words"},typesCountLexical:{en:"Types"},typeTokenRatioLexical:{en:"Ratio"},language:{en:"Language"},matchingDocuments:{en:"Matching documents: {count}"}},glyph:"xf0ce@FontAwesome"},constructor:function(a){var b=Ext.create("Voyant.data.store.Documents",{selModel:{pruneRemoved:!1}});b.on("totalcountchange",function(){this.down("#status").update({count:this.getStore().getTotalCount()})},this);Ext.apply(this,{title:this.localize("title"),
columns:[{xtype:"rownumberer",width:30,sortable:!1},{text:this.localize("documentTitle"),dataIndex:"title",sortable:!0,flex:3},{text:this.localize("documentAuthor"),dataIndex:"author",sortable:!0,hidden:!0,flex:2},{text:this.localize("tokensCountLexical"),dataIndex:"tokensCount-lexical",renderer:Ext.util.Format.numberRenderer("0,000"),sortable:!0,width:"autoSize"},{text:this.localize("typesCountLexical"),dataIndex:"typesCount-lexical",renderer:Ext.util.Format.numberRenderer("0,000"),width:"autoSize"},
{text:this.localize("typeTokenRatioLexical"),dataIndex:"typeTokenRatio-lexical",renderer:function(a){return Ext.util.Format.percent(a)},width:"autoSize"},{text:this.localize("language"),dataIndex:"language",hidden:!0,renderer:function(a,b,e,g,f,h,l){return l.ownerCt.getLanguage(a)},width:"autoSize"}],store:b,selModel:Ext.create("Ext.selection.RowModel",{listeners:{selectionchange:{fn:function(a,b){this.getApplication().dispatchEvent("documentsClicked",this,b,this.getStore().getCorpus())},scope:this}}}),
dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingDocuments"),style:"margin-right:5px"}]}]});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.store.setCorpus(b);this.store.loadPage(1,{params:this.getApiParams()})});this.on("query",function(a,b){this.setApiParam("query",b);this.store.loadPage(1,{params:this.getApiParams()})});
if(a.embedded){debugger;"Voyant.data.model.Corpus"==Ext.getClass(a.embedded).getName()?a.corpus=a.embedded:"Voyant.data.store.Documents"==Ext.getClass(a.embedded).getName()&&(this.store.setRecords(a.embedded.getData()),a.corpus=a.embedded.getCorpus())}a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus)}});Ext.define("Voyant.panel.DocumentsFinder",{extend:"Ext.grid.Panel",require:["Voyant.data.store.DocumentQueryMatches","Ext.grid.plugin.CellEditing"],mixins:["Voyant.panel.Panel"],alias:"widget.documentsfinder",statics:{i18n:{title:{en:"Documents Finder"},operator:{en:"Operator"},field:{en:"Field"},query:{en:"Query"},count:{en:"Count"},emptyQuery:{en:"type query here"},titleField:{en:"title"},authorField:{en:"author"},pubDateField:{en:"publication date"},publisherField:{en:"publisher"},pubPlaceField:{en:"publication location"},
advancedField:{en:"\x3ci\x3eadvanced query\x3c/i\x3e"},textField:{en:"text (default)"},loading:{en:"loading corpus"},unsuccessfulQuery:{en:"Unable to complete query."},addRow:{en:"Add Row"},deleteRowTip:{en:"Click to delete this row"},noMatches:{en:new Ext.Template("No matches (out of {0} documents).",{compiled:!0})},queryMatches:{en:new Ext.Template("A total of {0} matching documents (out of {1}).",{compiled:!0})},exportNewCorpus:{en:"New Corpus"},exportNewCorpusTip:{en:"Create a new corpus from matching documents (button will be disabled if there are no matches)."}}},
config:{corpus:void 0},constructor:function(a){this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});this.cellEditing.on("edit",this.onEditComplete,this);var b=this;Ext.apply(this,{title:this.localize("title"),plugins:[this.cellEditing],bbar:[{text:this.localize("addRow"),glyph:"xf055@FontAwesome",handler:this.addRow,scope:this},{text:this.localize("exportNewCorpus"),disabled:!0,glyph:"xf08e@FontAwesome",tooltip:this.localize("exportNewCorpusTip"),handler:function(){var a=this.getQueryFromStore();
a?(this.setLoading(!0),this.getCorpus().getDocumentQueryMatches().load({params:{query:a,createNewCorpus:!0},callback:function(a,b,c){this.setLoading(!1);c?(a=b.getProxy().getReader().rawData.documentsFinder.corpus,a=this.getBaseUrl()+"?corpus\x3d"+a,Ext.Msg.alert({title:this.localize("title"),message:"\x3ca href\x3d'"+a+"' target\x3d'_blank'\x3eNew Corpus\x3c/a\x3e"})):Ext.create("Voyant.util.ResponseError",{msg:this.localize("unsuccessfulQuery"),response:b.getError().response}).show()},scope:this})):
Ext.Msg.alert({title:this.localize("title"),message:this.localize("noMatches")})},scope:this,cls:"exportBtn"},{xtype:"tbtext",name:"status",cls:"status"}],columns:[{text:this.localize("query"),dataIndex:"query",renderer:function(a){return Ext.isEmpty(a)?'\x3cspan class\x3d"placeholder"\x3e'+b.localize("emptyQuery")+"\x3c/span\x3e":a},editor:!0,minWidth:150,maxWidth:300},{text:this.localize("field"),dataIndex:"field",editor:{xtype:"combo",typeAhead:!0,triggerAction:"all",forceSelection:!0,value:"",
valueField:"value",listeners:{change:function(){Ext.isEmpty(this.getValue())&&this.reset()}},store:new Ext.data.Store({fields:["text","value"],data:[[this.localize("textField"),"text"],[this.localize("advancedField"),"advanced"]]})},width:150,renderer:function(a){return Ext.isEmpty(a)?"":b.localize(a+"Field")}},{text:this.localize("operator"),dataIndex:"operator",editor:{xtype:"combo",forceSelection:!0,store:new Ext.data.Store({autoDestroy:!0,fields:["text","value"],displayField:"text",valueField:"value",
data:[{text:"AND",value:"+"},{text:"OR",value:""}]})},minWidth:75,maxWidth:75},{text:this.localize("count"),dataIndex:"count",renderer:function(a,b,e){return Ext.isEmpty(e.get("query"))?"":Ext.util.Format.number(a,"0,000")},minWidth:100,maxWidth:100},{xtype:"actioncolumn",width:25,sortable:!1,menuDisabled:!0,width:25,getGlyph:"xf014@FontAwesome",tooltip:this.localize("deleteQueryTip"),menuDisabled:!0,sortable:!1,handler:this.removeRow,scope:this}],store:new Ext.data.Store({autoDestroy:!0,fields:["id",
"operator","field","query","count"],data:[["","","","",0]]})});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.setCorpus(b);var e=b.getDocuments();if(e&&0<e.getCount()){var g=e.getDocument(0),f=[];["title","author","pubDate","publisher","pubPlace"].forEach(function(a){Ext.isEmpty(g.get(a))||f.push([this.localize(a+"Field"),a])},this);f&&(e=this.getColumnManager().getHeaderByDataIndex("field").getEditor(),e.getStore().each(function(a){f.push([a.get("text"),
a.get("value")])},this),e.setStore(Ext.create("Ext.data.Store",{fields:["text","value"],data:f})));this.updateStatus(0);this.setLoading(!1)}})},removeRow:function(a,b){this.getStore().removeAt(b);0==this.getStore().getCount()&&this.addRow();this.updateAggregate()},addRow:function(){this.store.loadData([["","","","",0]],!0)},onEditComplete:function(a,b){var c=this.getQueryFromRecord(b.record);if(Ext.isEmpty(c))b.record.set("count",""),this.updateAggregate();else{var d=b.view.getCell(b.record,this.getColumnManager().getHeaderByDataIndex("count"));
d.mask("loading");this.getCorpus().getDocumentQueryMatches().load({params:{query:c},callback:function(a,c,f){d.unmask();f?b.record.set("count",0==a.length?0:a[0].get("count")):(Ext.create("Voyant.util.ResponseError",{msg:this.localize("unsuccessfulQuery"),response:c.getError().response}).show(),b.record.set("count",0));this.updateAggregate()},scope:this})}},getQueryFromRecord:function(a){if(Ext.isEmpty(a)||Ext.isEmpty(a.get("query")))return"";var b=a.get("query").trim();if(Ext.isEmpty(b))return"";
a=a.get("field");return Ext.isEmpty(a?a.trim():a)?b:a+":"+b},getQueryFromStore:function(){var a="";this.getStore().each(function(b){var c=this.getQueryFromRecord(b);Ext.isEmpty(c)||(Ext.isEmpty(a)||(b=b.get("operator"),a+="AND"==b?" + ":" | "),a+=c)},this);console.warn(a);return a},updateAggregate:function(){var a=this.getStore().sum("count");a&&"string"!=typeof a?1==a?(a=this.getStore().getAt(0).get("count"),this.updateStatus(this.getStore().getAt(0).get("count"))):(a=this.getQueryFromStore(),Ext.isEmpty(a)||
(this.status||(this.status=this.down("[cls~\x3dstatus]")),this.status.mask(this.localize("loading")),this.getCorpus().getDocumentQueryMatches().load({params:{query:a},callback:function(a,c,d){debugger;this.status.unmask();d?this.updateStatus(a[0].get("count")):(Ext.create("Voyant.util.ResponseError",{msg:this.localize("unsuccessfulQuery"),response:c.getError().response}).show(),this.updateStatus(0))},scope:this}))):this.updateStatus(0)},updateStatus:function(a){this.status||(this.status=this.down("[cls~\x3dstatus]"));
this.exportBtn||(this.exportBtn=this.down("[cls~\x3dexportBtn]"));0==a?this.status.update(this.localize("noMatches",[this.getCorpus().getDocumentsCount()])):this.status.update(this.localize("queryMatches",[a,this.getCorpus().getDocumentsCount()]));this.exportBtn.setDisabled(0==a)}});Ext.define("Voyant.panel.Dummy",{extend:"Ext.Panel",xtype:"dummy",width:650,initComponent:function(){this.myDataStore=Ext.create("Ext.data.JsonStore",{fields:["theta","sin","cos","tan"],data:[{theta:0,sin:0,cos:1,tan:0},{theta:10,sin:.17,cos:.98,tan:.18},{theta:20,sin:.34,cos:.94,tan:.36},{theta:30,sin:.5,cos:.87,tan:.58},{theta:40,sin:.64,cos:.77,tan:.84},{theta:50,sin:.77,cos:.64,tan:1.19},{theta:60,sin:.87,cos:.5,tan:1.73},{theta:70,sin:.94,cos:.34,tan:2.75},{theta:80,sin:.98,cos:.17,tan:5.67},
{theta:90,sin:1,cos:0,tan:!1},{theta:100,sin:.98,cos:-.17,tan:-5.67},{theta:110,sin:.94,cos:-.34,tan:-2.75},{theta:120,sin:.87,cos:-.5,tan:-1.73},{theta:130,sin:.77,cos:-.64,tan:-1.19},{theta:140,sin:.64,cos:-.77,tan:-.84},{theta:150,sin:.5,cos:-.87,tan:-.58},{theta:160,sin:.34,cos:-.94,tan:-.36},{theta:170,sin:.17,cos:-.98,tan:-.18},{theta:180,sin:0,cos:-1,tan:0},{theta:190,sin:-.17,cos:-.98,tan:.18},{theta:200,sin:-.34,cos:-.94,tan:.36},{theta:210,sin:-.5,cos:-.87,tan:.58},{theta:220,sin:-.64,cos:-.77,
tan:.84},{theta:230,sin:-.77,cos:-.64,tan:1.19},{theta:240,sin:-.87,cos:-.5,tan:1.73},{theta:250,sin:-.94,cos:-.34,tan:2.75},{theta:260,sin:-.98,cos:-.17,tan:5.67},{theta:270,sin:-1,cos:0,tan:!1},{theta:280,sin:-.98,cos:.17,tan:-5.67},{theta:290,sin:-.94,cos:.34,tan:-2.75},{theta:300,sin:-.87,cos:.5,tan:-1.73},{theta:310,sin:-.77,cos:.64,tan:-1.19},{theta:320,sin:-.64,cos:.77,tan:-.84},{theta:330,sin:-.5,cos:.87,tan:-.58},{theta:340,sin:-.34,cos:.94,tan:-.36},{theta:350,sin:-.17,cos:.98,tan:-.18},
{theta:360,sin:0,cos:1,tan:0}]});this.items=[{xtype:"cartesian",width:"100%",height:500,store:this.myDataStore,insetPadding:{top:40,right:40,bottom:20,left:20},legend:{docked:"right"},sprites:[{type:"text",text:"Line Charts - Marked Spline",fontSize:22,width:100,height:30,x:40,y:20}],axes:[{type:"numeric",fields:["sin","cos","tan"],position:"left",grid:!0,renderer:function(a){return Ext.util.Format.number(a,"0.0")}},{type:"category",title:"Theta",fields:"theta",position:"bottom",style:{textPadding:0},
grid:!0,label:{rotate:{degrees:-45}}}],series:[{type:"line",axis:"left",xField:"theta",yField:"sin",smooth:!0,style:{lineWidth:4},marker:{radius:4},highlight:{fillStyle:"#000",radius:5,lineWidth:2,strokeStyle:"#fff"}},{type:"line",axis:"left",xField:"theta",yField:"cos",smooth:!0,style:{lineWidth:4},marker:{radius:4},highlight:{fillStyle:"#000",radius:5,lineWidth:2,strokeStyle:"#fff"}},{type:"line",axis:"left",xField:"theta",yField:"tan",smooth:!0,style:{lineWidth:4},marker:{radius:4},highlight:{fillStyle:"#000",
radius:5,lineWidth:2,strokeStyle:"#fff"}}]}];this.callParent()}});Ext.define("Voyant.panel.Reader",{extend:"Ext.panel.Panel",requires:["Voyant.data.store.Tokens"],mixins:["Voyant.panel.Panel"],alias:"widget.reader",statics:{i18n:{title:{en:"Reader"},helpTip:{en:"\x3cp\x3eThe Reader tool provides a view of text from the corpus. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3efrequency information appears when hovering over a word\x3c/li\x3e\x3cli\x3edistribution information appears in a graph at the bottom when clicking on a word\x3c/li\x3e\x3cli\x3ea bar graph at the bottom indicates the relative size of each document in the corpus\x3c/li\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
documentFrequency:{en:"document frequency:"}},api:{start:0,limit:1E3,skipToDocId:void 0},glyph:"xf0f6@FontAwesome"},config:{corpus:void 0,tokensStore:void 0,documentsStore:void 0,documentTermsStore:void 0,exportVisualization:!1},innerContainer:null,cls:"voyant-reader",layout:"fit",items:{layout:"border",items:[{bodyPadding:10,region:"center",border:!1,autoScroll:!0,html:'\x3cdiv class\x3d"readerContainer"\x3e\x3c/div\x3e'},{region:"south",height:40,split:{size:2},splitterResize:!0,border:!1,layout:{type:"hbox"}}]},
constructor:function(){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){var a=Ext.create("Voyant.data.store.Tokens");a.on("load",function(a,c,d){if(d){var e="",g=this.localize("documentFrequency"),f=!1,h=-1;c.forEach(function(a){0==a.getPosition()&&(e+="\x3ch3\x3e"+this.getDocumentsStore().getById(a.getDocId()).getFullLabel()+"\x3c/h3\x3e");a.getDocIndex()!=h&&(f=this.getDocumentsStore().getById(a.getDocId()).isPlainText(),
h=a.getDocIndex());e=a.isWord()?e+("\x3cspan class\x3d'word' id\x3d'"+a.getId()+"' data-qtip\x3d'"+g+" "+a.getDocumentRawFreq()+"'\x3e"+a.getTerm()+"\x3c/span\x3e"):e+a.getTermWithLineSpacing(f)},this);this.updateText(e,!0);a=this.down("querysearchfield").getValue();""!=a&&this.highlightKeywords(a)}},this);this.setTokensStore(a);this.on("query",function(a,c){this.loadQueryTerms([c])},this);this.setDocumentTermsStore(Ext.create("Ext.data.Store",{model:"Voyant.data.model.DocumentTerm",autoLoad:!1,remoteSort:!1,
proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",withDistributions:!0,withPositions:!0,bins:25},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0},listeners:{load:function(a,c,d,e){a.sort("docIndex","ASC");var g={},f=0,h;a.each(function(a){var b=[],c=a.get("distributions"),d=a.get("docId"),e=a.get("docIndex");h=a.get("term");for(a=0;a<c.length;a++){var p=a,r=c[a];r>f&&(f=r);b.push([d,e,p,
r,h])}g[e]=b},this);this.highlightKeywords(h);this.down("querysearchfield").setValue(h);a=this.query("cartesian");for(c=0;c<a.length;c++)d=a[c],e=g[c],void 0!==e?(d.getAxes()[0].setMaximum(f),d.getStore().loadData(e)):d.getStore().removeAll()},scope:this}}));this.on("afterrender",function(){var a=this.down('panel[region\x3d"center"]');this.innerContainer=a.getLayout().getRenderTarget();a.body.on("scroll",function(a,b){var e=this.items.getAt(0).body.dom;if(e.scrollTop+e.offsetHeight>e.scrollHeight/
2){var g=this.innerContainer.first(),e=g.last();if(0==e.hasCls("loading"))for(;e;){if(e.hasCls("word")){e.insertSibling("\x3cdiv class\x3d'loading'\x3e"+this.localize("loading")+"\x3c/div\x3e","after",!1).mask();g=Voyant.data.model.Token.getInfoFromElement(e);e.destroy();e=this.getDocumentsStore().getAt(g.docIndex).getId();this.setApiParams({skipToDocId:e,start:g.position});this.load();break}e.destroy();e=g.last()}}},this);a.body.on("click",function(a,b){b=Ext.get(b);if(b.hasCls("word")){var e=Voyant.data.model.Token.getInfoFromElement(b),
e=[{term:b.getHtml(),docIndex:e.docIndex}];this.getApplication().dispatchEvent("termsClicked",this,e)}},this);this.getCorpus()&&this.load()},this);Ext.apply(this,{dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"}]}],listeners:{loadedCorpus:function(a,c){this.setCorpus(c);this.getTokensStore().setCorpus(c);this.getDocumentTermsStore().getProxy().setExtraParam("corpus",c.getId());var d=c.getDocuments();this.setDocumentsStore(d);d=this.down('panel[region\x3d"south"]');this.generateChart(c,
d);this.rendered&&this.load()},termsClicked:function(a,c){var d=[];c.forEach(function(a){a.term&&d.push(a.term)});this.loadQueryTerms(d)},corpusTermsClicked:function(a,c){var d=[];c.forEach(function(a){a.getTerm()&&d.push(a.getTerm())});this.loadQueryTerms(d)},documentTermsClicked:function(a,c){var d=[];c.forEach(function(a){a.getTerm()&&d.push(a.getTerm())});this.loadQueryTerms(d)},documentsClicked:function(a,c,d){c&&(this.setApiParams({skipToDocId:c[0].getId(),start:0}),this.load(!0))},termLocationClicked:function(a,
c){if(void 0!==c[0]){var d=c[0],e=d.get("docIndex"),g=d.get("position"),f=g-this.getApiParam("limit")/2,h=this.getCorpus().getDocument(e);this.setApiParams({skipToDocId:h.getId(),start:0>f?0:f});this.load(!0,{callback:function(){var a=this.body.dom.querySelector("#_"+e+"_"+g);a&&a.scrollIntoView();this.highlightKeywords(d.get("term"),!1)},scope:this})}},scope:this}});this.callParent(arguments)},loadQueryTerms:function(a){a&&0<a.length&&this.getDocumentTermsStore().load({params:{query:a,docIndex:void 0,
docId:void 0,page:void 0,start:void 0,limit:void 0}})},generateChart:function(a,b){function c(a,b){var c=[[116,116,181],[139,163,83],[189,157,60],[171,75,75],[174,61,155]],c=c[a%c.length];return"rgba("+c[0]+","+c[1]+","+c[2]+","+b+")"}function d(d,e){var f=d.index,g=d.fraction,h=d.relativeHeight,l=c(f,.3),f=c(f,1);b.add({xtype:"cartesian",flex:g,height:"100%",insetPadding:0,background:{type:"linear",degrees:90,stops:[{offset:0,color:l},{offset:h,color:l},{offset:h,color:"white"},{offset:1,color:"white"}]},
axes:[{type:"numeric",position:"left",fields:"distribution",hidden:!0},{type:"category",position:"bottom",fields:"bin",hidden:!0}],series:[{type:"line",xField:"bin",yField:"distribution",style:{lineWidth:2,strokeStyle:f},tooltip:{corpus:a,trackMouse:!0,style:"background: #fff",showDelay:0,dismissDelay:500,hideDelay:5,renderer:function(b,c){this.setHtml(a.getDocument(b.get("docIndex")).getTitle()+"\x3cbr\x3e"+b.get("term")+": "+b.get("distribution"))}}}],store:Ext.create("Ext.data.ArrayStore",{fields:["docId",
"docIndex","bin","distribution","term"],data:[]})}).body.on("click",function(a,b){var c=Ext.get(b);a.getX();c.getBox();var c=c.parent(".x-panel"),d=c.parent(),c=Ext.toArray(d.dom.children).indexOf(c.dom),c=this.getDocumentsStore().getAt(c);this.getApplication().dispatchEvent("documentsClicked",this,[c])},e)}b.removeAll();var e=a.getDocuments();if(50>e.getTotalCount()){for(var g=a.getWordTokensCount(),f=[],h=1E6,l=-1,m=0;m<e.getCount();m++){var k=e.getAt(m),n=k.get("index"),k=k.get("tokensCount-lexical");
k<h&&(h=k);k>l&&(l=k);f.push({index:n,count:k,fraction:k/g})}for(m=0;m<f.length;m++)k=f[m],k.relativeHeight=k.count==l?1:0+(k.count-h)/(l-h)*1,d(k,this)}},highlightKeywords:function(a,b){Ext.isArray(a)||(a=[a]);this.innerContainer.first().select("span[class*\x3dkeyword]").removeCls("keyword");var c=[],d=new RegExp("^"+a[0]+"$","i");this.innerContainer.first().select("span.word").each(function(a,b,f){a.dom.firstChild&&a.dom.firstChild.nodeValue.match(d)&&(a.addCls("keyword"),c.push(a.dom))})},load:function(a,
b){a&&(this.innerContainer.first().destroy(),this.innerContainer.setHtml('\x3cdiv class\x3d"readerContainer"\x3e\x3cdiv class\x3d"loading"\x3e'+this.localize("loading")+"\x3c/div\x3e\x3c/div\x3e"),this.innerContainer.first().first().mask());this.getTokensStore().load(Ext.apply(b||{},{params:Ext.apply(this.getApiParams(),{stripTags:"blocksOnly"})}))},updateText:function(a){var b=this.innerContainer.first().last();b&&b.isMasked()&&b.destroy();this.innerContainer.first().insertHtml("beforeEnd",a)},updateChart:function(){}});Ext.define("Voyant.panel.ScatterPlot",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],requires:["Ext.chart.CartesianChart"],alias:"widget.scatterplot",config:{corpus:void 0},statics:{i18n:{title:{en:"ScatterPlot"},analysis:{en:"Analysis"},ca:{en:"Correspondence Analysis"},pca:{en:"Principal Components Analysis"},freqType:{en:"Frequency Type"},rawFreq:{en:"Raw Frequency"},relFreq:{en:"Relative Frequency"},terms:{en:"Terms"},clusters:{en:"Clusters"},remove:{en:"Remove"},nearby:{en:"Nearby"},
helpTip:{en:"\x3cp\x3eScatterPlot displays the correspondance of word use in a corpus. This visualization relies on a statistical analysis that takes the word\u2019s correspondance from each document (where each document represents a dimension) and reduces it to a three dimensional space to easily visualize the data through a scatterplot.\x3c/p\x3e"},tokenFreqTip:{en:"\x3cb\x3e{0}\x3c/b\x3e\x3cbr/\x3e\x3cb\x3eRaw Frequency\x3c/b\x3e\x3cbr/\x3e{1}\x3c/b\x3e\x3cbr/\x3e\x3cb\x3eRelative Frequency\x3c/b\x3e\x3cbr/\x3e{2}\x3c/b\x3e"},
docFreqTip:{en:"\x3cb\x3e{0}\x3c/b\x3e\x3cbr/\x3e\x3cb\x3eWord Count\x3c/b\x3e\x3cbr/\x3e{1}\x3c/b\x3e"}},api:{analysis:"ca",limit:50,dimensions:3,bins:10,clusters:3,freqType:"raw",stopList:"auto",target:void 0},glyph:"xf06e@FontAwesome"},tokenFreqTipTemplate:null,docFreqTipTemplate:null,caStore:null,pcaStore:null,chartMenu:null,layout:"center",constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){Ext.apply(this,
{title:this.localize("title"),caStore:Ext.create("Voyant.data.store.CAAnalysis"),pcaStore:Ext.create("Voyant.data.store.PCAAnalysis"),chartMenu:Ext.create("Ext.menu.Menu",{items:[{text:this.localize("nearby")}]}),tbar:[{text:this.localize("analysis"),menu:{items:[{text:this.localize("pca"),checked:!1,group:"analysis",xtype:"menucheckitem"},{text:this.localize("ca"),checked:!0,group:"analysis",xtype:"menucheckitem"}],listeners:{click:function(a,b){void 0!==b&&(b.text===this.localize("pca")?this.setApiParam("analysis",
"pca"):(this.setApiParam("analysis","ca"),this.getCorpus().getDocumentsCount()),this.loadFromApis())},scope:this}}},{text:this.localize("freqType"),disabled:!0,menu:{items:[{text:this.localize("rawFreq"),checked:!0,group:"freqType",xtype:"menucheckitem"},{text:this.localize("relFreq"),checked:!1,group:"freqType",xtype:"menucheckitem"}],listeners:{click:function(a,b){void 0!==b&&(b.text===this.localize("rawFreq")?this.setApiParam("freqType","raw"):this.setApiParam("freqType","relative"),this.loadFromApis())},
scope:this}}},{text:this.localize("terms"),menu:{items:[{text:"10",checked:!1,group:"terms",xtype:"menucheckitem"},{text:"20",checked:!1,group:"terms",xtype:"menucheckitem"},{text:"30",checked:!1,group:"terms",xtype:"menucheckitem"},{text:"40",checked:!1,group:"terms",xtype:"menucheckitem"},{text:"50",checked:!0,group:"terms",xtype:"menucheckitem"},{text:"60",checked:!1,group:"terms",xtype:"menucheckitem"},{text:"70",checked:!1,group:"terms",xtype:"menucheckitem"},{text:"80",checked:!1,group:"terms",
xtype:"menucheckitem"},{text:"90",checked:!1,group:"terms",xtype:"menucheckitem"},{text:"100",checked:!1,group:"terms",xtype:"menucheckitem"}],listeners:{click:function(a,b){void 0!==b&&(this.setApiParam("limit",parseInt(b.text)),this.loadFromApis())},scope:this}}},{text:this.localize("clusters"),menu:{items:[{text:"1",checked:!1,group:"clusters",xtype:"menucheckitem"},{text:"2",checked:!1,group:"clusters",xtype:"menucheckitem"},{text:"3",checked:!0,group:"clusters",xtype:"menucheckitem"},{text:"4",
checked:!1,group:"clusters",xtype:"menucheckitem"},{text:"5",checked:!1,group:"clusters",xtype:"menucheckitem"}],listeners:{click:function(a,b){void 0!==b&&(this.setApiParam("clusters",parseInt(b.text)),this.loadFromApis())},scope:this}}}]});this.on("loadedCorpus",function(a,b){this.setCorpus(b);this.caStore.setCorpus(b);this.pcaStore.setCorpus(b);this.loadFromApis()},this);this.caStore.on("load",function(a,b){this.buildChart(a)},this);this.pcaStore.on("load",function(a,b){this.buildChart(a)},this);
this.tokenFreqTipTemplate=new Ext.Template(this.localize("tokenFreqTip"));this.docFreqTipTemplate=new Ext.Template(this.localize("docFreqTip"));this.on("add",function(a){var b=this.down("#chart");null!==b&&(a=Math.min(a.body.getHeight(),a.body.getWidth()),b.setSize(a,a).redraw(),b.on("render",function(a){a.body.on("click",function(a,b){var c=a.getXY(),f=Ext.fly(b).getXY(),h=c[0]-f[0],c=c[1]-f[1],h=this.down("#chart").getItemForPoint(h,c);null!=h&&(h=Ext.create("Voyant.data.model.CorpusTerm",h.record.data),
this.getApplication().dispatchEvent("corpusTermsClicked",this,[h]))},this);a.body.on("contextmenu",function(a,b){a.preventDefault();var c=a.getXY(),f=Ext.fly(b).getXY(),h=c[0]-f[0],f=c[1]-f[1],l=this.down("#chart").getItemForPoint(h,f);null!=l&&(this.chartMenu.on("click",function(a,b){if(void 0!==b&&b.text!==this.localize("remove")){var c=Math.max(2E3,Math.round(this.getCorpus().getWordTokensCount()/100));this.setApiParams({limit:c,target:l.record.get("term")});this.loadFromApis();this.setApiParam("target",
void 0)}},this,{single:!0}),this.chartMenu.showAt(c))},this)},this))},this);this.callParent(arguments)},buildChart:function(a){var b=this,c=this.queryById("chart");null!==c&&c.remove();a=a.getAt(0).getTokens();var d=0,e=Number.MAX_VALUE,g=[];a.forEach(function(a){var b=parseInt(a.get("@rawFreq"),10),c="part"===a.get("@category");c||(b>d&&(d=b),b<e&&(e=b));a={term:a.get("@term"),rawFreq:b,relativeFreq:a.get("@relativeFreq"),cluster:a.get("@cluster"),x:a.get("vector")[0],y:a.get("vector")[1]};a.isDoc=
c;g.push(a)});a={itemId:"chart",xtype:"cartesian",store:Ext.create("Ext.data.JsonStore",{fields:"term x y rawFreq cluster isDoc".split(" "),data:g}),interactions:["crosszoom","itemhighlight"],axes:[{type:"numeric",position:"bottom",fields:["x"]},{type:"numeric",position:"left",fields:["y"]}],series:[{type:"scatter",xField:"x",yField:"y",label:{field:"term",display:"over"},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c){a.get("isDoc")?this.setHtml(b.docFreqTipTemplate.apply([a.get("term"),
a.get("rawFreq")])):this.setHtml(b.tokenFreqTipTemplate.apply([a.get("term"),a.get("rawFreq"),a.get("relativeFreq")]))}},renderer:function(a,b,c,g){c=c.store.getAt(g);g=parseInt(c.get("cluster"),10);a=this.getParent().up("scatterplot");-1===g&&(g=0);g=a.getApplication().getColor(g);b.fillStyle="rgba("+g.join(",")+",0.5)";b.strokeStyle="rgba("+g.join(",")+",1)";c=c.get("rawFreq");a=a.interpolate(c,e,d,2,20);b.radius=a}}]};a=Ext.create("Ext.chart.CartesianChart",a);this.add(a)},loadFromApis:function(){var a=
{};Ext.apply(a,this.getApiParams());"pca"===a.analysis?this.pcaStore.load({params:a}):this.caStore.load({params:a})},interpolate:function(a,b,c,d,e){return d+(e-d)*Math.max(0,Math.min(1,(a-b)/(c-b)))}});Ext.define("Voyant.panel.Summary",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel","Voyant.util.SparkLine"],alias:"widget.summary",statics:{i18n:{title:{en:"Summary"},helpTip:{en:"\x3cp\x3eThe \x3ci\x3eSummary\x3c/i\x3e tool provides general information about the corpus. Many elements in the tool are links that trigger other views. Features include:\x3c/p\x3e\x3cul\x3e\x3cli\x3etotal words (tokens) and word forms (types) and age of the corpus\x3c/li\x3e\x3cli\x3emost frequent terms in the corpus\x3c/li\x3e\x3cli\x3efor corpora with more than one documen\x3cul\x3e\x3cli\x3edocuments ordered by length and vocabulary density\x3c/li\x3e\x3cli\x3edistinctive words for each document (by TF-IDF score)\x3c/li\x3e\x3c/ul\x3e\x3c/li\x3e\x3c/ul\x3e"},
corpusType:{en:'\x3ctpl for\x3d"types"\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"corpus-type keyword" voyant:recordId\x3d"{id}"\x3e{type}\x3c/a\x3e ({val})\x3ctpl if\x3d"xindex \x26lt; len"\x3e, \x3c/tpl\x3e\x3c/tpl\x3e'},documentType:{en:'\x3ctpl for\x3d"types"\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-type keyword" voyant:recordId\x3d"{id}" voyant:val\x3d"{docId}:{type}"\x3e{type}\x3c/a\x3e ({val})\x3ctpl if\x3d"xindex \x26lt; len"\x3e, \x3c/tpl\x3e\x3c/tpl\x3e'},
mostFrequentWords:{en:"Most \x3cb\x3efrequent words\x3c/b\x3e in the corpus: "},docsLength:{en:'\x3cul\x3e\x3ctpl for\x3d"docs"\x3e\x3cli\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-id" voyant:val\x3d"{id}"\x3e{title}\x3c/a\x3e ({totalWordTokens})\x3c/li\x3e\x3c/tpl\x3e\x3c/ul\x3e'},docsLengthLongest:{en:"\x3cb\x3eLongest documents\x3c/b\x3e (by words {0})"},docsLengthShortest:{en:"Shortest documents"},docsLengthAll:{en:"Documents ordered by number of words ({0})"},docsDensity:{en:'\x3cul\x3e\x3ctpl for\x3d"docs"\x3e\x3cli\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-id" voyant:val\x3d"{id}"\x3e{title}\x3c/a\x3e ({wordDensity})\x3c/li\x3e\x3c/tpl\x3e\x3c/ul\x3e'},
docsDensityHighest:{en:"Highest \x3cb\x3evocabulary density\x3c/b\x3e ({0})"},docsDensityLowest:{en:"Lowest density"},docsDensityAll:{en:"Documents ordered by vocabulary density ({0})"},distinctiveWords:{en:"\x3cb\x3eDistinctive words\x3c/b\x3e (compared to the rest of the corpus): "},moreDistinctiveWords:{en:'\x3ca href\x3d"#" onclick\x3d"return false"\x3eNext {0} of {1} remaining\x3c/a\x3e'},seeAll:{en:"All\x26hellip;"},more:{en:"More\x26hellip;"}},api:{stopList:"auto",start:0,limit:5,numberOfDocumentsForDistinctiveWords:5},
glyph:"xf1ea@FontAwesome"},config:{corpus:void 0},autoScroll:!0,cls:"corpus-summary",corpusTermsStore:null,docsStore:null,documentTermsStore:null,summaryListParent:null,constructor:function(a){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,c){this.setCorpus(c);this.corpusTermsStore=c.getCorpusTerms();this.docStore=Ext.create("Ext.data.Store",{model:"Voyant.data.model.Document",
autoLoad:!1,remoteSort:!1,corpus:this.getCorpus(),proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsMetadata",corpus:this.getCorpus().getId()},reader:{type:"json",rootProperty:"documentsMetadata.documents",totalProperty:"documentsMetadata.total"},simpleSortMode:!0},listeners:{load:function(a,b,c,d){var l=this.getCorpus();b.forEach(function(a){a.set("corpus",l)})},scope:this}});this.documentTermsStore=Ext.create("Ext.data.Store",{model:"Voyant.data.model.DocumentTerm",
autoLoad:!1,remoteSort:!1,corpus:this.getCorpus(),proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",corpus:this.getCorpus().getId()},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0}});if(this.rendered){var d=this.getLayout().getRenderTarget();d.update("");this.summaryListParent=Ext.dom.Helper.append(d,"\x3cul\x3e\x3c/ul\x3e");Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e"+c.getShow()+
"\x3c/li\x3e");d=c.getDocumentsCount();1<d&&this.showLongestDocuments();1<d&&this.showMostDenseDocuments();this.showMostFrequentWords();1<d&&this.showDistinctiveWords();d=Ext.apply({},{limit:null},this.getApiParams());this.docStore.load({params:d});this.addLinksHandler()}else Ext.defer(this.fireEvent,100,this)});this.on("activate",function(){this.getCorpus()&&this.dispatchEvent("ensureCorpusView",this,this.getCorpus())},this);a.embedded&&"Voyant.data.model.Corpus"==Ext.getClass(a.embedded).getName()&&
(a.corpus=a.embedded);a&&a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus)},showLongestDocuments:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e\x3c/li\x3e");this.docStore.on("load",function(b,c,d){c=b.getTotalCount();if(1<c){b.sort("index","ASC");var e=[];b.each(function(a){e.push(a.get("tokensCount-lexical"))});b.sort("tokensCount-lexical","DESC");b={shortest:b.getRange(c-2,c).reverse(),longest:b.getRange(0,1),all:b.getRange(0,c)};for(var g in b)if(g){d=b[g];for(var f=
0;f<d.length;f++){var h=d[f];b[g][f]={title:h.getShortTitle(),id:h.get("id"),totalWordTokens:Ext.util.Format.number(h.get("tokensCount-lexical"),"0,000"),docsLen:d.length}}}g=new Ext.XTemplate(this.localize("docsLength"));d="";5<c?(d+=(new Ext.Template(this.localize("docsLengthLongest"))).applyTemplate([this.getSparkLine(e)])+this.localize("colon")+g.apply({docs:b.longest}),d+=this.localize("docsLengthShortest")+this.localize("colon")+g.apply({docs:b.shortest}),d+="\x3ca href\x3d'#' onclick\x3d'return false' class\x3d'corpus-documents corpus-documents-length'\x3e"+
this.localize("seeAll")+"\x3c/a\x3e"):d+=(new Ext.Template(this.localize("docsLengthAll"))).apply([this.getSparkLine(e)])+this.localize("colon")+g.apply({docs:b.all});Ext.dom.Helper.append(a,d)}},this)},showMostDenseDocuments:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e\x3c/li\x3e");this.docStore.on("load",function(b,c,d){c=b.getTotalCount();if(1<c){b.sort("index","ASC");var e=[];b.each(function(a){e.push(a.get("typeTokenRatio-lexical"))});b.sort("typeTokenRatio-lexical",
"DESC");b={lowest:b.getRange(c-2,c).reverse(),highest:b.getRange(0,1),all:b.getRange(0,c)};for(var g in b)if(g){d=b[g];for(var f=0;f<d.length;f++){var h=d[f];b[g][f]={title:h.getShortTitle(),id:h.get("id"),wordDensity:Ext.util.Format.number(h.get("typeTokenRatio-lexical"),"0.000"),docsLen:d.length}}}g=new Ext.XTemplate(this.localize("docsDensity"));d="";5<c?(d+=(new Ext.Template(this.localize("docsDensityHighest"))).applyTemplate([this.getSparkLine(e)])+this.localize("colon")+g.apply({docs:b.highest}),
d+=this.localize("docsDensityLowest")+this.localize("colon")+g.apply({docs:b.lowest}),d+="\x3ca href\x3d'#' onclick\x3d'return false' class\x3d'corpus-documents corpus-documents-density'\x3e"+this.localize("seeAll")+"\x3c/a\x3e"):d+=(new Ext.Template(this.localize("docsDensityAll"))).applyTemplate([this.getSparkLine(e)])+this.localize("colon")+g.apply({docs:b.all});Ext.dom.Helper.append(a,d)}},this)},showMostFrequentWords:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e\x3c/li\x3e"),
b=this.getApiParams();this.corpusTermsStore.load({params:b,scope:this,callback:function(b){var d=this.localize("mostFrequentWords"),e=[],g=b.length;b.forEach(function(a,b,c){e.push({id:a.getId(),type:a.getTerm(),val:Ext.util.Format.number(a.get("rawFreq"),"0,000"),len:g})});d+=(new Ext.XTemplate(this.localize("corpusType"))).applyTemplate({types:e})+".";Ext.dom.Helper.append(a,d)}})},showDistinctiveWords:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e"+this.localize("distinctiveWords")+
"\x3col\x3e\x3c/ol\x3e\x3c/li\x3e",!0).first("ol");this.docStore.on("load",function(b,c,d){c=b.getTotalCount();if(1<c){b.sort("index","ASC");var e=this.getApiParam("numberOfDocumentsForDistinctiveWords");b.each(function(b,c,d){Ext.dom.Helper.append(a,{tag:"li","voyant:index":String(c),cls:c>e-1?"x-hidden":"",html:'\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-id document-id-distinctive" voyant:val\x3d"'+b.get("id")+'"\x3e'+b.getShortTitle()+"\x3c/a\x3e"})},this);if(c>e){var g=new Ext.Template(this.localize("moreDistinctiveWords"));
b=c-e;var f=Ext.dom.Helper.append(this.summaryListParent,{tag:"div",html:g.apply([e>b?b:e,b])},!0);f.addListener("click",function(){var b=a.select('li[class\x3d"x-hidden"]');for(i=0;i<b.getCount()&&i!=e;i++)b.item(i).removeCls("x-hidden");this.showDistinctiveWordsStep(b.item(0));b=b.getCount()-e;0<b?f.update(g.apply([e>b?b:e,b])):f.remove()},this)}this.showDistinctiveWordsStep(a.first("li"))}},this)},showDistinctiveWordsStep:function(a){var b=Number(a.getAttribute("index","voyant"));this.documentTermsStore.load({addRecords:!0,
params:{docIndex:b,limit:5,sort:"TFIDF",dir:"DESC"},scope:this,callback:function(b,d,e){var g=[];if(b){var f=b.length;b.forEach(function(a,b,c){g.push({id:a.getId(),type:a.getTerm(),val:Ext.util.Format.number(a.get("rawFreq"),"0,000"),docId:a.get("docId"),len:f})});Ext.dom.Helper.append(a,this.localize("colon")+(new Ext.XTemplate(this.localize("documentType"))).apply({types:g})+".");(b=a.next("li"))&&!b.hasCls("x-hidden")&&this.showDistinctiveWordsStep(b)}}})},addLinksHandler:function(){this.body.addListener("click",
function(a){if((a=a.getTarget(null,null,!0))&&"A"==a.dom.tagName){var b={};a.hasCls("corpus-documents")?(a.hasCls("corpus-documents-length")?b.sortBy="totalWordTokens":a.hasCls("corpus-documents-density")&&(b.sortBy="wordDensity"),b.sortDirection="DESC"):a.hasCls("document-id")?(a=a.getAttribute("val","voyant"),a=this.docStore.getById(a),this.dispatchEvent("documentsClicked",this,[a])):a.hasCls("corpus-type")?(a=a.getAttribute("recordId","voyant"),a=this.corpusTermsStore.getById(a),this.dispatchEvent("corpusTermsClicked",
this,[a])):a.hasCls("corpus-types")?(b.query="",a.hasCls("corpus-types-peaks")?Ext.apply(b,{sortBy:"RELATIVEDISTRIBUTIONKURTOSIS",sortDirection:"DESC",extendedSortZscoreMinimum:1}):Ext.apply(b,{sortBy:"rawFreq",sortDirection:"DESC",extendedSortZscoreMinimum:null})):a.hasCls("document-type")&&(a=a.getAttribute("recordId","voyant"),a=this.documentTermsStore.getById(a),this.dispatchEvent("documentTermsClicked",this,[a]))}},this)}});Ext.define("Voyant.panel.TopicContexts",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.topiccontexts",statics:{i18n:{title:{en:"Topic Contexts"},helpTip:{en:"Topic Contexts"},reset:{en:"reset"}},api:{},glyph:"xf06e@FontAwesome"},constructor:function(a){Ext.apply(this,{title:this.localize("title"),cls:"twic_body"});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},listeners:{loadedCorpus:function(a,b){this.loadFromCorpus(b)}},loadFromCorpus:function(a){a=
Ext.Loader.getPath("resources")+"/twic/current/data/input/json";var b=TWiC.Level.prototype.Instance();b.LoadJSON(a+"/twic_corpusinfo.json",a+"/twic_corpusmap.json");var c=this;b.m_queue.await(function(){var a=[],e=[],g=new TWiC.TopicBar({x:0,y:635},{width:1280,height:165},"dickinson",b,[]);e.push(g);var f=new TWiC.DocumentBar({x:1055,y:0},{width:225,height:635},"dickinson",b,[]);e.push(f);f=new TWiC.CorpusClusterView({x:0,y:0},{width:1055,height:635},"dickinson",b,[g,f]);a.push(f);g.m_linkedViews.push(f);
g=c.getLayout().getRenderTarget();b.Initialize([0,0],{width:g.getWidth(),height:g.getHeight()},"dickinson",a,e,"#"+g.getId());b.Start()}.bind(b))}});Ext.define("Voyant.panel.Trends",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],requires:["Ext.chart.CartesianChart","Voyant.data.store.Documents"],alias:"widget.trends",config:{corpus:void 0},statics:{i18n:{title:{en:"Trends"},helpTip:{en:"\x3cp\x3e\x3ci\x3eTrends\x3c/i\x3e shows a line graph of the relative frequencies across the corpus (for multiple documents) or within a document. Features include\x3c/p\x3e\x3cul\x3e\x3cli\x3ea search box for queries (hover over the magnifying icon for help with the syntax)\x3c/li\x3e\x3c/ul\x3e"},
rawFrequencies:{en:"raw frequencies"},relativeFrequencies:{en:"relative frequencies"},segments:{en:"document segments"},documents:{en:"documents"}},api:{limit:5,stopList:"auto",query:void 0,freqsMode:"relativeFreqs",docIndex:void 0,docId:void 0,mode:void 0},glyph:"xf201@FontAwesome"},MODE_CORPUS:"corpus",MODE_DOCUMENT:"document",layout:"fit",constructor:function(a){Ext.apply(this,{title:this.localize("title"),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",
itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}]});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);if(a.embedded){var b=Ext.getClass(a.embedded).getName();"Voyant.data.store.CorpusTerms"==b&&this.loadFromCorpusTerms(a.embedded);"Voyant.data.model.Corpus"==b&&this.loadFromCorpusTerms(a.embedded.getCorpusTerms())}this.on("loadedCorpus",function(a,b){this.setCorpus(b);this.isVisible()&&this.loadFromCorpus(b)});this.on("documentsClicked",
function(a,b){this.getCorpus()&&1==b.length&&this.loadFromDocument(b[0])});this.on("query",function(a,b){Ext.isString(b)&&this.fireEvent("termsClicked",a,[b])},this);this.on("termsClicked",function(a,b){if(this.getCorpus()){var e=[];b.forEach(function(a){Ext.isString(a)?e.push(a):a.term?e.push(a.term):a.getTerm&&e.push(a.getTerm())});e&&(this.setApiParams({query:e}),this.isVisible()&&this.loadFromCorpus(this.getCorpus()))}});this.on("documentTermsClicked",function(a,b){this.getCorpus()&&(this.setApiParam("mode",
"document"),this.loadFromRecords(b))});this.on("corpusTermsClicked",function(a,b){this.getCorpus()&&(b[0]&&void 0!==b[0].get("distributions")?this.loadFromRecords(b):this.fireEvent("termsClicked",a,b))});this.on("activate",function(){this.getCorpus()&&this.loadFromCorpus(this.getCorpus())},this);this.on("ensureCorpusView",function(a,b){this.getApiParam("mode")!=this.MODE_CORPUS&&1<b.getDocumentsCount()&&(this.setApiParam("docId",void 0),this.loadFromCorpus(b))},this)},loadFromDocument:function(a){if(a.then){var b=
this;a.then(function(a){b.loadFromDocument(a)})}else"Voyant.data.model.Document"==Ext.getClassName(a)&&(this.setApiParams({docIndex:void 0,query:void 0,docId:a.getId(),mode:this.MODE_DOCUMENT}),this.isVisible()&&this.loadFromDocumentTerms())},loadFromDocumentTerms:function(a){this.getCorpus()&&(a=a||this.getCorpus().getDocumentTerms({autoLoad:!1}),a.load({callback:function(a,c,d){d?(this.setApiParam("mode","document"),this.loadFromRecords(a)):Voyant.application.showResponseError(this.localize("failedGetDocumentTerms"),
c)},scope:this,params:Ext.apply(this.getApiParams(["limit","stopList","query","docId"]),{withDistributions:!0})}))},loadFromCorpus:function(a){this.setCorpus(a);this.getApiParam("docId")?this.loadFromDocumentTerms():1==a.getDocumentsCount()?this.loadFromDocument(a.getDocument(0)):this.loadFromCorpusTerms(a.getCorpusTerms())},loadFromCorpusTerms:function(a){a.load({callback:function(a,c,d){d?(this.setApiParam("mode",this.MODE_CORPUS),this.loadFromRecords(a)):Voyant.application.showResponseError(this.localize("failedGetCorpusTerms"),
c)},scope:this,params:Ext.apply(this.getApiParams(["limit","stopList","query"])||{},{withDistributions:"relative"})})},loadFromRecords:function(a){var b=this.getApiParam("mode"),c=[],d=["index"],e=[];a.forEach(function(a,f){var h=a.get("term");a.get("distributions").forEach(function(a,b){c[b]||(c[b]={index:b});c[b]["_"+f]=a},this);d.push("_"+f);e.push({type:"line",title:h,xField:"index",yField:"_"+f,style:{lineWidth:2},marker:{radius:3},highlight:!0,smooth:!0,tooltip:{trackMouse:!0,style:"background: #fff",
renderer:function(a,c){var d="\x3ci\x3e"+c.series.getTitle()+"\x3c/i\x3e: "+a.get(c.series.getYField());if(b==this.panel.MODE_CORPUS){var e=this.panel.getCorpus();e&&e.getDocumentsCount()==a.store.getCount()&&(d+="\x3cbr/\x3e\x3ci\x3e"+this.panel.getCorpus().getDocument(c.index).getShortTitle()+"\x3c/i\x3e")}this.setHtml(d)},panel:this},listeners:{itemclick:{fn:this.handleClickedItem,scope:this}}})},this);a=Ext.create("Ext.data.JsonStore",{fields:d,data:c});d.shift();this.buildChart({store:a,series:e,
axes:[{type:"numeric",position:"left",minimum:0,title:{text:this.localize(b==this.MODE_DOCUMENT||"rawFreqs"==this.getApiParam("freqsMode")?"rawFrequencies":"relativeFrequencies")}},{type:"category",position:"bottom",fields:["index"],title:{text:this.localize(b==this.MODE_DOCUMENT?"segments":"documents")},renderer:function(a,c){return b==this.MODE_DOCUMENT?parseInt(a)+1:a}}]})},buildChart:function(a){a.axes.forEach(function(a){Ext.applyIf(a,{style:{opacity:.2},label:{opacity:.5}});Ext.applyIf(a.title,
{fontSize:12})});Ext.applyIf(a,{plugins:{ptype:"chartitemevents",moveEvents:!0},legend:{docked:"top"},interactions:["itemhighlight","panzoom"],innerPadding:{top:5,right:5,bottom:5,left:5},border:!1,bodyBorder:!1});this.query("chart").forEach(function(a){this.remove(a)},this);a=Ext.create("Ext.chart.CartesianChart",a);this.add(a)},clearChart:function(){this.query("chart").forEach(function(a){this.remove(a)},this)},handleClickedItem:function(a,b){var c=this.getApiParam("mode");c===this.MODE_DOCUMENT?
(c=this.getApiParam("docId"))&&this.dispatchEvent("documentIndexTermsClicked",this,[{term:b.series.getTitle(),docId:c}]):c==this.MODE_CORPUS&&this.dispatchEvent("documentIndexTermsClicked",this,[{term:b.series.getTitle(),docIndex:b.index}])},isLastClickedItem:function(a){return this.lastClickedItem&&this.lastClickedItem.term==a.term&&this.lastClickedItem.index==a.index}});Ext.define("Voyant.panel.VoyantFooter",{extend:"Ext.container.Container",mixins:["Voyant.panel.Panel"],alias:"widget.voyantfooter",statics:{i18n:{voyantLink:{en:'\x3ca href\x3d"http://docs.voyant-tools.org/" target\x3d"_blank"\x3eVoyant Tools\x3c/a\x3e'},privacy:{en:"Privacy"},privacyMsg:{en:'The developers of Voyant Tools gather data from the site about what tools are invoked and with what parameters (IP addresses are also logged in order to be able to identify multiple requests during a same session). In addition, Voyant Tools uses Google Analytics (see \x26lt;a href\x3d"http://www.google.ca/intl/en/policies/privacy/" target\x3d"_blank"\x26gt;Google\x26apos;s Privacy Policy\x26lt;/a\x26gt; and the \x26lt;em\x26gt;Log Information\x26lt;/em\x26gt; section in particular). Locally logged data and Google Analytics data will be used by the development team in order to debug and improve the tools, as well as to understand how researchers are using them. This data may also be used for research purposes in anonymous and aggregate forms. Please note that texts submitted to Voyant Tools are stored in order to allow persistent access during a work session and between work sessions. If you have questions about the data being collected and how it is being used, or to request that a corpus be removed, please contact \x26lt;a href\x3d"http://stefansinclair.name/contact/"\x26gt;St\u00e9fan Sinclair\x26lt;/a\x26gt;.'}}},
height:18,cls:"x-tab-bar-default voyant-footer",listeners:{boxready:function(a,b,c){c=[a.localize("voyantLink"),", \x3ca href\x3d'http://stefansinclair.name/'\x3eSt\x26eacute;fan Sinclair\x3c/a\x3e \x26amp; \x3ca href\x3d'http://geoffreyrockwell.com'\x3eGeoffrey Rockwell\x3c/a\x3e"," (\x26copy;"+(new Date).getFullYear()+")"," \x3ca href\x3d'http://docs.voyant-tools.org/privacy/' target\x3d'top' data-qtip\x3d'"+a.localize("privacyMsg")+"'\x3e"+a.localize("privacy")+"\x3c/a\x3e"," v. "+Voyant.application.getVersion()+
" ("+Voyant.application.getBuild()+")"];for(var d="",e=0,g,f=a.getEl(),h=0;h<c.length;h++)g=f.getTextWidth(c[h].replace(/<.+?>/g,"")),e+g<b&&(d+=c[h],e+=g);a.update(d)}}});Ext.define("Voyant.panel.VoyantHeader",{extend:"Ext.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.voyantheader",statics:{i18n:{title:{en:"Voyant Tools"}}},constructor:function(a){Ext.apply(this,{id:"voyantheader",title:"",layout:"fit",html:'\x3cdiv id\x3d"logo-container"\x3e\x3c/div\x3e',collapseMode:void 0,collapsible:!0,animCollapse:!1,titleCollapse:!1,floatable:!1,header:!0,hideCollapseTool:!0,listeners:{collapse:this.onCollapse},titleAlign:"center"});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.call(this,
Ext.apply(a,{moreTools:["corpusset"]}))},onCollapse:function(a){Ext.defer(function(){this.setTitle(this.localize("title"))},10,a)}});Ext.define("Voyant.panel.CorpusSet",{extend:"Ext.panel.Panel",requires:"Voyant.panel.Cirrus Voyant.panel.Summary Voyant.panel.CorpusTerms Voyant.panel.Reader Voyant.panel.Documents Voyant.panel.Trends Voyant.panel.Contexts Voyant.panel.DocumentTerms Voyant.panel.CorpusCollocates Voyant.panel.CollocatesGraph".split(" "),mixins:["Voyant.panel.Panel"],alias:"widget.corpusset",statics:{i18n:{title:{en:"Corpus View"},helpTip:{en:"This is the default, general-purpose corpus view."}},glyph:"xf17a@FontAwesome"},
constructor:function(a){this.callParent(arguments)},layout:"border",items:[{region:"center",flex:3,layout:"fit",xtype:"voyanttabpanel",tabBarHeaderPosition:0,items:{xtype:"reader"}},{region:"west",flex:3,layout:"fit",moreTools:["cirrus","corpusterms"],xtype:"voyanttabpanel",split:{width:5},tabBarHeaderPosition:0,items:[{xtype:"cirrus"},{xtype:"corpusterms"}]},{region:"east",flex:3,layout:"fit",xtype:"voyanttabpanel",split:{width:5},tabBarHeaderPosition:0,moreTools:["trends","collocatesgraph","corpuscollocates"],
items:[{xtype:"trends"},{xtype:"collocatesgraph"},{xtype:"corpuscollocates"}]},{region:"south",flex:2,split:{width:5},layout:"border",items:[{layout:"fit",region:"center",flex:1,xtype:"voyanttabpanel",split:{width:5},tabBarHeaderPosition:0,moreTools:["summary","documents"],items:[{xtype:"summary"},{xtype:"documents"}]},{layout:"fit",region:"east",flex:1,xtype:"voyanttabpanel",split:{width:5},tabBarHeaderPosition:0,moreTools:["contexts","documentterms"],items:[{xtype:"contexts"},{xtype:"bubblelines"}]}]}]});Ext.define("Voyant.panel.TabPanel",{extend:"Ext.tab.Panel",alias:"widget.voyanttabpanel",mixins:["Voyant.panel.Panel"],statics:{i18n:{}},constructor:function(a){console.warn(arguments);this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){this.callParent(arguments)},listeners:{tabchange:function(a,b){this.tools=[];this.getHeader().tools=[];this.query("toolmenu").forEach(function(a){a.destroy()});this.addTool(b.tools)},afterrender:function(a){this.fireEvent("tabchange",
this,this.getActiveTab())}},showOptionsClick:function(a){debugger;var b=a.getActiveTab();b.showOptionsClick&&b.showOptionsClick.apply(b,arguments)}});Ext.define("Voyant.VoyantApp",{extend:"Ext.app.Application",mixins:["Voyant.util.Deferrable","Voyant.util.Localization"],requires:["Voyant.util.ResponseError"],name:"VoyantApp",statics:{i18n:{error:{en:"Error"},serverResponseError:{en:"The server error reponse:"}}},config:{baseUrl:void 0,tromboneUrl:void 0},constructor:function(a){this.setBaseUrl(this.config.baseUrl);this.setTromboneUrl(this.config.baseUrl+"trombone");Voyant.application=this;this.callParent(arguments)},getTools:function(){return[{type:"maximize"},
{type:"help"}]},launch:function(){this.callParent(arguments);var a=Ext.Object.fromQueryString(document.location.search);if(!a||!a.debug||"true"!=a.debug){var b=this.getViewport();b.mask();Ext.create("Ext.window.Window",{title:"Voyant Tools 2.0 Preview Release",width:825,layout:"fit",modal:!0,layout:"vbox",items:[{width:800,margin:"10 5 3 10",html:"\x3ch2 style\x3d'text-align: center;'\x3eWelcome to this Preview Release of Voyant Tools 2.0!\x3c/h2\x3e\x3cp\x3eWe've tried to make things usable in order to give a glimpse of what's to come, but this is an early preview release with lots of missing goodies and a whole bunch of bugs. Please kick the tires and let us know if you have suggestions on \x3ca href\x3d'https://github.com/sgsinclair/Voyant/issues'\x3eGithub\x3c/a\x3e or \x3ca href\x3d'http://twitter.com/voyanttools'\x3eTwitter\x3c/a\x3e.\x3cul\x3e\x3cli\x3esome new features and functionality:\x3cul\x3e\x3cli\x3eflexible search (wildcards, phrases, proximity) \u2013 hover over search boxes for more details\x3c/li\x3e\x3cli\x3ebetter cross-platform and device support (all tools in HTML5, no Flash or Java Applets)\x3c/li\x3e\x3cli\x3emuch better support for larger corpora\x3c/li\x3e\x3cli\x3evastly improved performance throughout (corpus reader and collocates are notable examples)\x3c/li\x3e\x3c/ul\x3e\x3cli\x3esome things not yet fully implemented:\x3cul\x3e\x3cli\x3efull list of tools and skins from 1.0\x3c/li\x3e\x3cli\x3epanel/tool-level help, options, and exporting\x3c/li\x3e\x3cli\x3eadding and reordering documents (new in 2.0)\x3c/li\x3e\x3cli\x3eN-Gram support (term sequences) (new in 2.0)\x3c/li\x3e\x3c!--\x3cli\x3epart-of-speech tagging and lemmatization (new in 2.0)\x3c/li\x3e--\x3e\x3c/ul\x3e\x3c/li\x3e\x3c/ul\x3e\x3cp\x3eIt's best to assume that this preview release may be incompatible with future releases and that any stored corpora will no longer be available after your session. Of course, you can keep using \x3ca href\x3d'http://voyant-tools.org'\x3eVoyant Tools 1.0\x3c/a\x3e if you want persistence (normal persistence will be avilable with the full release of Voyant Tools 2.0). Have fun and please give us your \x3ca href\x3d'http://twitter.com/voyanttools'\x3efeeback\x3c/a\x3e!\x3c/p\x3e"},
{xtype:"button",glyph:"xf00c@FontAwesome",width:"100%",scale:"medium",text:"Continue",handler:function(a){a.up("window").close()}}],listeners:{close:function(a){b.unmask()}}}).show()}},tromboneCall:function(a){a=a?a:{};Ext.applyIf(a,{url:this.getTromboneUrl()});a.success||a.failure||a.callback||Ext.applyIf(a,{url:this.getTromboneUrl(),scope:this,callback:function(b,c,d){this.dispatchEvent(a.tool+"Loaded",b,c,d)}});Ext.Ajax.request(a)},getViewport:function(){return Ext.ComponentQuery.query("viewport")[0]},
dispatchEvent:function(a){var b=this.getViewport().query("panel,chart"),c=!1;this.hasListener&&this.hasListener(a)&&(this.fireEvent.apply(this,arguments),c=!0);for(var d=0;d<b.length;d++)b[d].hasListener&&b[d].hasListener(a)&&(c=!0,b[d].fireEvent.apply(b[d],arguments));c||console&&console.info("Unhandled event: "+a,arguments)},showResponseError:function(a,b){this.showError(Ext.create("Voyant.util.ResponseError",{msg:Ext.isString(a)?a:a.msg,response:b}))},showError:function(a){if(a instanceof Voyant.util.ResponseError){var b=
a.getResponse();Ext.apply(a,{message:a.getMsg()+" "+this.localize("serverResponseError")+"\x3cpre class\x3d'error'\x3e\n"+b.responseText.substring(0,b.responseText.indexOf("\n\t"))+"\u2026 \x3ca href\x3d'#' onclick\x3d\"window.open('').document.write(unescape('\x3cpre\x3e"+escape(b.responseText)+"\x3c/pre\x3e')); return false;\"\x3emore\x3c/a\x3e\x3c/pre\x3e"})}Ext.applyIf(a,{title:this.localize("error"),buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,autoScroll:!0});Ext.Msg.show(a)},getToolConfigFromToolXtype:function(a){cls=
Ext.ClassManager.getByAlias("widget."+a);return{xtype:a,title:this._localizeClass(cls,"title"),tooltip:{text:this._localizeClass(cls,"helpTip")},glyph:cls&&cls.glyph?cls.glyph:"xf12e@FontAwesome"}},colors:[[0,0,255],[51,197,51],[255,0,255],[121,51,255],[28,255,255],[255,174,0],[30,177,255],[182,242,58],[255,0,164],[51,102,153],[34,111,52],[155,20,104],[109,43,157],[128,130,33],[111,76,10],[119,115,165],[61,177,169],[202,135,115],[194,169,204],[181,212,228],[182,197,174],[255,197,197],[228,200,124],
[197,179,159]],rgbToHex:function(a){return"#"+(16777216+(a[0]<<16)+(a[1]<<8)+a[2]).toString(16).slice(1)},getColorPalette:function(a){if(a){a=[];for(var b=0;b<this.colors.length;b++)a.push(this.rgbToHex(this.colors[b]));return a}return this.colors},getColor:function(a,b){return b?this.rgbToHex(this.colors[a]):this.colors[a]},colorTermAssociations:new Ext.util.MixedCollection,getColorForTerm:function(a,b){-1!=a.indexOf(":")&&(a=a.split(":")[1]);var c=this.colorTermAssociations.get(a);null==c&&(c=this.colorTermAssociations.getCount()%
this.colors.length,c=this.colors[c],this.colorTermAssociations.add(a,c));b&&(c=this.rgbToHex(c));return c}});Ext.define("Voyant.VoyantCorpusApp",{extend:"Voyant.VoyantApp",name:"VoyantCorpusApp",requires:"Voyant.panel.CorpusSet Voyant.data.model.Corpus Voyant.panel.VoyantHeader Voyant.panel.VoyantFooter Voyant.panel.CorpusCreator Voyant.panel.Cirrus Voyant.panel.Summary Voyant.panel.CorpusTerms Voyant.panel.Reader Voyant.panel.Documents Voyant.panel.Trends Voyant.panel.Contexts Voyant.panel.DocumentTerms Voyant.panel.CorpusCollocates Voyant.panel.CollocatesGraph Voyant.panel.ScatterPlot Voyant.panel.TopicContexts".split(" "),
statics:{i18n:{fetchingCorpus:{en:"Fetching your corpus"},moreToolsScale:{en:"Tools by Scale"},moreToolsScaleCorpus:{en:"Corpus Tools"},moreToolsScaleDocument:{en:"Document Tools"},moreToolsType:{en:"Tools by Type"},moreToolsTypeViz:{en:"Visualization Tools"},moreToolsTypeGrid:{en:"Grid Tools"},moreToolsTypeOther:{en:"Other Tools"}}},config:{corpus:void 0,moreTools:[{i18n:"moreToolsScale",glyph:"xf07d@FontAwesome",items:[{i18n:"moreToolsScaleCorpus",glyph:"xf111@FontAwesome",items:"cirrus corpusterms corpuscollocates documents summary trends scatterplot".split(" ")},
{i18n:"moreToolsScaleDocument",glyph:"xf10c@FontAwesome",items:["cirrus","contexts","documentterms","reader","trends"]}]},{i18n:"moreToolsType",glyph:"xf12e@FontAwesome",items:[{i18n:"moreToolsTypeViz",glyph:"xf06e@FontAwesome",items:["cirrus","collocatesgraph","trends","scatterplot"]},{i18n:"moreToolsTypeGrid",glyph:"xf0ce@FontAwesome",items:["corpusterms","corpuscollocates","contexts","documentterms","documents"]},{i18n:"moreToolsTypeOther",glyph:"xf035@FontAwesome",items:["reader","summary"]}]}]},
launch:function(){this.callParent(arguments);var a=Ext.Object.fromQueryString(document.location.search);if(a.corpus||a.input){var b=this,c=b.getViewport();c.mask(this.localize("fetchingCorpus"));(new Corpus(a)).then(function(a){c.unmask();b.dispatchEvent("loadedCorpus",this,a)}).fail(function(a,b){c.unmask()})}},listeners:{loadedCorpus:function(a,b){this.setCorpus(b)}}});Ext.define("Voyant.VoyantDefaultApp",{extend:"Voyant.VoyantCorpusApp",mixins:["Voyant.util.Api"],name:"VoyantDefaultApp",constructor:function(){this.mixins["Voyant.util.Api"].constructor.apply(this,arguments);this.callParent(arguments)},statics:{i18n:{noViewErrorTitle:{en:"View Error"},noViewErrorTpl:{en:'No view was found with the name "{view}". You can \x3ca href\x3d"{url}"\x3etry with the default view\x3c/a\x3e instead'}},api:{view:"corpusset",stopList:"auto"}},listeners:{loadedCorpus:function(a,
b){this.viewport.down("voyantheader").collapse();this.viewport.down("#toolsContainer").setActiveItem(1);if(window.history.pushState){var c=b.getId(),d=Ext.Object.fromQueryString(document.location.search),e=this.getBaseUrl()+"?corpus\x3d"+c,g;for(g in d)"corpus"!==g&&(e+="\x26"+g+"\x3d"+d[g]);window.history.pushState({corpus:c},"Corpus: "+c,e)}}},getViewComponent:function(){return this.viewport.down("#toolsContainer-main")},launch:function(){var a=this.getApiParam("view","CorpusSet"),b=a.toLowerCase();
Ext.ClassManager.getByAlias("widget."+b)?(this.viewport=Ext.create("Ext.container.Viewport",{layout:"border",items:[{xtype:"voyantheader",region:"north"},{region:"south",xtype:"voyantfooter"},{region:"center",layout:"card",itemId:"toolsContainer",activeItem:0,items:[{xtype:"container",layout:{type:"hbox",pack:"center"},items:{xtype:"corpuscreator"}},{layout:"fit",itemId:"toolsContainer-main",items:{xtype:b}}]}]}),this.callParent(arguments)):(b=document.location.href.replace(/view=.*?&/,""),Ext.Msg.show({title:this.localize("noViewErrorTitle"),
message:(new Ext.Template(this.localize("noViewErrorTpl"))).apply({view:a,url:b}),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}))}});