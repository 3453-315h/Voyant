/* This file created by JSCacher. Last modified: Tue Dec 02 11:44:25 EST 2014 */
Ext.define("Voyant.data.model.Context",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"docIndex",type:"int"},{name:"docId"},{name:"left"},{name:"keyword"},{name:"term"},{name:"right"}]});var Corpus=function(a,b){return Ext.create("Voyant.data.model.Corpus",a,b)};
Ext.define("Voyant.data.model.Corpus",{alternateClassName:["Corpus"],mixins:["Voyant.notebook.util.Embeddable","Voyant.util.Transferable","Voyant.util.Localization"],transferable:"show getSize getId getDocument getDocuments getCorpusTerms getDocumentsCount getWordTokensCount getWordTypesCount getDocumentTerms".split(" "),embeddable:["Voyant.panel.Summary","Voyant.panel.Cirrus","Voyant.panel.Documents","Voyant.panel.CorpusTerms"],requires:["Voyant.util.ResponseError","Voyant.data.store.CorpusTerms",
"Voyant.data.store.Documents","Voyant.panel.Documents"],extend:"Ext.data.Model",config:{documentsStore:void 0},statics:{i18n:{failedCreateCorpus:{en:"Failed attempt to create a Corpus."},thisCorpus:{en:"This corpus"},isEmpty:{en:"is empty"},hasNdocuments:{en:new Ext.Template("has {count} documents")},has1document:{en:"has 1 document"},widthNwordsAndNTypes:{en:new Ext.Template("with {words} \x3cspan class\x3d'info-tip' data-qtip\x3d'every occurrence of every word (like multiple occurrences of \"the\") is counted'\x3etotal words\x3c/span\x3e and {types} \x3cspan class\x3d'info-tip' data-qtip\x3d'multiple occurrences of words (like \"the\") are counted once'\x3eunique word forms\x3c/span\x3e")},
yearAgo:{en:new Ext.Template("about a year ago")},yearsAgo:{en:new Ext.Template("about {count} years ago")},monthAgo:{en:new Ext.Template("about a month ago")},monthsAgo:{en:new Ext.Template("about {count} months ago")},dayAgo:{en:new Ext.Template("about a day ago")},daysAgo:{en:new Ext.Template("about {count} days ago")},hourAgo:{en:new Ext.Template("about an hour ago")},hoursAgo:{en:new Ext.Template("about {count} hours ago")},minuteAgo:{en:new Ext.Template("about a minute ago")},minutesAgo:{en:new Ext.Template("about {count} minutes ago")},
secondAgo:{en:new Ext.Template("about a second ago")},secondsAgo:{en:new Ext.Template("{count} seconds ago")},now:{en:"now"}}},fields:[{name:"documentsCount",type:"int"},{name:"lexicalTokensCount",type:"int"},{name:"lexicalTypesCount",type:"int"},{name:"createdTime",type:"int"},{name:"createdDate",type:"date",dateFormat:"c"}],constructor:function(a,b){this.callParent([b]);this.mixins["Voyant.notebook.util.Embeddable"].constructor.apply(this);if(a){b=b||{};Ext.apply(b,{tool:"corpus.CorpusMetadata"});
Ext.isString(a)||Ext.isArray(a)?b.input=a:Ext.isObject(a)&&Ext.apply(b,a);var c=Voyant.application.getDeferred(this),d=this;$.getJSON(Voyant.application.getTromboneUrl(),b).done(function(a){d.set(a.corpus.metadata);a=Ext.create("Voyant.data.store.Documents",{corpus:d});d.setDocumentsStore(a);a.load({params:{limit:100},callback:function(a,b,e){d.setDocumentsStore(this);c.resolve(d)},scope:a})}).fail(function(a){Voyant.application.showResponseError(d.localize("failedCreateCorpus"),a);c.reject()});return Voyant.application.getPromiseFromDeferred(c)}},
getId:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("id")},getCorpusTerms:function(a){return Ext.create("Voyant.data.store.CorpusTerms",Ext.apply(a||{},{corpus:this}))},getCorpusCollocates:function(a){return Ext.create("Voyant.data.store.CorpusCollocates",Ext.apply(a||{},{corpus:this}))},getDocumentQueryMatches:function(a){return Ext.create("Voyant.data.store.DocumentQueryMatches",Ext.apply(a||{},{corpus:this}))},getDocumentTerms:function(a){return Ext.create("Voyant.data.store.DocumentTerms",
Ext.apply(a||{},{corpus:this}))},getDocuments:function(a){return this.getDocumentsStore()?this.getDocumentsStore():Ext.create("Voyant.data.store.Documents",Ext.apply(a||{},{corpus:this}))},getDocument:function(a){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.getDocumentsStore().getDocument(a)},getDocumentsCount:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("documentsCount")},getWordTokensCount:function(){return this.then?
Voyant.application.getDeferredNestedPromise(this,arguments):this.get("lexicalTokensCount")},getWordTypesCount:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("lexicalTypesCount")},getCreatedTime:function(){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.get("createdTime")},show:function(a){return this.then?Voyant.application.getDeferredNestedPromise(this,arguments):this.getShow().show()},getShow:function(a){if(this.then)return Voyant.application.getDeferredNestedPromise(this,
arguments);var b=this.getDocumentsCount(),c=this.localize("thisCorpus");if(0==b)c+=" "+this.localize("isEmpty")+".";else{var c=c+" ",c=1<b?c+this.localize("hasNdocuments",{count:Ext.util.Format.number(b,"0,000")}):c+this.localize("has1document"),c=c+(" "+this.localize("widthNwordsAndNTypes",{words:Ext.util.Format.number(this.getWordTokensCount(),"0,000"),types:Ext.util.Format.number(this.getWordTypesCount(),"0,000")})+"."),c=c+" Created ",d=this.get("createdDate"),e=new Date;!0===Ext.Array.each([["year",
Ext.Date.YEAR],["month",Ext.Date.MONTH],["day",Ext.Date.DAY],["hour",Ext.Date.HOUR],["minute",Ext.Date.MINUTE],["second",Ext.Date.SECOND]],function(a){if(Ext.Date.diff(d,e,a[1])>("second"==a[0]?1:0)){var b=Ext.Date.diff(d,e,a[1]);c+="\x3cspan class\x3d'info-tip' data-qtip\x3d'"+Ext.Date.format(d,"Y-m-d, H:i:s")+"'\x3e";c=1==b?c+this.localize(a[0]+"Ago",{count:b,date:d}):c+this.localize(a[0]+"sAgo",{count:b,date:d});c+="\x3c/span\x3e";return!1}},this)&&(c+=this.localize("now"));c+=".";c+=""}return c}});Ext.define("Voyant.data.model.CorpusCollocate",{extend:"Ext.data.Model",fields:[{name:"term"},{name:"rawFreq",type:"int"},{name:"contextTerm"},{name:"contextTermRawFreq",type:"int"}],getTerm:function(){return this.getKeyword()},getRawFreq:function(){return this.getKeywordRawFreq()},getKeyword:function(){return this.get("term")},getKeywordRawFreq:function(){return this.get("rawFreq")},getContextTerm:function(){return this.get("contextTerm")},getContextTermRawFreq:function(){return this.get("contextTermRawFreq")}});Ext.define("Voyant.data.model.CorpusTerm",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"rawFreq",type:"int"},{name:"relativeFreq",type:"float"},{name:"relativePeakedness",type:"float"},{name:"relativeSkewness",type:"float"},{name:"distributions"},{name:"typeTokenRatio-lexical",type:"float",calculate:function(a){return a["typesCount-lexical"]/a["tokensCount-lexical"]}}],getTerm:function(){return this.get("term")}});Ext.define("Voyant.data.model.Document",{extend:"Ext.data.Model",requires:["Voyant.data.store.DocumentTerms"],fields:[{name:"corpus"},{name:"id"},{name:"index",type:"int"},{name:"tokensCount-lexical",type:"int"},{name:"typesCount-lexical",type:"int"},{name:"typeTokenRatio-lexical",type:"float",calculate:function(a){return a["typesCount-lexical"]/a["tokensCount-lexical"]}},{name:"title"},{name:"shortTitle",mapping:function(a){a=a.title.replace(/\.(html?|txt|xml|docx?|pdf|rtf|\/)$/,"");if(25<a.length){var b=
a.lastIndexOf("/");-1<b&&(a=a.substr(b+1));if(25<a.length){b=a.indexOf(" ",20);if(0>b||30<b)b=25;a=a.substring(0,b)+"\x26hellip;;"}}return a}},{name:"language",convert:function(a){return Ext.isEmpty(a)?"":a}}],getDocumentTerms:function(a){a=a||{};Ext.apply(a,{docId:this.get("id")});return this.get("corpus").getDocumentTerms(a)},getFullLabel:function(){return this.getTitle()},getTitle:function(){return this.get("title")},getShortTitle:function(){return this.get("shortTitle")},getCorpusId:function(){return this.get("corpus")},
isPlainText:function(){return this.get("extra.Content-Type")&&/plain/i.test(this.get("extra.Content-Type"))?!0:!1}});Ext.define("Voyant.data.model.DocumentQueryMatch",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"count",type:"int"},{name:"query"}],getCount:function(){return this.get("count")}});Ext.define("Voyant.data.model.DocumentTerm",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"term"},{name:"docIndex",type:"int"},{name:"docId"},{name:"rawFreq",type:"int"},{name:"relativeFreq",type:"float"},{name:"tfidf",type:"float"},{name:"zscore",type:"float"},{name:"zscoreRatio",type:"float"},{name:"distributions"}],getTerm:function(){return this.get("term")},getDocIndex:function(){return this.get("docIndex")}});Ext.define("Voyant.data.model.Token",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"docId"},{name:"docIndex",type:"int"},{name:"token"},{name:"rawFreq"},{name:"tokenType"},{name:"position",type:"int"},{name:"startOffset",type:"int"},{name:"endOffset",type:"int"}],statics:{getInfoFromElement:function(a){if(a&&a.getId)return a=a.getId().split("_"),{docIndex:a[1],position:a[2]}}},isWord:function(){return"lexical"==this.getTokenType()},getTokenType:function(){return this.get("tokenType")},getId:function(){return["",
this.getDocIndex(),this.getPosition()].join("_")},getDocIndex:function(){return this.get("docIndex")},getDocId:function(){return this.get("docId")},getTerm:function(){return this.get("term")},getTermWithLineSpacing:function(a){var b=this.getTerm().replace(/<\/?\w+\b.*?>/g,"\x3cbr /\x3e\x3cbr /\x3e").replace(/>\s+</g,"\x3e\x3c").replace(/<br \/><br \/>(<br \/>)+/g,"\x3cbr /\x3e\x3cbr /\x3e");a&&(b=b.replace(/(\r\n|\r|\n)\s*/g,"\x3cbr /\x3e"));return b},getPosition:function(){return this.get("position")},
getDocumentRawFreq:function(){return this.get("rawFreq")}});Ext.define("Voyant.data.store.Contexts",{extend:"Ext.data.Store",mixins:["Voyant.util.Transferable","Voyant.notebook.util.Embeddable"],model:"Voyant.data.model.Context",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentContexts",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,stripTags:a.stripTags},reader:{type:"json",rootProperty:"documentContexts.contexts"},simpleSortMode:!0}});
this.callParent([a])},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.CorpusCollocates",{extend:"Ext.data.BufferedStore",mixins:["Voyant.util.Transferable","Voyant.notebook.util.Embeddable"],model:"Voyant.data.model.CorpusCollocate",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,autoLoad:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.CorpusCollocates",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():
void 0},reader:{type:"json",rootProperty:"corpusCollocates.collocates",totalPropery:"corpusCollocates.total"},simpleSortMode:!0},reader:{type:"json",rootProperty:"corpusCollocates.collocates",totalPropery:"corpusCollocates.total"}});this.callParent([a])},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.proxy.CorpusTerms",{extend:"Ext.data.proxy.Ajax",constructor:function(a){a=a||{};Ext.apply(a,{extraParams:Ext.apply(a.extraParams||{},{tool:"corpus.CorpusTerms"})});Ext.applyIf(a,{url:Voyant.application.getTromboneUrl()});this.callParent([a])},reader:{type:"json",rootProperty:"corpusTerms.terms",totalProperty:"corpusTerms.total"},simpleSortMode:!0});
Ext.define("Voyant.data.store.CorpusTerms",{extend:"Ext.data.BufferedStore",mixins:["Voyant.util.Transferable","Voyant.notebook.util.Embeddable"],model:"Voyant.data.model.CorpusTerm",transferable:["setCorpus"],requires:["Voyant.panel.CorpusTerms","Voyant.panel.Cirrus"],embeddable:["Voyant.panel.CorpusTerms","Voyant.panel.Cirrus"],config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,autoLoad:!1,proxy:Ext.create("Voyant.data.proxy.CorpusTerms")});
this.mixins["Voyant.notebook.util.Embeddable"].constructor.apply(this,arguments);this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),c=this;a.corpus.then(function(a){c.setCorpus(a);c.getAutoLoad()?c.load({callback:function(){b.resolve(c)}}):b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.DocumentQueryMatches",{extend:"Ext.data.Store",model:"Voyant.data.model.DocumentQueryMatch",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{autoLoad:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsFinder",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"documentsFinder.queries"}}});this.callParent([a]);a&&a.corpus&&this.setCorpus(a.corpus)},
setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.data.store.Documents",{extend:"Ext.data.BufferedStore",model:"Voyant.data.model.Document",mixins:["Voyant.util.Transferable","Voyant.notebook.util.Embeddable"],embeddable:["Voyant.panel.Documents"],config:{corpus:void 0},statics:{i18n:{failedGetDocuments:{en:"Failed attempt to get documents."}}},sorters:{property:"index",direction:"ASC"},remoteSort:!0,constructor:function(a){Ext.apply(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),
extraParams:{tool:"corpus.DocumentsMetadata",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"documentsMetadata.documents",totalProperty:"documentsMetadata.total"},simpleSortMode:!0},listeners:{load:function(a,b,c,h){if(c){var g=a.getCorpus();b.forEach(function(a){a.set("corpus",g)})}}}});this.mixins["Voyant.notebook.util.Embeddable"].constructor.apply(this,arguments);this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),
c=this;a.corpus.then(function(a){c.setCorpus(a);b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)},getDocument:function(a){if(this.getCorpus().getDocumentsCount()!=this.getTotalCount()){var b=Voyant.application.getDeferred();this.load({scope:this,callback:function(c,d,e){e?b.resolve(this.getDocument(a)):(Voyant.application.showResponseError(this.localize("failedGetDocuments"),
response),b.reject())}});return b.promise()}return Ext.isNumber(a)?this.getAt(a):this.getById(a)}});Ext.define("Voyant.data.store.DocumentTerms",{extend:"Ext.data.BufferedStore",mixins:["Voyant.util.Transferable","Voyant.notebook.util.Embeddable"],model:"Voyant.data.model.DocumentTerm",transferable:["setCorpus"],requires:["Voyant.panel.DocumentTerms","Voyant.panel.Cirrus"],embeddable:["Voyant.panel.DocumentTerms","Voyant.panel.Cirrus"],config:{corpus:void 0},constructor:function(a){a=a||{};Ext.applyIf(a,{pagePurgeCount:0,pageSize:100,leadingBufferZone:100,remoteSort:!0,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),
extraParams:{tool:"corpus.DocumentTerms",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0}});this.mixins["Voyant.notebook.util.Embeddable"].constructor.apply(this,arguments);this.callParent([a]);if(a&&a.corpus){if(a.corpus.then){var b=Voyant.application.getDeferred(this),c=this;a.corpus.then(function(a){c.setCorpus(a);b.resolve(c)});return Voyant.application.getPromiseFromDeferred(b)}this.setCorpus(a.corpus)}},
setCorpus:function(a){a&&(this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId()),this.load());this.callParent(arguments)}});Ext.define("Voyant.data.store.Tokens",{extend:"Ext.data.Store",mixins:["Voyant.util.Transferable","Voyant.notebook.util.Embeddable"],model:"Voyant.data.model.Token",config:{corpus:void 0},constructor:function(a){a=a||{};Ext.apply(a,{proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTokens",corpus:a&&a.corpus?Ext.isString(a.corpus)?a.corpus:a.corpus.getId():void 0,stripTags:a.stripTags},reader:{type:"json",rootProperty:"documentTokens.tokens",totalProperty:"documentTokens.total"},
simpleSortMode:!0}});this.callParent([a])},setCorpus:function(a){a&&this.getProxy().setExtraParam("corpus",Ext.isString(a)?a:a.getId());this.callParent(arguments)}});Ext.define("Voyant.notebook.editor.button.Add",{extend:"Ext.button.Button",mixins:["Voyant.util.Localization"],alias:"widget.notebookwrapperadd",statics:{i18n:{tip:{en:"Add New Block"}}},constructor:function(a){Ext.apply(this,{tooltip:this.localize("tip")});this.callParent(arguments)},glyph:"xf055@FontAwesome",textAlign:"left",listeners:{click:function(a,b){this.findParentByType("notebook").fireEvent("notebookWrapperAdd",this.findParentByType("notebookeditorwrapper"),b)}}});Ext.define("Voyant.notebook.editor.button.Edit",{extend:"Ext.button.Button",mixins:["Voyant.util.Localization"],alias:"widget.notebookwrapperedit",statics:{i18n:{tip:{en:"Edit"}}},constructor:function(a){Ext.apply(this,{toolTip:this.localize("tip")});this.callParent(arguments)},glyph:"xf040@FontAwesome",listeners:{click:function(){this.findParentByType("notebook").fireEvent("notebookWrapperEdit",this.findParentByType("notebookeditorwrapper"))}}});Ext.define("Voyant.notebook.editor.button.MoveDown",{extend:"Ext.button.Button",mixins:["Voyant.util.Localization"],alias:"widget.notebookwrappermovedown",statics:{i18n:{tip:{en:"Move Down"}}},constructor:function(a){Ext.apply(this,{text:this.localize("tip")});this.callParent(arguments)},glyph:"xf0ab@FontAwesome",textAlign:"left",listeners:{click:function(){this.findParentByType("notebook").fireEvent("notebookWrapperMoveDown",this.findParentByType("notebookeditorwrapper"))}}});Ext.define("Voyant.notebook.editor.button.Movement",{extend:"Ext.button.Button",mixins:["Voyant.util.Localization"],requires:["Voyant.notebook.editor.button.MoveUp","Voyant.notebook.editor.button.MoveDown","Voyant.notebook.editor.button.Remove"],alias:"widget.notebookwrappermovement",statics:{i18n:{tip:{en:"Move / Remove Controls"}}},constructor:function(a){Ext.apply(this,{tooltip:this.localize("tip")});this.callParent(arguments)},glyph:"xf07d@FontAwesome",menu:[{xtype:"notebookwrappermoveup"},{xtype:"notebookwrappermovedown"},
" ",{xtype:"notebookwrapperremove"}]});Ext.define("Voyant.notebook.editor.button.MoveUp",{extend:"Ext.button.Button",mixins:["Voyant.util.Localization"],alias:"widget.notebookwrappermoveup",statics:{i18n:{tip:{en:"Move Up"}}},constructor:function(a){Ext.apply(this,{text:this.localize("tip")});this.callParent(arguments)},glyph:"xf0aa@FontAwesome",textAlign:"left",listeners:{click:function(){this.findParentByType("notebook").fireEvent("notebookWrapperMoveUp",this.findParentByType("notebookeditorwrapper"))}}});Ext.define("Voyant.notebook.editor.button.Remove",{extend:"Ext.button.Button",mixins:["Voyant.util.Localization"],alias:"widget.notebookwrapperremove",statics:{i18n:{tip:{en:"Remove"},confirmRemoveTitle:{en:"Confirm Remove"},confirmRemove:{en:"Are you sure you want to remove this block (and lose any content in the editor)?"}}},constructor:function(a){Ext.apply(this,{text:this.localize("tip")});this.callParent(arguments)},glyph:"xf057@FontAwesome",textAlign:"left",listeners:{click:function(){Ext.Msg.show({buttons:Ext.Msg.OKCANCEL,
icon:Ext.MessageBox.QUESTION,msg:this.localize("confirmRemove"),title:this.localize("confirmRemoveTitle"),fn:function(a){"ok"==a&&this.findParentByType("notebook").fireEvent("notebookWrapperRemove",this.findParentByType("notebookeditorwrapper"))},scope:this})}}});Ext.define("Voyant.notebook.editor.button.Run",{extend:"Ext.button.Button",mixins:["Voyant.util.Localization"],alias:"widget.notebookwrapperrun",statics:{i18n:{tip:{en:"Run the script in this block"}}},glyph:"xf144@FontAwesome"});Ext.define("Voyant.notebook.editor.CodeEditor",{extend:"Ext.Component",alias:"widget.notebookcodeeditor",mixins:["Voyant.util.Localization"],cls:"notebook-code-editor",config:{theme:"ace/theme/chrome",mode:"ace/mode/javascript",content:""},statics:{i18n:{emptyText:{en:"// click here to edit"}}},listeners:{boxready:function(){var a=this;this.editor=ace.edit(Ext.getDom(this.getEl()));this.editor.setTheme(this.getTheme());this.editor.getSession().setMode(this.getMode());this.editor.setOptions({minLines:6,
maxLines:100});this.editor.setHighlightActiveLine(!1);this.editor.renderer.setShowPrintMargin(!1);this.editor.renderer.setShowGutter(!1);this.editor.setValue(this.getContent()?this.getContent():this.localize("emptyText"));this.editor.clearSelection();this.editor.on("focus",function(){a.editor.renderer.setShowGutter(!0)});this.editor.on("blur",function(){a.editor.renderer.setShowGutter(!1)});var b=this.getHeight();this.editor.on("change",function(c,d){Ext.Function.defer(function(){b!=a.getHeight()&&
(a.ownerCt.fireEvent("editorresize",a),b=a.getHeight())},10)})}},getValue:function(){return this.editor.getValue()}});Ext.define("Voyant.notebook.editor.CodeEditorWrapper",{extend:"Voyant.notebook.editor.EditorWrapper",requires:["Voyant.notebook.editor.CodeEditor","Voyant.notebook.editor.button.Run"],alias:"widget.notebookcodeeditorwrapper",cls:"notebook-code-wrapper",layout:{type:"vbox",align:"stretch"},height:130,border:!1,constructor:function(a){this.results=Ext.create("Ext.Component",{align:"stretch",cls:"notebook-code-results"});this.editor=Ext.create("Voyant.notebook.editor.CodeEditor",{content:a.content});
Ext.apply(this,{dockedItems:[{xtype:"toolbar",dock:"left",items:[{xtype:"notebookwrapperrun",listeners:{click:{fn:this.run,scope:this}}}," ",{xtype:"notebookwrappermovement"}," ",{xtype:"notebookwrapperadd"}]}],items:[this.editor,this.results]});this.callParent(arguments)},run:function(){this.results.show();this.results.update(" ");this.results.mask("working\u2026");var a=this.editor.getValue();try{Voyant.notebook.util.Show.TARGET=this.results.getEl(),eval.call(window,a),Ext.defer(this.tryToUnmask,
20,this)}catch(b){this.results.unmask(),Voyant.application.releaseAllDeferred(),Voyant.notebook.util.Show.showError(b)}return!1},tryToUnmask:function(){if(0==Voyant.application.getDeferredCount()){for(var a in window)"object"==typeof window[a]&&window[a]&&window[a].isFulfilled&&window[a].isFulfilled()&&(window[a]=window[a].valueOf());this.results.unmask();0==this.results.getEl().dom.textContent.trim().length&&this.results.hide();this.fireEvent("editorresize")}else Ext.defer(this.tryToUnmask,20,this)},
getContent:function(){return this.editor.getValue()}});Ext.define("Voyant.notebook.editor.EditorWrapper",{extend:"Ext.panel.Panel",mixins:["Voyant.util.Localization"],requires:["Voyant.notebook.editor.button.Movement","Voyant.notebook.editor.button.Add"],alias:"widget.notebookeditorwrapper",cls:"notebook-editor-wrapper",config:{content:"",isEditing:!1},border:!1,bodyBorder:!1,initComponent:function(){this.on("afterrender",function(){this.child("toolbar").getEl().setVisibilityMode(Ext.dom.Element.VISIBILITY).setVisible(!1);this.body.on("click",function(){this.removeCls("notebook-editor-wrapper-hover")});
this.mon(this.getEl(),"mouseover",function(){this.child("toolbar").getEl().setVisibility(!0);this.getIsEditing()||this.body.addCls("notebook-editor-wrapper-hover")},this);this.mon(this.getEl(),"mouseout",function(){this.child("toolbar").getEl().setVisibility(!1);this.getIsEditing()||this.body.removeCls("notebook-editor-wrapper-hover")},this);var a=this.getHeight();this.on("editorresize",function(b){var c=0;this.items.each(function(a){c+=a.getHeight()});c>this.getHeight()?this.setSize({height:c}):
this.getHeight()<c&&c>a&&this.setSize({height:c});this.updateLayout()})},this);this.callParent(arguments)}});Ext.define("Voyant.notebook.editor.TextEditor",{extend:"Ext.Component",mixins:["Voyant.util.Localization"],alias:"widget.notebooktexteditor",cls:"notebook-text-editor",config:{theme:"ace/theme/chrome",mode:"ace/mode/javascript",content:"test",ckeditorConfig:{toolbar:[{name:"basicstyles",items:["Bold","Italic","-","RemoveFormat"]},{name:"paragraph",items:"NumberedList BulletedList - Outdent Indent Blockquote JustifyLeft JustifyCenter JustifyRight".split(" ")},{name:"colors",items:["TextColor","BGColor"]},
{name:"styles",items:["Styles","Format"]},{name:"links",items:["Link","Unlink"]},{name:"insert",items:["Image","Table"]},{name:"document",items:["Source"]}],allowedContent:!0,toolbarCanCollapse:!0},editor:void 0},statics:{i18n:{emptyText:{en:"(Click here to edit.)"}}},border:!1,constructor:function(a){Ext.apply(this,{html:'\x3cdiv contenteditable\x3d"true"\x3e'+(a.content?a.content:this.localize("emptyText"))+"\x3c/div\x3e"});this.callParent(arguments)},listeners:{boxready:function(){var a=this;this.getEl().set({contenteditable:!0});
var b=CKEDITOR.inline(Ext.getDom(this.getEl()),this.getCkeditorConfig());b.on("focus",function(b,c){a.findParentByType("notebookeditorwrapper").setIsEditing(!0)});b.on("blur",function(b,c){a.findParentByType("notebookeditorwrapper").setIsEditing(!1).getEl().fireEvent("mouseout")});var c=this.getHeight();b.on("change",function(b,e){c!=a.getHeight()&&(a.ownerCt.fireEvent("editorresize",a),c=a.getHeight(),a.setContent(e.getValue()))});this.setEditor(b)}},getContent:function(){return this.getEditor()?
this.getEditor().getData():""}});Ext.define("Voyant.notebook.editor.TextEditorWrapper",{extend:"Voyant.notebook.editor.EditorWrapper",requires:["Voyant.notebook.editor.TextEditor","Voyant.notebook.editor.button.Edit"],alias:"widget.notebooktexteditorwrapper",cls:"notebook-text-wrapper",config:{content:""},minHeight:85,dockedItems:[{xtype:"toolbar",dock:"left",items:[{xtype:"notebookwrappermovement"}," ",{xtype:"notebookwrapperadd"}]}],constructor:function(a){Ext.apply(this,{items:[{xtype:"notebooktexteditor",content:a.content}]});
this.callParent(arguments)},getContent:function(){return this.items.get(0).getContent()}});Ext.define("Voyant.notebook.Notebook",{extend:"Ext.panel.Panel",requires:["Voyant.notebook.editor.CodeEditorWrapper","Voyant.notebook.editor.TextEditorWrapper","Voyant.notebook.util.Show","Voyant.panel.Cirrus","Voyant.panel.Summary"],mixins:["Voyant.panel.Panel"],alias:"widget.notebook",statics:{i18n:{title:{en:"Voyant Notebook"},eror:{en:"Error"},cannotMoveHigher:{en:"This block is already at the top and cannot be moved higher."},cannotMoveLower:{en:"This block is already at the bottom and cannot be moved lower."},
defaultBlocks:{en:[{type:"text",content:"\x3ch1 style\x3d'text-align: center;'\x3eVoyant Notebook Template (title)\x3c/h1\x3e\x3cp\x3eThis is a Voyant Notebook, a dynamic document that combines writing, code and data in service of reading, analyzing and interpreting digital texts.\x3c/p\x3e\x3cp\x3eVoyant Notebooks are composed of text blocks (like this one) and code blocks (like the one below). You can \x3cspan class\x3d'marker'\x3eclick on the blocks to edit\x3c/span\x3e them and add new blocks by clicking add icon that appears in the left column when hovering over a block.\x3c/p\x3e"},
{content:'// create a new corpus and embed the default visualization for its terms\nvar corpus \x3d new Corpus("Hello world!");\ncorpus.getCorpusTerms().embed();'}]},failedNotebookLoad:{en:"Failed to load the specified notebook. A new notebook template will be presented instead."},failedNotebookParse:{en:"The loaded notebook appears to have a syntax error and will probably not run as is."},exportAllLinks:{en:"\x3cul\x3e\x3cli\x3eopen notebook in \x3ca href\x3d'{0}'\x3ecurrent window\x3c/a\x3e or a \x3ca href\x3d'{0}' target\x3d'_blank'\x3enew window\x3c/a\x3e\x3c/li\x3e\x3cli\x3eview \x3ca href\x3d'#' onclick\x3d'{1}' target\x3d'_blank'\x3eraw notebook code\x3c/a\x3e in new window\x3c/li\x3e\x3c/ul\x3e"},
originalJson:{en:"Original JSON string"}}},constructor:function(){Ext.apply(this,{title:this.localize("title"),tools:[{type:"help"},{type:"next",handler:this.runAllCode,scope:this},{type:"save",handler:this.exportAll,scope:this}]});this.callParent(arguments)},autoScroll:!0,listeners:{boxready:function(){var a=Ext.Object.fromQueryString(document.location.search,!0);if(a.input)this.loadBlocksFromString(a.input),a.run&&this.runAllCode();else{var b=location.href.replace(location.hash,"").replace(location.search,
"");if((b=b.substring(b.lastIndexOf("/",b.length-2)+1,b.length-1))&&"new"!=b){var c=this;this.mask(this.localize("fetchingNotebook"));$.getJSON(this.getTromboneUrl(),{tool:"notebook.NotebookManager",notebook:b}).done(function(a){c.loadBlocks(a)}).fail(function(a,b,f){"parsererror"==b?c.loadBlocksFromString(a.responseText):(Ext.create("Voyant.util.ResponseError",{msg:c.localize("failedNotebookLoad"),response:a}).showMsg(),c.loadBlocks(c.localize("defaultBlocks")))}).always(function(){c.unmask();a&&
a.run&&c.runAllCode()})}else this.loadBlocks(this.localize("defaultBlocks")),a.run&&this.runAllCode()}},notebookWrapperMoveUp:function(a){a=this.items.findIndex("id",a.id);0==a?Ext.Msg.show({title:this.localize("error"),msg:this.localize("cannotMoveHigher"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING}):this.move(a,a-1)},notebookWrapperMoveDown:function(a){a=this.items.findIndex("id",a.id);a==this.items.getCount()-1?Ext.Msg.show({title:this.localize("error"),msg:this.localize("cannotMoveLower"),
buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING}):this.move(a,a+1)},notebookWrapperRemove:function(a){this.remove(a)},notebookWrapperRun:function(a){},notebookWrapperAdd:function(a,b){var c=this.items.findIndex("id",a.id),d=a.getXType(a);"notebooktexteditorwrapper"==d&&!b.hasModifier()||"notebookcodeeditorwrapper"==d&&b.hasModifier()?this.addCode("",c+1):this.addText("",c+1)}},loadBlocksFromString:function(a){if(/^\s*[\[\{].*?[\}\]]\s*$/.test(a)){var b=void 0;try{b=jQuery.parseJSON(a)}catch(c){Ext.create("Voyant.util.DetailedError",
{msg:this.localize("failedNotebookParse"),error:c.message,details:c.stack+"\n\n"+this.localize("originalJson")+": "+a}).showMsg()}b&&this.loadBlocks(Ext.isArray(b)?b:[b])}else this.loadBlocks([a])},loadBlocks:function(a){a.forEach(function(a){a&&(Ext.isString(a)&&""!=a?this.addCode(a):a.content&&("text"==a.type?this.addText(a.content):this.addCode(a.content)))},this)},addText:function(a,b){this._add(a,b,"notebooktexteditorwrapper")},addCode:function(a,b){this._add(a,b,"notebookcodeeditorwrapper")},
_add:function(a,b,c){b="undefined"===typeof b?this.items.getCount():b;this.insert(b,{xtype:c,content:a})},runAllCode:function(){var a=[];this.items.each(function(b){b.isXType("notebookcodeeditorwrapper")&&a.push(b)});this._runCodeContainers(a)},_runCodeContainers:function(a){0<a.length&&(0==Voyant.application.getDeferredCount()&&a.shift().run(),Ext.defer(this._runCodeContainers,100,this,[a]))},exportAll:function(){var a=[];this.items.each(function(b){a.push({type:b.isXType("notebookcodeeditorwrapper")?
"code":"text",content:b.getContent()})});1==a.length&&"code"==a[0].type&&(a=a[0].content);var b="./?input\x3d"+encodeURIComponent(Ext.encode(a)),c="window.open().document.write(unescape('"+escape(Ext.encode(a))+"')); return false";Ext.Msg.alert("",(new Ext.Template(this.localize("exportAllLinks"))).apply([b,c]))}});Ext.define("Voyant.notebook.util.Embeddable",{mixins:["Voyant.util.Localization"],statics:{i18n:{widgetNotRecognized:{en:new Ext.Template('"{widget}" is not a recognized Voyant widget.')},knownWidgets:{en:"Known widgets: "}}},transferable:["getEmbeddable","getEmbedTo","embed"],constructor:function(){if(this.embeddable)for(var a=0;a<this.embeddable.length;a++){var b=this.embeddable[a],c="embed"+b.substring(b.lastIndexOf(".")+1),d=this,e=function(a){var b=arguments.callee.embeddable;this.then?this.then(function(){d.embed(b,
a)}):this.embed(b,a)};e.embeddable=b;this[c]=e;this.transferable.push(c)}},getEmbeddable:function(a){if(Ext.isFunction(a))return a;if(Ext.isString(a)){var b=Ext.ClassManager.get(a);if(b||(b=Ext.ClassManager.get("Voyant.panel."+a)))return b}a=this.localize("widgetNotRecognized",{widget:a.toString()});a+=" "+this.localize("knownWidgets")+this.embeddable.join(", ");showError(a);return!1},getEmbedTo:function(){if(Voyant.notebook.util.Show)return Voyant.notebook.util.Show.TARGET.insertHtml("beforeEnd",
"\x3cdiv\x3e\x3c/div\x3e")},embed:function(a,b){if(this.then)return Voyant.application.getDeferredNestedPromise(this,arguments);Ext.isObject(a)&&!b&&(b=a,a=this.embeddable[0]);a=a?a:this.embeddable?this.embeddable[0]:void 0;if(a=this.getEmbeddable(a)){var c=Voyant.application.getDeferred();b=b||{};Ext.applyIf(b,{renderTo:this.getEmbedTo(),height:350,listeners:{afterrender:function(){c.resolve()}},embedded:this});Ext.create(a,b)}}});Ext.define("Voyant.notebook.util.Show",{extend:"Ext.Base",requires:[],statics:{show:function(a){if(this.then){var b=Voyant.application.getDeferred();return this.then(function(a){a.show();b.resolve()}).fail(function(a){a&&showError(a);b.reject()})}if(0<arguments.length)if(1<arguments.length){show("\x3cdiv class\x3d'"+Voyant.notebook.util.Show.MODE+"'\x3e");Voyant.notebook.util.Show.SINGLE_LINE_MODE=!0;for(var c=0;c<arguments.length;c++)arguments[c].show.call(arguments[c]);Voyant.notebook.util.Show.SINGLE_LINE_MODE=
!1;show("\x3c/div\x3e")}else arguments[0].show.call(arguments[0]);else a=a||(this==window?"[empty]":this),Voyant.notebook.util.Show.TARGET?(0==Voyant.notebook.util.Show.SINGLE_LINE_MODE&&(a="\x3cdiv class\x3d'"+Voyant.notebook.util.Show.MODE+"'\x3e"+a+"\x3c/div\x3e"),Voyant.notebook.util.Show.TARGET.insertHtml?Voyant.notebook.util.Show.TARGET.insertHtml("beforeEnd",a):Voyant.notebook.util.Show.TARGET.innerHTML&&(Voyant.notebook.util.Show.TARGET.innerHTML+=a)):Ext.Msg.show({msg:a,buttons:Ext.Msg.OK,
icon:"error"==Voyant.notebook.util.Show.MODE?Ext.window.MessageBox.ERROR:Ext.window.MessageBox.INFO})},showError:function(a,b){var c=Voyant.notebook.util.Show.MODE;Voyant.notebook.util.Show.MODE="error";this instanceof Voyant.util.ResponseError&&(a=this);a instanceof Voyant.util.ResponseError?(console&&console.error(a.getResponse()),b=a.getResponse().responseText,a=a.getMsg()):(a.stack&&!b&&(b=a.stack),b&&!1===Ext.isString(b)&&(b=b.toString()));console&&console.error(a);b&&(console&&console.error(b),
a="\x3ch3\x3e"+a.toString()+"\x3c/h3\x3e\x3cpre\x3e"+Ext.String.htmlEncode(b)+"\x3c/pre\x3e");show(a);Voyant.notebook.util.Show.MODE=c},TARGET:null,MODE:"info",SINGLE_LINE_MODE:!1}});var cirrushtml5path=Ext.Loader.getPath("resources")+"/cirrus/html5";Ext.Loader.loadScript(cirrushtml5path+"/Cirrus.js");Ext.Loader.loadScript(cirrushtml5path+"/Word.js");Ext.Loader.loadScript(cirrushtml5path+"/WordController.js");
Ext.define("Voyant.panel.Cirrus",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.cirrus",statics:{i18n:{title:{en:"Cirrus"}},api:{limit:50,stopList:"auto",terms:void 0}},config:{mode:void 0},MODE_CORPUS:"corpus",MODE_DOCUMENT:"mode_document",layout:"fit",constructor:function(a){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);if(a.embedded){var b=Ext.getClass(a.embedded).getName();"Voyant.data.store.CorpusTerms"==
b&&this.loadFromCorpusTerms(a.embedded);"Voyant.data.model.Corpus"==b&&this.loadFromCorpusTerms(a.embedded.getCorpusTerms())}},listeners:{resize:function(a,b,c){this.cirrus&&this.cirrus.resizeWords()},loadedCorpus:function(a,b){this.loadFromCorpus(b)},documentsClicked:function(a,b,c){b&&(this.setApiParam("docId",b[0].getId()),this.loadFromDocumentTerms(b[0].getDocumentTerms({autoload:!1,corpus:c})))},ensureCorpusView:function(a,b){this.getMode()!=this.MODE_CORPUS&&this.loadFromCorpus(b)}},loadFromCorpus:function(a){this.loadFromCorpusTerms(a.getCorpusTerms({autoload:!1}))},
loadFromDocumentTerms:function(a){a.load({callback:function(a,c,d){this.setMode(this.MODE_DOCUMENT);this.loadFromTermsRecords(a)},scope:this,params:this.getApiParams()})},loadFromCorpusTerms:function(a){a.load({callback:function(a,c,d){this.setMode(this.MODE_CORPUS);this.loadFromTermsRecords(a)},scope:this,params:this.getApiParams()})},loadFromTermsRecords:function(a){var b=[];a.forEach(function(a){b.push({word:a.get("term"),size:a.get("rawFreq"),value:a.get("rawFreq")})});this.buildFromTerms(b)},
buildFromTerms:function(a){if(this.rendered&&a){var b=this,c=this.getLayout().getRenderTarget();this.cirrus&&c.update("");this.cirrus=new Cirrus({containerId:this.getLayout().getRenderTarget().dom.id,clickHandler:function(a){b.getApplication().dispatchEvent("termsClicked",b,[a])},words:a})}else Ext.defer(this.buidlFromTerms,50,this)}});Ext.define("Voyant.panel.CollocatesGraph",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.collocatesgraph",statics:{i18n:{title:{en:"Collocates Graph"}},api:{limit:15,stopList:"auto",terms:void 0}},config:{corpus:void 0,node:void 0,link:void 0,nodes:void 0,links:void 0,force:void 0,corpusColours:d3.scale.category10()},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){Ext.apply(this,
{title:this.localize("title"),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}],listeners:{loadedCorpus:{fn:function(a,b){this.setCorpus(b);this.isVisible()&&this.initLoad()},scope:this},query:{fn:function(a,b){this.loadFromQuery(b)},scope:this},activate:{fn:function(){this.getCorpus()&&Ext.Function.defer(this.initLoad,100,this)},scope:this}}});this.mixins["Voyant.panel.Panel"].initComponent.apply(this,
arguments);this.callParent(arguments)},initLoad:function(){this.getCorpus()&&(this.initGraph(),this.getCorpus().getCorpusTerms({leadingBufferZone:0,autoLoad:!1}).load({callback:function(a,b,c){c&&this.loadFromCorpusTermRecords(a)},scope:this,params:{limit:10,stopList:this.getApiParam("stopList")}}))},loadFromQuery:function(a){var b=this.getCorpus().getCorpusCollocates({autoLoad:!1});this.setApiParams({query:a,mode:"corpus"});b.load({params:this.getApiParams(),callback:function(a,b,e){e&&this.loadFromCorpusCollocateRecords(a)},
scope:this})},loadFromCorpusTermRecords:function(a){if(Ext.isArray(a)&&0<a.length){var b=[];a.forEach(function(a){b.push(a.getTerm())});this.loadFromCorpusTermStringsArray(b)}},loadFromCorpusTermStringsArray:function(a){var b=this.getCorpus().getCorpusCollocates({autoLoad:!1});this.setApiParams({query:a,mode:"corpus"});b.load({params:this.getApiParams(),callback:function(a,b,e){e&&this.loadFromCorpusCollocateRecords(a)},scope:this})},loadFromCorpusCollocateRecords:function(a){if(Ext.isArray(a)){var b=
this.getNodes()||{},c=this.getLinks()||{},d=this.getApiParam("limit");a.forEach(function(a){var f={term:a.getKeyword(),type:"keyword",value:a.getKeywordRawFreq(),start:d},h=[f.term,f.type].join(";");b[h]?b[h].value+=f.value:b[h]=f;f={term:a.getContextTerm(),type:"context",value:a.getContextTermRawFreq(),start:0};a=[f.term,f.type].join(";");b[a]?b[a].value+=f.value:b[a]=f;f=[h,a].join("--");c[f]||(c[f]={source:b[h],target:b[a]})});this.updateNodesAndLinks(b,c)}},initGraph:function(){var a=this.getLayout().getRenderTarget();
a.update("");var b=a.getHeight(),c=a.getWidth();this.setForce(d3.layout.force().nodes([]).links([]).charge(-50).linkDistance(120).size([c,b]).on("tick",function(){link.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y});node.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}));a=d3.select(a.dom).append("svg").attr("width",c).attr("height",b);this.setNode(a.selectAll(".node"));
this.setLink(a.selectAll(".link"))},start:function(){var a=this.getForce(),b=a.drag().on("dragstart",this.dragstart);link=this.getLink().data(a.links(),function(a){return a.source.term+a.source.type+"-"+a.target.term+a.source.type});link.enter().insert("line",".node").attr("class","link");link.exit().remove();this.setLink(link);node=this.getNode().data(a.nodes(),function(a){return a.term+a.type});var c=a.nodes().filter(function(a){return"keyword"==a.type}).map(function(a){return a.value}),d=a.nodes().filter(function(a){return"context"==
a.type}).map(function(a){return a.value}),e=[8,20],f=d3.scale.linear().domain([d3.min(c),d3.max(c)]).range(e),h=d3.scale.linear().domain([d3.min(d),d3.max(d)]).range(e),g=this,l=this.getCorpusColours();node.enter().append("text").attr("class",function(a){return"node "+a.type}).attr("text-anchor","middle").style("fill",function(a){return l("keyword"==a.type?1:2)}).attr("dx",12).attr("dy",".35em").text(function(a){return a.term}).style("font-size",function(a){return("context"==a.type?h(a.value):f(a.value))+
"pt"}).on("dblclick",function(){g.dragstart.apply(this,arguments);g.itemdblclick.apply(g,arguments)}).on("click",this.itemclick).on("mouseover",function(a){this.textContent=a.term+" ("+a.value+")";a.wasfixed=a.fixed;g.itemclick.apply(this,arguments)}).on("mouseout",function(a){this.textContent=a.term;d3.select(this).classed("fixed",a.fixed=a.wasfixed)}).call(b);node.exit().remove();this.setNode(node);a.start()},dragstart:function(a){a.wasfixed=!0;d3.select(this).classed("fixed",a.fixed=!0)},itemclick:function(a){},
itemdblclick:function(a){this.getCorpus().getCorpusCollocates({autoLoad:!1}).load({params:Ext.apply(this.getApiParams(),{query:a.term,start:a.start,limit:10}),callback:function(b,c,d){if(d){var e=this.getNodes()||{},f=this.getLinks()||{};this.getApiParam("limit");a.start+=10;var h=[a.term,a.type].join(";");b.forEach(function(a){var b={term:a.getContextTerm(),type:"context",value:a.getContextTermRawFreq(),start:0};a=[b.term,b.type].join(";");e[a]?e[a].value+=b.value:e[a]=b;b=[h,a].join("--");f[b]||
(f[b]={source:e[h],target:e[a]})});this.updateNodesAndLinks(e,f)}},scope:this})},updateNodesAndLinks:function(a,b){this.setNodes(a);this.setLinks(b);this.getForce().nodes($.map(a,function(a){return a}));this.getForce().links($.map(b,function(a){return a}));this.start()}});Ext.define("Voyant.panel.Contexts",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],requires:["Voyant.data.store.Contexts"],alias:"widget.contexts",statics:{i18n:{title:{en:"Keywords in Context"},termTip:{en:"The keyword for the context."},left:{en:"Left"},leftTip:{en:"Context to the left of the keyword."},right:{en:"Right"},rightTip:{en:"Context to the right of the keyword."}},api:{query:void 0,docId:void 0,docIndex:void 0,stopList:"auto"}},constructor:function(){this.callParent(arguments);
this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){var a=this;Ext.apply(a,{title:this.localize("title"),store:Ext.create("Voyant.data.store.Contexts",{stripTags:"all",remoteSort:!1,sortOnLoad:!0,sorters:{property:"position",direction:"ASC"}}),selModel:Ext.create("Ext.selection.RowModel",{listeners:{selectionchange:{fn:function(a,c){this.getApplication().dispatchEvent("termLocationClicked",this,c)},scope:this}}}),dockedItems:[{dock:"bottom",xtype:"toolbar",
items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}],columns:[{text:"#",width:30,dataIndex:"docIndex",sortable:!0,renderer:function(a){return a+1}},{text:this.localize("left"),tooltip:this.localize("leftTip"),align:"right",dataIndex:"left",sortable:!0,flex:1},{text:this.localize("term"),tooltip:this.localize("termTip"),dataIndex:"term",sortable:!0,width:"autoSize"},{text:this.localize("right"),tooltip:this.localize("rightTip"),
dataIndex:"right",sortable:!0,flex:1}],listeners:{documentIndexTermsClicked:{fn:function(a,c){var d={},e=[],f={},h=[];c.forEach(function(a){d[a.term]||(e.push(a.term),d[a.term]=!0);f[a.docIndex]||(h.push(a.docIndex),f[a.docIndex]=!0)});this.setApiParams({docId:void 0,docIndex:h,query:e});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})},scope:this}}});a.on("loadedCorpus",function(b,c){this.getStore().setCorpus(c);this.getApiParam("query")||Ext.create("Voyant.data.store.CorpusTerms",
{corpus:c}).load({callback:function(a,b,c){c&&0<a.length&&(this.setApiParam("query",a[0].getTerm()),this.getStore().load({params:this.getApiParams()}))},scope:a,params:{limit:1,stopList:this.getApiParam("stopList")}})});a.on("query",function(a,c){this.setApiParam("query",c);this.getStore().load({params:this.getApiParams()})},a);a.on("documentTermsClicked",function(a,c){var d=[];c.forEach(function(a){d.push({term:a.getTerm(),docIndex:a.getDocIndex()})});this.fireEvent("documentIndexTermsClicked",this,
d)});a.on("termsClicked",function(a,c){var d=[];Ext.isString(c)&&(c=[c]);c.forEach(function(a){void 0!==a.docIndex&&d.push({term:a.term,docIndex:a.docIndex})});0<d.length&&this.fireEvent("documentIndexTermsClicked",this,d)});a.callParent(arguments)}});Ext.define("Voyant.panel.CorpusCollocates",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.corpuscollocates",config:{corpus:void 0},statics:{i18n:{title:{en:"Collocates"},term:{en:"Term"},termTip:{en:"This is the keyword term around which collocate (context) terms are counted."},termRawFreq:{en:"Count (keyword)"},termRawFreqTip:{en:"The number of times the keyword term occurs in the corpus."},contextTerm:{en:"Collocate"},contextTermTip:{en:"This is the collocate (context) term that occurs near the keyword term."},
contextTermRawFreq:{en:"Count (context)"},contextTermRawFreqTip:{en:"The number of times this collocate occurs near the keyword term in the corpus."},matchingTerms:{en:"Matching terms: {count}"}},api:{stopList:"auto",query:void 0,docId:void 0,docIndex:void 0}},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,c){this.getStore().setCorpus(c);this.isVisible()&&this.loadFromApis()});a.embedded||a.corpus&&
this.fireEvent("loadedCorpus",this,a.corpus);this.on("corpusTermsClicked",function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){d.push(a.get("term"))});this.setApiParams({query:d,docId:void 0,docIndex:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})}});this.on("documentsClicked",function(a,c){var d=[];c.forEach(function(a){d.push(a.get("id"))});this.setApiParams({docId:d,docid:void 0,query:void 0});this.isVisible()&&this.getStore().loadPage(1,
{params:this.getApiParams()})});this.on("activate",function(){this.getStore().getCorpus()&&this.loadFromApis()},this);this.on("query",function(a,c){this.setApiParam("query",c);this.getStore().getProxy().setExtraParam("query",c);this.loadFromApis()},this)},loadFromApis:function(){this.getStore().getCorpus()&&(this.getApiParam("query")?this.getStore().loadPage(1,{params:this.getApiParams()}):this.getStore().getCorpus().getCorpusTerms({leadingBufferZone:0,autoLoad:!1}).load({callback:function(a,b,c){if(c){var d=
[];a.forEach(function(a){d.push(a.getTerm())});this.getStore().getProxy().setExtraParam("query",d);this.setApiParam("query",d);this.loadFromApis()}},scope:this,params:{limit:10,stopList:this.getApiParam("stopList")}}))},initComponent:function(){var a=Ext.create("Voyant.data.store.CorpusCollocates");a.on("totalcountchange",function(){this.down("#status").update({count:this.getStore().getTotalCount()})},this);Ext.apply(this,{title:this.localize("title"),store:a,selModel:Ext.create("Ext.selection.CheckboxModel",
{listeners:{selectionchange:{fn:function(a,c){this.getApplication().dispatchEvent("documentTermsClicked",this,c)},scope:this}}}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}],columns:[{text:this.localize("term"),dataIndex:"term",tooltip:this.localize("termTip"),sortable:!0,width:"autoSize"},{text:this.localize("rawFreq"),dataIndex:"rawFreq",tooltip:this.localize("termRawFreqTip"),
sortable:!0,width:"autoSize",hidden:!0},{text:this.localize("contextTerm"),dataIndex:"contextTerm",tooltip:this.localize("contextTermTip"),width:"autoSize",sortable:!0},{text:this.localize("contextTermRawFreq"),tooltip:this.localize("contextTermRawFreqTip"),dataIndex:"contextTermRawFreq",width:"autoSize",sortable:!0}],listeners:{termsClicked:{fn:function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){a.term&&d.push(a.term)});d&&(this.setApiParams({docIndex:void 0,docId:void 0,
query:d}),this.isVisible()&&this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()}))}},scope:this}}});this.callParent(arguments);this.getStore().getProxy().setExtraParam("withDistributions",!0)}});Ext.define("Voyant.panel.CorpusCreator",{extend:"Ext.form.Panel",requires:["Ext.form.field.File"],requires:["Voyant.data.model.Corpus"],mixins:["Voyant.panel.Panel"],alias:"widget.corpuscreator",statics:{i18n:{title:{en:"Add Texts"},emptyInput:{en:"Type in one or more URLs on separate lines or paste in a full text."},reveal:{en:"Reveal"}}},config:{},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){var a=
this;Ext.apply(a,{title:this.localize("title"),width:800,frame:!0,border:!0,frameHeader:!0,layout:{type:"vbox",align:"middle"},dockedItems:[{xtype:"toolbar",dock:"bottom",buttonAlign:"right",defaultButtonUI:"default",items:[{text:"Open",glyph:"xf115@FontAwesome",tooltip:"Select an exsting corpus",handler:function(){Ext.create("Ext.window.Window",{title:"Open an Existing Corpus",layout:"fit",modal:!0,items:{xtype:"form",margin:"5,5,5,5",items:{xtype:"combo",labelWidth:150,fieldLabel:"Choose a corpus:",
name:"corpus",queryMode:"local",store:[["shakespeare","Shakespeare's Plays"]],forceSelection:!0},buttons:[{text:"Open",glyph:"xf00c@FontAwesome",handler:function(b){b.up("form").getForm();var c=b.up("form").getForm().getValues().corpus;""!=c?(a.loadCorpus({corpus:c}),b.up("window").close()):Ext.Msg.show({title:"Select a Corpus",message:"Please be sure to select a corpus.",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})},flex:1},{text:"Cancel",glyph:"xf00d@FontAwesome",flex:1,handler:function(a){a.up("window").close()}}]}}).show()}},
{xtype:"filefield",glyph:"xf093@FontAwesome",name:"upload",buttonOnly:!0,hideLabel:!0,buttonText:"Upload",tooltip:"test",listeners:{render:function(a){a.fileInputEl.dom.setAttribute("multiple",!0);Ext.QuickTips.register({target:a.getEl(),text:"Upload one or more documents from your computer",enabled:!0,showDelay:20,trackMouse:!0,autoShow:!0})},change:function(b,c){if(c){var d=b.up("form").getForm();d.isValid()&&d.submit({url:a.getTromboneUrl(),params:{tool:"corpus.CorpusCreator"},failure:function(b,
c){c.result&&a.loadCorpus({corpus:c.result.stepEnabledCorpusCreator.storedId})}})}}}},"-\x3e",{xtype:"button",scale:"large",glyph:"xf00c@FontAwesome",text:this.localize("reveal"),handler:function(b){b=b.up("form").down("#input").getValue();""!==b?a.loadCorpus({input:b}):Ext.Msg.show({title:"No Text Provided",message:"Please provide text in the text box (or choose open or upload).",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}]}],items:{xtype:"textareafield",width:800,height:100,itemId:"input",emptyText:this.localize("emptyInput")}});
a.callParent(arguments)},loadCorpus:function(a){var b=this.getApplication(),c=b.getViewport();c.mask();(new Corpus(a)).then(function(a){c.unmask();b.dispatchEvent("loadedCorpus",b,a)}).fail(function(a,e){c.unmask();b.showErrorResponse({message:a},e)})}});Ext.define("Voyant.panel.CorpusTerms",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.corpusterms",statics:{i18n:{title:{en:"Corpus Terms"},matchingTerms:{en:"Matching terms: {count}"},termTip:{en:"The term in the corpus."},rawFreqTip:{en:"The total count (raw frequency) of this term in the entire corpus."},relativeFreqTip:{en:"The relative frequency (per million) of this term in the entire corpus."},relativePeakedness:{en:"Peakedness"},relativePeakednessTip:{en:"This is a statistical measure of how much the relative frequencies of a term in a corpus are bunched up into peaks (regions with higher values where the rest are lower)."},
relativeSkewness:{en:"Skew"},relativeSkewnessTip:{en:"This is a statistical measure of the symmetry of the relative frequencies of a term across the corpus."},trendTip:{en:"This represents the trend of the relative frequencies for each term in each document in the corpus."}},api:{stopList:"auto",query:void 0}},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);var b=Ext.apply(this.getApiParams(["stopList","query"]),{withDistributions:"relative"}),
c=this.getStore().getProxy(),d;for(d in b)c.setExtraParam(d,b[d]);this.on("loadedCorpus",function(a,b){var c=this.getStore();c.setCorpus(b);c.getProxy().setExtraParam("corpus",b.getId());c.load()});this.on("query",function(a,b){this.setApiParam("query",b);this.store.loadPage(1,{params:this.getApiParams()})},this);a.embedded?(b=Ext.getClass(a.embedded).getName(),"Voyant.data.store.CorpusTerms"==b&&this.fireEvent("loadedCorpus",this,a.embedded.getCorpus()),"Voyant.data.model.Corpus"==b&&this.fireEvent("loadedCorpus",
this,a.embedded)):a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus)},initComponent:function(){var a=Ext.create("Voyant.data.store.CorpusTerms");a.on("totalcountchange",function(){this.down("#status").update({count:this.getStore().getTotalCount()})},this);Ext.apply(this,{title:this.localize("title"),store:a,selModel:Ext.create("Ext.selection.CheckboxModel",{pruneRemoved:!1,listeners:{selectionchange:{fn:function(a,c){c&&0<c.length&&this.getApplication().dispatchEvent("corpusTermsClicked",this,
c)},scope:this}},mode:"SIMPLE"}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}],columns:[{xtype:"rownumberer",width:"autoSize",sortable:!1},{text:this.localize("term"),tooltip:this.localize("termTip"),dataIndex:"term",width:125,sortable:!0},{text:this.localize("rawFreq"),tooltip:this.localize("rawFreqTip"),dataIndex:"rawFreq",width:"autoSize",sortable:!0},{text:this.localize("relativeFreq"),
tooltip:this.localize("relativeFreqTip"),dataIndex:"relativeFreq",renderer:function(a){return Ext.util.Format.number(1E6*a,"0,000")},width:"autoSize",hidden:!0,sortable:!0},{text:this.localize("relativePeakedness"),tooltip:this.localize("relativePeakednessTip"),dataIndex:"relativePeakedness",renderer:Ext.util.Format.numberRenderer("0,000.0"),width:"autoSize",hidden:!0,sortable:!0},{text:this.localize("relativeSkewness"),tooltip:this.localize("relativeSkewnessTip"),dataIndex:"relativeSkewness",renderer:Ext.util.Format.numberRenderer("0,000.0"),
width:"autoSize",hidden:!0,sortable:!0},{xtype:"widgetcolumn",text:this.localize("trend"),tooltip:this.localize("trendTip"),width:150,dataIndex:"distributions",widget:{xtype:"sparklineline",tipTpl:new Ext.XTemplate("{[this.getDocumentTitle(values.x,values.y)]}",{getDocumentTitle:function(a,c){return this.panel.store.getCorpus().getDocument(a).getTitle()+"\x3cbr\x3erelative frequency: "+Ext.util.Format.number(1E6*c,"0,000")},panel:this})}}]});this.callParent(arguments)},load:function(){this.rendered?
this.store.loadPage(1):Ext.defer(this.load,100,this)}});Ext.define("Voyant.panel.Documents",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel","Voyant.util.Localization"],alias:"widget.documents",statics:{i18n:{title:{en:"Documents"},id:{en:"ID"},documentTitle:{en:"Title"},documentAuthor:{en:"Author"},tokensCountLexical:{en:"Words"},typesCountLexical:{en:"Types"},typeTokenRatioLexical:{en:"Ratio"},language:{en:"Language"},matchingDocuments:{en:"Matching documents: {count}"}}},constructor:function(a){var b=Ext.create("Voyant.data.store.Documents",{selModel:{pruneRemoved:!1}});
b.on("totalcountchange",function(){this.down("#status").update({count:this.getStore().getTotalCount()})},this);Ext.apply(this,{title:this.localize("title"),columns:[{xtype:"rownumberer",width:30,sortable:!1},{text:this.localize("documentTitle"),dataIndex:"title",sortable:!0,flex:3},{text:this.localize("documentAuthor"),dataIndex:"author",sortable:!0,hidden:!0,flex:2},{text:this.localize("tokensCountLexical"),dataIndex:"tokensCount-lexical",renderer:Ext.util.Format.numberRenderer("0,000"),sortable:!0,
width:"autoSize"},{text:this.localize("typesCountLexical"),dataIndex:"typesCount-lexical",renderer:Ext.util.Format.numberRenderer("0,000"),width:"autoSize"},{text:this.localize("typeTokenRatioLexical"),dataIndex:"typeTokenRatio-lexical",renderer:function(a){return Ext.util.Format.percent(a)},width:"autoSize"},{text:this.localize("language"),dataIndex:"language",hidden:!0,renderer:function(a,b,e,f,h,g,l){return l.ownerCt.getLanguage(a)},width:"autoSize"}],store:b,selModel:Ext.create("Ext.selection.RowModel",
{listeners:{selectionchange:{fn:function(a,b){this.getApplication().dispatchEvent("documentsClicked",this,b,this.getStore().getCorpus())},scope:this}}}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingDocuments"),style:"margin-right:5px"}]}]});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.store.setCorpus(b);this.store.loadPage(1,
{params:this.getApiParams()})});this.on("query",function(a,b){this.setApiParam("query",b);this.store.loadPage(1,{params:this.getApiParams()})});if(a.embedded){debugger;"Voyant.data.model.Corpus"==Ext.getClass(a.embedded).getName()?a.corpus=a.embedded:"Voyant.data.store.Documents"==Ext.getClass(a.embedded).getName()&&(this.store.setRecords(a.embedded.getData()),a.corpus=a.embedded.getCorpus())}a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus)}});Ext.define("Voyant.panel.DocumentsFinder",{extend:"Ext.grid.Panel",require:["Voyant.data.store.DocumentQueryMatches","Ext.grid.plugin.CellEditing"],mixins:["Voyant.panel.Panel","Voyant.util.Localization"],alias:"widget.documentsfinder",statics:{i18n:{title:{en:"Documents Finder"},operator:{en:"Operator"},field:{en:"Field"},query:{en:"Query"},count:{en:"Count"},emptyQuery:{en:"type query here"},titleField:{en:"title"},authorField:{en:"author"},pubDateField:{en:"publication date"},publisherField:{en:"publisher"},
pubPlaceField:{en:"publication location"},advancedField:{en:"\x3ci\x3eadvanced query\x3c/i\x3e"},textField:{en:"text (default)"},loading:{en:"loading corpus"},unsuccessfulQuery:{en:"Unable to complete query."},addRow:{en:"Add Row"},deleteRowTip:{en:"Click to delete this row"},noMatches:{en:new Ext.Template("No matches (out of {0} documents).",{compiled:!0})},queryMatches:{en:new Ext.Template("A total of {0} matching documents (out of {1}).",{compiled:!0})},exportNewCorpus:{en:"New Corpus"},exportNewCorpusTip:{en:"Create a new corpus from matching documents (button will be disabled if there are no matches)."}}},
config:{corpus:void 0},constructor:function(a){this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});this.cellEditing.on("edit",this.onEditComplete,this);var b=this;Ext.apply(this,{title:this.localize("title"),plugins:[this.cellEditing],bbar:[{text:this.localize("addRow"),glyph:"xf055@FontAwesome",handler:this.addRow,scope:this},{text:this.localize("exportNewCorpus"),disabled:!0,glyph:"xf08e@FontAwesome",tooltip:this.localize("exportNewCorpusTip"),handler:function(){var a=this.getQueryFromStore();
a?(this.setLoading(!0),this.getCorpus().getDocumentQueryMatches().load({params:{query:a,createNewCorpus:!0},callback:function(a,b,c){this.setLoading(!1);c?(a=b.getProxy().getReader().rawData.documentsFinder.corpus,a=this.getBaseUrl()+"?corpus\x3d"+a,Ext.Msg.alert({title:this.localize("title"),message:"\x3ca href\x3d'"+a+"' target\x3d'_blank'\x3eNew Corpus\x3c/a\x3e"})):Ext.create("Voyant.util.ResponseError",{msg:this.localize("unsuccessfulQuery"),response:b.getError().response}).show()},scope:this})):
Ext.Msg.alert({title:this.localize("title"),message:this.localize("noMatches")})},scope:this,cls:"exportBtn"},{xtype:"tbtext",name:"status",cls:"status"}],columns:[{text:this.localize("query"),dataIndex:"query",renderer:function(a){return Ext.isEmpty(a)?'\x3cspan class\x3d"placeholder"\x3e'+b.localize("emptyQuery")+"\x3c/span\x3e":a},editor:!0,minWidth:150,maxWidth:300},{text:this.localize("field"),dataIndex:"field",editor:{xtype:"combo",typeAhead:!0,triggerAction:"all",forceSelection:!0,value:"",
valueField:"value",listeners:{change:function(){Ext.isEmpty(this.getValue())&&this.reset()}},store:new Ext.data.Store({fields:["text","value"],data:[[this.localize("textField"),"text"],[this.localize("advancedField"),"advanced"]]})},width:150,renderer:function(a){return Ext.isEmpty(a)?"":b.localize(a+"Field")}},{text:this.localize("operator"),dataIndex:"operator",editor:{xtype:"combo",forceSelection:!0,store:new Ext.data.Store({autoDestroy:!0,fields:["text","value"],displayField:"text",valueField:"value",
data:[{text:"AND",value:"+"},{text:"OR",value:""}]})},minWidth:75,maxWidth:75},{text:this.localize("count"),dataIndex:"count",renderer:function(a,b,e){return Ext.isEmpty(e.get("query"))?"":Ext.util.Format.number(a,"0,000")},minWidth:100,maxWidth:100},{xtype:"actioncolumn",width:25,sortable:!1,menuDisabled:!0,width:25,getGlyph:"xf014@FontAwesome",tooltip:this.localize("deleteQueryTip"),menuDisabled:!0,sortable:!1,handler:this.removeRow,scope:this}],store:new Ext.data.Store({autoDestroy:!0,fields:["id",
"operator","field","query","count"],data:[["","","","",0]]})});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.setCorpus(b);var e=b.getDocuments();if(e&&0<e.getCount()){var f=e.getDocument(0),h=[];["title","author","pubDate","publisher","pubPlace"].forEach(function(a){Ext.isEmpty(f.get(a))||h.push([this.localize(a+"Field"),a])},this);h&&(e=this.getColumnManager().getHeaderByDataIndex("field").getEditor(),e.getStore().each(function(a){h.push([a.get("text"),
a.get("value")])},this),e.setStore(Ext.create("Ext.data.Store",{fields:["text","value"],data:h})));this.updateStatus(0);this.setLoading(!1)}})},removeRow:function(a,b){this.getStore().removeAt(b);0==this.getStore().getCount()&&this.addRow();this.updateAggregate()},addRow:function(){this.store.loadData([["","","","",0]],!0)},onEditComplete:function(a,b){var c=this.getQueryFromRecord(b.record);if(Ext.isEmpty(c))b.record.set("count",""),this.updateAggregate();else{var d=b.view.getCell(b.record,this.getColumnManager().getHeaderByDataIndex("count"));
d.mask("loading");this.getCorpus().getDocumentQueryMatches().load({params:{query:c},callback:function(a,c,h){d.unmask();h?b.record.set("count",0==a.length?0:a[0].get("count")):(Ext.create("Voyant.util.ResponseError",{msg:this.localize("unsuccessfulQuery"),response:c.getError().response}).show(),b.record.set("count",0));this.updateAggregate()},scope:this})}},getQueryFromRecord:function(a){if(Ext.isEmpty(a)||Ext.isEmpty(a.get("query")))return"";var b=a.get("query").trim();if(Ext.isEmpty(b))return"";
a=a.get("field");return Ext.isEmpty(a?a.trim():a)?b:a+":"+b},getQueryFromStore:function(){var a="";this.getStore().each(function(b){var c=this.getQueryFromRecord(b);Ext.isEmpty(c)||(Ext.isEmpty(a)||(b=b.get("operator"),a+="AND"==b?" + ":" | "),a+=c)},this);console.warn(a);return a},updateAggregate:function(){var a=this.getStore().sum("count");a&&"string"!=typeof a?1==a?(a=this.getStore().getAt(0).get("count"),this.updateStatus(this.getStore().getAt(0).get("count"))):(a=this.getQueryFromStore(),Ext.isEmpty(a)||
(this.status||(this.status=this.down("[cls~\x3dstatus]")),this.status.mask(this.localize("loading")),this.getCorpus().getDocumentQueryMatches().load({params:{query:a},callback:function(a,c,d){debugger;this.status.unmask();d?this.updateStatus(a[0].get("count")):(Ext.create("Voyant.util.ResponseError",{msg:this.localize("unsuccessfulQuery"),response:c.getError().response}).show(),this.updateStatus(0))},scope:this}))):this.updateStatus(0)},updateStatus:function(a){this.status||(this.status=this.down("[cls~\x3dstatus]"));
this.exportBtn||(this.exportBtn=this.down("[cls~\x3dexportBtn]"));0==a?this.status.update(this.localize("noMatches",[this.getCorpus().getDocumentsCount()])):this.status.update(this.localize("queryMatches",[a,this.getCorpus().getDocumentsCount()]));this.exportBtn.setDisabled(0==a)}});Ext.define("Voyant.panel.DocumentTerms",{extend:"Ext.grid.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.documentterms",config:{corpus:void 0},statics:{i18n:{title:{en:"Document Terms"},matchingTerms:{en:"Matching terms: {count}"},termTip:{en:"The term in a single, specific document."},rawFreqTip:{en:"The count (raw frequency) of this term in this document."},relativeFreqTip:{en:"The relative frequency (per million) of this term in each document."},trendTip:{en:"This is a sparkline graph that represents the distribution of the term within linear segments of the document (by default 10 segments of equal size)."},
tfidf:{en:"Significance"},tfidfTip:{en:"The significance is measured here using an TF-IDF score, a common way of expressing how important a term is in a document relative to the rest of the corpus."}},api:{stopList:"auto",query:void 0,docId:void 0,docIndex:void 0}},constructor:function(a){this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,b){this.getStore().setCorpus(b)});if(a.embedded){console.warn(a.embedded.then);var b=
Ext.getClass(a.embedded).getName();"Voyant.data.store.DocumentTerms"!=b&&"Voyant.data.model.Document"!=b||this.fireEvent("loadedCorpus",this,a.embedded.getCorpus())}else a.corpus&&this.fireEvent("loadedCorpus",this,a.corpus);this.on("query",function(a,b){this.fireEvent("corpusTermsClicked",a,[b])},this);this.on("corpusTermsClicked",function(a,b){if(this.getStore().getCorpus()){var e=[];b.forEach(function(a){e.push(Ext.isString(a)?a:a.get("term"))});this.setApiParams({query:e,docId:void 0,docIndex:void 0});
this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})}});this.on("documentsClicked",function(a,b){var e=[];b.forEach(function(a){e.push(a.get("id"))});this.setApiParams({docId:e,query:void 0});this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()})});this.on("activate",function(){this.getStore().getCorpus()&&this.getStore().loadPage(1,{params:this.getApiParams()})},this)},initComponent:function(){var a=Ext.create("Voyant.data.store.DocumentTerms");a.on("totalcountchange",
function(){this.down("#status").update({count:this.getStore().getTotalCount()})},this);Ext.apply(this,{title:this.localize("title"),store:a,selModel:Ext.create("Ext.selection.CheckboxModel",{listeners:{selectionchange:{fn:function(a,c){this.getApplication().dispatchEvent("documentTermsClicked",this,c)},scope:this}}}),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}],columns:[{text:"#",
width:30,dataIndex:"docIndex",sortable:!0,renderer:function(a){return a+1}},{text:this.localize("term"),dataIndex:"term",tooltip:this.localize("termTip"),sortable:!0,width:125},{text:this.localize("rawFreq"),dataIndex:"rawFreq",tooltip:this.localize("rawFreqTip"),width:"autoSize",sortable:!0},{text:this.localize("relativeFreq"),tooltip:this.localize("relativeFreqTip"),dataIndex:"relativeFreq",width:"autoSize",sortable:!0,renderer:Ext.util.Format.numberRenderer("0,000")},{text:this.localize("tfidf"),
tooltip:this.localize("tfidfTip"),dataIndex:"tfidf",width:"autoSize",sortable:!0,hidden:!0,renderer:Ext.util.Format.numberRenderer("0,000.000")},{xtype:"widgetcolumn",text:this.localize("trend"),tooltip:this.localize("trendTip"),width:120,dataIndex:"distributions",widget:{xtype:"sparklineline"}}],listeners:{termsClicked:{fn:function(a,c){if(this.getStore().getCorpus()){var d=[];c.forEach(function(a){a.term&&d.push(a.term)});d&&(this.setApiParams({docIndex:void 0,docId:void 0,query:d}),this.isVisible()&&
this.isVisible()&&this.getStore().loadPage(1,{params:this.getApiParams()}))}},scope:this}}});this.callParent(arguments);this.getStore().getProxy().setExtraParam("withDistributions",!0)}});Ext.define("Voyant.panel.Dummy",{extend:"Ext.Panel",xtype:"dummy",width:650,initComponent:function(){this.myDataStore=Ext.create("Ext.data.JsonStore",{fields:["theta","sin","cos","tan"],data:[{theta:0,sin:0,cos:1,tan:0},{theta:10,sin:.17,cos:.98,tan:.18},{theta:20,sin:.34,cos:.94,tan:.36},{theta:30,sin:.5,cos:.87,tan:.58},{theta:40,sin:.64,cos:.77,tan:.84},{theta:50,sin:.77,cos:.64,tan:1.19},{theta:60,sin:.87,cos:.5,tan:1.73},{theta:70,sin:.94,cos:.34,tan:2.75},{theta:80,sin:.98,cos:.17,tan:5.67},
{theta:90,sin:1,cos:0,tan:!1},{theta:100,sin:.98,cos:-.17,tan:-5.67},{theta:110,sin:.94,cos:-.34,tan:-2.75},{theta:120,sin:.87,cos:-.5,tan:-1.73},{theta:130,sin:.77,cos:-.64,tan:-1.19},{theta:140,sin:.64,cos:-.77,tan:-.84},{theta:150,sin:.5,cos:-.87,tan:-.58},{theta:160,sin:.34,cos:-.94,tan:-.36},{theta:170,sin:.17,cos:-.98,tan:-.18},{theta:180,sin:0,cos:-1,tan:0},{theta:190,sin:-.17,cos:-.98,tan:.18},{theta:200,sin:-.34,cos:-.94,tan:.36},{theta:210,sin:-.5,cos:-.87,tan:.58},{theta:220,sin:-.64,cos:-.77,
tan:.84},{theta:230,sin:-.77,cos:-.64,tan:1.19},{theta:240,sin:-.87,cos:-.5,tan:1.73},{theta:250,sin:-.94,cos:-.34,tan:2.75},{theta:260,sin:-.98,cos:-.17,tan:5.67},{theta:270,sin:-1,cos:0,tan:!1},{theta:280,sin:-.98,cos:.17,tan:-5.67},{theta:290,sin:-.94,cos:.34,tan:-2.75},{theta:300,sin:-.87,cos:.5,tan:-1.73},{theta:310,sin:-.77,cos:.64,tan:-1.19},{theta:320,sin:-.64,cos:.77,tan:-.84},{theta:330,sin:-.5,cos:.87,tan:-.58},{theta:340,sin:-.34,cos:.94,tan:-.36},{theta:350,sin:-.17,cos:.98,tan:-.18},
{theta:360,sin:0,cos:1,tan:0}]});this.items=[{xtype:"cartesian",width:"100%",height:500,store:this.myDataStore,insetPadding:{top:40,right:40,bottom:20,left:20},legend:{docked:"right"},sprites:[{type:"text",text:"Line Charts - Marked Spline",fontSize:22,width:100,height:30,x:40,y:20}],axes:[{type:"numeric",fields:["sin","cos","tan"],position:"left",grid:!0,renderer:function(a){return Ext.util.Format.number(a,"0.0")}},{type:"category",title:"Theta",fields:"theta",position:"bottom",style:{textPadding:0},
grid:!0,label:{rotate:{degrees:-45}}}],series:[{type:"line",axis:"left",xField:"theta",yField:"sin",smooth:!0,style:{lineWidth:4},marker:{radius:4},highlight:{fillStyle:"#000",radius:5,lineWidth:2,strokeStyle:"#fff"}},{type:"line",axis:"left",xField:"theta",yField:"cos",smooth:!0,style:{lineWidth:4},marker:{radius:4},highlight:{fillStyle:"#000",radius:5,lineWidth:2,strokeStyle:"#fff"}},{type:"line",axis:"left",xField:"theta",yField:"tan",smooth:!0,style:{lineWidth:4},marker:{radius:4},highlight:{fillStyle:"#000",
radius:5,lineWidth:2,strokeStyle:"#fff"}}]}];this.callParent()}});Ext.define("Voyant.panel.Panel",{mixins:["Voyant.util.Localization","Voyant.util.Api","Voyant.notebook.util.Embeddable","Voyant.util.DetailedError","Voyant.util.QuerySearchField"],statics:{i18n:{term:{en:"Term"},rawFreq:{en:"Count"},relativeFreq:{en:"Relative"},trend:{en:"Trend"},colon:{en:": "},loading:{en:"Loading"}}},constructor:function(a){this.mixins["Voyant.util.Api"].constructor.apply(this,arguments);this.mixins["Voyant.notebook.util.Embeddable"].constructor.apply(this,arguments)},initComponent:function(a){this.tools=
this.getApplication().getTools()},getApplication:function(){return Voyant.application},getBaseUrl:function(){return this.getApplication().getBaseUrl()},getTromboneUrl:function(){return this.getApplication().getTromboneUrl()},dispatchEvent:function(){var a=this.getApplication();a.dispatchEvent.apply(a,arguments)},showError:function(a){this.getApplication().showError.apply(this,arguments)}});Ext.define("Voyant.panel.Reader",{extend:"Ext.panel.Panel",requires:["Voyant.data.store.Tokens"],mixins:["Voyant.panel.Panel"],alias:"widget.reader",statics:{i18n:{title:{en:"Reader"},documentFrequency:{en:"document frequency:"}},api:{start:0,limit:1E3}},config:{corpus:void 0,tokensStore:void 0,documentsStore:void 0,documentTermsStore:void 0},innerContainer:null,cls:"voyant-reader",layout:"border",items:[{bodyPadding:10,region:"center",border:!1,height:"auto",autoScroll:!0,html:'\x3cdiv class\x3d"readerContainer"\x3e\x3c/div\x3e'},
{region:"south",height:40,split:{size:2},splitterResize:!0,border:!1,layout:{type:"hbox"}}],constructor:function(){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments)},initComponent:function(){var a=Ext.create("Voyant.data.store.Tokens");a.on("load",function(a,c,d){if(d){var e="",f=this.localize("documentFrequency"),h=!1,g=-1;c.forEach(function(a){0==a.getPosition()&&(e+="\x3ch3\x3e"+this.getDocumentsStore().getById(a.getDocId()).getFullLabel()+
"\x3c/h3\x3e");a.getDocIndex()!=g&&(h=this.getDocumentsStore().getById(a.getDocId()).isPlainText(),g=a.getDocIndex());e=a.isWord()?e+("\x3cspan class\x3d'word' id\x3d'"+a.getId()+"' data-qtip\x3d'"+f+" "+a.getDocumentRawFreq()+"'\x3e"+a.getTerm()+"\x3c/span\x3e"):e+a.getTermWithLineSpacing(h)},this);this.updateText(e,!0);a=this.down("querysearchfield").getValue();""!=a&&this.highlightKeywords(a)}},this);this.setTokensStore(a);this.on("query",function(a,c){this.loadQueryTerms([c])},this);this.setDocumentTermsStore(Ext.create("Ext.data.Store",
{model:"Voyant.data.model.DocumentTerm",autoLoad:!1,remoteSort:!1,proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",withDistributions:!0,withPositions:!0,withOffsets:!0,bins:25},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0},listeners:{load:function(a,c,d,e){a.sort("docIndex","ASC");var f={},h=0,g;a.each(function(a){var b=[],c=a.get("distributions"),d=a.get("docId"),e=a.get("docIndex");
g=a.get("term");for(a=0;a<c.length;a++){var q=a,n=c[a];n>h&&(h=n);b.push([d,e,q,n,g])}f[e]=b},this);this.highlightKeywords(g);this.down("querysearchfield").setValue(g);a=this.query("cartesian");for(c=0;c<a.length;c++)d=a[c],e=f[c],void 0!==e?(d.getAxes()[0].setMaximum(h),d.getStore().loadData(e)):d.getStore().removeAll()},scope:this}}));this.on("afterrender",function(){this.innerContainer=this.down('panel[region\x3d"center"]').getLayout().getRenderTarget();this.items.getAt(0).body.on("scroll",function(){var a=
this.items.getAt(0).body.dom;if(a.scrollTop+a.offsetHeight>a.scrollHeight/2){var c=this.innerContainer.first().last();if(0==c.hasCls("loading"))for(;c;){if(c.hasCls("word")){c.insertSibling("\x3cdiv class\x3d'loading'\x3e"+this.localize("loading")+"\x3c/div\x3e","after",!1).mask();a=Voyant.data.model.Token.getInfoFromElement(c);c.destroy();c=this.getDocumentsStore().getAt(a.docIndex).getId();this.setApiParams({skipToDocId:c,start:a.position});this.load();break}c.destroy();c=target.last()}}},this);
this.items.getAt(0).body.on("click",function(a,c){c=Ext.get(c);if(c.hasCls("word")){var d=Voyant.data.model.Token.getInfoFromElement(c),d=[{term:c.getHtml(),docIndex:d.docIndex}];this.getApplication().dispatchEvent("termsClicked",this,d)}},this);this.getCorpus()&&this.load()},this);Ext.apply(this,{dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"}]}],listeners:{loadedCorpus:function(a,c){this.setCorpus(c);this.getTokensStore().setCorpus(c);this.getDocumentTermsStore().getProxy().setExtraParam("corpus",
c.getId());var d=c.getDocuments();this.setDocumentsStore(d);d=this.down('panel[region\x3d"south"]');this.generateChart(c,d);this.rendered&&this.load()},termsClicked:function(a,c){var d=[];c.forEach(function(a){a.term&&d.push(a.term)});this.loadQueryTerms(d)},corpusTermsClicked:function(a,c){var d=[];c.forEach(function(a){a.getTerm()&&d.push(a.getTerm())});this.loadQueryTerms(d)},documentTermsClicked:function(a,c){var d=[];c.forEach(function(a){a.getTerm()&&d.push(a.getTerm())});this.loadQueryTerms(d)},
documentsClicked:function(a,c,d){c&&(this.setApiParams({skipToDocId:c[0].getId(),start:0}),this.load(!0))},termLocationClicked:function(a,c){if(void 0!==c[0]){var d=c[0],e=d.get("docIndex"),d=d.get("position"),e=this.getCorpus().getDocument(e);this.setApiParams({skipToDocId:e.getId(),start:d});this.load(!0)}},scope:this}});this.callParent(arguments)},loadQueryTerms:function(a){a&&0<a.length&&this.getDocumentTermsStore().load({params:{query:a,docIndex:void 0,docId:void 0,page:void 0,start:void 0,limit:void 0}})},
generateChart:function(a,b){function c(a,b){var c=[[116,116,181],[139,163,83],[189,157,60],[171,75,75],[174,61,155]],c=c[a%c.length];return"rgba("+c[0]+","+c[1]+","+c[2]+","+b+")"}function d(d){var e=d.index,f=d.fraction;d=d.relativeHeight;var g=c(e,.3),e=c(e,1);b.add({xtype:"cartesian",flex:f,height:"100%",insetPadding:0,background:{type:"linear",degrees:90,stops:[{offset:0,color:g},{offset:d,color:g},{offset:d,color:"white"},{offset:1,color:"white"}]},axes:[{type:"numeric",position:"left",fields:"distribution",
hidden:!0},{type:"category",position:"bottom",fields:"bin",hidden:!0}],series:[{type:"line",xField:"bin",yField:"distribution",style:{lineWidth:2,strokeStyle:e},tooltip:{corpus:a,trackMouse:!0,style:"background: #fff",showDelay:0,dismissDelay:500,hideDelay:5,renderer:function(b,c){this.setHtml(a.getDocument(b.get("docIndex")).getTitle()+"\x3cbr\x3e"+b.get("term")+": "+b.get("distribution"))}}}],store:Ext.create("Ext.data.ArrayStore",{fields:["docId","docIndex","bin","distribution","term"],data:[]})})}
b.removeAll();for(var e=a.getDocuments(),f=a.getWordTokensCount(),h=[],g=1E6,l=-1,m=0;m<e.getTotalCount();m++){var k=e.getAt(m),p=k.get("index"),k=k.get("tokensCount-lexical");k<g&&(g=k);k>l&&(l=k);h.push({index:p,count:k,fraction:k/f})}for(m=0;m<h.length;m++)k=h[m],k.relativeHeight=k.count==l?1:0+(k.count-g)/(l-g)*1,d(k)},highlightKeywords:function(a,b){Ext.isArray(a)||(a=[a]);this.innerContainer.first().select("span[class*\x3dkeyword]").removeCls("keyword");var c=[],d=new RegExp("^"+a[0]+"$","i");
this.innerContainer.first().select("span.word").each(function(a,b,h){a.dom.firstChild&&a.dom.firstChild.nodeValue.match(d)&&(a.addCls("keyword"),c.push(a.dom))})},load:function(a){a&&(this.innerContainer.first().destroy(),this.innerContainer.setHtml('\x3cdiv class\x3d"readerContainer"\x3e\x3cdiv class\x3d"loading"\x3e'+this.localize("loading")+"\x3c/div\x3e\x3c/div\x3e"),this.innerContainer.first().first().mask());this.getTokensStore().load({params:Ext.apply(this.getApiParams(),{stripTags:"blocksOnly"})})},
updateText:function(a){var b=this.innerContainer.first().last();b&&b.isMasked()&&b.destroy();this.innerContainer.first().insertHtml("beforeEnd",a)},updateChart:function(){}});Ext.define("Voyant.panel.Summary",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel","Voyant.util.SparkLine"],alias:"widget.summary",statics:{i18n:{title:{en:"Summary"},corpusType:{en:'\x3ctpl for\x3d"types"\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"corpus-type keyword" voyant:recordId\x3d"{id}"\x3e{type}\x3c/a\x3e ({val})\x3ctpl if\x3d"xindex \x26lt; len"\x3e, \x3c/tpl\x3e\x3c/tpl\x3e'},documentType:{en:'\x3ctpl for\x3d"types"\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-type keyword" voyant:recordId\x3d"{id}" voyant:val\x3d"{docId}:{type}"\x3e{type}\x3c/a\x3e ({val})\x3ctpl if\x3d"xindex \x26lt; len"\x3e, \x3c/tpl\x3e\x3c/tpl\x3e'},
mostFrequentWords:{en:"Most \x3cb\x3efrequent words\x3c/b\x3e in the corpus: "},docsLength:{en:'\x3cul\x3e\x3ctpl for\x3d"docs"\x3e\x3cli\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-id" voyant:val\x3d"{id}"\x3e{title}\x3c/a\x3e ({totalWordTokens})\x3c/li\x3e\x3c/tpl\x3e\x3c/ul\x3e'},docsLengthLongest:{en:"\x3cb\x3eLongest documents\x3c/b\x3e (by words {0})"},docsLengthShortest:{en:"Shortest documents"},docsLengthAll:{en:"Documents ordered by number of words ({0})"},docsDensity:{en:'\x3cul\x3e\x3ctpl for\x3d"docs"\x3e\x3cli\x3e\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-id" voyant:val\x3d"{id}"\x3e{title}\x3c/a\x3e ({wordDensity})\x3c/li\x3e\x3c/tpl\x3e\x3c/ul\x3e'},
docsDensityHighest:{en:"Highest \x3cb\x3evocabulary density\x3c/b\x3e ({0})"},docsDensityLowest:{en:"Lowest density"},docsDensityAll:{en:"Documents ordered by vocabulary density ({0})"},distinctiveWords:{en:"\x3cb\x3eDistinctive words\x3c/b\x3e (compared to the rest of the corpus): "},moreDistinctiveWords:{en:'\x3ca href\x3d"#" onclick\x3d"return false"\x3eNext {0} of {1} remaining\x3c/a\x3e'},seeAll:{en:"All\x26hellip;"},more:{en:"More\x26hellip;"}},api:{stopList:"auto",start:0,limit:5,numberOfDocumentsForDistinctiveWords:5}},
config:{corpus:void 0},autoScroll:!0,cls:"corpus-summary",corpusTermsStore:null,docsStore:null,documentTermsStore:null,summaryListParent:null,constructor:function(a){Ext.apply(this,{title:this.localize("title")});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);this.on("loadedCorpus",function(a,c){this.setCorpus(c);this.corpusTermsStore=c.getCorpusTerms();this.docStore=Ext.create("Ext.data.Store",{model:"Voyant.data.model.Document",autoLoad:!1,remoteSort:!1,
corpus:this.getCorpus(),proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentsMetadata",corpus:this.getCorpus().getId()},reader:{type:"json",rootProperty:"documentsMetadata.documents",totalProperty:"documentsMetadata.total"},simpleSortMode:!0},listeners:{load:function(a,b,c,d){var l=this.getCorpus();b.forEach(function(a){a.set("corpus",l)})},scope:this}});this.documentTermsStore=Ext.create("Ext.data.Store",{model:"Voyant.data.model.DocumentTerm",autoLoad:!1,
remoteSort:!1,corpus:this.getCorpus(),proxy:{type:"ajax",url:Voyant.application.getTromboneUrl(),extraParams:{tool:"corpus.DocumentTerms",corpus:this.getCorpus().getId()},reader:{type:"json",rootProperty:"documentTerms.terms",totalProperty:"documentTerms.total"},simpleSortMode:!0}});if(this.rendered){this.summaryListParent=Ext.dom.Helper.append(this.getLayout().getRenderTarget(),"\x3cul\x3e\x3c/ul\x3e");Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e"+c.getShow()+"\x3c/li\x3e");var d=c.getDocumentsCount();
1<d&&this.showLongestDocuments();1<d&&this.showMostDenseDocuments();this.showMostFrequentWords();1<d&&this.showDistinctiveWords();d=Ext.apply({},{limit:null},this.getApiParams());this.docStore.load({params:d});this.addLinksHandler()}else Ext.defer(this.fireEvent,100,this)});this.on("activate",function(){this.getCorpus()&&this.dispatchEvent("ensureCorpusView",this,this.getCorpus())},this);a.embedded&&"Voyant.data.model.Corpus"==Ext.getClass(a.embedded).getName()&&(a.corpus=a.embedded);a&&a.corpus&&
this.fireEvent("loadedCorpus",this,a.corpus)},showLongestDocuments:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e\x3c/li\x3e");this.docStore.on("load",function(b,c,d){c=b.getTotalCount();if(1<c){b.sort("index","ASC");var e=[];b.each(function(a){e.push(a.get("tokensCount-lexical"))});b.sort("tokensCount-lexical","DESC");b={shortest:b.getRange(c-2,c).reverse(),longest:b.getRange(0,1),all:b.getRange(0,c)};for(var f in b)if(f){d=b[f];for(var h=0;h<d.length;h++){var g=d[h];b[f][h]=
{title:g.getShortTitle(),id:g.get("id"),totalWordTokens:Ext.util.Format.number(g.get("tokensCount-lexical"),"0,000"),docsLen:d.length}}}f=new Ext.XTemplate(this.localize("docsLength"));d="";5<c?(d+=(new Ext.Template(this.localize("docsLengthLongest"))).applyTemplate([this.getSparkLine(e)])+this.localize("colon")+f.apply({docs:b.longest}),d+=this.localize("docsLengthShortest")+this.localize("colon")+f.apply({docs:b.shortest}),d+="\x3ca href\x3d'#' onclick\x3d'return false' class\x3d'corpus-documents corpus-documents-length'\x3e"+
this.localize("seeAll")+"\x3c/a\x3e"):d+=(new Ext.Template(this.localize("docsLengthAll"))).apply([this.getSparkLine(e)])+this.localize("colon")+f.apply({docs:b.all});Ext.dom.Helper.append(a,d)}},this)},showMostDenseDocuments:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e\x3c/li\x3e");this.docStore.on("load",function(b,c,d){c=b.getTotalCount();if(1<c){b.sort("index","ASC");var e=[];b.each(function(a){e.push(a.get("typeTokenRatio-lexical"))});b.sort("typeTokenRatio-lexical",
"DESC");b={lowest:b.getRange(c-2,c).reverse(),highest:b.getRange(0,1),all:b.getRange(0,c)};for(var f in b)if(f){d=b[f];for(var h=0;h<d.length;h++){var g=d[h];b[f][h]={title:g.getShortTitle(),id:g.get("id"),wordDensity:Ext.util.Format.number(g.get("typeTokenRatio-lexical"),"0.000"),docsLen:d.length}}}f=new Ext.XTemplate(this.localize("docsDensity"));d="";5<c?(d+=(new Ext.Template(this.localize("docsDensityHighest"))).applyTemplate([this.getSparkLine(e)])+this.localize("colon")+f.apply({docs:b.highest}),
d+=this.localize("docsDensityLowest")+this.localize("colon")+f.apply({docs:b.lowest}),d+="\x3ca href\x3d'#' onclick\x3d'return false' class\x3d'corpus-documents corpus-documents-density'\x3e"+this.localize("seeAll")+"\x3c/a\x3e"):d+=(new Ext.Template(this.localize("docsDensityAll"))).applyTemplate([this.getSparkLine(e)])+this.localize("colon")+f.apply({docs:b.all});Ext.dom.Helper.append(a,d)}},this)},showMostFrequentWords:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e\x3c/li\x3e"),
b=this.getApiParams();this.corpusTermsStore.load({params:b,scope:this,callback:function(b){var d=this.localize("mostFrequentWords"),e=[],f=b.length;b.forEach(function(a,b,c){e.push({id:a.getId(),type:a.getTerm(),val:Ext.util.Format.number(a.get("rawFreq"),"0,000"),len:f})});d+=(new Ext.XTemplate(this.localize("corpusType"))).applyTemplate({types:e})+".";Ext.dom.Helper.append(a,d)}})},showDistinctiveWords:function(){var a=Ext.dom.Helper.append(this.summaryListParent,"\x3cli\x3e"+this.localize("distinctiveWords")+
"\x3col\x3e\x3c/ol\x3e\x3c/li\x3e",!0).first("ol");this.docStore.on("load",function(b,c,d){c=b.getTotalCount();if(1<c){b.sort("index","ASC");var e=this.getApiParam("numberOfDocumentsForDistinctiveWords");b.each(function(b,c,d){Ext.dom.Helper.append(a,{tag:"li","voyant:index":String(c),cls:c>e-1?"x-hidden":"",html:'\x3ca href\x3d"#" onclick\x3d"return false" class\x3d"document-id document-id-distinctive" voyant:val\x3d"'+b.get("id")+'"\x3e'+b.getShortTitle()+"\x3c/a\x3e"})},this);if(c>e){var f=new Ext.Template(this.localize("moreDistinctiveWords"));
b=c-e;var h=Ext.dom.Helper.append(this.summaryListParent,{tag:"div",html:f.apply([e>b?b:e,b])},!0);h.addListener("click",function(){var b=a.select('li[class\x3d"x-hidden"]');for(i=0;i<b.getCount()&&i!=e;i++)b.item(i).removeCls("x-hidden");this.showDistinctiveWordsStep(b.item(0));b=b.getCount()-e;0<b?h.update(f.apply([e>b?b:e,b])):h.remove()},this)}this.showDistinctiveWordsStep(a.first("li"))}},this)},showDistinctiveWordsStep:function(a){var b=Number(a.getAttribute("index","voyant"));this.documentTermsStore.load({addRecords:!0,
params:{docIndex:b,limit:5,sort:"TFIDF",dir:"DESC"},scope:this,callback:function(b,d,e){var f=[],h=b.length;b.forEach(function(a,b,c){f.push({id:a.getId(),type:a.getTerm(),val:Ext.util.Format.number(a.get("rawFreq"),"0,000"),docId:a.get("docId"),len:h})});Ext.dom.Helper.append(a,this.localize("colon")+(new Ext.XTemplate(this.localize("documentType"))).apply({types:f})+".");(b=a.next("li"))&&!b.hasCls("x-hidden")&&this.showDistinctiveWordsStep(b)}})},addLinksHandler:function(){this.body.addListener("click",
function(a){if((a=a.getTarget(null,null,!0))&&"A"==a.dom.tagName){var b={};a.hasCls("corpus-documents")?(a.hasCls("corpus-documents-length")?b.sortBy="totalWordTokens":a.hasCls("corpus-documents-density")&&(b.sortBy="wordDensity"),b.sortDirection="DESC"):a.hasCls("document-id")?(a=a.getAttribute("val","voyant"),a=this.docStore.getById(a),this.dispatchEvent("documentsClicked",this,[a])):a.hasCls("corpus-type")?(a=a.getAttribute("recordId","voyant"),a=this.corpusTermsStore.getById(a),this.dispatchEvent("corpusTermsClicked",
this,[a])):a.hasCls("corpus-types")?(b.query="",a.hasCls("corpus-types-peaks")?Ext.apply(b,{sortBy:"RELATIVEDISTRIBUTIONKURTOSIS",sortDirection:"DESC",extendedSortZscoreMinimum:1}):Ext.apply(b,{sortBy:"rawFreq",sortDirection:"DESC",extendedSortZscoreMinimum:null})):a.hasCls("document-type")&&(a=a.getAttribute("recordId","voyant"),a=this.documentTermsStore.getById(a),this.dispatchEvent("documentTermsClicked",this,[a]))}},this)}});Ext.define("Voyant.panel.Trends",{extend:"Ext.panel.Panel",mixins:["Voyant.panel.Panel"],requires:["Ext.chart.CartesianChart","Voyant.data.store.Documents"],alias:"widget.trends",config:{corpus:void 0},statics:{i18n:{title:{en:"Trends"},rawFrequencies:{en:"raw frequencies"},relativeFrequencies:{en:"relative frequencies"},segments:{en:"document segments"},documents:{en:"documents"}},api:{limit:5,stopList:"auto",query:void 0,freqsMode:"relativeFreqs"}},MODE_CORPUS:"corpus",MODE_DOCUMENT:"document",
layout:"fit",constructor:function(a){Ext.apply(this,{title:this.localize("title"),dockedItems:[{dock:"bottom",xtype:"toolbar",items:[{xtype:"querysearchfield"},{xtype:"component",itemId:"status",tpl:this.localize("matchingTerms"),style:"margin-right:5px"}]}]});this.callParent(arguments);this.mixins["Voyant.panel.Panel"].constructor.apply(this,arguments);if(a.embedded){var b=Ext.getClass(a.embedded).getName();"Voyant.data.store.CorpusTerms"==b&&this.loadFromCorpusTerms(a.embedded);"Voyant.data.model.Corpus"==
b&&this.loadFromCorpusTerms(a.embedded.getCorpusTerms())}this.on("loadedCorpus",function(a,b){this.setCorpus(b);this.isVisible()&&this.loadFromCorpus(b)});this.on("documentsClicked",function(a,b){this.getCorpus()&&1==b.length&&this.loadFromDocument(b[0])});this.on("query",function(a,b){Ext.isString(b)&&this.fireEvent("termsClicked",a,[b])},this);this.on("termsClicked",function(a,b){if(this.getCorpus()){var e=[];b.forEach(function(a){Ext.isString(a)?e.push(a):a.term&&e.push(a.term)});e&&(this.setApiParams({docIndex:void 0,
docId:void 0,query:e,mode:this.MODE_CORPUS}),this.isVisible()&&this.loadFromCorpus(this.getCorpus()))}});this.on("corpusTermsClicked",function(a,b){this.getCorpus()&&b[0]&&void 0!==b[0].get("distributions")&&this.loadFromRecords(b)});this.on("activate",function(){this.getCorpus()&&this.loadFromCorpus(this.getCorpus())},this);this.on("ensureCorpusView",function(a,b){this.getApiParam("mode")!=this.MODE_CORPUS&&1<b.getDocumentsCount()&&(this.setApiParam("docId",void 0),this.loadFromCorpus(b))},this)},
loadFromDocument:function(a){if(a.then){var b=this;a.then(function(a){b.loadFromDocument(a)})}else"Voyant.data.model.Document"==Ext.getClassName(a)&&(this.setApiParams({docIndex:void 0,query:void 0,docId:a.getId(),mode:this.MODE_DOCUMENT}),this.isVisible()&&this.loadFromDocumentTerms())},loadFromDocumentTerms:function(a){this.getCorpus()&&(a=a||this.getCorpus().getDocumentTerms({autoLoad:!1}),a.load({callback:function(a,c,d){d?(this.setApiParam("mode","document"),this.loadFromRecords(a)):Voyant.application.showResponseError(this.localize("failedGetDocumentTerms"),
c)},scope:this,params:Ext.apply(this.getApiParams(["limit","stopList","query","docId"]),{withDistributions:!0})}))},loadFromCorpus:function(a){this.setCorpus(a);this.getApiParam("docId")?this.loadFromDocumentTerms():1==a.getDocumentsCount()?this.loadFromDocument(a.getDocument(0)):this.loadFromCorpusTerms(a.getCorpusTerms())},loadFromCorpusTerms:function(a){a.load({callback:function(a,c,d){d?(this.setApiParam("mode",this.MODE_CORPUS),this.loadFromRecords(a)):Voyant.application.showResponseError(this.localize("failedGetCorpusTerms"),
c)},scope:this,params:Ext.apply(this.getApiParams(["limit","stopList","query"])||{},{withDistributions:"relative"})})},loadFromRecords:function(a){var b=this.getApiParam("mode"),c=[],d=["index"],e=[];a.forEach(function(a,b){var g=a.get("term");a.get("distributions").forEach(function(a,d){c[d]||(c[d]={index:d});c[d]["_"+b]=a},this);d.push("_"+b);e.push({type:"line",title:g,xField:"index",yField:"_"+b,style:{lineWidth:2},marker:{radius:3},highlight:!0,smooth:!0,tooltip:{trackMouse:!0,style:"background: #fff",
renderer:function(a,b){this.setHtml("\x3ci\x3e"+b.series.getTitle()+"\x3c/i\x3e: "+a.get(b.series.getYField()))}},listeners:{itemmousedown:function(){debugger;console.warn("not working currently")}}})},this);a=Ext.create("Ext.data.JsonStore",{fields:d,data:c});d.shift();this.buildChart({store:a,series:e,axes:[{type:"numeric",position:"left",title:{text:this.localize(b==this.MODE_DOCUMENT||"rawFreqs"==this.getApiParam("freqsMode")?"rawFrequencies":"relativeFrequencies")}},{type:"category",position:"bottom",
fields:["index"],title:{text:this.localize(b==this.MODE_DOCUMENT?"segments":"documents")},renderer:function(a,c){return b==this.MODE_DOCUMENT?parseInt(a)+1:a}}]})},buildChart:function(a){a.axes.forEach(function(a){Ext.applyIf(a,{style:{opacity:.2},label:{opacity:.5}});Ext.applyIf(a.title,{fontSize:12})});Ext.applyIf(a,{legend:{docked:"top"},interactions:["itemhighlight","panzoom"],innerPadding:{top:5,right:5,bottom:5,left:5},border:!1,bodyBorder:!1,listeners:{itemhighlight:{fn:function(a){this.isLastClickedItem(a)||
(this.deferredHandleClickedItem&&clearTimeout(this.deferredHandleClickedItem),this.deferredHandleClickedItem=Ext.defer(this.handleClickedItem,250,this,arguments))},scope:this}}});this.query("chart").forEach(function(a){this.remove(a)},this);a=Ext.create("Ext.chart.CartesianChart",a);this.add(a)},handleClickedItem:function(a){if(!this.isLastClickedItem(a)){var b=this.getApiParam("mode");b!==this.MODE_DOCUMENT&&b==this.MODE_CORPUS&&this.dispatchEvent("documentIndexTermsClicked",this,[{term:a.series.getTitle(),
docIndex:a.index}]);this.lastClickedItem=a}},isLastClickedItem:function(a){return this.lastClickedItem&&this.lastClickedItem.term==a.term&&this.lastClickedItem.index==a.index}});Ext.define("Voyant.panel.VoyantFooter",{extend:"Ext.container.Container",mixins:["Voyant.panel.Panel"],alias:"widget.voyantfooter",statics:{i18n:{voyantLink:{en:'\x3ca href\x3d"http://docs.voyant-tools.org/" target\x3d"_blank"\x3eVoyant Tools\x3c/a\x3e'},privacy:{en:"Privacy"},privacyMsg:{en:'The developers of Voyant Tools gather data from the site about what tools are invoked and with what parameters (IP addresses are also logged in order to be able to identify multiple requests during a same session). In addition, Voyant Tools uses Google Analytics (see \x26lt;a href\x3d"http://www.google.ca/intl/en/policies/privacy/" target\x3d"_blank"\x26gt;Google\x26apos;s Privacy Policy\x26lt;/a\x26gt; and the \x26lt;em\x26gt;Log Information\x26lt;/em\x26gt; section in particular). Locally logged data and Google Analytics data will be used by the development team in order to debug and improve the tools, as well as to understand how researchers are using them. This data may also be used for research purposes in anonymous and aggregate forms. Please note that texts submitted to Voyant Tools are stored in order to allow persistent access during a work session and between work sessions. If you have questions about the data being collected and how it is being used, or to request that a corpus be removed, please contact \x26lt;a href\x3d"http://stefansinclair.name/contact/"\x26gt;St\u00e9fan Sinclair\x26lt;/a\x26gt;.'}}},
height:18,cls:"x-tab-bar-default voyant-footer",listeners:{boxready:function(a,b,c){c=[a.localize("voyantLink"),", \x3ca href\x3d'http://stefansinclair.name/'\x3eSt\x26eacute;fan Sinclair\x3c/a\x3e \x26amp; \x3ca href\x3d'http://geoffreyrockwell.com'\x3eGeoffrey Rockwell\x3c/a\x3e"," (\x26copy;"+(new Date).getFullYear()+")"," \x3ca href\x3d'http://docs.voyant-tools.org/privacy/' target\x3d'top' data-qtip\x3d'"+a.localize("privacyMsg")+"'\x3e"+a.localize("privacy")+"\x3c/a\x3e"," v. "+Voyant.application.getVersion()+
" ("+Voyant.application.getBuild()+")"];for(var d="",e=0,f,h=a.getEl(),g=0;g<c.length;g++)f=h.getTextWidth(c[g].replace(/<.+?>/g,"")),e+f<b&&(d+=c[g],e+=f);a.update(d)}}});Ext.define("Voyant.panel.VoyantHeader",{extend:"Ext.Panel",mixins:["Voyant.panel.Panel"],alias:"widget.voyantheader",statics:{i18n:{title:{en:"Voyant Tools"}}},constructor:function(){Ext.apply(this,{id:"voyantheader",title:"",layout:"fit",html:'\x3cdiv id\x3d"logo-container"\x3e\x3c/div\x3e',collapseMode:void 0,collapsible:!0,animCollapse:!1,titleCollapse:!1,floatable:!1,header:!0,hideCollapseTool:!0,tools:[],listeners:{collapse:this.onCollapse}});this.callParent(arguments)},onCollapse:function(a){a.setTitle(this.localize("title"))}});Ext.define("Voyant.util.Api",{constructor:function(a){this.api={};Ext.apply(this.api,Ext.ClassManager.getClass(this).api);a=Ext.Object.fromQueryString(document.location.search);for(var b in this.api)b in a&&this.setApiParam(b,a[b])},getApiParam:function(a,b){return void 0!==this.api[a]?this.api[a]:b},getApiParams:function(a,b){if(a){var c={};Ext.isString(a)&&(a=[a]);a.forEach(function(a){var e=this.getApiParam(a);if(b||!Ext.isEmpty(e))c[a]=e},this);return c}return this.api},setApiParams:function(a){for(var b in a)this.setApiParam(b,
a[b])},setApiParam:function(a,b){this.api[a]=b}});Ext.define("Voyant.util.Deferrable",{deferredStack:[],releaseAllDeferred:function(){this.deferredStack=[]},getDeferredCount:function(){return this.deferredStack.length},getDeferred:function(a){var b=jQuery.Deferred(),c=this.getPromiseFromDeferred(b);a&&a.transfer&&a.transfer(a,c);!c.show&&window.show&&(c.show=show);this.deferredStack.push(b);var d=this;c.always(function(){d.deferredStack.pop()});return b},getPromiseFromDeferred:function(a){return"object"===typeof a.promise?a.promise:a.promise()},
getDeferredNestedPromise:function(a,b,c){var d=arguments.callee.caller,e=Voyant.application.getDeferred(c);a.then(function(a){e.resolve(d.apply(a,b))}).fail(function(){e.reject.apply(this,arguments)});return e.promise}});Ext.define("Voyant.util.DetailedError",{extend:"Ext.Error",mixins:["Voyant.util.Localization"],config:{msg:void 0,error:void 0,details:void 0},statics:{i18n:{error:{en:"Error"}}},constructor:function(a){this.setMsg(a.msg);this.setError(a.error);this.setDetails(a.details);this.callParent(arguments)},show:function(a){window.showError?showError.call(this):this.showMsg(a)},showMsg:function(a){a=a||{};Ext.applyIf(a,{message:this.getMsg()+"\x3cp class\x3d'error'\x3e\n"+this.getError()+"\u2026 \x3ca href\x3d'#' onclick\x3d\"window.open('').document.write(unescape('\x3cpre\x3e"+
escape(this.getDetails())+"\x3c/pre\x3e')); return false;\"\x3emore\x3c/a\x3e\x3c/p\x3e",title:this.localize("error"),buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,autoScroll:!0});Ext.Msg.show(a)}});Ext.define("Voyant.util.Localization",{statics:{DEFAULT_LANGUAGE:"en",LANGUAGE:"en"},languageStore:Ext.create("Ext.data.ArrayStore",{fields:["code","language"],data:[["en","English"]]}),getLanguage:function(a){var b=this.languageStore.findRecord(2==a.length?"code":"language",a);if(b)return b.get(2==a.length?"language":"code")},localize:function(a,b){return this._localizeObject(this,a,b)},_localizeObject:function(a,b,c){var d=this._localizeClass(Ext.ClassManager.getClass(a),b,c);if(d)return d;if(a.mixins)for(mixin in a.mixins)if(d=
this._localizeClass(Ext.ClassManager.getClass(a.mixins[mixin]),b,c))return d;return a.superclass&&(d=this._localizeObject(a.superclass,b,c))?d:"["+b+"]"},_localizeClass:function(a,b,c){if(a.i18n&&a.i18n[b]){var d=!1;a.i18n[b][Voyant.util.Localization.LANGUAGE]?d=a.i18n[b][Voyant.util.Localization.LANGUAGE]:a.i18n[b][Voyant.util.Localization.DEFAULT_LANGUAGE]&&(d=a.i18n[b][Voyant.util.Localization.DEFAULT_LANGUAGE]);return d?d.isTemplate?d.apply(c):d:"["+b+"]"}return!1}});Ext.define("Voyant.util.QuerySearchField",{extend:"Ext.form.field.Text",mixins:["Voyant.util.Localization"],alias:"widget.querysearchfield",statics:{i18n:{querySearch:{en:"Search"},querySearchTip:{en:"\x3cul\x3e\x3cli\x3e\x3cb\x3ecoat\x3c/b\x3e: match exact term \x3ci\x3ecoat\x3c/i\x3e\x3c/li\x3e\x3cli\x3e\x3cb\x3ecoat*\x3c/b\x3e: match terms that start with \x3ci\x3ecoat\x3c/i\x3e as one term\x3c/li\x3e\x3cli\x3e\x3cb\x3e^coat*\x3c/b\x3e: match terms that start with \x3ci\x3ecoat\x3c/i\x3e as separate terms (coat, coats, etc.)\x3c/li\x3e\x3cli\x3e\x3cb\x3ecoat,jacket\x3c/b\x3e: match each term separated by commas as separate terms\x3c/li\x3e\x3cli\x3e\x3cb\x3ecoat|jacket\x3c/b\x3e: match terms separate by pipe as a single term\x3c/li\x3e\x3cli\x3e\x3cb\x3e\x26quot;winter coat\x26quot;\x3c/b\x3e: \x3ci\x3ewinter coat\x3c/i\x3e as a phrase\x3c/li\x3e\x3cli\x3e\x3cb\x3e\x26quot;coat mittens\x26quot;~5\x3c/b\x3e: \x3ci\x3ecoat\x3c/i\x3e near \x3ci\x3emittens\x3c/i\x3e (within 5 words)\x3c/li\x3e\x3cli\x3e\x3cb\x3e^coat*,jacket|parka,\x26quot;coat mittens\x26quot;~5\x3c/b\x3e: combine syntaxes\x3c/li\x3e\x3c/ul\x3e"}}},
triggers:{clear:{weight:0,cls:Ext.baseCSSPrefix+"form-clear-trigger",hidden:!0,handler:"onClearClick",scope:"this"},search:{weight:1,cls:Ext.baseCSSPrefix+"form-search-trigger",handler:"onSearchClick",scope:"this"}},initComponent:function(){var a=this;Ext.apply(a,{listeners:{render:function(a){Ext.QuickTips.register({target:a.triggers.search.getEl(),text:a.localize("querySearchTip"),enabled:!0,showDelay:20,trackMouse:!0,autoShow:!0})},scope:a},labelWidth:50,fieldLabel:a.localize("querySearch"),width:"autoSize"});
a.callParent(arguments);a.on("specialkey",function(b,c){if(c.getKey()==c.ENTER)a.onSearchClick()})},onClearClick:function(){this.setValue("");this.findParentByType("panel").fireEvent("query",this,void 0);this.getTrigger("clear").hide();this.updateLayout()},onSearchClick:function(){var a=this.getValue();this.findParentByType("panel").fireEvent("query",this,a);a?this.getTrigger("clear").show():this.getTrigger("clear").hide();this.updateLayout()}});Ext.define("Voyant.util.ResponseError",{extend:"Voyant.util.DetailedError",config:{response:void 0},constructor:function(a){debugger;this.setResponse(a.response);Ext.applyIf(a,{msg:a.response.statusText,error:a.response.responseText.split(/(\r\n|\r|\n)/).shift(),details:a.response.responseText});this.callParent(arguments)}});Ext.define("Voyant.util.SparkLine",{getSparkLine:function(a,b){if(2>a.length)return"";for(var c=Number.MAX_VALUE,d=Number.MIN_VALUE,e=!1,f=0;f<a.length;f++)a[f]<c&&(c=a[f]),a[f]>d&&(d=a[f]),!e&&-1<a[f].toString().indexOf(".")&&(e=!0);var h=(d-c).toString(),g=1,g=1,l=[];if(e){g=100;for(f=h.indexOf(".")+1;f<h.length;f++)if("0"==h.charAt(f))g*=10;else break;for(f=0;f<a.length;f++)l[f]=parseInt(a[f]*g);d=parseInt(d*g);c=parseInt(c*g)}else{g=1;for(f=h.length-1;-1<f;f--)if("0"==h.charAt(f))g*=10;else break;
if(1!=g){for(f=0;f<a.length;f++)l[f]=a[f]/g;d/=g;c/=g}else l=a}var e=Math.floor(1800/((d.toString().length>c.toString().length?d.toString().length:c.toString().length)+1)),c="http://chart.apis.google.com/chart?cht\x3dls\x26amp;chco\x3d0077CC\x26amp;chls\x3d1,0,0\x26amp;chds\x3d"+c+","+d,d=Math.ceil(a.length/e),h=0,g="",m;m=5>a.length?5:10>a.length?4:20>a.length?3:50>a.length?2:1;for(f=0;f<d;f++){var k=l.slice(h,h+=e),g=g+("\x3cimg style\x3d'margin: 0; padding: 0;' border\x3d'0' src\x3d'"+c+"\x26amp;chs\x3d"+
m*k.length+"x15\x26amp;chd\x3dt:"+k.join(",")+"' alt\x3d'' class\x3d'chart-");1==d?g+="full":0<f&&f+1<d?g+"middle":g=0==f?g+"left":g+"right";g+="' /\x3e"}return g}});Ext.define("Voyant.util.Transferable",{transferable:["transfer"],transfer:function(a,b){if(a.transferable)for(var c=0;c<a.transferable.length;c++){var d=a.transferable[c];b[d]=Ext.bind(a[d],b)}if(a.mixins)for(mixin in a.mixins)this.transfer(a.mixins[mixin],b)}});Ext.define("Voyant.util.Variants",{extend:"Ext.Base",constructor:function(a){this.variants=a;this.map={};this.variants.forEach(function(a,c){a.forEach(function(a){this.map[a]=c},this)},this)},getVariants:function(a){var b=[];Ext.isString(a)&&(a=[a]);Ext.isArray(a)&&a.forEach(function(a){void 0!=this.map[a]&&b.push.apply(b,this.variants[this.map[a]])},this);return b}});Ext.define("Voyant.VoyantApp",{extend:"Ext.app.Application",mixins:["Voyant.util.Deferrable","Voyant.util.Localization"],requires:["Voyant.util.ResponseError"],name:"VoyantApp",statics:{i18n:{error:{en:"Error"},serverResponseError:{en:"The server error reponse:"}}},config:{baseUrl:void 0,tromboneUrl:void 0},constructor:function(a){this.setBaseUrl(this.config.baseUrl);this.setTromboneUrl(this.config.baseUrl+"trombone");Voyant.application=this;this.callParent(arguments)},getTools:function(){return[{type:"maximize"},
{type:"help"}]},launch:function(){this.callParent(arguments);var a=Ext.Object.fromQueryString(document.location.search);if(!a||!a.debug||"true"!=a.debug){var b=this.getViewport();b.mask();Ext.create("Ext.window.Window",{title:"Voyant Tools 2.0 Preview Release",width:825,layout:"fit",modal:!0,layout:"vbox",items:[{width:800,margin:"10 5 3 10",html:"\x3ch2 style\x3d'text-align: center;'\x3eWelcome to this Preview Release of Voyant Tools 2.0!\x3c/h2\x3e\x3cp\x3eWe've tried to make things usable in order to give a glimpse of what's to come, but this is an early preview release with lots of missing goodies and a whole bunch of bugs. Please kick the tires and let us know if you have suggestions on \x3ca href\x3d'https://github.com/sgsinclair/Voyant/issues'\x3eGithub\x3c/a\x3e or \x3ca href\x3d'http://twitter.com/voyanttools'\x3eTwitter\x3c/a\x3e.\x3cul\x3e\x3cli\x3esome new features and functionality:\x3cul\x3e\x3cli\x3eflexible search (wildcards, phrases, proximity) \u2013 hover over search boxes for more details\x3c/li\x3e\x3cli\x3ebetter cross-platform and device support (all tools in HTML5, no Flash or Java Applets)\x3c/li\x3e\x3cli\x3emuch better support for larger corpora\x3c/li\x3e\x3cli\x3evastly improved performance throughout (corpus creation and tools)\x3c/li\x3e\x3c/ul\x3e\x3cli\x3esome things not yet fully implemented:\x3cul\x3e\x3cli\x3efull list of tools and skins from 1.0\x3c/li\x3e\x3cli\x3epanel/tool-level help, options, and exporting\x3c/li\x3e\x3cli\x3eadding and reordering documents (new in 2.0)\x3c/li\x3e\x3cli\x3eN-Gram support (term sequences) (new in 2.0)\x3c/li\x3e\x3cli\x3epart-of-speech tagging and lemmatization (new in 2.0)\x3c/li\x3e\x3c/ul\x3e\x3c/li\x3e\x3c/ul\x3e\x3cp\x3eIt's best to assume that this preview release may be incompatible with future releases and that any stored corpora will no longer be available after your session. Of course, you can keep using \x3ca href\x3d'http://voyant-tools.org'\x3eVoyant Tools 1.0\x3c/a\x3e if you want persistence (normal persistence will be avilable with the full release of Voyant Tools 2.0). Have fun and please give us your \x3ca href\x3d'http://twitter.com/voyanttools'\x3efeeback\x3c/a\x3e!\x3c/p\x3e"},
{xtype:"button",glyph:"xf00c@FontAwesome",width:"100%",scale:"medium",text:"Continue",handler:function(a){a.up("window").close()}}],listeners:{close:function(a){b.unmask()}}}).show()}},tromboneCall:function(a){a=a?a:{};Ext.applyIf(a,{url:this.getTromboneUrl()});a.success||a.failure||a.callback||Ext.applyIf(a,{url:this.getTromboneUrl(),scope:this,callback:function(b,c,d){this.dispatchEvent(a.tool+"Loaded",b,c,d)}});Ext.Ajax.request(a)},getViewport:function(){return Ext.ComponentQuery.query("viewport")[0]},
dispatchEvent:function(a){var b=this.getViewport().query("panel,chart"),c=!1;this.hasListener&&this.hasListener(a)&&(this.fireEvent.apply(this,arguments),c=!0);for(var d=0;d<b.length;d++)b[d].hasListener&&b[d].hasListener(a)&&(c=!0,b[d].fireEvent.apply(b[d],arguments));console&&console.info("Unhandled event: "+a,arguments);c||console&&console.info("Unhandled event: "+a,arguments)},showResponseError:function(a,b){this.showError(Ext.create("Voyant.util.ResponseError",{msg:Ext.isString(a)?a:a.msg,response:b}))},
showError:function(a){if(a instanceof Voyant.util.ResponseError){var b=a.getResponse();Ext.apply(a,{message:a.getMsg()+" "+this.localize("serverResponseError")+"\x3cpre class\x3d'error'\x3e\n"+b.responseText.substring(0,b.responseText.indexOf("\n\t"))+"\u2026 \x3ca href\x3d'#' onclick\x3d\"window.open('').document.write(unescape('\x3cpre\x3e"+escape(b.responseText)+"\x3c/pre\x3e')); return false;\"\x3emore\x3c/a\x3e\x3c/pre\x3e"})}Ext.applyIf(a,{title:this.localize("error"),buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,
autoScroll:!0});Ext.Msg.show(a)}});Ext.define("Voyant.VoyantCorpusApp",{extend:"Voyant.VoyantApp",name:"VoyantCorpusApp",requires:["Voyant.data.model.Corpus"],statics:{i18n:{fetchingCorpus:{en:"Fetching your corpus\u2026"}}},launch:function(){this.callParent(arguments);var a=Ext.Object.fromQueryString(document.location.search);if(a.corpus||a.input){var b=this,c=b.getViewport();c.mask(this.localize("fetchingCorpus"));(new Corpus(a)).then(function(a){c.unmask();b.dispatchEvent("loadedCorpus",this,a)}).fail(function(a,e){c.unmask();b.showErrorResponse({message:a},
e)})}}});Ext.define("Voyant.panel.DocumentClusters",{extend:"Ext.panel.Panel",alias:"widget.documentclusters",title:"Document Clusters"});Ext.define("Voyant.panel.RezoViz",{extend:"Ext.panel.Panel",alias:"widget.rezoviz",title:"RezoViz"});
Ext.define("Voyant.VoyantCorpusToolsetApp",{extend:"Voyant.VoyantCorpusApp",requires:["Voyant.panel.Contexts","Voyant.panel.CollocatesGraph","Voyant.panel.Trends"],name:"VoyantCorpusToolsetApp",launch:function(){Ext.create("Ext.container.Viewport",{layout:"border",items:[{region:"south",xtype:"voyantfooter"},{xtype:"tabpanel",region:"center",split:!0,items:[{xtype:"cirrus",collapsible:!0},{xtype:"corpusterms",collapsible:!0},{xtype:"documents",collapsible:!0},{xtype:"rezoviz",collapsible:!0},{xtype:"trends",
collapsible:!0},{xtype:"documentclusters",collapsible:!0}],flex:6}]});this.callParent(arguments)}});Ext.define("Voyant.VoyantDefaultApp",{extend:"Voyant.VoyantCorpusApp",requires:"Voyant.panel.VoyantHeader Voyant.panel.VoyantFooter Voyant.panel.CorpusCreator Voyant.panel.Cirrus Voyant.panel.Summary Voyant.panel.CorpusTerms Voyant.panel.Reader Voyant.panel.Documents Voyant.panel.Trends Voyant.panel.Contexts Voyant.panel.DocumentTerms Voyant.panel.CorpusCollocates Voyant.panel.CollocatesGraph".split(" "),name:"VoyantDefaultApp",config:{toolsContainerMainEastSouthTabpanelInitialCollapsed:!0},listeners:{loadedCorpus:function(a,
b){this.viewport.down("voyantheader").collapse();this.viewport.down("#toolsContainer").setActiveItem(1);if(window.history.pushState){var c=b.getId(),d=Ext.Object.fromQueryString(document.location.search),e=this.getBaseUrl()+"?corpus\x3d"+c,f;for(f in d)"corpus"!==f&&(e+="\x26"+f+"\x3d"+d[f]);window.history.pushState({corpus:c},"Corpus: "+c,e)}},termsClicked:function(a,b){0<b.length&&b[0].docIndex&&this.getToolsContainerMainEastSouthTabpanelInitialCollapsed()&&(this.viewport.getComponent("toolsContainer").getComponent("toolsContainer-main").getComponent("toolsContainer-main-east").getComponent("toolsContainer-main-east-south-tabpanel").expand(),
this.setToolsContainerMainEastSouthTabpanelInitialCollapsed(!1))}},launch:function(){this.viewport=Ext.create("Ext.container.Viewport",{layout:"border",items:[{xtype:"voyantheader",region:"north"},{region:"south",xtype:"voyantfooter"},{region:"center",layout:"card",itemId:"toolsContainer",activeItem:0,items:[{xtype:"container",layout:{type:"hbox",pack:"center"},items:{xtype:"corpuscreator"}},{layout:"border",itemId:"toolsContainer-main",items:[{region:"center",flex:1,xtype:"reader"},{region:"west",
flex:1,layout:"border",split:{size:5},items:[{xtype:"tabpanel",region:"center",items:[{xtype:"cirrus",collapsible:!0},{xtype:"corpusterms",collapsible:!0}],flex:6},{xtype:"tabpanel",region:"south",split:{size:5},items:[{xtype:"summary",collapsible:!0},{xtype:"documents",collapsible:!0}],flex:4}]},{region:"east",itemId:"toolsContainer-main-east",split:{size:5},flex:1,layout:"border",items:[{xtype:"tabpanel",region:"center",flex:5,items:[{xtype:"trends",collapsible:!0},{xtype:"documentterms",collapsible:!0},
{xtype:"corpuscollocates",collapsible:!0}]},{xtype:"tabpanel",region:"south",collapsed:!0,itemId:"toolsContainer-main-east-south-tabpanel",split:{size:5},flex:5,items:[{xtype:"contexts",split:!0,flex:5,collapsible:!0},{xtype:"collocatesgraph",split:!0,flex:5,collapsible:!0}]}]}]}]}]});this.callParent(arguments)}});Ext.define("Voyant.panel.MoreLikeThis",{extend:"Ext.panel.Panel",alias:"widget.morelikethis",title:"More Like this"});
Ext.define("Voyant.VoyantDocumentToolsetApp",{extend:"Voyant.VoyantCorpusApp",requires:["Voyant.panel.Contexts","Voyant.panel.CollocatesGraph","Voyant.panel.Trends"],name:"VoyantDocumentToolsetApp",launch:function(){Ext.create("Ext.container.Viewport",{layout:"border",items:[{region:"south",xtype:"voyantfooter"},{xtype:"tabpanel",region:"center",split:!0,items:[{xtype:"cirrus",collapsible:!0},{xtype:"documentterms",collapsible:!0},{xtype:"contexts",collapsible:!0},{xtype:"collocatesgraph",collapsible:!0},
{xtype:"trends",collapsible:!0},{xtype:"morelikethis",collapsible:!0}],flex:6}]});this.callParent(arguments)}});Ext.define("Voyant.VoyantNotebookApp",{extend:"Voyant.VoyantApp",requires:["Voyant.panel.VoyantFooter","Voyant.notebook.Notebook","Voyant.data.model.Corpus","Voyant.notebook.util.Show"],name:"VoyantNotebookApp",launch:function(){Ext.create("Ext.container.Viewport",{layout:"border",items:[{xtype:"notebook",region:"center"},{xtype:"voyantfooter",region:"south"}]});this.callParent(arguments)}});Ext.define("Voyant.VoyantToolApp",{extend:"Voyant.VoyantCorpusApp",name:"VoyantToolApp",launch:function(){Ext.create("Ext.container.Viewport",{layout:"border",items:[{region:"south",xtype:"voyantfooter"},{region:"center",xtype:this.getTool()}]});this.callParent(arguments)}});